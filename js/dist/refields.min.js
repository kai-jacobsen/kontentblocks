/*! Kontentblocks ProdVersion 2014-03-27 09:03 */
function initFlicker(a){jQuery(".flicker",jQuery(a)).flicker({arrows:!0,auto_flick:!1,auto_flick_delay:10,dot_navigation:!0,block_text:!1,flick_animation:"transition-slide",theme:"light"})}var KB=KB||{};KB.Fields.register("Color",function(a){return{init:function(){a("body").on("mouseup",".kb-field--color",function(){setTimeout(function(){KB.FrontendEditModal&&KB.FrontendEditModal.recalibrate()},150)}),a(".kb-color-picker").wpColorPicker({change:function(){},clear:function(){pickColor("")}})},update:function(){this.init()}}}(jQuery));var KB=KB||{};KB.Fields.register("Date",function(a){var b={};return{defaults:{format:"d M Y",offset:[0,250],onSelect:function(b,c,d){a(activeField).find(".kb-date-machine-format").val(c),a(activeField).find(".kb-date-unix-format").val(Math.round(d.getTime()/1e3))}},init:function(){var c=this;_.each(a(".kb-datepicker"),function(d){var e=a(d).closest(".kb-field-wrapper").attr("id");e&&(b=KB.FieldConfig[e]||{}),a(d).Zebra_DatePicker(_.extend(c.defaults,b))})},update:function(){this.init()}}}(jQuery));var KB=KB||{};KB.Fields.register("File",function(a){var b,c;return b={selector:".kb-js-add-file",remove:".kb-js-reset-file",container:null,init:function(){var b=this;a("body").on("click",this.selector,function(c){c.preventDefault(),b.container=a(".kb-field-file-wrapper",activeField),b.frame().open()}),a("body").on("click",this.remove,function(c){c.preventDefault(),b.container=a(".kb-field-file-wrapper",activeField),b.resetFields()})},frame:function(){return this._frame?this._frame:(this._frame=wp.media({title:KB.i18n.Refields.file.modalTitle,button:{text:KB.i18n.Refields.common.select},multiple:!1,library:{type:"application"}}),this._frame.on("ready",this.ready),this._frame.state("library").on("select",this.select),this._frame)},ready:function(){a(".media-modal").addClass(" smaller no-sidebar")},select:function(){c=this.get("selection").first(),b.handleAttachment(c)},handleAttachment:function(b){a(".kb-file-filename",this.container).html(b.get("filename")),a(".kb-file-attachment-id",this.container).val(b.get("id")),a(".kb-file-title",this.container).html(b.get("title")),a(".kb-file-id",this.container).html(b.get("id")),a(".kb-file-editLink",this.container).attr("href",b.get("editLink")),a(this.remove,activeField).show(),this.container.show(750)},resetFields:function(){a(".kb-file-attachment-id",this.container).val(""),this.container.hide(750),a(this.remove,activeField).hide()},update:function(){this.init()}}}(jQuery));var KB=KB||{};KB.Fields.register("Image",function(a){"use strict";var b;return b={selector:".kb-js-add-image",reset:".kb-js-reset-image",_frame:null,$container:null,$wrapper:null,$id:null,$title:null,$caption:null,init:function(){var b=this;a("body").on("click",this.selector,function(c){c.preventDefault(),b.settings=b.getSettings(this),b.$container=a(".kb-field-image-container",activeField),b.$wrapper=a(".kb-field-image-wrapper",activeField),b.$id=a(".kb-js-image-id",b.$wrapper),b.$title=a(".kb-js-image-title",b.$wrapper),b.$caption=a(".kb-js-image-caption",b.$wrapper),b.openModal()})},getSettings:function(b){var c=a(b).closest(".kb-field-wrapper"),d=c.attr("id");return KB.payload.Fields&&KB.payload.Fields[d]?KB.payload.Fields[d]:void 0},frame:function(){return this._frame?this._frame:void 0},openModal:function(){return this._frame?(this._frame.open(),void 0):(this._frame=wp.media({title:KB.i18n.Refields.image.modalTitle,button:{text:KB.i18n.Refields.common.select},multiple:!1,library:{type:"image"}}),this._frame.state("library").on("select",this.select),this._frame.open(),this._frame)},select:function(){var a=this.get("selection").first();b.handleAttachment(a)},handleAttachment:function(b){var c,d=this;this.settings&&this.settings.previewSize?(c={width:this.settings.previewSize[0],height:this.settings.previewSize[1],crop:!0,upscale:!1},jQuery.ajax({url:ajaxurl,data:{action:"fieldGetImage",args:c,id:b.get("id"),_ajax_nonce:kontentblocks.nonces.get},type:"GET",dataType:"json",success:function(a){d.$container.html('<img src="'+a+'" >')},error:function(){}})):this.$container.html('<img src="'+b.get("sizes").thumbnail.url+'" >'),this.$id.val(b.get("id")),this.$title.val(b.get("title")),this.$caption.val(b.get("caption")),a(document).trigger("KB:osUpdate")},update:function(){this.init()}}}(jQuery));var KB=KB||{};KB.MultipleImageText=function(a){this.view=a,this.view.on("kb:frontend::viewLoaded",_.bind(this.viewLoaded,this)),this.view.on("kb:backend::viewUpdated",this.listen),this.view.on("kb:frontend::viewUpdated",_.bind(this.listen,this)),this.view.on("kb:viewAdded",_.bind(this.preInit,this))},_.extend(KB.MultipleImageText.prototype,{preInit:function(){_K.log("MultipleImageText preInit called"),$=jQuery,this.defaults={content:"",imgid:null,imgsrc:null,label:""},this.elCount=0,this.$wrapper=$(".kb-field--wrap",this.view.$el),this.$list=$(".kb-generic--list",this.$wrapper),this.$parentEl=this.view.$el,this.selector=".kb-js--generic-create-item",this.template=$(".template",this.$wrapper).html(),this.instance_id=this.view.model.get("instance_id"),this.init()},init:function(){var a=this;this.$list.on("mouseover",".kb-generic--list-item",function(){a.$currentItem=jQuery(this)}),this.$wrapper.on("click",this.selector,function(){a.addItem()}),this.$wrapper.on("click",".kb-js-generic-toggle",function(){jQuery(this).not("input").next().slideToggle(350,function(){KB.FrontendEditModal&&KB.FrontendEditModal.recalibrate()})}),this.$wrapper.on("click",".kb-js-add-custom",function(){a.$imgid=$(".kb-js-generic--imgid",a.$currentItem),a.$imgwrap=$(".kb-generic--image-wrapper",a.$currentItem),a.modal?a.modal.open():a.modal=KB.Utils.MediaWorkflow({select:_.bind(a.select,a),buttontext:"Insert",title:"Insert or upload an image"})}),this.$wrapper.on("click",".kb-js-generic--delete",function(a){$(a.currentTarget).closest(".kb-generic--list-item").hide(150).remove()}),this.initialSetup()},initialSetup:function(){var a=this,b=this.view.model.get("instance_id");if(!KB.payload.fieldData)return!1;var c=KB.payload.fieldData["mltpl-image-text"]?KB.payload.fieldData["mltpl-image-text"][b]:[];_.each(c,function(b){a.addItem(b)}),$(".kb-generic--list").sortable({handle:".kb-js-generic--move",stop:function(){KB.TinyMCE.restoreEditors()},start:function(){KB.TinyMCE.removeEditors()}})},addItem:function(a,b){var c=a||_.extend(this.defaults,this.view.model.get("moduleData"));this.count=b||jQuery(".kb-generic--list-item",this.$list).length,this.$list.append(_.template(this.template,_.extend({base:this.instance_id,counter:this.count},c)));var d=jQuery(".kb-generic--list-item",this.$list).last().find(".kb-remote-editor"),e=d.attr("data-name");KB.TinyMCE.remoteGetEditor(d,e,d.html(),this.view.model.get("post_id"),!1),jQuery(".kb-generic-tabs").tabs()},viewLoaded:function(a){a&&(this.view=a),this.preInit(),KB.FrontendEditModal.recalibrate()},select:function(a){var b=a.get("selection").first(),c=b.get("sizes").large;this.$imgid.val(b.get("id")),this.$imgwrap.empty().append('<img src="'+c.url+'" >')},listen:function(){$(document).foundation("orbit"),$(window).trigger("resize"),initFlicker(this.view.parentView.el)}}),function(){return{init:function(){(!KB.appData||KB.appData.config.loggedIn)&&(KB.on("kb:Module_MultipleImageText:added",function(a){a.MIT=new KB.MultipleImageText(a),a.MIT.preInit.call(a.MIT)}),KB.on("kb:Module_MultipleImageText:loaded",function(a){a.MIT=new KB.MultipleImageText(a),a.MIT.preInit.call(a.MIT)}),KB.on("kb:Module_MultipleImageText:loadedOnFront",function(a){a.MIT=new KB.MultipleImageText(a)}))}}}(jQuery).init(),jQuery(document).ready(function(){KB.appData&&KB.appData.config.frontend&&initFlicker("body")});