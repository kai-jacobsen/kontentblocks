/*! Kontentblocks ProdVersion 2015-05-31 04:05 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){b.exports=Backbone.View.extend({rerender:function(){this.render()}})},{}],2:[function(a,b,c){var d={};_.extend(d,Backbone.Events),_.extend(d,{fields:{},addEvent:function(){this.listenTo(KB,"kb:ready",this.init),this.listenTo(this,"newModule",this.newModule)},register:function(a,b){_.extend(b,Backbone.Events),this.fields[a]=b},registerObject:function(a,b){_.extend(b,Backbone.Events),this.fields[a]=b},init:function(){var a=this;_.each(this.fields,function(b){b.hasOwnProperty("init")&&b.init.call(b),b.listenTo(a,"update",b.update),b.listenTo(a,"frontUpdate",b.frontUpdate)})},newModule:function(a){var b=this;a.listenTo(this,"update",a.update),a.listenTo(this,"frontUpdate",a.frontUpdate),setTimeout(function(){b.trigger("update")},750)},get:function(a){return this.fields[a]?this.fields[a]:null}}),d.addEvent(),b.exports=d},{}],3:[function(a,b,c){KB.Fields=a("./Fields"),a("./controls/color.js"),a("./controls/date.js"),a("./controls/datetime.js"),a("./controls/file.js"),a("./controls/flexfields.js"),a("./controls/gallery.js"),a("./controls/image.js"),a("./controls/link.js")},{"./Fields":2,"./controls/color.js":4,"./controls/date.js":5,"./controls/datetime.js":6,"./controls/file.js":7,"./controls/flexfields.js":8,"./controls/gallery.js":9,"./controls/image.js":10,"./controls/link.js":11}],4:[function(a,b,c){var d=a("../FieldBaseView");KB.Fields.registerObject("color",d.extend({initialize:function(){console.log("test"),this.render()},events:{"mouseup .kb-field--color":"recalibrate"},render:function(){this.$(".kb-color-picker").wpColorPicker({}),jQuery("body").on("click.wpcolorpicker",this.update)},derender:function(){jQuery("body").off("click.wpcolorpicker",this.update)},update:function(){KB.Events.trigger("modal.preview")},recalibrate:function(){_.delay(function(){KB.Events.trigger("modal.recalibrate")},150)}}))},{"../FieldBaseView":1}],5:[function(a,b,c){var d=a("../FieldBaseView");KB.Fields.registerObject("date",d.extend({initialize:function(){var a=this;this.defaults={format:"d M Y",offset:[0,250],onSelect:function(b,c,d,e){a.$machineIn.val(c),a.$unixIn.val(Math.round(d.getTime()/1e3))}},this.settings=this.model.get("options")||{},this.render()},render:function(){this.$machineIn=this.$(".kb-date-machine-format"),this.$unixIn=this.$(".kb-date-unix-format"),this.$(".kb-datepicker").Zebra_DatePicker(_.extend(this.defaults,this.settings))},derender:function(){}}))},{"../FieldBaseView":1}],6:[function(a,b,c){var d=a("../FieldBaseView");KB.Fields.registerObject("datetime",d.extend({initialize:function(){var a=this;this.defaults={format:"d.m.Y H:i",inline:!1,mask:!0,lang:"de",allowBlank:!0,onChangeDateTime:function(b,c){a.$unixIn.val(b.dateFormat("unixtime")),a.$sqlIn.val(b.dateFormat("Y-m-d H:i:s"))}},this.setting=this.model.get("settings")||{},this.render()},render:function(){this.$unixIn=this.$(".kb-datetimepicker--js-unix"),this.$sqlIn=this.$(".kb-datetimepicker--js-sql"),this.$(".kb-datetimepicker").datetimepicker(_.extend(this.defaults,this.settings))},derender:function(){this.$(".kb-datetimepicker").datetimepicker("destroy")}}))},{"../FieldBaseView":1}],7:[function(a,b,c){var d=a("../FieldBaseView");KB.Fields.registerObject("file",d.extend({initialize:function(){this.render()},events:{"click .kb-js-add-file":"openFrame","click .kb-js-reset-file":"reset"},render:function(){this.$container=this.$(".kb-field-file-wrapper"),this.$IdIn=this.$(".kb-file-attachment-id"),this.$resetIn=this.$(".kb-js-reset-file")},derender:function(){this.frame&&(this.frame.dispose(),this.frame=null)},openFrame:function(){var a=this;return this.frame?this.frame.open():(this.frame=wp.media({title:KB.i18n.Refields.file.modalTitle,button:{text:KB.i18n.Refields.common.select},multiple:!1,library:{type:""}}),this.frame.on("ready",function(){a.ready(this)}),this.frame.state("library").on("select",function(){a.select(this)}),this.frame.open())},ready:function(a){this.$(".media-modal").addClass(" smaller no-sidebar")},select:function(a){var b=a.get("selection").first();this.handleAttachment(b)},handleAttachment:function(a){this.$(".kb-file-filename",this.$container).html(a.get("filename")),this.$(".kb-file-attachment-id",this.$container).val(a.get("id")),this.$(".kb-file-title",this.$container).html(a.get("title")),this.$(".kb-file-id",this.$container).html(a.get("id")),this.$(".kb-file-editLink",this.$container).attr("href",a.get("editLink")),this.$resetIn.show(),this.$container.show(450,function(){KB.Events.trigger("modal.recalibrate")})},reset:function(){this.$IdIn.val(""),this.$container.hide(450),this.$resetIn.hide()}}))},{"../FieldBaseView":1}],8:[function(a,b,c){var d=a("../FieldBaseView");KB.Fields.registerObject("flexfields",d.extend({initialize:function(){this.render()},render:function(){this.$stage=this.$(".flexible-fields--stage"),this.createController()},derender:function(){this.FlexFieldsController.dispose()},rerender:function(){this.derender(),this.render()},createController:function(){return this.FlexFieldsController?(this.FlexFieldsController.setElement(this.$stage.get(0)),this.FlexFieldsController.render()):this.FlexFieldsController=new KB.FlexibleFields.Controller({el:this.$stage.get(0),model:this.model})}})),KB.FlexibleFields={},KB.FlexibleFields.ItemView=Backbone.View.extend({tagName:"li",className:"kb-flexible-fields--item-wrapper",initialize:function(a){this.Controller=a.Controller,this.listenTo(this.Controller,"dispose",this.dispose)},events:{"click .flexible-fields--js-toggle":"toggleItem","click .flexible-fields--js-trash":"deleteItem"},toggleItem:function(){this.$(".flexible-fields--toggle-title").next().slideToggle(250,function(){KB.Events.trigger("modal.recalibrate")})},deleteItem:function(){this.$el.hide(250);var a=this.createInputName(this.model.get("_tab").uid);this.$el.append('<input type="hidden" name="'+a+'[delete]" value="'+this.model.get("_tab").uid+'" >'),KB.Notice.notice("Please click update to save the changes","success")},render:function(){var a=this.createInputName(this.model.get("_tab").uid),b=this.model.toJSON(),c=this.$el.append(KB.Templates.render("fields/FlexibleFields/single-item",{item:b,inputName:a,uid:this.model.get("_tab").uid}));return this.renderTabs(c),c},renderTabs:function(a){var b=this,c=HandlebarsKB.compile("<li><a href='#tab-{{ uid }}-{{ index }}'>{{ tab.label }}</a></li>"),d=HandlebarsKB.compile("<div id='tab-{{ uid }}-{{ index }}'></div>");_.each(this.Controller.Tabs,function(e,f){jQuery(".flexible-field--tab-nav",a).append(c({uid:b.model.get("_tab").uid,tab:e,index:f}));var g=jQuery(".kb-field--tabs",a),h=jQuery(d({uid:b.model.get("_tab").uid,index:f})).appendTo(g);b.renderFields(e,h)})},renderFields:function(a,b){var c,d,e=this;_.each(a.fields,function(a){a.model.set("index",e.model.get("_tab").uid),c=KB.FieldsAPI.get(a),d=e.model.get("value"),_.isUndefined(d)||c.setValue(d.get(a.model.get("primeKey"))),b.append(c.render(e.uid)),b.append('<input type="hidden" name="'+c.model.get("baseId")+"["+c.model.get("index")+"][_mapping]["+c.model.get("primeKey")+']" value="'+c.model.get("type")+'" >'),c.$container=b,c.postRender&&c.postRender.call(c),setTimeout(function(){if(e.Controller.model.FieldView){e.Controller.model.FieldView.model.collection.add(c.model.toJSON())}},150)})},createInputName:function(a){return this.createBaseId()+"["+this.Controller.model.get("fieldkey")+"]["+a+"]"},createBaseId:function(){return _.isEmpty(this.Controller.model.get("arrayKey"))?this.Controller.model.get("fieldId"):this.Controller.model.get("fieldId")+"["+this.Controller.model.get("arrayKey")+"]"},dispose:function(){this.stopListening(),this.remove()}}),KB.FlexibleFields.Controller=Backbone.View.extend({initialize:function(){this.Tabs=this.setupConfig(),this.subviews=[],this.setupElements(),this.initialSetup()},events:{"click .kb-flexible-fields--js-add-item":"addItem"},initialSetup:function(){var a,b=this;a=this.model.get("value"),_.isEmpty(a)||_.each(a,function(a,c){var d=new KB.FlexibleFields.ItemView({Controller:b,model:new Backbone.Model({_tab:{title:a._tab.title,uid:c},value:new Backbone.Model(a)})});b.subviews.push(d),b.$list.append(d.render())}),KB.Ui.initTabs(),this.$list.sortable({handle:".flexible-fields--js-drag-handle",start:function(){KB.TinyMCE.removeEditors()},stop:function(){KB.TinyMCE.restoreEditors()}}),KB.Events.trigger("modal.recalibrate"),this._initialized=!0},render:function(){this.setupElements(),this.initialSetup()},setupConfig:function(){var a=this;return _.each(this.model.get("config"),function(b){b.fields&&(b.fields=a.setupFields(b.fields))}),this.model.get("config")},setupFields:function(a){var b=this;return _.each(a,function(c,d){c.baseId=b.model.get("baseId"),c.ModuleModel=b.model.get("ModuleModel"),c.fieldId=b.model.get("fieldId"),c.fieldKey=b.model.get("fieldkey"),c.arrayKey=b.model.get("arrayKey"),c.index=null,c.primeKey=d,a[d]=new Backbone.View({Controller:b,el:b.el,model:new Backbone.Model(c)})}),a},setupElements:function(){this.$list=jQuery('<ul class="flexible-fields--item-list"></ul>').appendTo(this.$el),this.$addButton=jQuery('<a class="button button-primary kb-flexible-fields--js-add-item">Add Item</a>').appendTo(this.$el)},addItem:function(){var a=new KB.FlexibleFields.ItemView({Controller:this,model:new Backbone.Model({_tab:{title:_.uniqueId("ff"),uid:_.uniqueId("ff")}})});this.subviews.push(a),this.$list.append(a.render()),KB.Ui.initTabs(),KB.Events.trigger("modal.recalibrate")},dispose:function(){this.trigger("dispose"),this.subviews=[]}})},{"../FieldBaseView":1}],9:[function(a,b,c){var d=a("../FieldBaseView");KB.Fields.registerObject("gallery",d.extend({initialize:function(){this.render()},render:function(){this.$stage=this.$(".kb-gallery--stage"),this.createController()},derender:function(){this.GalleryController.dispose()},rerender:function(){this.derender(),this.render()},createController:function(){return this.GalleryController?(this.GalleryController.setElement(this.$stage.get(0)),this.GalleryController.render()):this.GalleryController=new KB.Gallery.Controller({el:this.$stage.get(0),model:this.model})}})),KB.Gallery={},KB.Gallery.ImageView=Backbone.View.extend({tagName:"div",className:"kb-gallery--image-wrapper",initialize:function(a){this.Controller=a.Controller,this.uid=this.model.get("uid")||_.uniqueId("kbg"),this.editorAdded=!1,this._remove=!1},events:{"click .kb-gallery--js-edit":"edit","click .kb-gallery--js-delete":"delete","click .kb-gallery--js-meta-close":"close"},edit:function(){this.$el.wrap('<div class="kb-gallery--item-placeholder kb-gallery--image-wrapper"></div>'),this._placeholder=this.$el.parent(),this.$el.addClass("kb-gallery--active-item kb_field").appendTo("body"),jQuery("#wpwrap").addClass("module-browser-open"),this.handleEditor(),KB.Ui.initTabs()},handleEditor:function(){var a=this;$re=jQuery(".kb-js--remote-editor",this.$el);var b=this.createInputName(this.uid)+"[details][description]";if(this.editorAdded)KB.TinyMCE.addEditor($re,null,150);else{var c=KB.TinyMCE.remoteGetEditor($re,b,this.uid,this.model.get("details").description,null,!1,!1);c.done(function(b){a.editorAdded=b,KB.Ui.initTabs()})}},"delete":function(){this._remove?(this.$el.fadeTo(450,1).css("borderColor","#ccc"),jQuery(".kb-gallery--image-remove",this.$el).val(""),this._remove=!1):(this.$el.fadeTo(450,.5).css("borderColor","red"),this._remove=!0,jQuery(".kb-gallery--image-remove",this.$el).val("true"))},remove:function(){this.$el.remove(),delete this.$el},close:function(){var a=tinymce.get(this.uid+"_ededitor"),b=this.model.get("details");b.description=this.getEditorContent(a),tinymce.remove(a),this.$el.appendTo(this._placeholder).unwrap(),this.$el.removeClass("kb-gallery--active-item").removeClass("kb_field"),jQuery("#wpwrap").removeClass("module-browser-open")},getEditorContent:function(a){var b=jQuery("#wp-"+this.uid+"_ededitor-wrap"),c=b.hasClass("tmce-active");if(c)return a.getContent();var d=document.getElementById(this.uid+"_ededitor").value;return d=d.replace(/<br\s*\/?>/gm,"\n"),a.setContent(d),d},render:function(){var a=this.createInputName(this.uid),b=this.model.toJSON();return this.$el.append(KB.Templates.render("fields/Gallery/single-image",{image:b,id:b.id,inputName:a,uid:this.uid}))},createInputName:function(a){return this.createBaseId()+"["+this.Controller.model.get("fieldkey")+"][images]["+a+"]"},createBaseId:function(){return _.isEmpty(this.Controller.model.get("arrayKey"))?this.Controller.model.get("baseId"):this.Controller.model.get("baseId")+"["+this.Controller.model.get("arrayKey")+"]"}}),KB.Gallery.Controller=Backbone.View.extend({initialize:function(a){this._frame=null,this.subviews=[],this.listenTo(KB.Events,"modal.saved",this.frontendSave),this.setupElements(),this.initialSetup(),_K.log("Fields: Gallery instance created and initialized")},events:{"click .kb-gallery--js-add-images":"addImages"},setupElements:function(){this.$list=jQuery('<div class="kb-gallery--item-list"></div>').appendTo(this.$el),this.$list.sortable({revert:!0,delay:300}),this.$addButton=jQuery('<a class="button button-primary kb-gallery--js-add-images">'+KB.i18n.Refields.image.addButton+"</a>").appendTo(this.$el)},addImages:function(){this.openModal()},frame:function(){return this._frame?this._frame:void 0},openModal:function(){var a=this;return this._frame?void this._frame.open():(this._frame=wp.media({title:KB.i18n.Refields.image.modalHelpTitle,button:{text:KB.i18n.Refields.common.select},multiple:!0,library:{type:"image"}}),this._frame.state("library").on("select",function(){a.select(this)}),this._frame.open(),this._frame)},select:function(a){var b=a.get("selection");b.length>0&&this.handleModalSelection(b.models)},handleModalSelection:function(a){var b=this;_.each(a,function(a){var c={file:a.toJSON(),details:{title:"",alt:"",description:""},id:a.get("id")},d=new Backbone.Model(c),e=new KB.Gallery.ImageView({model:d,Controller:b});b.subviews.push(e),b.$list.append(e.render()),setTimeout(function(){KB.Events.trigger("modal.recalibrate")},250)})},initialSetup:function(){var a=this,b=this.model.get("value").images||{};_.toArray(b).length>0&&_.each(b,function(b){var c=new Backbone.Model(b),d=new KB.Gallery.ImageView({model:c,Controller:a});a.subviews.push(d),a.$list.append(d.render())})},frontendSave:function(){var a=this;this.subviews.length>0&&_.each(this.subviews,function(b,c){b._remove&&(delete a.subviews[c],b.remove())})}})},{"../FieldBaseView":1}],10:[function(a,b,c){var d=a("../FieldBaseView");KB.Fields.registerObject("image",d.extend({initialize:function(){this.defaultState="replace-image",this.defaultFrame="image",this.render()},events:{"click .kb-js-add-image":"openFrame","click .kb-js-reset-image":"resetImage"},render:function(){this.$reset=this.$(".kb-js-reset-image"),this.$container=this.$(".kb-field-image-container"),this.$saveId=this.$(".kb-js-image-id")},editImage:function(){this.openFrame(!0)},openFrame:function(a){var b,c=this;this.frame&&this.frame.dispose();var d={};""!==this.model.get("value").id&&(d.post__in=[this.model.get("value").id]),wp.media.query(d).more().done(function(){var a=this.first();c.attachment=a,a?(a.set("attachment_id",a.get("id")),b=c.attachment.toJSON()):(b={},c.defaultFrame="select",c.defaultState="library"),c.frame=wp.media({frame:c.defaultFrame,state:c.defaultState,metadata:b,imageEditView:c,library:{type:"image"}}).on("update",function(a){c.update(a)}).on("ready",function(){c.ready()}).on("replace",function(){c.replace(c.frame.image.attachment)}).on("select",function(a){var b=this.get("library").get("selection").first();c.replace(b)}).open()})},ready:function(){jQuery(".media-modal").addClass("smaller")},replace:function(a){this.attachment=a,this.handleAttachment(a)},update:function(a){this.attachment.set(a),this.attachment.sync("update",this.attachment)},handleAttachment:function(a){var b=this,c=a.get("id"),d=this.prepareValue(a),e=_.clone(this.model.get("ModuleModel").get("moduleData")),f=this.model.get("kpath");KB.Util.setIndex(e,f,d),this.model.get("ModuleModel").set("moduleData",e);var g={width:b.model.get("width")||null,height:b.model.get("height")||null,crop:b.model.get("crop")||!0,upscale:b.model.get("upscale")||!1};if(g.width&&g.height)jQuery.ajax({url:ajaxurl,data:{action:"fieldGetImage",args:g,id:c,_ajax_nonce:KB.Config.getNonce("read")},type:"POST",dataType:"json",success:function(a){b.$container.html('<img src="'+a.data.src+'" >')},error:function(){}});else{var h=a.get("sizes").thumbnail?a.get("sizes").thumbnail.url:a.get("sizes").full.url;this.$container.html('<img src="'+h+'" >')}this.$saveId.val(a.get("id")),this.model.get("ModuleModel").trigger("data.updated")},prepareValue:function(a){return{id:a.get("id"),title:a.get("title"),caption:a.get("caption"),alt:a.get("alt")}},resetImage:function(){this.$container.html(""),this.$saveId.val(""),this.model.set("value",{id:null})}}))},{"../FieldBaseView":1}],11:[function(a,b,c){var d=a("../FieldBaseView");KB.Fields.registerObject("link",d.extend({initialize:function(){this.render()},events:{"click .kb-js-add-link":"openModal"},render:function(){this.$input=this.$(".kb-js-link-input")},derender:function(){},openModal:function(){wpActiveEditor=this.$input.attr("id"),jQuery("#wp-link-wrap").addClass("kb-customized"),kb_restore_htmlUpdate=wpLink.htmlUpdate,kb_restore_isMce=wpLink.isMCE,wpLink.isMCE=this.isMCE,wpLink.htmlUpdate=this.htmlUpdate,wpLink.open()},htmlUpdate:function(){var a,b,c,d=wpLink.textarea;d&&(a=wpLink.getAttrs(),a.href&&"http://"!=a.href&&(b=a.href,c=a.title,jQuery(d).empty(),d.value=b,wpLink.close(),this.close(),d.focus()))},isMCE:function(){return!1},close:function(){wpLink.isMCE=kb_restore_isMce,wpLink.htmlUpdate=kb_restore_htmlUpdate}}))},{"../FieldBaseView":1}]},{},[3]);