/*! Kontentblocks ProdVersion 2015-09-09 10:09 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){b.exports=Backbone.View.extend({tagName:"div",className:"",isValid:function(){return!0}})},{}],2:[function(a,b,c){b.exports=Backbone.View.extend({initialize:function(a){this.Controller=a.Controller,this.ContextsViews=this.setupContextsViews(),this.isVisible=!0,this.listenTo(this.Controller,"columns.rendered",this.columnActivated),this.listenTo(this.Controller,"columns.reset",this.reset)},setupContextsViews:function(){var a={},b=this,c=this.$(".kb-context-container");return _.each(c,function(c,d){var e=c.dataset.kbcontext,f=KB.Contexts.get(e);a[f.View.cid]=f.View,f.View.isVisible=!0,f.View.ColumnView=b,b.listenTo(f.View,"context.activated",b.activateColumn)}),a},activateColumn:function(){this.trigger("column.activate",this)},columnActivated:function(a){a.cid!==this.cid?_.each(this.ContextsViews,function(a){a.renderProxy()}):_.each(this.ContextsViews,function(a){a.removeProxy()})},reset:function(){_.each(this.ContextsViews,function(a){a.removeProxy()})}})},{}],3:[function(a,b,c){var d=a("templates/backend/context-bar.hbs"),e=a("backend/Views/ContextUi/ContextUiView"),f=a("backend/Views/ContextUi/ContextColumnView"),g=a("backend/Views/ContextUi/controls/ResetControl"),h=a("backend/Views/ContextUi/controls/ColumnControl");b.exports=Backbone.View.extend({initialize:function(){var a=this;this.columns=this.setupColumns(),this.layoutBackup=this.createLayoutBackup(),this.cols=_.toArray(this.columns).length,this.render(),jQuery(window).resize(function(){a.resetLayout()})},setupColumns:function(){var a=this,b=this.$(".kb-context-col");return _.map(b,function(b){var c=new f({el:b,Controller:a});return a.listenTo(c,"column.activate",a.evalLayout),c})},render:function(){var a=jQuery(d({}));this.$el.before(a),this.BarView=new e({el:a}),this.setupMenuItems()},setupMenuItems:function(){var a=this;this.BarView.addItem(new g({model:this.model,parent:this})),_.each(this.columns,function(b){a.BarView.addItem(new h({model:a.model,parent:a,ColumnView:b}))})},createLayoutBackup:function(){var a={};return _.each(this.columns,function(b,c){a[c]=b.$el.attr("class")}),a},resetLayout:function(){var a=this;_.each(this.columns,function(b){b.isVisible||b.Control["switch"](),b.$el.attr("class",a.layoutBackup[b.cid]),b.$el.width("")}),this.trigger("columns.reset")},evalLayout:function(a){var b=this.$el.width()-20*this.cols,c=this.findProportion(this.cols);return 1100>b?!1:(_.each(this.columns,function(d){d.cid===a.cid?d.$el.width(Math.floor(b*c.large)):d.$el.width(Math.floor(b*c.small))}),void this.trigger("columns.rendered",a))},renderLayout:function(){var a=_.filter(this.columns,function(a){return a.isVisible}),b=a.length,c=this.$el.width()-20*b;_.each(a,function(a){a.$el.width(Math.floor(c*(100/b/100)))})},findProportion:function(a){switch(a){case 3:return{small:.1,large:.8};case 2:return{small:.3333,large:.6666};default:return{small:1,large:1}}}})},{"backend/Views/ContextUi/ContextColumnView":2,"backend/Views/ContextUi/ContextUiView":4,"backend/Views/ContextUi/controls/ColumnControl":5,"backend/Views/ContextUi/controls/ResetControl":6,"templates/backend/context-bar.hbs":41}],4:[function(a,b,c){var d=a("backend/Views/ModuleControls/ControlsView");b.exports=d.extend({initialize:function(){this.$menuList=jQuery(".kb-context-bar--actions",this.$el)}})},{"backend/Views/ModuleControls/ControlsView":7}],5:[function(a,b,c){var d=a("backend/Views/BaseControlView");b.exports=d.extend({initialize:function(a){this.options=a||{},this.Controller=a.parent,this.ColumnView=a.ColumnView,this.ColumnView.Control=this},className:"context-visibility",events:{click:"switch"},render:function(){this.$el.append('<span class="kb-button-small">'+this.ColumnView.$el.data("kbcolname")+"</span>")},isValid:function(){return!0},"switch":function(){this.$el.toggleClass("kb-context-hidden"),this.ColumnView.$el.toggle(),this.ColumnView.isVisible=!this.ColumnView.isVisible,this.Controller.renderLayout()}})},{"backend/Views/BaseControlView":1}],6:[function(a,b,c){var d=a("backend/Views/BaseControlView");b.exports=d.extend({initialize:function(a){this.options=a||{},this.Controller=a.parent},className:"context-reset-layout",events:{click:"resetLayout"},render:function(){this.$el.append('<span class="kb-button-small">Reset</span>')},isValid:function(){return!0},resetLayout:function(){this.Controller.resetLayout()}})},{"backend/Views/BaseControlView":1}],7:[function(a,b,c){var d=a("templates/backend/module-menu.hbs");b.exports=Backbone.View.extend({$menuWrap:{},$menuList:{},initialize:function(){this.$menuWrap=jQuery(".menu-wrap",this.$el),this.$menuWrap.append(d({})),this.$menuList=jQuery(".module-actions",this.$menuWrap)},addItem:function(a){if(a.isValid&&a.isValid()===!0){var b=jQuery("<li></li>").appendTo(this.$menuList),c=b.append(a.el);this.$menuList.append(c),a.render.call(a)}}})},{"templates/backend/module-menu.hbs":42}],8:[function(a,b,c){var d=a("common/Notice");b.exports={send:function(a,b,c,e){var f,g=e||{};f=a.postId?a.postId:KB.Environment&&KB.Environment.postId?KB.Environment.postId:!1;var h=_.extend({supplemental:a.supplemental||{},nonce:jQuery("#_kontentblocks_ajax_nonce").val(),post_id:f,postId:f,kbajax:!0},a);return jQuery("#publish").attr("disabled","disabled"),jQuery.ajax({url:ajaxurl,data:h,type:"POST",dataType:"json",success:function(a){a&&(c&&b?b.call(c,a,g):b&&b(a,g))},error:function(){d.notice("<p>Generic Ajax Error</p>","error")},complete:function(){jQuery("#publish").removeAttr("disabled")}})}}},{"common/Notice":12}],9:[function(a,b,c){var d=a("common/Config");b.exports={blockLimit:function(a){var b=a.get("limit"),c=jQuery("#"+a.get("id")+" li.kb-module").length;return!(0!==b&&c===b)},userCan:function(a){var b=jQuery.inArray(a,d.get("caps"));return-1!==b}}},{"common/Config":10}],10:[function(a,b,c){var d=function(a){var b=KB.appData.config;return{get:function(a){return a?b[a]?b[a]:null:b},getNonce:function(a){var c=["update","create","delete","read"];return-1!==_.indexOf(c,a)?b.nonces[a]:(console.error("Invalid nonce requested in kb.cm.Config.js"),null)},inDevMode:function(){return b.env.dev},getRootURL:function(){return b.env.rootUrl},getFieldJsUrl:function(){return b.env.fieldJsUrl},getHash:function(){return b.env.hash},getLayoutMode:function(){return b.layoutMode||"default-boxes"}}}(jQuery);b.exports=d},{}],11:[function(a,b,c){var d=a("common/Config");Function.prototype.bind&&window.console&&"object"==typeof console.log&&["log","info","warn","error","assert","dir","clear","profile","profileEnd"].forEach(function(a){console[a]=this.bind(console[a],console)},Function.prototype.call),Logger.useDefaults();var e=Logger.get("_K"),f=Logger.get("_KS");e.setLevel(e.INFO),f.setLevel(f.INFO),d.inDevMode()||e.setLevel(Logger.OFF),Logger.setHandler(function(a,b){if(KB.Menubar&&2===b.level.value&&"_KS"===b.name)a[0]&&KB.Menubar.StatusBar.setMsg(a[0]);else{var c=window.console,d=c.log;b.name&&(a[0]="["+b.name+"] "+a[0]),b.level===Logger.WARN&&c.warn?d=c.warn:b.level===Logger.ERROR&&c.error?d=c.error:b.level===Logger.INFO&&c.info&&(d=c.info),d.apply(c,a)}}),b.exports={Debug:e,User:f}},{"common/Config":10}],12:[function(a,b,c){"use strict";b.exports={notice:function(a,b,c){var d=c||3;window.alertify.notify(a,b,d)},confirm:function(a,b,c,d,e){var f=a||"Title";window.alertify.confirm(f,b,function(){c.call(e)},function(){d.call(e)})}}},{}],13:[function(a,b,c){b.exports={getFieldData:function(a,b,c,d){var e;return this._typeExists(a)?(e=KB.payload.fieldData[a],e[b]?_.isEmpty(d)?e[b][c]?e[b][c]:[]:e[b][d]&&e[b][d][c]?e[b][d][c]:[]:[]):[]},_typeExists:function(a){return!_.isUndefined(KB.payload.fieldData[a])},getFieldArgs:function(a,b){return KB.payload.Fields&&KB.payload.Fields[a]?b&&KB.payload.Fields[a][b]?KB.payload.Fields[a][b]:KB.payload.Fields[a]:null},parseAdditionalJSON:function(a){var b;return b={Fields:[]},a&&a.Fields&&(b.Fields=KB.FieldControls.add(_.toArray(a.Fields))),b},getPayload:function(a){return KB&&KB.payload&&KB.payload[a]?KB.payload[a]:{}}}},{}],14:[function(a,b,c){var d=a("common/Ajax"),e=a("common/Logger"),f=a("common/Config");b.exports={removeEditors:function(a){a||(a=jQuery("body")),jQuery(".wp-editor-area",a).each(function(){if("wp-content-wrap"===jQuery(this).attr("id")||"ghosteditor"===jQuery(this).attr("id"));else{var a=this.id;tinyMCE.execCommand("mceRemoveEditor",!0,a)}})},restoreEditors:function(a){a||(a=jQuery("body")),jQuery(".wp-editor-wrap",a).each(function(){var a=jQuery(this).find("textarea").attr("id"),b=jQuery(this).find("textarea");"ghosteditor"!==a&&(b.val(switchEditors.wpautop(b.val())),tinyMCE.execCommand("mceAddEditor",!0,a),switchEditors.go(a,"tmce"))})},addEditor:function(a,b,c,d){if(!a)return e.Debug.error("No scope element ($el) provided"),!1;if(_.isUndefined(tinyMCEPreInit))return!1;var f=c||350,g=_.isUndefined(d)?!0:!1;jQuery(".wp-editor-area",a).each(function(){var a=this.id,b=window.tinyMCE.get(a);b&&tinyMCE.execCommand("mceRemoveEditor",null,a);var c=tinyMCEPreInit&&tinyMCEPreInit.mceInit&&tinyMCEPreInit.mceInit.ghosteditor?"ghosteditor":"content",d=_.clone(tinyMCEPreInit.mceInit[c]);d.elements=a,d.selector="#"+a,d.id=a,d.kblive=g,d.height=f,d.remove_linebreaks=!1,d.setup=function(a){a.on("init",function(){KB.Events.trigger("KB::tinymce.new-editor",a)}),a.on("change",function(){var b;a.module||(b=jQuery(a.editorContainer).closest(".kb-module"),a.module=KB.Views.Modules.get(b.attr("id"))),a.module.$el.trigger("tinymce.change")})},tinymce.init(d),tinyMCEPreInit.mceInit[a]||(tinyMCEPreInit.mceInit[a]=d);var e={buttons:"",disabled_buttons:"",id:a};window.quicktags(e)}),setTimeout(function(){jQuery(".wp-editor-wrap",a).removeClass("html-active").addClass("tmce-active"),window.QTags._buttonsInit()},1500)},remoteGetEditor:function(a,b,c,g,h,i,j){var k=h||KB.appData.config.post.ID,c=c||a.attr("id");if(!i)var i=!1;var l=g||"";return d.send({action:"getRemoteEditor",editorId:c+"_ed",editorName:b,post_id:k,postId:k,editorContent:l,_ajax_nonce:f.getNonce("read"),args:{media_buttons:i}},function(b){b.success?(a.empty().append(b.data.html),this.addEditor(a,null,150,j)):e.Debug.info("Editor markup could not be retrieved from the server")},this)}}},{"common/Ajax":8,"common/Config":10,"common/Logger":11}],15:[function(a,b,c){var d=jQuery,e=a("common/Config"),f=a("common/Ajax"),g=a("common/TinyMCE"),h=a("common/Notice"),i=a("backend/Views/ContextUi/ContextRowGrid"),j={isSorting:!1,init:function(){var a=this,b=d("body");this.initTabs(),this.initSortable(),this.initSortableAreas(),this.initToggleBoxes(),this.flexContext(),this.flushLocalStorage(),this.initTipsy(),b.on("mousedown",".kb_field",function(a){activeField=this}),b.on("mousedown",".kb-module",function(a){activeBlock=this.id}),b.on("mouseenter",".kb-js-field-identifier",function(){KB.currentFieldId=this.id}),b.on("mouseenter",".kb-area__list-item li",function(){KB.currentModuleId=this.id}),jQuery(document).ajaxComplete(function(b,c,d){a.metaBoxReorder(b,c,d,"restore")}),jQuery(document).ajaxSend(function(b,c,d){a.metaBoxReorder(b,c,d,"remove")})},flexContext:function(){jQuery(".kb-context-row").each(function(a,b){var c=jQuery(b);c.data("KB.ContextRow",new i({el:b}))})},repaint:function(a){this.initTabs(),this.initToggleBoxes(),g.addEditor(a)},initTabs:function(a){var b=a||jQuery("body"),c=d(".kb_fieldtabs",b);c.tabs({activate:function(a,b){d(".kb-nano").nanoScroller({contentClass:"kb-nano-content"}),KB.Events.trigger("modal.recalibrate")}}),c.each(function(){var a=d(".ui-tabs-nav li",d(this)).length;1===a&&d(this).find(".ui-tabs-nav").css("display","none")})},initToggleBoxes:function(){d(".kb-togglebox-header").on("click",function(){d(this).next("div").slideToggle()}),d(".kb_fieldtoggles div:first-child").trigger("click")},initSortable:function(a){function b(){var a=i.get("limit"),b=c(i.get("id"));return-1===_.indexOf(i.get("assignedModules"),f.get("settings")["class"])?!1:0!==a&&b-1>=a?(h.notice("Not allowed here","error"),!1):!0}function c(a){return d("#"+a+" li.kb-module").length}var f,i,j=a||jQuery("body"),k=this,l="parent";"default-tabs"===e.getLayoutMode()&&(l="#kb-contexts-tabs"),d(".kb-module-ui__sortable",j).sortable({placeholder:"ui-state-highlight",ghost:!0,connectWith:".kb-module-ui__sortable--connect",helper:"clone",handle:".kb-move",cancel:"li.disabled, li.cantsort",tolerance:"pointer",delay:150,revert:350,appendTo:l,start:function(a,b){k.isSorting=!0,d("body").addClass("kb-is-sorting"),f=KB.Modules.get(b.item.attr("id")),i=KB.currentArea,d(KB).trigger("kb:sortable::start"),d(".kb-open").toggleClass("kb-open"),d(".kb-module__body").hide(),g.removeEditors(),d(document).trigger("kb_sortable_start",[a,b])},stop:function(a,b){k.isSorting=!1,d("body").removeClass("kb-is-sorting"),g.restoreEditors(),d(document).trigger("kb_sortable_stop",[a,b]),f.get("open")&&f.View.toggleBody(155)},over:function(a,b){i=KB.Areas.get(this.id)},receive:function(a,c){b()||(h.notice("Module not allowed in this area","error"),d(c.sender).sortable("cancel"))},update:function(a,c){if(!b())return!1;if(this!==c.item.parent("ul")[0]||c.sender){if(c.sender){if(c.item.parent("ul")[0].id===c.sender.attr("id"))return!1;d.when(k.changeArea(i,f)).then(function(a){return a.success?void k.resort(c.sender):!1}).done(function(){k.triggerAreaChange(i,f),d(KB).trigger("kb:sortable::update"),f.View.clearFields(),h.notice("Area change and order were updated successfully","success")})}}else d.when(k.resort(c.sender)).done(function(a){return a.success?(d(KB).trigger("kb:sortable::update"),void h.notice(a.message,"success")):(h.notice(a.message,"error"),!1)})}}).disableSelection()},flushLocalStorage:function(){var a=e.get("env").hash;store.get("kbhash")!==a&&(store.clear(),store.set("kbhash",a))},resort:function(a){var b={};return d(".kb-module-ui__sortable").each(function(){b[this.id]=d("#"+this.id).sortable("serialize",{attribute:"rel"})}),f.send({action:"resortModules",data:b,_ajax_nonce:e.getNonce("update")})},changeArea:function(a,b){return f.send({action:"changeArea",_ajax_nonce:e.getNonce("update"),mid:b.get("mid"),area_id:a.get("id"),context:a.get("context")})},triggerAreaChange:function(a,b){b.unsubscribeFromArea(),b.setArea(a)},toggleModule:function(){d("body").on("click",".kb-toggle",function(){KB.isLocked()&&!KB.userCan("lock_kontentblocks")?h.notice(kontentblocks.l18n.gen_no_permission,"alert"):(d(this).parent().nextAll(".kb-module__body:first").slideToggle("fast",function(){d("body").trigger("module::opened")}),d("#"+activeBlock).toggleClass("kb-open",1e3))})},initSortableAreas:function(){jQuery(".kb-context__inner").sortable({items:".kb-area__wrap",handle:".kb-area-move-handle",start:function(a,b){g.removeEditors()},stop:function(a,b){var c=jQuery("#post").serializeJSON(),d=c.kbcontext;d&&f.send({action:"updateContextAreaOrder",_ajax_nonce:e.getNonce("update"),data:d},function(a){a.success?h.notice(a.message,"success"):h.notice(a.message,"error"),g.restoreEditors()},this)}})},initTipsy:function(){jQuery("body").on("mouseenter","[data-kbtooltip]",function(a){jQuery(this).qtip({content:{attr:"data-kbtooltip"},style:"qtip-dark qtip-shadow",show:{event:a.type,effect:!0,delay:180,solo:!0,ready:!0}})})},metaBoxReorder:function(a,b,c,e){if(c.data){var f=c.data,h=f.split("&"),i={};d.each(h,function(a,b){var c=b.split("=");i[c[0]]=c[1]}),"meta-box-order"===i.action&&("restore"===e?g.restoreEditors():"remove"===e&&g.removeEditors())}}};b.exports=j},{"backend/Views/ContextUi/ContextRowGrid":3,"common/Ajax":8,"common/Config":10,"common/Notice":12,"common/TinyMCE":14}],16:[function(a,b,c){var d=function(a){return{stex:{set:function(a,b,c){store.set(a,{val:b,exp:c,time:(new Date).getTime()})},get:function(a){var b=store.get(a);return b?(new Date).getTime()-b.time>b.exp?null:b.val:null}},setIndex:function(a,b,c){return _.isObject(a)||(a={}),"string"==typeof b?this.setIndex(a,b.split("."),c):1==b.length&&void 0!==c?a[b[0]]=c:0==b.length?a:this.setIndex(a[b[0]],b.slice(1),c)},getIndex:function(a,b){b=b.replace(/\[(\w+)\]/g,".$1"),b=b.replace(/^\./,"");for(var c=b.split(".");c.length;){var d=c.shift();if(!(_.isObject(a)&&d in a))return{};a=a[d]}return a},sleep:function(a){for(var b=(new Date).getTime(),c=0;1e7>c&&!((new Date).getTime()-b>a);c++);}}}(jQuery);b.exports=d},{}],17:[function(a,b,c){b.exports=Backbone.View.extend({rerender:function(){this.render()},gone:function(){this.trigger("field.view.gone",this),this.derender()}})},{}],18:[function(a,b,c){var d=a("common/Checks"),e=a("common/Utilities"),f=a("common/Payload"),g=a("common/Config"),h=a("common/Logger");b.exports=Backbone.Model.extend({idAttribute:"uid",initialize:function(){this.cleanUp();var a=this.get("fieldId");a&&(this.ModuleModel=KB.ObjectProxy.get(a))&&this.getType()&&(this.set("ModuleModel",this.ModuleModel),this.setData(),this.bindHandlers(),this.setupType(),this.ModuleModel.attachField(this))},cleanUp:function(){var a=this.get("linkedFields")||{};a.hasOwnProperty(this.get("uid"))&&delete a[this.get("uid")]},bindHandlers:function(){this.listenTo(this,"field.model.settings",this.updateLinkedFields),this.listenToOnce(this.ModuleModel,"remove",this.remove),this.listenTo(this.ModuleModel,"change:moduleData",this.setData),this.listenTo(this.ModuleModel,"module.model.updated",this.getClean),this.listenTo(this,"change:value",this.upstreamData),this.listenTo(this.ModuleModel,"modal.serialize.before",this.unbind),this.listenTo(this.ModuleModel,"modal.serialize",this.rebind),this.listenTo(this.ModuleModel,"change:area",this.unbind),this.listenTo(this.ModuleModel,"after.change.area",this.rebind)},setupType:function(){var a;(a=this.getType())&&(this.FieldControlView=new a({el:this.getElement(),model:this}))},updateLinkedFields:function(a){a.linkedFields&&(this.set("linkedFields",a.linkedFields),this.cleanUp())},getElement:function(){return jQuery('*[data-kbfuid="'+this.get("uid")+'"]')[0]},getType:function(){var a=this.get("type");if(!d.userCan("edit_kontentblocks"))return!1;var b=KB.Fields.get(a);return b&&b.prototype.hasOwnProperty("initialize")?b:!1},getClean:function(){this.trigger("field.model.clean",this)},setData:function(a){var b,c,d,g,h,i={};b=a||this.get("ModuleModel"),c=f.getPayload("fieldData"),c[this.get("type")]&&(d=c[this.get("type")],d[this.get("fieldId")]&&(g=d[this.get("fieldId")],i=e.getIndex(g,this.get("kpath")))),h=e.getIndex(b.get("moduleData"),this.get("kpath")),this.set("value",_.extend(h,i))},upstreamData:function(){var a;if(a=this.get("ModuleModel")){var b=_.clone(this.get("ModuleModel").get("moduleData"));e.setIndex(b,this.get("kpath"),this.get("value")),a.set("moduleData",b,{silent:!1}),a.View.getDirty()}},externalUpdate:function(a){this.FieldControlView.synchronize(a)},remove:function(){this.stopListening(),KB.FieldControls.remove(this)},rebind:function(){var a=this;_.defer(function(){_.isUndefined(a.getElement())?_.defer(_.bind(a.FieldControlView.gone,a.FieldControlView)):a.FieldControlView&&(a.FieldControlView.setElement(a.getElement()),_.defer(_.bind(a.FieldControlView.rerender,a.FieldControlView)))},!0)},unbind:function(){this.FieldControlView&&this.FieldControlView.derender&&this.FieldControlView.derender()},sync:function(a){var b=this;KB.Events.trigger("field.before.sync",this.model);var c=b.toJSON(),d=c.ModuleModel.type,e=c.ModuleModel.toJSON();return delete c.ModuleModel,delete c.linkedFields,jQuery.ajax({url:ajaxurl,data:{action:"updateFieldModel",data:b.get("value"),field:c,module:e,type:d,_ajax_nonce:g.getNonce("update")},context:a?a:b,type:"POST",dataType:"json",success:function(a){b.trigger("field.model.updated",b)},error:function(){h.Debug.error("serialize | FrontendModal | Ajax error")}})}})},{"common/Checks":9,"common/Config":10,"common/Logger":11,"common/Payload":13,"common/Utilities":16}],19:[function(a,b,c){var d=a("./FieldControlModel");b.exports=d.extend({bindHandlers:function(){this.listenToOnce(this.ModuleModel,"remove",this.remove),this.listenTo(this.ModuleModel,"change:moduleData",this.setData),this.listenTo(KB.Events,"modal.reload",this.rebind),this.listenTo(KB.Events,"modal.close",this.remove)},rebind:function(){this.FieldControlView&&(this.FieldControlView.setElement(this.getElement()),this.FieldControlView.rerender())},getElement:function(){return jQuery('*[data-kbfuid="'+this.get("uid")+'"]')}})},{"./FieldControlModel":18}],20:[function(a,b,c){var d={};a("common/Logger");_.extend(d,Backbone.Events),_.extend(d,{fields:{},registerObject:function(a,b){_.extend(b,Backbone.Events),this.fields[a]=b},get:function(a){return this.fields[a]?this.fields[a]:null}}),b.exports=d},{"common/Logger":11}],21:[function(a,b,c){var d=a("./Fields");window.KB.Fields=d,d.registerObject("color",a("./controls/color")),d.registerObject("date",a("./controls/date")),d.registerObject("datetime",a("./controls/datetime")),d.registerObject("file",a("./controls/file")),d.registerObject("flexfields",a("./controls/flexfields")),d.registerObject("gallery",a("./controls/gallery")),d.registerObject("gallery2",a("./controls/gallery2")),d.registerObject("image",a("./controls/image")),d.registerObject("link",a("./controls/link")),d.registerObject("textarea",a("./controls/textarea")),d.registerObject("otimes",a("./controls/otimes"))},{"./Fields":20,"./controls/color":22,"./controls/date":23,"./controls/datetime":24,"./controls/file":25,"./controls/flexfields":26,"./controls/gallery":31,"./controls/gallery2":34,"./controls/image":37,"./controls/link":38,"./controls/otimes":39,"./controls/textarea":40}],22:[function(a,b,c){var d=a("../FieldControlBaseView");b.exports=d.extend({initialize:function(){this.render()},events:{"mouseup .kb-field--color":"recalibrate"},render:function(){this.$(".kb-color-picker").wpColorPicker({}),jQuery("body").on("click.wpcolorpicker",this.update)},derender:function(){jQuery("body").off("click.wpcolorpicker",this.update)},update:function(){KB.Events.trigger("modal.preview")},recalibrate:function(){_.delay(function(){KB.Events.trigger("modal.recalibrate")},150)}})},{"../FieldControlBaseView":17}],23:[function(a,b,c){var d=a("../FieldControlBaseView");b.exports=d.extend({initialize:function(){var a=this;this.defaults={format:"d M Y",offset:[0,250],onSelect:function(b,c,d,e){a.$machineIn.val(c),a.$unixIn.val(Math.round(d.getTime()/1e3))}},this.settings=this.model.get("options")||{},this.render()},render:function(){this.$machineIn=this.$(".kb-date-machine-format"),this.$unixIn=this.$(".kb-date-unix-format"),this.$(".kb-datepicker").Zebra_DatePicker(_.extend(this.defaults,this.settings))},derender:function(){}})},{"../FieldControlBaseView":17}],24:[function(a,b,c){var d=a("../FieldControlBaseView");b.exports=d.extend({initialize:function(){var a=this;this.defaults={format:"d.m.Y H:i",inline:!1,mask:!0,lang:"de",allowBlank:!0,onChangeDateTime:function(b,c){a.$unixIn.val(b.dateFormat("unixtime")),a.$sqlIn.val(b.dateFormat("Y-m-d H:i:s"))}},this.setting=this.model.get("settings")||{},this.render()},render:function(){this.$unixIn=this.$(".kb-datetimepicker--js-unix"),this.$sqlIn=this.$(".kb-datetimepicker--js-sql"),this.$(".kb-datetimepicker").datetimepicker(_.extend(this.defaults,this.settings))},derender:function(){this.$(".kb-datetimepicker").datetimepicker("destroy")}})},{"../FieldControlBaseView":17}],25:[function(a,b,c){var d=a("../FieldControlBaseView");b.exports=d.extend({initialize:function(){this.render()},events:{"click .kb-js-add-file":"openFrame","click .kb-js-reset-file":"reset"},render:function(){this.$container=this.$(".kb-field-file-wrapper"),this.$IdIn=this.$(".kb-file-attachment-id"),this.$resetIn=this.$(".kb-js-reset-file")},derender:function(){this.frame&&(this.frame.dispose(),this.frame=null)},openFrame:function(){var a=this;return this.frame?this.frame.open():(this.frame=wp.media({title:KB.i18n.Refields.file.modalTitle,button:{text:KB.i18n.Refields.common.select},multiple:!1,library:{type:""}}),this.frame.on("ready",function(){a.ready(this)}),this.frame.state("library").on("select",function(){a.select(this)}),this.frame.open())},ready:function(a){this.$(".media-modal").addClass(" smaller no-sidebar")},select:function(a){var b=a.get("selection").first();this.handleAttachment(b)},handleAttachment:function(a){this.$(".kb-file-filename",this.$container).html(a.get("filename")),this.$(".kb-file-attachment-id",this.$container).val(a.get("id")),this.$(".kb-file-title",this.$container).html(a.get("title")),this.$(".kb-file-id",this.$container).html(a.get("id")),this.$(".kb-file-editLink",this.$container).attr("href",a.get("editLink")),this.$resetIn.show(),this.$container.show(450,function(){KB.Events.trigger("modal.recalibrate")})},reset:function(){this.$IdIn.val(""),this.$container.hide(450),this.$resetIn.hide()}})},{"../FieldControlBaseView":17}],26:[function(a,b,c){var d=a("../FieldControlBaseView"),e=a("fields/controls/flexfields/FlexfieldsController");b.exports=d.extend({initialize:function(){this.createController(),this.render()},render:function(){this.$stage=this.$(".flexible-fields--stage"),this.FlexFieldsController.setElement(this.$stage.get(0)),this.FlexFieldsController.render()},derender:function(){this.FlexFieldsController.derender()},rerender:function(){this.render()},createController:function(){return this.FlexFieldsController?void 0:this.FlexFieldsController=new e({el:this.$(".flexible-fields--stage"),model:this.model,parentView:this})}})},{"../FieldControlBaseView":17,"fields/controls/flexfields/FlexfieldsController":28}],27:[function(a,b,c){var d=a("fields/FieldControlModelModal");b.exports=Backbone.Collection.extend({model:d})},{"fields/FieldControlModelModal":19}],28:[function(a,b,c){var d=a("fields/controls/flexfields/ToggleBoxItem"),e=a("fields/controls/flexfields/SectionBoxItem"),f=a("common/TinyMCE"),g=a("common/UI"),h=a("common/Logger"),i=a("fields/controls/flexfields/FlexFieldsCollection");b.exports=Backbone.View.extend({initialize:function(a){this.parentView=a.parentView,this.Tabs=this.setupConfig(),this.subviews=[],this.Renderer="sections"==this.model.get("renderer")?e:d,this.Fields=new i,jQuery('<ul class="flexible-fields--item-list"></ul>').appendTo(this.$el),jQuery('<a class="button button-primary kb-flexible-fields--js-add-item">Add Item</a>').appendTo(this.$el),h.Debug.log("Fields: Flexfields instance created and initialized")},events:{"click .kb-flexible-fields--js-add-item":"addItem"},initialSetup:function(){var a,b=this;a=this.model.get("value"),_.isEmpty(a)||_.each(a,function(a,c){if(a){var d=new b.Renderer({Controller:b,model:new Backbone.Model({_tab:{title:a._tab.title,uid:c},value:new Backbone.Model(a)})});b.subviews.push(d),b.$list.append(d.render())}}),g.initTabs(),this.$list.sortable({handle:".flexible-fields--js-drag-handle",start:function(){f.removeEditors()},stop:function(){f.restoreEditors()}}),KB.Events.trigger("modal.recalibrate"),this._initialized=!0},render:function(){this.setupElements(),this.initialSetup()},derender:function(){this.trigger("derender"),this.subviews=[]},setupConfig:function(){var a=this;return _.each(this.model.get("config"),function(b){b.fields&&(b.fields=a.setupFields(b.fields),h.Debug.log("Fields: Flexfields configs setup",b.fields))}),this.model.get("config")},setupFields:function(a){var b=this,c={};return _.each(a,function(a,d){_.defaults(a,b.model.toJSON()),a.index=null,a.kpath=null,a.primeKey=d,c[d]=new Backbone.View({Controller:b,el:b.el,model:new Backbone.Model(a)})}),c},setupElements:function(){this.$list=this.$(".flexible-fields--item-list"),this.$addButton=this.$(".kb-flexible-fields--js-add-item")},addItem:function(){var a=new this.Renderer({Controller:this,model:new Backbone.Model({_tab:{title:_.uniqueId("ff"),uid:_.uniqueId("ff")}})});this.subviews.push(a),this.$list.append(a.render()),g.initTabs(),KB.Events.trigger("modal.recalibrate")}})},{"common/Logger":11,"common/TinyMCE":14,"common/UI":15,"fields/controls/flexfields/FlexFieldsCollection":27,"fields/controls/flexfields/SectionBoxItem":29,"fields/controls/flexfields/ToggleBoxItem":30}],29:[function(a,b,c){var d=a("fields/controls/flexfields/ToggleBoxItem"),e=a("templates/fields/FlexibleFields/single-section-box.hbs");b.exports=d.extend({render:function(){var a=this.createInputName(this.model.get("_tab").uid),b=this.model.toJSON(),c=this.$el.append(e({item:b,inputName:a,uid:this.model.get("_tab").uid}));return this.renderTabs(c),c},renderTabs:function(a){var b=this,c=HandlebarsKB.compile("<li><a href='#tab-{{ uid }}-{{ index }}'>{{ tab.label }}</a></li>"),d=HandlebarsKB.compile("<div id='tab-{{ uid }}-{{ index }}'></div>");_.each(this.Controller.Tabs,function(e,f){jQuery(".flexible-field--tab-nav",a).append(c({uid:b.model.get("_tab").uid,tab:e,index:f}));var g=jQuery(".kb-field--tabs",a),h=jQuery(d({uid:b.model.get("_tab").uid,index:f})).appendTo(g);b.renderFields(e,h)})}})},{"fields/controls/flexfields/ToggleBoxItem":30,"templates/fields/FlexibleFields/single-section-box.hbs":43}],30:[function(a,b,c){var d=a("common/Notice"),e=a("templates/fields/FlexibleFields/single-toggle-box.hbs");b.exports=Backbone.View.extend({tagName:"li",className:"kb-flexible-fields--item-wrapper",initialize:function(a){this.Controller=a.Controller,this.listenTo(this.Controller,"derender",this.derender),this.FieldViews={}},events:{"click .flexible-fields--js-toggle":"toggleItem","click .flexible-fields--js-trash":"deleteItem"},toggleItem:function(){this.$(".flexible-fields--toggle-title").next().slideToggle(250,function(){KB.Events.trigger("modal.recalibrate")})},deleteItem:function(){this.$el.hide(250);var a=this.createInputName(this.model.get("_tab").uid);this.$el.append('<input type="hidden" name="'+a+'[delete]" value="'+this.model.get("_tab").uid+'" >'),d.notice("Please click update to save the changes","success")},render:function(){var a=this.createInputName(this.model.get("_tab").uid),b=this.model.toJSON(),c=this.$el.append(e({item:b,inputName:a,uid:this.model.get("_tab").uid}));return this.renderTabs(c),c},renderTabs:function(a){var b=this,c=HandlebarsKB.compile("<li><a href='#tab-{{ uid }}-{{ index }}'>{{ tab.label }}</a></li>"),d=HandlebarsKB.compile("<div id='tab-{{ uid }}-{{ index }}'></div>");_.each(this.Controller.Tabs,function(e,f){jQuery(".flexible-field--tab-nav",a).append(c({uid:b.model.get("_tab").uid,tab:e,index:f}));var g=jQuery(".kb-field--tabs",a),h=jQuery(d({uid:b.model.get("_tab").uid,index:f})).appendTo(g);b.renderFields(e,h)})},renderFields:function(a,b){var c,d;_.each(a.fields,function(a){a.model.set("index",this.model.get("_tab").uid),c=KB.FieldsAPI.get(a),d=this.model.get("value"),_.isUndefined(d)?c.setupDefaults():c.setValue(d.get(a.model.get("primeKey"))),a.listenTo(this,"derender",a.destroy),c.listenTo(this,"derender",c.derender),b.append(c.render(this.uid)),this.setupFieldInstance(c,b)},this)},createInputName:function(a){return this.createBaseId()+"["+this.Controller.model.get("fieldkey")+"]["+a+"]"},createBaseId:function(){return _.isEmpty(this.Controller.model.get("arrayKey"))?this.Controller.model.get("fieldId"):this.Controller.model.get("fieldId")+"["+this.Controller.model.get("arrayKey")+"]"},derender:function(){this.stopListening(),this.remove()},setupFieldInstance:function(a,b){var c=this;_.defer(function(){a.setElement(b),a.postRender&&a.postRender.call(a),c.Controller.parentView&&_.defer(function(){var b=c.Controller.Fields.findWhere({uid:a.model.get("uid")});if(_.isUndefined(b)){c.Controller.Fields.add(a.model.toJSON())}else b.rebind()})})}})},{"common/Notice":12,"templates/fields/FlexibleFields/single-toggle-box.hbs":44}],31:[function(a,b,c){var d=a("fields/FieldControlBaseView"),e=a("./gallery/GalleryController");b.exports=d.extend({initialize:function(){this.render()},render:function(){
this.$stage=this.$(".kb-gallery--stage"),this.createController()},derender:function(){this.GalleryController.dispose()},rerender:function(){this.derender(),this.render()},createController:function(){return this.GalleryController?(this.GalleryController.setElement(this.$stage.get(0)),this.GalleryController.render()):this.GalleryController=new e({el:this.$stage.get(0),model:this.model})}})},{"./gallery/GalleryController":32,"fields/FieldControlBaseView":17}],32:[function(a,b,c){var d=a("common/Logger"),e=a("./ImageView");b.exports=Backbone.View.extend({initialize:function(a){this._frame=null,this.subviews=[],this.listenTo(KB.Events,"modal.saved",this.frontendSave),this.setupElements(),this.initialSetup(),d.Debug.log("Fields: Gallery instance created and initialized")},events:{"click .kb-gallery--js-add-images":"addImages"},setupElements:function(){this.$list=jQuery('<div class="kb-gallery--item-list"></div>').appendTo(this.$el),this.$list.sortable({revert:!0,delay:300}),this.$addButton=jQuery('<a class="button button-primary kb-gallery--js-add-images">'+KB.i18n.Refields.image.addButton+"</a>").appendTo(this.$el)},addImages:function(){this.openModal()},frame:function(){return this._frame?this._frame:void 0},openModal:function(){var a=this;return this._frame?void this._frame.open():(this._frame=wp.media({title:KB.i18n.Refields.image.modalHelpTitle,button:{text:KB.i18n.Refields.common.select},multiple:!0,library:{type:"image"}}),this._frame.state("library").on("select",function(){a.select(this)}),this._frame.open(),this._frame)},select:function(a){var b=a.get("selection");b.length>0&&this.handleModalSelection(b.models)},handleModalSelection:function(a){var b=this;_.each(a,function(a){var c={file:a.toJSON(),details:{title:"",alt:"",description:""},id:a.get("id")},d=new Backbone.Model(c),f=new e({model:d,Controller:b});b.subviews.push(f),b.$list.append(f.render()),setTimeout(function(){KB.Events.trigger("modal.recalibrate")},250)})},initialSetup:function(){var a=this,b=this.model.get("value").images||{};_.toArray(b).length>0&&_.each(b,function(b){var c=new Backbone.Model(b),d=new e({model:c,Controller:a});a.subviews.push(d),a.$list.append(d.render())})},frontendSave:function(){var a=this;this.subviews.length>0&&_.each(this.subviews,function(b,c){b._remove&&(delete a.subviews[c],b.remove())})}})},{"./ImageView":33,"common/Logger":11}],33:[function(a,b,c){var d=a("common/TinyMCE"),e=a("common/UI"),f=a("templates/fields/Gallery/single-image.hbs");b.exports=Backbone.View.extend({tagName:"div",className:"kb-gallery--image-wrapper",initialize:function(a){this.Controller=a.Controller,this.uid=this.model.get("uid")||_.uniqueId("kbg"),this.editorAdded=!1,this._remove=!1},events:{"click .kb-gallery--js-edit":"edit","click .kb-gallery--js-delete":"delete","click .kb-gallery--js-meta-close":"close"},edit:function(){this.$el.wrap('<div class="kb-gallery--item-placeholder kb-gallery--image-wrapper"></div>'),this._placeholder=this.$el.parent(),this.$el.addClass("kb-gallery--active-item kb_field").appendTo("body"),jQuery("#wpwrap").addClass("module-browser-open"),this.handleEditor(),e.initTabs()},handleEditor:function(){var a=this,b=jQuery(".kb-js--remote-editor",this.$el),c=this.createInputName(this.uid)+"[details][description]";if(this.editorAdded)d.addEditor(b,null,150);else{var f=d.remoteGetEditor(b,c,this.uid,this.model.get("details").description,null,!1,!1);f.done(function(b){a.editorAdded=b,e.initTabs()})}},"delete":function(){this._remove?(this.$el.fadeTo(450,1).css("borderColor","#ccc"),jQuery(".kb-gallery--image-remove",this.$el).val(""),this._remove=!1):(this.$el.fadeTo(450,.5).css("borderColor","red"),this._remove=!0,jQuery(".kb-gallery--image-remove",this.$el).val("true"))},remove:function(){this.$el.remove(),delete this.$el},close:function(){var a=tinymce.get(this.uid+"_ededitor"),b=this.model.get("details");b.description=this.getEditorContent(a),tinymce.remove(a),this.$el.appendTo(this._placeholder).unwrap(),this.$el.removeClass("kb-gallery--active-item").removeClass("kb_field"),jQuery("#wpwrap").removeClass("module-browser-open")},getEditorContent:function(a){var b=jQuery("#wp-"+this.uid+"_ededitor-wrap"),c=b.hasClass("tmce-active");if(c)return a.getContent();var d=document.getElementById(this.uid+"_ededitor").value;return d=d.replace(/<br\s*\/?>/gm,"\n"),a.setContent(d),d},render:function(){var a=this.createInputName(this.uid),b=this.model.toJSON();return this.$el.append(f({image:b,id:b.id,inputName:a,uid:this.uid}))},createInputName:function(a){return this.createBaseId()+"["+this.Controller.model.get("fieldkey")+"][images]["+a+"]"},createBaseId:function(){return _.isEmpty(this.Controller.model.get("arrayKey"))?this.Controller.model.get("baseId"):this.Controller.model.get("baseId")+"["+this.Controller.model.get("arrayKey")+"]"}})},{"common/TinyMCE":14,"common/UI":15,"templates/fields/Gallery/single-image.hbs":45}],34:[function(a,b,c){var d=a("fields/FieldControlBaseView"),e=a("./gallery2/Gallery2Controller");b.exports=d.extend({initialize:function(){this.selection=null,this.render()},render:function(){this.$stage=this.$(".kb-gallery2__stage"),this.createController(),this.$stage.append(this.GalleryController.render())},derender:function(){this.GalleryController&&this.GalleryController.$el.detach()},createController:function(){return this.GalleryController||(this.GalleryController=new e({el:this.$stage.get(0),model:this.model})),this.GalleryController}})},{"./gallery2/Gallery2Controller":35,"fields/FieldControlBaseView":17}],35:[function(a,b,c){var d=a("common/Logger"),e=a("./ImageView");b.exports=Backbone.View.extend({initialize:function(a){this._frame=null,this.subviews={},this.ids=[],d.Debug.log("Fields: Gallery instance created and initialized"),this.renderElements(),this.initialSetup()},render:function(){return this.trigger("render"),this.setupElements(),this.delegateEvents(),this.$el},events:{"click .kb-gallery2--js-add-images":"addImages"},derender:function(){},renderElements:function(){jQuery('<div class="kb-gallery2--item-list"></div>').appendTo(this.$el),jQuery('<a class="button button-primary kb-gallery2--js-add-images">'+KB.i18n.Refields.image.addButton+"</a>").appendTo(this.$el)},setupElements:function(){this.$list=this.$(".kb-gallery2--item-list"),this.$list.sortable({revert:!0,delay:300,stop:_.bind(this.resortSelection,this)})},addImages:function(){this.openModal()},frame:function(){return this._frame?this._frame:void 0},openModal:function(){var a=this;return this._frame?void this._frame.open():(this._frame=new wp.media.view.KBGallery({state:"gallery-edit",multiple:!0,selection:this.selection,editing:!0}),this._frame.state("gallery-edit").on("update",function(b){a.selection=b,a.resortToSelection(),setTimeout(function(){KB.Events.trigger("modal.recalibrate")},250)}),this._frame.options.selection.on("add",function(b){a.add(b)}),this._frame.options.selection.on("remove",function(b){a.remove(b)}),this._frame.open(),this._frame)},initialSetup:function(){var a=this,b=this.model.get("value").images||{};if(this.setIds(b),""!=this.ids){var c={post__in:this.ids},d=wp.media.query(c);this.selection||(this.selection=new wp.media.model.Selection(d.models,{props:d.props.toJSON(),multiple:!0}),this.selection.more().done(function(){a.selection.props.set({query:!1}),a.selection.unmirror(),a.selection.props.unset("orderby"),a.initImages(),a.resortSelection()}))}},initImages:function(){_.each(this.ids,function(a){this.add(this.selection.get(a))},this)},add:function(a){var b=new e({model:a,Controller:this});this.subviews[a.get("id")]=b;var c=b.render();this.ids.push(a.get("id")),this.$list.append(c)},setIds:function(a){var b=[];_.each(a,function(a){a=parseInt(a,10),_.isNumber(a)&&!isNaN(a)&&b.push(a)}),this.ids=b},resortSelection:function(){var a=[],b=this.getIdsFromInputs();_.each(b,function(b){a.push(this.selection.get(b))},this),this.selection.reset(a),this.setIds(b)},remove:function(a){var b=this.ids.indexOf(a.get("id"));-1!==b&&this.ids.splice(b,1);var c=this.subviews[a.get("id")];c.remove(),delete this.subviews[a.get("id")]},getIdsFromInputs:function(){return this.$(".kb-gallery--image-holder input").map(function(a,b){return jQuery(b).val()}).get()},resortToSelection:function(){var a=_.pluck(this.selection.models,"id");_.each(this.subviews,function(a){a.$el.detach()},this),_.each(a,function(a){var b=this.subviews[a];b.$el.appendTo(this.$list)},this)}})},{"./ImageView":36,"common/Logger":11}],36:[function(a,b,c){var d=a("templates/fields/Gallery2/single-image.hbs");b.exports=Backbone.View.extend({tagName:"div",className:"kb-gallery--image-wrapper",initialize:function(a){this.Controller=a.Controller},remove:function(){this.$el.remove(),delete this.$el},render:function(){var a=this.createInputName(this.uid),b=this.model.toJSON();jQuery(d({image:b,id:b.id,inputName:a})).appendTo(this.$el);return this.$el},createInputName:function(a){return this.createBaseId()+"["+this.Controller.model.get("fieldkey")+"][images][]"},createBaseId:function(){return _.isEmpty(this.Controller.model.get("arrayKey"))?this.Controller.model.get("baseId"):this.Controller.model.get("baseId")+"["+this.Controller.model.get("arrayKey")+"]"}})},{"templates/fields/Gallery2/single-image.hbs":46}],37:[function(a,b,c){var d=a("../FieldControlBaseView"),e=a("common/Utilities"),f=a("common/Config");b.exports=d.extend({initialize:function(){this.defaultState="replace-image",this.defaultFrame="image",this.render()},events:{"click .kb-js-add-image":"openFrame","click .kb-js-reset-image":"resetImage"},render:function(){this.$reset=this.$(".kb-js-reset-image"),this.$container=this.$(".kb-field-image-container"),this.$saveId=this.$(".kb-js-image-id"),this.$description=this.$(".kb-js-image-description"),this.$title=this.$(".kb-js-image-title")},editImage:function(){this.openFrame(!0)},derender:function(){this.frame&&this.frame.dispose()},openFrame:function(a){var b,c=this;this.frame&&this.frame.dispose();var d={};""!==this.model.get("value").id&&(d.post__in=[this.model.get("value").id]),wp.media.query(d).more().done(function(){var a=this.first();c.attachment=a,a?(a.set("attachment_id",a.get("id")),b=c.attachment.toJSON()):(b={},c.defaultFrame="select",c.defaultState="library"),c.frame=wp.media({frame:c.defaultFrame,state:c.defaultState,metadata:b,imageEditView:c,type:"image",library:{type:"image"}}).on("update",function(a){c.update(a)}).on("close",function(a){c.frame.image&&c.frame.image.attachment&&(c.$description.val(c.frame.image.attachment.get("caption")),c.$title.val(c.frame.image.attachment.get("title")))}).on("ready",function(){c.ready()}).on("replace",function(){c.replace(c.frame.image.attachment)}).on("select",function(a){var b=this.get("library").get("selection").first();c.replace(b)}).open()})},ready:function(){jQuery(".media-modal").addClass("smaller kb-image-frame")},replace:function(a){this.attachment=a,this.handleAttachment(a)},update:function(a){this.attachment.set(a),this.attachment.sync("update",this.attachment)},handleAttachment:function(a){var b=this,c=a.get("id"),d=this.prepareValue(a),g=_.clone(this.model.get("ModuleModel").get("moduleData")),h=this.model.get("kpath");e.setIndex(g,h,d),this.model.get("ModuleModel").set("moduleData",g);var i={width:b.model.get("width")||null,height:b.model.get("height")||null,crop:b.model.get("crop")||!0,upscale:b.model.get("upscale")||!1};if(i.width&&i.height)jQuery.ajax({url:ajaxurl,data:{action:"fieldGetImage",args:i,id:c,_ajax_nonce:f.getNonce("read")},type:"POST",dataType:"json",success:function(a){b.$container.html('<img src="'+a.data.src+'" >')},error:function(){}});else{var j=a.get("sizes").thumbnail?a.get("sizes").thumbnail.url:a.get("sizes").full.url;this.$container.html('<img src="'+j+'" >')}this.$saveId.val(a.get("id")),this.$description.val(a.get("caption")),this.$title.val(a.get("title")),this.model.get("ModuleModel").trigger("data.updated")},prepareValue:function(a){return{id:a.get("id"),title:a.get("title"),caption:a.get("caption"),alt:a.get("alt")}},resetImage:function(){this.$container.html(""),this.$saveId.val(""),this.model.set("value",{id:null,caption:"",title:""}),this.$description.val(""),this.$title.val("")}})},{"../FieldControlBaseView":17,"common/Config":10,"common/Utilities":16}],38:[function(a,b,c){var d=a("../FieldControlBaseView");b.exports=d.extend({initialize:function(){window._kbLink=this,this.render()},events:{"click .kb-js-add-link":"openModal"},render:function(){this.$input=this.$("[data-kbf-link-url]"),this.$text=this.$("[data-kbf-link-linktext]")},derender:function(){},openModal:function(){wpActiveEditor=this.$input.attr("id"),jQuery("#wp-link-wrap").addClass("kb-customized"),window.kb_restore_htmlUpdate=wpLink.htmlUpdate,window.kb_restore_isMce=wpLink.isMCE,wpLink.isMCE=this.isMCE,wpLink.htmlUpdate=this.htmlUpdate,wpLink.open(),jQuery("#wp-link-text").val(this.$text.val()),jQuery("#wp-link-url").val(this.$input.val())},htmlUpdate:function(){var a,b,c,d=wpLink.textarea;d&&(a=wpLink.getAttrs(),c=jQuery("#wp-link-text").val(),a.href&&"http://"!=a.href&&(b=a.href,jQuery(d).empty(),d.value=b,window._kbLink.trigger("update",c,b),window._kbLink.$text.val(c),wpLink.close(),window._kbLink.close(),d.focus()))},isMCE:function(){return!1},close:function(){wpLink.isMCE=window.kb_restore_isMce,wpLink.htmlUpdate=window.kb_restore_htmlUpdate}})},{"../FieldControlBaseView":17}],39:[function(a,b,c){var d=a("../FieldControlBaseView");b.exports=d.extend({events:{"click .js-oday-activate-split":"split"},initialize:function(){this.render()},render:function(){this.$(".kb-ot-timepicker").datetimepicker({datepicker:!1,format:"H:i",validateOnBlur:!1,step:30})},derender:function(){this.$(".kb-ot-timepicker").datetimepicker("destroy")},split:function(){this.$("table").toggleClass("split")}})},{"../FieldControlBaseView":17}],40:[function(a,b,c){var d=a("../FieldControlBaseView");b.exports=d.extend({initialize:function(){this.render()},render:function(){var a=this;this.$textarea=this.$("textarea"),this.$textarea.on("change",function(){a.update(a.$textarea.val())})},derender:function(){},update:function(a){this.model.set("value",a)}})},{"../FieldControlBaseView":17}],41:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return'<div class="kb-context-bar grid__col grid__col--12-of-12">\n    <ul class="kb-context-bar--actions">\n\n    </ul>\n</div>'},useData:!0})},{"hbsfy/runtime":55}],42:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return"<ul class='module-actions'></ul>"},useData:!0})},{"hbsfy/runtime":55}],43:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f,g=b.helperMissing,h="function",i=this.escapeExpression;return'<input type="hidden" name="'+i((f=null!=(f=b.inputName||(null!=a?a.inputName:a))?f:g,typeof f===h?f.call(a,{name:"inputName",hash:{},data:d}):f))+'[_uid]" value="'+i((f=null!=(f=b.uid||(null!=a?a.uid:a))?f:g,typeof f===h?f.call(a,{name:"uid",hash:{},data:d}):f))+'">\n<div class="flexible-fields--section-box">\n    <div class="flexible-fields--section-title">\n        <h3>\n            <span class="genericon genericon-draggable flexible-fields--js-drag-handle"></span>\n            <span class="dashicons dashicons-trash flexible-fields--js-trash"></span>\n            <input type="text" value="'+i(this.lambda(null!=(e=null!=(e=null!=a?a.item:a)?e._tab:e)?e.title:e,a))+'" name="'+i((f=null!=(f=b.inputName||(null!=a?a.inputName:a))?f:g,typeof f===h?f.call(a,{name:"inputName",hash:{},data:d}):f))+'[_tab][title] ">\n        </h3>\n    </div>\n    <div class="kb-field--tabs kb_fieldtabs">\n        <ul class="flexible-field--tab-nav">\n\n        </ul>\n\n    </div>\n</div>'},useData:!0})},{"hbsfy/runtime":55}],44:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f,g=b.helperMissing,h="function",i=this.escapeExpression;return'<input type="hidden" name="'+i((f=null!=(f=b.inputName||(null!=a?a.inputName:a))?f:g,typeof f===h?f.call(a,{name:"inputName",hash:{},data:d}):f))+'[_uid]" value="'+i((f=null!=(f=b.uid||(null!=a?a.uid:a))?f:g,typeof f===h?f.call(a,{name:"uid",hash:{},data:d}):f))+'">\n<div class="flexible-fields--toggle-title">\n    <h3>\n        <span class="genericon genericon-draggable flexible-fields--js-drag-handle"></span>\n        <span class="genericon genericon-expand flexible-fields--js-toggle"></span>\n        <span class="dashicons dashicons-trash flexible-fields--js-trash"></span>\n\n        <input type="text" value="'+i(this.lambda(null!=(e=null!=(e=null!=a?a.item:a)?e._tab:e)?e.title:e,a))+'" name="'+i((f=null!=(f=b.inputName||(null!=a?a.inputName:a))?f:g,typeof f===h?f.call(a,{name:"inputName",hash:{},data:d}):f))+'[_tab][title] ">\n    </h3>\n</div>\n<div class="flexible-fields--toggle-box kb-hide">\n    <div class="kb-field--tabs kb_fieldtabs">\n        <ul class="flexible-field--tab-nav">\n\n        </ul>\n    </div>\n\n</div>'},useData:!0})},{"hbsfy/runtime":55}],45:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f,g=b.helperMissing,h="function",i=this.escapeExpression,j=this.lambda;return'<div class="kb-gallery--header">\n    <h3>Image Details</h3>\n</div>\n<div class="kb-gallery--left-column">\n    <div class="kb-gallery--image-meta" style="display: none;">\n        <span class="genericon genericon-close-alt kb-gallery--js-meta-close"></span>\n\n        <div class="kb_fieldtabs kb-field--tabs">\n            <ul class="kb-gallery--tabs-nav">\n                <li><a href="#tab'+i((f=null!=(f=b.uid||(null!=a?a.uid:a))?f:g,typeof f===h?f.call(a,{name:"uid",hash:{},data:d}):f))+'-1">Details</a></li>\n                <li><a href="#tab'+i((f=null!=(f=b.uid||(null!=a?a.uid:a))?f:g,typeof f===h?f.call(a,{name:"uid",hash:{},data:d}):f))+'-2">Beschreibung</a></li>\n            </ul>\n            <div id="tab'+i((f=null!=(f=b.uid||(null!=a?a.uid:a))?f:g,typeof f===h?f.call(a,{name:"uid",hash:{},data:d}):f))+'-1">\n                <div class="kb-gallery--meta-field kb-field">\n                    <label class="heading">Titel</label>\n                    <input class="large" type="text" name="'+i((f=null!=(f=b.inputName||(null!=a?a.inputName:a))?f:g,typeof f===h?f.call(a,{name:"inputName",hash:{},data:d}):f))+'[details][title]" value="'+i(j(null!=(e=null!=(e=null!=a?a.image:a)?e.details:e)?e.title:e,a))+'">\n                </div>\n                <div class="kb-gallery--meta-field kb-field">\n                    <label class="heading">Alt</label>\n                    <input class="large" type="text" name="'+i((f=null!=(f=b.inputName||(null!=a?a.inputName:a))?f:g,typeof f===h?f.call(a,{name:"inputName",hash:{},data:d}):f))+'[details][alt]" value="'+i(j(null!=(e=null!=(e=null!=a?a.image:a)?e.details:e)?e.alt:e,a))+'">\n                </div>\n            </div>\n\n            <div id="tab'+i((f=null!=(f=b.uid||(null!=a?a.uid:a))?f:g,typeof f===h?f.call(a,{name:"uid",hash:{},data:d}):f))+'-2">\n                <div class="kb-js--remote-editor" data-uid="'+i((f=null!=(f=b.uid||(null!=a?a.uid:a))?f:g,typeof f===h?f.call(a,{name:"uid",hash:{},data:d}):f))+'">\n                    <textarea name="'+i((f=null!=(f=b.inputName||(null!=a?a.inputName:a))?f:g,typeof f===h?f.call(a,{name:"inputName",hash:{},data:d}):f))+'[details][description]">'+i(j(null!=(e=null!=(e=null!=a?a.image:a)?e.details:e)?e.description:e,a))+'</textarea>\n                </div>\n\n            </div>\n        </div>\n    </div>\n</div>\n<div class="kb-gallery--right-column">\n    <div class="kb-gallery--image-holder">\n        <img src="'+i(j(null!=(e=null!=(e=null!=(e=null!=(e=null!=a?a.image:a)?e.file:e)?e.sizes:e)?e.thumbnail:e)?e.url:e,a))+'">\n        <span class="genericon genericon-edit kb-gallery--js-edit"></span>\n        <span class="genericon genericon-close-alt kb-gallery--js-delete"></span>\n        <input type="hidden" name="'+i((f=null!=(f=b.inputName||(null!=a?a.inputName:a))?f:g,typeof f===h?f.call(a,{name:"inputName",hash:{},data:d}):f))+'[id]" value="'+i(j(null!=(e=null!=a?a.image:a)?e.id:e,a))+'">\n        <input type="hidden" class="kb-gallery--image-remove" name="'+i((f=null!=(f=b.inputName||(null!=a?a.inputName:a))?f:g,typeof f===h?f.call(a,{name:"inputName",hash:{},data:d}):f))+'[remove]" value="">\n    </div>\n</div>'},useData:!0})},{"hbsfy/runtime":55}],46:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f,g=this.lambda,h=this.escapeExpression;return'<div class="kb-gallery--right-column">\n    <div class="kb-gallery--image-holder">\n        <img src="'+h(g(null!=(e=null!=(e=null!=(e=null!=a?a.image:a)?e.sizes:e)?e.thumbnail:e)?e.url:e,a))+'">\n        <input type="hidden" name="'+h((f=null!=(f=b.inputName||(null!=a?a.inputName:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"inputName",hash:{},data:d}):f))+'" value="'+h(g(null!=(e=null!=a?a.image:a)?e.id:e,a))+'">\n    </div>\n</div>'},useData:!0})},{"hbsfy/runtime":55}],47:[function(a,b,c){"use strict";function d(){var a=new g.HandlebarsEnvironment;return m.extend(a,g),a.SafeString=i["default"],a.Exception=k["default"],a.Utils=m,a.escapeExpression=m.escapeExpression,a.VM=o,a.template=function(b){return o.template(b,a)},a}var e=function(a){return a&&a.__esModule?a:{"default":a}};c.__esModule=!0;var f=a("./handlebars/base"),g=e(f),h=a("./handlebars/safe-string"),i=e(h),j=a("./handlebars/exception"),k=e(j),l=a("./handlebars/utils"),m=e(l),n=a("./handlebars/runtime"),o=e(n),p=a("./handlebars/no-conflict"),q=e(p),r=d();r.create=d,q["default"](r),r["default"]=r,c["default"]=r,b.exports=c["default"]},{"./handlebars/base":48,"./handlebars/exception":49,"./handlebars/no-conflict":50,"./handlebars/runtime":51,"./handlebars/safe-string":52,"./handlebars/utils":53}],48:[function(a,b,c){"use strict";function d(a,b){this.helpers=a||{},this.partials=b||{},e(this)}function e(a){a.registerHelper("helperMissing",function(){if(1===arguments.length)return void 0;throw new k["default"]('Missing helper: "'+arguments[arguments.length-1].name+'"')}),a.registerHelper("blockHelperMissing",function(b,c){var d=c.inverse,e=c.fn;if(b===!0)return e(this);if(b===!1||null==b)return d(this);if(o(b))return b.length>0?(c.ids&&(c.ids=[c.name]),a.helpers.each(b,c)):d(this);if(c.data&&c.ids){var g=f(c.data);g.contextPath=i.appendContextPath(c.data.contextPath,c.name),c={data:g}}return e(b,c)}),a.registerHelper("each",function(a,b){function c(b,c,e){j&&(j.key=b,j.index=c,j.first=0===c,j.last=!!e,l&&(j.contextPath=l+b)),h+=d(a[b],{data:j,blockParams:i.blockParams([a[b],b],[l+b,null])})}if(!b)throw new k["default"]("Must pass iterator to #each");var d=b.fn,e=b.inverse,g=0,h="",j=void 0,l=void 0;if(b.data&&b.ids&&(l=i.appendContextPath(b.data.contextPath,b.ids[0])+"."),p(a)&&(a=a.call(this)),b.data&&(j=f(b.data)),a&&"object"==typeof a)if(o(a))for(var m=a.length;m>g;g++)c(g,g,g===a.length-1);else{var n=void 0;for(var q in a)a.hasOwnProperty(q)&&(n&&c(n,g-1),n=q,g++);n&&c(n,g-1,!0)}return 0===g&&(h=e(this)),h}),a.registerHelper("if",function(a,b){return p(a)&&(a=a.call(this)),!b.hash.includeZero&&!a||i.isEmpty(a)?b.inverse(this):b.fn(this)}),a.registerHelper("unless",function(b,c){return a.helpers["if"].call(this,b,{fn:c.inverse,inverse:c.fn,hash:c.hash})}),a.registerHelper("with",function(a,b){p(a)&&(a=a.call(this));var c=b.fn;if(i.isEmpty(a))return b.inverse(this);if(b.data&&b.ids){var d=f(b.data);d.contextPath=i.appendContextPath(b.data.contextPath,b.ids[0]),b={data:d}}return c(a,b)}),a.registerHelper("log",function(b,c){var d=c.data&&null!=c.data.level?parseInt(c.data.level,10):1;a.log(d,b)}),a.registerHelper("lookup",function(a,b){return a&&a[b]})}function f(a){var b=i.extend({},a);return b._parent=a,b}var g=function(a){return a&&a.__esModule?a:{"default":a}};c.__esModule=!0,c.HandlebarsEnvironment=d,c.createFrame=f;var h=a("./utils"),i=g(h),j=a("./exception"),k=g(j),l="3.0.1";c.VERSION=l;var m=6;c.COMPILER_REVISION=m;var n={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1"};c.REVISION_CHANGES=n;var o=i.isArray,p=i.isFunction,q=i.toString,r="[object Object]";d.prototype={constructor:d,logger:s,log:t,registerHelper:function(a,b){if(q.call(a)===r){if(b)throw new k["default"]("Arg not supported with multiple helpers");i.extend(this.helpers,a)}else this.helpers[a]=b},unregisterHelper:function(a){delete this.helpers[a]},registerPartial:function(a,b){if(q.call(a)===r)i.extend(this.partials,a);else{if("undefined"==typeof b)throw new k["default"]("Attempting to register a partial as undefined");this.partials[a]=b}},unregisterPartial:function(a){delete this.partials[a]}};var s={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:1,log:function(a,b){if("undefined"!=typeof console&&s.level<=a){var c=s.methodMap[a];(console[c]||console.log).call(console,b)}}};c.logger=s;var t=s.log;c.log=t},{"./exception":49,"./utils":53}],49:[function(a,b,c){"use strict";function d(a,b){var c=b&&b.loc,f=void 0,g=void 0;c&&(f=c.start.line,g=c.start.column,a+=" - "+f+":"+g);for(var h=Error.prototype.constructor.call(this,a),i=0;i<e.length;i++)this[e[i]]=h[e[i]];Error.captureStackTrace&&Error.captureStackTrace(this,d),c&&(this.lineNumber=f,this.column=g)}c.__esModule=!0;var e=["description","fileName","lineNumber","message","name","number","stack"];d.prototype=new Error,c["default"]=d,b.exports=c["default"]},{}],50:[function(a,b,c){"use strict";c.__esModule=!0,c["default"]=function(a){var b="undefined"!=typeof global?global:window,c=b.Handlebars;a.noConflict=function(){b.Handlebars===a&&(b.Handlebars=c)}},b.exports=c["default"]},{}],51:[function(a,b,c){"use strict";function d(a){var b=a&&a[0]||1,c=p.COMPILER_REVISION;if(b!==c){if(c>b){var d=p.REVISION_CHANGES[c],e=p.REVISION_CHANGES[b];throw new o["default"]("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+d+") or downgrade your runtime to an older version ("+e+").")}throw new o["default"]("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+a[1]+").")}}function e(a,b){function c(c,d,e){e.hash&&(d=m.extend({},d,e.hash)),c=b.VM.resolvePartial.call(this,c,d,e);var f=b.VM.invokePartial.call(this,c,d,e);if(null==f&&b.compile&&(e.partials[e.name]=b.compile(c,a.compilerOptions,b),f=e.partials[e.name](d,e)),null!=f){if(e.indent){for(var g=f.split("\n"),h=0,i=g.length;i>h&&(g[h]||h+1!==i);h++)g[h]=e.indent+g[h];f=g.join("\n")}return f}throw new o["default"]("The partial "+e.name+" could not be compiled when running in runtime-only mode")}function d(b){var c=void 0===arguments[1]?{}:arguments[1],f=c.data;d._setup(c),!c.partial&&a.useData&&(f=j(b,f));var g=void 0,h=a.useBlockParams?[]:void 0;return a.useDepths&&(g=c.depths?[b].concat(c.depths):[b]),a.main.call(e,b,e.helpers,e.partials,f,h,g)}if(!b)throw new o["default"]("No environment passed to template");if(!a||!a.main)throw new o["default"]("Unknown template object: "+typeof a);b.VM.checkRevision(a.compiler);var e={strict:function(a,b){if(!(b in a))throw new o["default"]('"'+b+'" not defined in '+a);return a[b]},lookup:function(a,b){for(var c=a.length,d=0;c>d;d++)if(a[d]&&null!=a[d][b])return a[d][b]},lambda:function(a,b){return"function"==typeof a?a.call(b):a},escapeExpression:m.escapeExpression,invokePartial:c,fn:function(b){return a[b]},programs:[],program:function(a,b,c,d,e){var g=this.programs[a],h=this.fn(a);return b||e||d||c?g=f(this,a,h,b,c,d,e):g||(g=this.programs[a]=f(this,a,h)),g},data:function(a,b){for(;a&&b--;)a=a._parent;return a},merge:function(a,b){var c=a||b;return a&&b&&a!==b&&(c=m.extend({},b,a)),c},noop:b.VM.noop,compilerInfo:a.compiler};return d.isTop=!0,d._setup=function(c){c.partial?(e.helpers=c.helpers,e.partials=c.partials):(e.helpers=e.merge(c.helpers,b.helpers),a.usePartial&&(e.partials=e.merge(c.partials,b.partials)))},d._child=function(b,c,d,g){if(a.useBlockParams&&!d)throw new o["default"]("must pass block params");if(a.useDepths&&!g)throw new o["default"]("must pass parent depths");return f(e,b,a[b],c,0,d,g)},d}function f(a,b,c,d,e,f,g){function h(b){var e=void 0===arguments[1]?{}:arguments[1];return c.call(a,b,a.helpers,a.partials,e.data||d,f&&[e.blockParams].concat(f),g&&[b].concat(g))}return h.program=b,h.depth=g?g.length:0,h.blockParams=e||0,h}function g(a,b,c){return a?a.call||c.name||(c.name=a,a=c.partials[a]):a=c.partials[c.name],a}function h(a,b,c){if(c.partial=!0,void 0===a)throw new o["default"]("The partial "+c.name+" could not be found");return a instanceof Function?a(b,c):void 0}function i(){return""}function j(a,b){return b&&"root"in b||(b=b?p.createFrame(b):{},b.root=a),b}var k=function(a){return a&&a.__esModule?a:{"default":a}};c.__esModule=!0,c.checkRevision=d,c.template=e,c.wrapProgram=f,c.resolvePartial=g,c.invokePartial=h,c.noop=i;var l=a("./utils"),m=k(l),n=a("./exception"),o=k(n),p=a("./base")},{"./base":48,"./exception":49,"./utils":53}],52:[function(a,b,c){"use strict";function d(a){this.string=a}c.__esModule=!0,d.prototype.toString=d.prototype.toHTML=function(){return""+this.string},c["default"]=d,b.exports=c["default"]},{}],53:[function(a,b,c){"use strict";function d(a){return k[a]}function e(a){for(var b=1;b<arguments.length;b++)for(var c in arguments[b])Object.prototype.hasOwnProperty.call(arguments[b],c)&&(a[c]=arguments[b][c]);return a}function f(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1}function g(a){if("string"!=typeof a){if(a&&a.toHTML)return a.toHTML();if(null==a)return"";if(!a)return a+"";a=""+a}return m.test(a)?a.replace(l,d):a}function h(a){return a||0===a?p(a)&&0===a.length?!0:!1:!0}function i(a,b){return a.path=b,a}function j(a,b){return(a?a+".":"")+b}c.__esModule=!0,c.extend=e,c.indexOf=f,c.escapeExpression=g,c.isEmpty=h,c.blockParams=i,c.appendContextPath=j;var k={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},l=/[&<>"'`]/g,m=/[&<>"'`]/,n=Object.prototype.toString;c.toString=n;var o=function(a){return"function"==typeof a};o(/x/)&&(c.isFunction=o=function(a){return"function"==typeof a&&"[object Function]"===n.call(a)});var o;c.isFunction=o;var p=Array.isArray||function(a){return a&&"object"==typeof a?"[object Array]"===n.call(a):!1};c.isArray=p},{}],54:[function(a,b,c){b.exports=a("./dist/cjs/handlebars.runtime")["default"]},{"./dist/cjs/handlebars.runtime":47}],55:[function(a,b,c){b.exports=a("handlebars/runtime")["default"]},{"handlebars/runtime":54}]},{},[21]);