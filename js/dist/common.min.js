/*! Kontentblocks ProdVersion 2014-11-23 02:11 */
var KB=KB||{};KB.Config={},KB.Backbone={Backend:{},Frontend:{},Shared:{}},KB.Fields={},KB.Utils={},KB.Ext={},KB.OSConfig={},KB.IEdit={},KB.Events={},_.extend(KB,Backbone.Events),_.extend(KB.Events,Backbone.Events),KB.Ajax=function($){return{send:function(data,callback,scope){var pid;pid=data.postId?data.postId:KB.Environment&&KB.Environment.postId?KB.Environment.postId:!1;var sned=_.extend({supplemental:data.supplemental||{},count:parseInt(KB.Environment.moduleCount,10),nonce:$("#_kontentblocks_ajax_nonce").val(),post_id:pid,kbajax:!0},data);return $("#publish").attr("disabled","disabled"),$.ajax({url:ajaxurl,data:sned,type:"POST",dataType:"json",success:function(data){data&&(scope&&callback?callback.call(scope,data):callback&&callback(data))},error:function(){KB.notice("<p>Generic Ajax Error</p>","error")},complete:function(){$("#publish").removeAttr("disabled")}})}}}(jQuery),KB.Checks=function($){return{blockLimit:function(areamodel){var limit=areamodel.get("limit"),children=$("#"+areamodel.get("id")+" li.kb-module").length;return 0!==limit&&children===limit?!1:!0},userCan:function(cap){var check=$.inArray(cap,KB.Config.get("caps"));return-1!==check}}}(jQuery),KB.Config=function(){var config=KB.appData.config;return{get:function(key){return key?config[key]?config[key]:null:config},getNonce:function(mode){var modes=["update","create","delete","read"];return-1!==_.indexOf(modes,mode)?config.nonces[mode]:(_K.error("Invalid nonce requested in kb.cm.Config.js"),null)},inDevMode:function(){return config.env.dev},getRootURL:function(){return config.env.url},getHash:function(){return config.env.hash}}}(jQuery),_.extend(KB.Fields,Backbone.Events),_.extend(KB.Fields,{fields:{},addEvent:function(){this.listenTo(KB,"kb:ready",this.init),this.listenTo(this,"newModule",this.newModule)},register:function(id,object){_.extend(object,Backbone.Events),this.fields[id]=object},init:function(){var that=this;_.each(this.fields,function(object){object.hasOwnProperty("init")&&object.init.call(object),object.listenTo(that,"update",object.update),object.listenTo(that,"frontUpdate",object.frontUpdate)})},newModule:function(object){_K.info("new Module added for Fields");var that=this;object.listenTo(this,"update",object.update),object.listenTo(this,"frontUpdate",object.frontUpdate),setTimeout(function(){that.trigger("update")},750)},get:function(id){return this.fields[id]?this.fields[id]:null}}),KB.Fields.addEvent(),Logger.useDefaults();var _K=Logger.get("_K"),_KS=Logger.get("_KS");_K.setLevel(_K.INFO),_KS.setLevel(_KS.INFO),KB.Config.inDevMode()||_K.setLevel(Logger.OFF),console.log(_K),Logger.setHandler(function(messages,context){if(KB.Menubar&&2===context.level.value&&"_KS"===context.name)messages[0]&&KB.Menubar.StatusBar.setMsg(messages[0]);else{var console=window.console,hdlr=console.log;context.name&&(messages[0]="["+context.name+"] "+messages[0]),context.level===Logger.WARN&&console.warn?hdlr=console.warn:context.level===Logger.ERROR&&console.error?hdlr=console.error:context.level===Logger.INFO&&console.info&&(hdlr=console.info),hdlr.apply(console,messages)}}),KB.Utils.MediaWorkflow=function(args){function frame(){return _frame?_frame:(_frame=wp.media({title:options.title,button:{text:options.buttontext},multiple:options.multiple,library:{type:options.type}}),_frame.on("ready",ready),_frame.state("library").on("select",select),_frame)}function init(args){options=_.isUndefined(args)?_.extend(defaults,{}):_.extend(defaults,args),frame().open()}function ready(){}function select(){options.select===!1&&alert("No callback given"),options.select(this)}var _frame,options,defaults={buttontext:"Buttontext",multiple:!1,type:"image",title:"",select:!1,ready:!1};init(args)},KB.Menus=function($){return{loadingContainer:null,initiatorEl:null,sendButton:null,createSanitizedId:function(el,mode){this.initiatorEl=$(el),this.loadingContainer=this.initiatorEl.closest(".kb-menu-field").addClass("loading"),this.$sendButton=$("#kb-submit"),this.disableSendButton(),KB.Ajax.send({inputvalue:el.value,checkmode:mode,action:"getSanitizedId",_ajax_nonce:KB.Config.getNonce("read")},this.insertId,this)},insertId:function(res){"translate"===res?(this.initiatorEl.addClass(),$(".kb-js-area-id").val("Please chose a different name")):($(".kb-js-area-id").val(res),this.enableSendButton()),this.loadingContainer.removeClass("loading")},disableSendButton:function(){this.$sendButton.attr("disabled","disabled").val("Disabled")},enableSendButton:function(){this.$sendButton.attr("disabled",!1).val("Create")}}}(jQuery),KB.Backbone.ModulesDefinitionsCollection=Backbone.Collection.extend({initialize:function(models,options){this.area=options.area},setup:function(){return this.categories=this.prepareCategories(),this.sortToCategories(),this},getModules:function(id){return this.categories[id].modules},sortToCategories:function(){var that=this;_.each(this.models,function(model){if(that.validateVisibility(model)){var cat=_.isUndefined(model.get("settings").category)?"standard":model.get("settings").category;that.categories[cat].modules.push(model)}})},validateVisibility:function(m){return m.get("settings").hidden?!1:m.get("settings").disabled?!1:!(!m.get("settings").globallyAvailable&&this.area.model.get("dynamic"))},prepareCategories:function(){var cats={};return _.each(KB.payload.ModuleCategories,function(item,key){cats[key]={id:key,name:item,modules:[]}}),cats}}),KB.Backbone.ModuleBrowserModuleDescription=Backbone.View.extend({initialize:function(options){this.options=options||{},this.options.browser.on("browser:close",this.close,this)},update:function(){this.$el.empty(),this.model.get("template")?this.$el.html(KB.Templates.render("backend/modulebrowser/module-template-description",{module:this.model.toJSON()})):this.$el.html(KB.Templates.render("backend/modulebrowser/module-description",{module:this.model.toJSON()})),this.model.get("settings").poster!==!1&&this.$el.append(KB.Templates.render("backend/modulebrowser/poster",{module:this.model.toJSON()})),this.model.get("settings").helpfile!==!1&&this.$el.append(KB.Templates.render(this.model.get("settings").helpfile,{module:this.model.toJSON()}))},close:function(){}}),KB.Backbone.ModuleBrowserListItem=Backbone.View.extend({tagName:"li",className:"modules-list-item",initialize:function(options){this.options=options||{},this.area=options.browser.area},render:function(el){this.model.get("template")?this.$el.html(KB.Templates.render("backend/modulebrowser/module-template-list-item",{module:this.model.toJSON()})):this.$el.html(KB.Templates.render("backend/modulebrowser/module-list-item",{module:this.model.toJSON()})),el.append(this.$el)},events:{click:"loadDetails","click .kb-js-create-module":"createModule"},loadDetails:function(){this.options.browser.loadDetails(this.model)},createModule:function(){this.options.browser.createModule(this.model)},close:function(){this.remove()}}),KB.Backbone.ModuleBrowserModulesList=Backbone.View.extend({initialize:function(options){this.options=options||{}},modules:{},subviews:{},setModules:function(modules){return this.modules=modules,this},update:function(){var that=this,first=!1;this.$el.empty(),_.each(this.modules,function(module){that.subviews[module.cid]=new KB.Backbone.ModuleBrowserListItem({model:module,parent:that,browser:that.options.browser}),first===!1&&(that.options.browser.loadDetails(module),first=!first),that.$el.append(that.subviews[module.cid].render(that.$el))})}}),KB.Backbone.ModuleBrowser=Backbone.View.extend({initialize:function(options){this.options=options||{},_K.info("module browser initialized"),this.area=this.options.area,this.modulesDefinitions=new KB.Backbone.ModulesDefinitionsCollection(this.prepareAssignedModules(),{model:KB.Backbone.ModuleDefinition,area:this.options.area}).setup();var viewMode=this.getViewMode();this.$el.append(KB.Templates.render("backend/modulebrowser/module-browser",{viewMode:viewMode})),this.subviews.ModulesList=new KB.Backbone.ModuleBrowserModulesList({el:jQuery(".modules-list",this.$el),browser:this}),this.subviews.ModuleDescription=new KB.Backbone.ModuleBrowserModuleDescription({el:jQuery(".module-description",this.$el),browser:this}),this.subviews.Navigation=new KB.Backbone.ModuleBrowserNavigation({el:jQuery(".module-categories",this.$el),cats:this.modulesDefinitions.categories,browser:this}),this.listenTo(this.subviews.Navigation,"browser:change",this.update),this.listenTo(this.subviews.ModulesList,"createModule",this.createModule)},tagName:"div",id:"module-browser",className:"kb-overlay",events:{"click .close-browser":"close","click .module-browser--switch__list-view":"toggleViewMode","click .module-browser--switch__excerpt-view":"toggleViewMode"},subviews:{},toggleViewMode:function(){jQuery(".module-browser-wrapper",this.$el).toggleClass("module-browser--list-view module-browser--excerpt-view");var abbr="mdb_"+this.area.model.get("id")+"_state",curr=store.get(abbr);"module-browser--list-view"==curr?store.set(abbr,"module-browser--excerpt-view"):store.set(abbr,"module-browser--list-view")},render:function(){this.open()},getViewMode:function(){var abbr="mdb_"+this.area.model.get("id")+"_state";return store.get(abbr)?store.get(abbr):(store.set(abbr,"module-browser--list-view"),"module-browser--list-view")},open:function(){this.$el.appendTo("body"),jQuery("#wpwrap").addClass("module-browser-open"),jQuery(".nano").nanoScroller({flash:!0})},close:function(){jQuery("#wpwrap").removeClass("module-browser-open"),this.trigger("browser:close"),this.$el.detach()},update:function(model){var id=model.get("id"),modules=this.modulesDefinitions.getModules(id);this.subviews.ModulesList.setModules(modules).update()},loadDetails:function(model){this.subviews.ModuleDescription.model=model,this.subviews.ModuleDescription.update()},createModule:function(module){var Area,data;return KB.Checks.userCan("create_kontentblocks")||KB.Notice.notice("You're not allowed to do this","error"),Area=KB.Areas.get(this.options.area.model.get("id")),KB.Checks.blockLimit(Area)?(data={action:"createNewModule","class":module.get("settings").class,master:module.get("master"),master_id:module.get("master_id"),parentId:module.get("master_id"),template:module.get("template"),templateObj:module.get("templateObj"),viewfile:module.get("viewfile"),duplicate:module.get("duplicate"),areaContext:this.options.area.model.get("context"),area:this.options.area.model.get("id"),_ajax_nonce:KB.Config.getNonce("create"),frontend:KB.appData.config.frontend},this.close(),KB.Ajax.send(data,this.success,this),void 0):(KB.Notice.notice("Limit for this area reached","error"),!1)},success:function(data){var model;this.options.area.modulesList.append(data.html),model=KB.Modules.add(new KB.Backbone.Backend.ModuleModel(data.module)),this.options.area.addModuleView(model.view),_K.info("new module created",{view:model.view}),this.parseAdditionalJSON(data.json),KB.TinyMCE.addEditor(model.view.$el),KB.Fields.trigger("newModule",KB.Views.Modules.lastViewAdded),KB.Views.Modules.lastViewAdded.$el.addClass("kb-open"),KB.Environment.moduleCount++},parseAdditionalJSON:function(json){KB.payload.Fields||(KB.payload.Fields={}),_.extend(KB.payload.Fields,json.Fields)},prepareAssignedModules:function(){var assignedModules=this.area.model.get("assignedModules"),fullDefs=[];return _.each(KB.payload.ModuleDefinitions,function(module){-1!==_.indexOf(assignedModules,module.settings.class)&&fullDefs.push(module)}),fullDefs}}),KB.Backbone.ModuleBrowserNavigation=Backbone.View.extend({item:Backbone.View.extend({initialize:function(options){this.options=options||{}},tagName:"li",className:"cat-item",events:{click:"change"},change:function(){this.options.parent.trigger("browser:change",this.model),this.$el.addClass("active"),jQuery("li").not(this.$el).removeClass("active")},render:function(){var count=_.keys(this.model.get("modules")).length,countstr="("+count+")";return 0===count?!1:(this.options.parent.catSet===!1&&(this.options.parent.catSet=!0,this.options.browser.update(this.model),this.$el.addClass("active")),this.options.parent.$list.append(this.$el.html(this.model.get("name")+'<span class="module-count">'+countstr+"</span>")),void 0)}}),catSet:!1,initialize:function(options){var that=this;this.options=options||{},this.$list=jQuery("<ul></ul>").appendTo(this.$el),_.each(this.options.cats,function(cat){var model=new Backbone.Model(cat);new that.item({parent:that,model:model,browser:that.options.browser}).render()})}}),KB.Notice=function(){"use strict";return{notice:function(msg,type){alertify.log(msg,type,3500)},confirm:function(msg,yes,no,scope){alertify.confirm(msg,function(e){e?yes.call(scope):no.call(scope)})}}}(jQuery),KB.Payload=function(){return{getFieldData:function(type,moduleId,key,arrayKey){var typeData;return this._typeExists(type)?(typeData=KB.payload.fieldData[type],typeData[moduleId]?_.isEmpty(arrayKey)?typeData[moduleId][key]?typeData[moduleId][key]:[]:typeData[moduleId][arrayKey]?typeData[moduleId][arrayKey][key]?typeData[moduleId][arrayKey][key]:[]:[]:[]):[]},_typeExists:function(type){return!_.isUndefined(KB.payload.fieldData[type])},getFieldArgs:function(id,key){return KB.payload.Fields&&KB.payload.Fields[id]?key&&KB.payload.Fields[id][key]?KB.payload.Fields[id][key]:KB.payload.Fields[id]:null}}}(jQuery),KB.Backbone.Frontend.StatusBar=Backbone.View.extend({messages:[],className:"kb-statusbar kb-brand",initialize:function(){this.$statusbar=jQuery('<span class="kb-brand kb-status-bar">Kontentblocks</span>').appendTo(this.$el),this.interval(this.handleMsg,500,1e4)},reset:function(){this.$statusbar.text("kontentblocks")},setMsg:function(msg){this.messages.push(msg)},printMsg:function(msg){var that=this;this.$statusbar.fadeTo(50,0,function(){that.$statusbar.text(msg),that.$statusbar.fadeTo(50,1)})},handleMsg:function(){this.messages.length>0&&this.printMsg(this.messages.shift())},interval:function(func,wait,times){var that=this,interv=function(w,t){return function(){if("undefined"==typeof t||t-->0){setTimeout(interv,w);try{func.call(that)}catch(e){throw t=0,e.toString()}}}}(wait,times);setTimeout(interv,wait)}}),KB.Templates=function($){function render(tplName,tplData){var tplString;if(!templateCache[tplName]){var tplDir=KB.Config.getRootURL()+"js/templates",tplUrl=tplDir+"/"+tplName+".hbs?"+KB.Config.getHash(),pat=/^https?:\/\//i;pat.test(tplName)&&(tplUrl=tplName),KB.Util.stex.get(tplUrl)?tplString=KB.Util.stex.get(tplUrl):$.ajax({url:tplUrl,method:"GET",async:!1,success:function(data){tplString=data,KB.Util.stex.set(tplUrl,tplString,12e4)}}),templateCache[tplName]=HandlebarsKB.compile(tplString)}return templateCache[tplName](tplData)}function helpfile(helpfileUrl){if(!helpfileCache[helpfileUrl]){var helpfileString;$.ajax({url:helpfileUrl,method:"GET",async:!1,dataType:"html",success:function(data){helpfileString=data}}),helpfileCache[helpfileUrl]=helpfileUrl}return helpfileCache[helpfileUrl]}var templateCache={},helpfileCache={};return{render:render,helpfile:helpfile}}(jQuery),KB.TinyMCE=function($){return{removeEditors:function(){$(".wp-editor-area").each(function(){if("wp-content-wrap"===$(this).attr("id")||"wp-ghosteditor-wrap"===$(this).attr("id"));else{var textarea=this.id;tinyMCE.execCommand("mceRemoveEditor",!1,textarea)}})},restoreEditors:function(){$(".wp-editor-wrap").each(function(){var settings=tinyMCEPreInit.mceInit.ghosteditor,id=$(this).find("textarea").attr("id");settings.elements=id,settings.selector="#"+id,settings.id=id,settings.height=350,settings.setup=function(ed){ed.on("init",function(){KB.Events.trigger("KB::tinymce.new-editor",ed)}),ed.on("change",function(){var $module;ed.module||($module=jQuery(ed.editorContainer).closest(".kb-module"),ed.module=KB.Views.Modules.get($module.attr("id"))),ed.module.$el.trigger("tinymce.change")})},tinymce.init(settings)})},addEditor:function($el,quicktags,height,watch){if(!$el)return _K.error("No scope element ($el) provided"),!1;if(_.isUndefined(tinyMCEPreInit))return!1;var settings=tinyMCEPreInit.mceInit.ghosteditor,edHeight=height||350,live=_.isUndefined(watch)?!0:!1;$(".wp-editor-area",$el).each(function(){var id=this.id;settings.elements=id,settings.selector="#"+id,settings.id=id,settings.kblive=live,settings.height=edHeight,settings.setup=function(ed){ed.on("init",function(){KB.Events.trigger("KB::tinymce.new-editor",ed)}),ed.on("change",function(){var $module;ed.module||($module=jQuery(ed.editorContainer).closest(".kb-module"),ed.module=KB.Views.Modules.get($module.attr("id"))),ed.module.$el.trigger("tinymce.change")})},tinymce.init(settings),tinyMCEPreInit.mceInit[id]||(tinyMCEPreInit.mceInit[id]=settings);var qtsettings={buttons:"",disabled_buttons:"",id:id},qts=jQuery("#qt_"+id+"_toolbar");qts.length||new QTags(qtsettings)}),setTimeout(function(){$(".wp-editor-wrap",$el).removeClass("html-active").addClass("tmce-active"),QTags._buttonsInit()},1500)},remoteGetEditor:function($el,name,id,content,post_id,media,watch){var pid=post_id||KB.appData.config.post.ID,id=id||$el.attr("id");if(!media)var media=!1;var editorContent=content||"";return KB.Ajax.send({action:"getRemoteEditor",editorId:id+"_ed",editorName:name,post_id:pid,editorContent:editorContent,_ajax_nonce:KB.Config.getNonce("read"),args:{media_buttons:media}},function(data){$el.empty().append(data),this.addEditor($el,null,150,watch)},this)}}}(jQuery),KB.Ui=function($){return{isSorting:!1,init:function(){var that=this,$body=$("body");this.initTabs(),this.initSortable(),this.initToggleBoxes(),this.flexContext(),this.flushLocalStorage(),$body.on("mousedown",".kb_field",function(){activeField=this}),$body.on("mousedown",".kb-module",function(){activeBlock=this.id}),$body.on("mouseenter",".kb-js-field-identifier",function(){KB.currentFieldId=this.id,_K.info("Current Field Id set to:",KB.currentFieldId)}),$body.on("mouseenter",".kb-area__list-item li",function(){KB.currentModuleId=this.id}),jQuery(document).ajaxComplete(function(e,o,settings){that.metaBoxReorder(e,o,settings,"restore")}),jQuery(document).ajaxSend(function(e,o,settings){that.metaBoxReorder(e,o,settings,"remove")})},flexContext:function(){var side=$(".area-side"),normal=$(".area-normal");$("#kontentblocks_stage");var that=this;jQuery("body").on("mouseover",".kb_module--body",function(){var $con=$(this).closest(".kb-context-container");return $con.addClass("active-context").removeClass("non-active-context"),$con.hasClass("area-top")||$con.hasClass("area-bottom")?!1:($(".kb-context-container").not($con).addClass("non-active-context").removeClass("active-context"),void 0)}),side.on("click",".kb-toggle",function(){return that.isSorting?!1:(side.addClass("active-context").removeClass("non-active-context"),normal.addClass("non-active-context"),void 0)}),normal.on("click",".kb-toggle",function(){return that.isSorting?!1:(side.delay(700).removeClass("active-context").addClass("non-active-context"),normal.delay(700).removeClass("non-active-context").addClass("active-context"),void 0)})},repaint:function($el){this.initTabs(),this.initToggleBoxes(),KB.TinyMCE.addEditor($el)},initTabs:function($cntxt){var $context=$cntxt||jQuery("body"),selector=$(".kb_fieldtabs",$context);selector.tabs({activate:function(){$(".kb-nano").nanoScroller({contentClass:"kb-nano-content"}),KB.Events.trigger("KB::ui-tabs-change"),KB.Events.trigger("KB::edit-modal-refresh")}}),selector.each(function(){var length=$(".ui-tabs-nav li",$(this)).length;1===length&&$(this).find(".ui-tabs-nav").css("display","none")})},initToggleBoxes:function(){$(".kb-togglebox-header").on("click",function(){$(this).next("div").slideToggle()}),$(".kb_fieldtoggles div:first-child").trigger("click")},initSortable:function($cntxt){function isValidModule(){var limit=areaOver.get("limit"),nom=numberOfModulesInArea(areaOver.get("id"));return-1===_.indexOf(areaOver.get("assignedModules"),currentModule.get("settings").class)?!1:0!==limit&&nom-1>=limit?(KB.Notice.notice("Not allowed here","error"),!1):!0}function numberOfModulesInArea(id){return $("#"+id+" li.kb-module").length}var currentModule,areaOver,$context=$cntxt||jQuery("body"),that=this;$(".kb-module-ui__sortable",$context).sortable({placeholder:"ui-state-highlight",ghost:!0,connectWith:".kb-module-ui__sortable--connect",handle:".kb-move",cancel:"li.disabled, li.cantsort",tolerance:"pointer",delay:150,revert:350,start:function(event,ui){that.isSorting=!0,$("#kontentblocks_stage").addClass("kb-is-sorting"),currentModule=KB.Modules.get(ui.item.attr("id")),areaOver=KB.currentArea,$(KB).trigger("kb:sortable::start"),$(".kb-open").toggleClass("kb-open"),$(".kb-module__body").hide(),KB.TinyMCE.removeEditors(),$(document).trigger("kb_sortable_start",[event,ui])},stop:function(event,ui){that.isSorting=!1,$("#kontentblocks_stage").removeClass("kb-is-sorting"),KB.TinyMCE.restoreEditors(),$(document).trigger("kb_sortable_stop",[event,ui]),currentModule.get("open")&&currentModule.view.toggleBody(155)},over:function(){areaOver=KB.Areas.get(this.id)},receive:function(event,ui){isValidModule()||(KB.Notice.notice("Module not allowed in this area","error"),$(ui.sender).sortable("cancel"))},update:function(ev,ui){if(!isValidModule())return!1;if(this!==ui.item.parent("ul")[0]||ui.sender){if(ui.sender){if(ui.item.parent("ul")[0].id===ui.sender.attr("id"))return!1;$.when(that.changeArea(areaOver,currentModule)).then(function(){that.resort(ui.sender)}).done(function(){that.triggerAreaChange(areaOver,currentModule),$(KB).trigger("kb:sortable::update"),currentModule.view.clearFields(),KB.Notice.notice("Area change and order were updated successfully","success")})}}else $.when(that.resort(ui.sender)).done(function(){$(KB).trigger("kb:sortable::update"),KB.Notice.notice("Order was updated successfully","success")})}})},flushLocalStorage:function(){var hash=KB.Config.get("env").hash;store.get("kbhash")!==hash&&(store.clear(),store.set("kbhash",hash))},resort:function(){var serializedData={};return $(".kb-module-ui__sortable").each(function(){serializedData[this.id]=$("#"+this.id).sortable("serialize",{attribute:"rel"})}),KB.Ajax.send({action:"resortModules",data:serializedData,_ajax_nonce:KB.Config.getNonce("update")})},changeArea:function(targetArea,module){return KB.Ajax.send({action:"changeArea",_ajax_nonce:KB.Config.getNonce("update"),block_id:module.get("instance_id"),area_id:targetArea.get("id"),context:targetArea.get("context")})},triggerAreaChange:function(newArea,moduleModel){moduleModel.unsubscribeFromArea(),moduleModel.setEnvVar("areaContext",newArea.get("context")),moduleModel.setEnvVar("area",newArea.get("id"))},toggleModule:function(){$("body").on("click",".kb-toggle",function(){KB.isLocked()&&!KB.userCan("lock_kontentblocks")?KB.notice(kontentblocks.l18n.gen_no_permission,"alert"):($(this).parent().nextAll(".kb-module__body:first").slideToggle("fast",function(){$("body").trigger("module::opened")}),$("#"+activeBlock).toggleClass("kb-open",1e3))})},metaBoxReorder:function(e,o,settings,action){if(settings.data){var a=settings.data,b=a.split("&"),result={};$.each(b,function(x,y){var temp=y.split("=");result[temp[0]]=temp[1]}),"meta-box-order"===result.action&&("restore"===action?KB.TinyMCE.restoreEditors():"remove"===action&&KB.TinyMCE.removeEditors())}}}}(jQuery),KB.Ui.init(),KB.Util=function(){return{stex:{set:function(key,val,exp){store.set(key,{val:val,exp:exp,time:(new Date).getTime()})},get:function(key){var info=store.get(key);return info?(new Date).getTime()-info.time>info.exp?null:info.val:null}},setIndex:function(obj,is,value){return"string"==typeof is?this.setIndex(obj,is.split("."),value):1==is.length&&void 0!==value?obj[is[0]]=value:0==is.length?obj:this.setIndex(obj[is[0]],is.slice(1),value)},getIndex:function(obj,s){s=s.replace(/\[(\w+)\]/g,".$1"),s=s.replace(/^\./,"");for(var a=s.split(".");a.length;){var n=a.shift();if(!(n in obj))return;obj=obj[n]}return obj},cleanArray:function(actual){for(var newArray=new Array,i=0;i<actual.length;i++)_.isUndefined(actual[i])||_.isEmpty(actual[i])||newArray.push(actual[i]);return newArray}}}(jQuery),KB.ViewsCollection=function(){this.views={},this.lastViewAdded=null,this.add=function(id,view){return this.views[id]||(this.views[id]=view,KB.trigger("kb:"+view.model.get("class")+":added",view),this.lastViewAdded=view),view},this.ready=function(){_.each(this.views,function(view){view.trigger("kb:"+view.model.get("class"),view),KB.trigger("kb:"+view.model.get("class")+":loaded",view)}),KB.trigger("kb:ready")},this.readyOnFront=function(){_.each(this.views,function(view){view.trigger("kb:"+view.model.get("class"),view),KB.trigger("kb:"+view.model.get("class")+":loadedOnFront",view)}),KB.trigger("kb:ready")},this.remove=function(id){var V=this.get(id);V.Area.trigger("kb.module.deleted",V),this.trigger("kb.modules.view.deleted",V),delete this.views[id]},this.get=function(id){return this.views[id]?this.views[id]:void 0},this.filterByModelAttr=function(attr,value){return _.filter(this.views,function(view){return view.model.get(attr)===value})}},_.extend(KB.ViewsCollection.prototype,Backbone.Events),HandlebarsKB.registerHelper("debug",function(optionalValue){console.log("Current Context"),console.log("===================="),console.log(this),optionalValue&&(console.log("Value"),console.log("===================="),console.log(optionalValue))}),HandlebarsKB.registerHelper("fieldName",function(base,index,key){return base+"["+index+"]["+key+"]"});