/*! Kontentblocks ProdVersion 2018-06-25 09:06 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){b.exports=Backbone.View.extend({tagName:"div",className:"",isValid:function(){return!0}})},{}],2:[function(a,b,c){b.exports=Backbone.View.extend({initialize:function(a){this.Controller=a.Controller,this.ContextsViews=this.setupContextsViews(),this.isVisible=!0,this.listenTo(this.Controller,"columns.rendered",this.columnActivated),this.listenTo(this.Controller,"columns.reset",this.reset)},setupContextsViews:function(){var a={},b=this,c=this.$(".kb-context-container");return _.each(c,function(c,d){var e=c.dataset.kbcontext,f=KB.Contexts.get(e);a[f.View.cid]=f.View,f.View.isVisible=!0,f.View.ColumnView=b,b.listenTo(f.View,"context.activated",b.activateColumn)}),a},activateColumn:function(){this.trigger("column.activate",this)},columnActivated:function(a){a.cid!==this.cid?_.each(this.ContextsViews,function(a){a.renderProxy()}):_.each(this.ContextsViews,function(a){a.removeProxy()})},reset:function(){_.each(this.ContextsViews,function(a){a.removeProxy()})}})},{}],3:[function(a,b,c){var d=a("templates/backend/context-bar.hbs"),e=a("backend/Views/ContextUi/ContextUiView"),f=a("backend/Views/ContextUi/ContextColumnView"),g=a("backend/Views/ContextUi/controls/ResetControl"),h=a("backend/Views/ContextUi/controls/ColumnControl");b.exports=Backbone.View.extend({initialize:function(){var a=this;this.columns=this.setupColumns(),this.layoutBackup=this.createLayoutBackup(),this.cols=_.toArray(this.columns).length,this.render(),jQuery(window).resize(function(){a.resetLayout()})},setupColumns:function(){var a=this,b=this.$(".kb-context-col");return _.map(b,function(b){var c=new f({el:b,Controller:a});return a.listenTo(c,"column.activate",a.evalLayout),c})},render:function(){var a=jQuery(d({}));this.$el.before(a),this.BarView=new e({el:a}),this.setupMenuItems()},setupMenuItems:function(){var a=this;this.BarView.addItem(new g({model:this.model,parent:this})),_.each(this.columns,function(b){a.BarView.addItem(new h({model:a.model,parent:a,ColumnView:b}))})},createLayoutBackup:function(){var a={};return _.each(this.columns,function(b,c){a[c]=b.$el.attr("class")}),a},resetLayout:function(){var a=this;_.each(this.columns,function(b){b.isVisible||b.Control["switch"](),b.$el.attr("class",a.layoutBackup[b.cid]),b.$el.width("")}),this.trigger("columns.reset")},evalLayout:function(a){var b=this.$el.width()-20*this.cols,c=this.findProportion(this.cols);return 1100>b?!1:(_.each(this.columns,function(d){d.cid===a.cid?d.$el.width(Math.floor(b*c.large)):d.$el.width(Math.floor(b*c.small))}),void this.trigger("columns.rendered",a))},renderLayout:function(){var a=_.filter(this.columns,function(a){return a.isVisible}),b=a.length,c=this.$el.width()-20*b;_.each(a,function(a){a.$el.width(Math.floor(c*(100/b/100)))})},findProportion:function(a){switch(a){case 3:return{small:.1,large:.8};case 2:return{small:.3333,large:.6666};default:return{small:1,large:1}}}})},{"backend/Views/ContextUi/ContextColumnView":2,"backend/Views/ContextUi/ContextUiView":4,"backend/Views/ContextUi/controls/ColumnControl":5,"backend/Views/ContextUi/controls/ResetControl":6,"templates/backend/context-bar.hbs":92}],4:[function(a,b,c){var d=a("backend/Views/ModuleControls/ControlsView");b.exports=d.extend({initialize:function(){this.$menuList=jQuery(".kb-context-bar--actions",this.$el)}})},{"backend/Views/ModuleControls/ControlsView":7}],5:[function(a,b,c){var d=a("backend/Views/BaseControlView");b.exports=d.extend({initialize:function(a){this.options=a||{},this.Controller=a.parent,this.ColumnView=a.ColumnView,this.ColumnView.Control=this},className:"context-visibility",events:{click:"switch"},render:function(){this.$el.append('<span class="kb-button-small">'+this.ColumnView.$el.data("kbcolname")+"</span>")},isValid:function(){return!0},"switch":function(){this.$el.toggleClass("kb-context-hidden"),this.ColumnView.$el.toggle(),this.ColumnView.isVisible=!this.ColumnView.isVisible,this.Controller.renderLayout()}})},{"backend/Views/BaseControlView":1}],6:[function(a,b,c){var d=a("backend/Views/BaseControlView");b.exports=d.extend({initialize:function(a){this.options=a||{},this.Controller=a.parent},className:"context-reset-layout",events:{click:"resetLayout"},render:function(){this.$el.append('<span class="kb-button-small">Reset</span>')},isValid:function(){return!0},resetLayout:function(){this.Controller.resetLayout()}})},{"backend/Views/BaseControlView":1}],7:[function(a,b,c){b.exports=Backbone.View.extend({id:"",$menuWrap:{},$menuList:{},initialize:function(){this.$menuWrap=jQuery(".menu-wrap",this.$el),this.$menuWrap.append("<div class='module-actions'></div>"),this.$menuList=jQuery(".module-actions",this.$menuWrap)},addItem:function(a){if(this.controls=this.controls||{},a.isValid&&a.isValid()===!0){var b=jQuery('<div class="kb-controls-item"></div>').appendTo(this.$menuList),c=b.append(a.el);this.$menuList.append(c),a.render.call(a),this.controls[a.id]=a}},getView:function(a){return this.controls[a]?this.controls[a]:!1}})},{}],8:[function(a,b,c){var d=a("common/Ajax"),e=a("common/Config"),f=a("./ViewsList"),g=a("./Controls"),h=a("./FieldsList"),i=a("templates/backend/template-editor/wrap.hbs");b.exports=Backbone.View.extend({className:"kb-codemirror-overlay",currentView:null,initialize:function(a){this.viewfile=a.viewfile,this.moduleView=a.moduleView,this.$wrap=jQuery(i()).appendTo(this.$el),this.$sidebar=this.$(".kb-tpled--sidebar"),this.$content=this.$(".kb-tpled--content"),this.moduleModel=a.module,this.views=this.prepareViews(this.moduleModel.get("views")),this.open()},events:{"click .kb-tpled--close":"close"},open:function(){this.$backdrop=jQuery('<div class="kb-fullscreen-backdrop"></div>').appendTo("body"),jQuery("#wpwrap").addClass("module-browser-open"),this.$el.appendTo("body"),this.trigger("open"),this.editor=CodeMirror(document.getElementById("codemirror"),{mode:"twig",theme:"dracula",lineNumbers:!0,lineWrapping:!0,tabMode:"indent",indentUnit:4}),this.render()},close:function(){this.$backdrop.remove(),jQuery("#wpwrap").removeClass("module-browser-open"),this.$el.detach(),this.trigger("close")},render:function(){this.List=new f({$container:this.$("[data-views]"),views:this.views,controller:this}).render(),this.Controls=new g({$container:this.$("[data-controls]"),controller:this}).render(),this.Fields=new h({$container:this.$("[data-fields]"),controller:this}),this.load(this.List.getActiveView())},load:function(a){var b=this;this.currentView&&this.currentView.deselect(),d.send({viewfile:a.model.toJSON(),action:"getTemplateString",module:this.moduleModel.toJSON(),_ajax_nonce:e.getNonce("read")},function(c){b.editor.setValue(c.data.string),b.currentView=a,b.currentView.select(),b.Fields.setFields(c.data.fields).render()},this)},getCurrentView:function(){return this.currentView},prepareViews:function(a){return _.map(a,function(a){return a.selected=a.filename===this.moduleModel.get("viewfile")?'selected="selected"':"",a.isActive=a.filename===this.moduleModel.get("viewfile"),a},this)}})},{"./Controls":9,"./FieldsList":11,"./ViewsList":13,"common/Ajax":19,"common/Config":21,"templates/backend/template-editor/wrap.hbs":103}],9:[function(a,b,c){var d=a("backend/Views/TemplateEditor/controls/UpdateControl"),e=a("backend/Views/TemplateEditor/controls/CreateControl"),f=a("backend/Views/TemplateEditor/controls/DuplicateControl"),g=a("backend/Views/TemplateEditor/controls/FeedbackControl"),h=a("backend/Views/TemplateEditor/controls/DeleteControl");b.exports=Backbone.View.extend({tagName:"ul",className:"kb-tpl-editor-controls",initialize:function(a){this.$container=a.$container,this.controller=a.controller},render:function(){return this.$container.empty().append(this.$el),this.createControls(),this},createControls:function(){this.$el.append(new d({controller:this.controller,controls:this}).render()),this.$el.append(new e({controller:this.controller,controls:this}).render()),this.$el.append(new f({controller:this.controller,controls:this}).render()),this.$el.append(new h({controller:this.controller,controls:this}).render()),this.$el.append(new g({controller:this.controller,controls:this}).render())}})},{"backend/Views/TemplateEditor/controls/CreateControl":14,"backend/Views/TemplateEditor/controls/DeleteControl":15,"backend/Views/TemplateEditor/controls/DuplicateControl":16,"backend/Views/TemplateEditor/controls/FeedbackControl":17,"backend/Views/TemplateEditor/controls/UpdateControl":18}],10:[function(a,b,c){var d=a("templates/backend/template-editor/field-item.hbs");b.exports=Backbone.View.extend({tagName:"li",initialize:function(a){this.controller=a.controller,this.$list=a.$list},render:function(){console.log(this.model.toJSON()),this.$el.append(d({data:this.model.toJSON()})),this.$list.append(this.$el)}})},{"templates/backend/template-editor/field-item.hbs":101}],11:[function(a,b,c){var d=a("backend/Views/TemplateEditor/FieldItem");b.exports=Backbone.View.extend({tagName:"ul",initialize:function(a){this.$container=a.$container,this.controller=a.controller},render:function(){return this.$container.empty().append(this.$el),this.$el.empty(),_.each(this.fields,function(a){a.render()}),this},setFields:function(a){return this.fields=this.createViews(a),this},createViews:function(a){return _.map(a,function(a){return new d({controller:this.controller,$list:this.$el,model:new Backbone.Model(a)})},this)}})},{"backend/Views/TemplateEditor/FieldItem":10}],12:[function(a,b,c){var d=a("templates/backend/template-editor/list-item.hbs");b.exports=Backbone.View.extend({tagName:"li",initialize:function(a){this.controller=a.controller,this.$list=a.$list},events:{click:"loadView"},render:function(){this.$el.append(d({data:this.model.toJSON()})),this.$list.append(this.$el)},loadView:function(){this.controller.load(this)},select:function(){this.$el.addClass("kb-active-template")},deselect:function(){this.$el.removeClass("kb-active-template")}})},{"templates/backend/template-editor/list-item.hbs":102}],13:[function(a,b,c){var d=a("backend/Views/TemplateEditor/ListItem");b.exports=Backbone.View.extend({tagName:"ul",initialize:function(a){this.$container=a.$container,this.controller=a.controller,this.views=this.createViews(a.views)},render:function(){return this.$container.empty().append(this.$el),_.each(this.views,function(a){a.render()}),this},updateViews:function(a){var b=this.controller.prepareViews(a);this.views=this.createViews(b),this.$el.empty(),this.render();var c=this.controller.moduleView.ModuleStatusBar.getView("templates");c.render(b)},getActiveView:function(){return _.find(this.views,function(a){return a.model.get("isActive")})},createViews:function(a){return _.map(a,function(a){return new d({controller:this.controller,$list:this.$el,model:new Backbone.Model(a)})},this)}})},{"backend/Views/TemplateEditor/ListItem":12}],14:[function(a,b,c){var d=a("common/Ajax"),e=a("common/Config"),f=a("common/Notice");b.exports=Backbone.View.extend({tagName:"li",initialize:function(a){this.controller=a.controller,this.controls=a.controls},events:{click:"ask"},render:function(){return this.$el.html('<span class="dashicons dashicons-welcome-add-page"></span> Create new template')},ask:function(){var a;f.prompt("Template Name","Please provide a unique template name",".twig",function(b,c){a=c,this.create(a)},function(a,b){},this)},create:function(a){this.controller.getCurrentView();d.send({action:"createModuleViewTemplate",_ajax_nonce:e.getNonce("update"),module:this.controller.moduleModel.toJSON(),tplstring:"",filename:a},this.success,this)},success:function(a){return a.success===!1?void f.notice(a.message,"error",8):(this.controller.List.updateViews(a.data.views),void this.controller.trigger("broadcast",a.message))}})},{"common/Ajax":19,"common/Config":21,"common/Notice":24}],15:[function(a,b,c){var d=a("common/Ajax"),e=a("common/Config"),f=a("common/Notice");b.exports=Backbone.View.extend({tagName:"li",initialize:function(a){this.controller=a.controller,this.controls=a.controls},events:{click:"ask"},render:function(){return this.$el.html('<span class="dashicons dashicons-trash"></span> Delete loaded template')},ask:function(){f.confirm("Template Name","Delete template?",function(a,b){this["delete"]()},function(a,b){},this)},"delete":function(){var a=this.controller.getCurrentView();d.send({action:"deleteModuleViewTemplate",_ajax_nonce:e.getNonce("update"),module:this.controller.moduleModel.toJSON(),view:a.model.toJSON()},this.success,this)},success:function(a){return a.success===!1?(f.notice(a.message,"error",8),void this.controller.trigger("broadcast",a.message)):(this.controller.List.updateViews(a.data.views),void this.controller.trigger("broadcast",a.message))}})},{"common/Ajax":19,"common/Config":21,"common/Notice":24}],16:[function(a,b,c){var d=a("common/Ajax"),e=a("common/Config"),f=a("common/Notice");b.exports=Backbone.View.extend({tagName:"li",initialize:function(a){this.controller=a.controller,this.controls=a.controls},events:{click:"ask"},render:function(){return this.$el.html('<span class="dashicons dashicons-admin-page"></span> Copy')},ask:function(){var a;f.prompt("Template Name","Please provide a unique template name",".twig",function(b,c){a=c,this.create(a)},function(a,b){},this)},create:function(a){this.controller.getCurrentView();d.send({action:"createModuleViewTemplate",_ajax_nonce:e.getNonce("update"),module:this.controller.moduleModel.toJSON(),filename:a,tplstring:this.controller.editor.getValue()},this.success,this)},success:function(a){return a.success===!1?void f.notice(a.message,"error",8):(this.controller.List.updateViews(a.data.views),void this.controller.trigger("broadcast",a.message))}})},{"common/Ajax":19,"common/Config":21,"common/Notice":24}],17:[function(a,b,c){a("common/Ajax"),a("common/Config"),a("common/Notice");b.exports=Backbone.View.extend({tagName:"li",className:"kb-tpled--notice",initialize:function(a){this.controller=a.controller,this.controls=a.controls,this.listenTo(this.controller,"broadcast",this.setMessage)},events:{click:"update"},render:function(){return this.$el.html('<span class="dashicons dashicons-warning"></span><div class="" data-message></div>')},setMessage:function(a){var b=this.$("[data-message]");b.hide().html(a).fadeIn(1500),setTimeout(function(){b.fadeOut(2e3)},5e3)}})},{"common/Ajax":19,"common/Config":21,"common/Notice":24}],18:[function(a,b,c){var d=a("common/Ajax"),e=a("common/Config"),f=a("common/Notice");b.exports=Backbone.View.extend({tagName:"li",initialize:function(a){this.controller=a.controller,this.controls=a.controls},events:{click:"update"},render:function(){return this.$el.html('<span class="dashicons dashicons-update"></span> Update')},update:function(){var a=this.controller.getCurrentView();d.send({action:"updateModuleViewTemplate",_ajax_nonce:e.getNonce("update"),view:a.model.toJSON(),tplstring:this.controller.editor.getValue(),module:this.controller.moduleModel.toJSON()},this.success,this)},success:function(a){a.success===!1&&(f.notice(a.message,"error",8),this.controller.trigger("broadcast",a.message)),this.controller.trigger("broadcast",a.message)}})},{"common/Ajax":19,"common/Config":21,"common/Notice":24}],19:[function(a,b,c){var d=a("common/Notice");b.exports={send:function(a,b,c,e){var f,g=e||{};f=a.postId?a.postId:KB.Environment&&KB.Environment.postId?KB.Environment.postId:!1;var h=_.extend({supplemental:a.supplemental||{},nonce:jQuery("#_kontentblocks_ajax_nonce").val(),post_id:f,postId:f,kbajax:!0},a);return jQuery("#publish").attr("disabled","disabled"),jQuery.ajax({url:ajaxurl,data:h,type:"POST",dataType:"json",success:function(a){a&&(c&&b?b.call(c,a,g):b&&b(a,g))},error:function(){d.notice("<p>Generic Ajax Error</p>","error")},complete:function(){jQuery("#publish").removeAttr("disabled")}})}}},{"common/Notice":24}],20:[function(a,b,c){var d=a("common/Config");b.exports={blockLimit:function(a){var b=a.get("limit"),c=jQuery("#"+a.get("id")+" li.kb-module").length;return!(0!==b&&c===b)},userCan:function(a){var b=jQuery.inArray(a,d.get("caps"));return-1!==b}}},{"common/Config":21}],21:[function(a,b,c){var d=function(a){var b=KB.appData.config||{};return{get:function(a){return a?b[a]?b[a]:null:b},getNonce:function(a){var c=["update","create","delete","read"];return-1!==_.indexOf(c,a)?b.nonces[a]:(console.error("Invalid nonce requested in kb.cm.Config.js"),null)},isAdmin:function(){return!b.frontend},inDevMode:function(){return b.env.dev},getRootURL:function(){return b.env.rootUrl},getFieldJsUrl:function(){return b.env.fieldJsUrl},getHash:function(){return b.env.hash},getLayoutMode:function(){return b.layoutMode||"default-boxes"}}}(jQuery);b.exports=d},{}],22:[function(a,b,c){var d=a("common/Utilities");b.exports={getString:function(a){return a&&KB&&KB.i18n?d.getIndex(KB.i18n,a):null}}},{"common/Utilities":29}],23:[function(a,b,c){var d=a("common/Config");Function.prototype.bind&&window.console&&"object"==typeof console.log&&["log","info","warn","error","assert","dir","clear","profile","profileEnd"].forEach(function(a){console[a]=this.bind(console[a],console)},Function.prototype.call),Logger.useDefaults();var e=Logger.get("_K"),f=Logger.get("_KS");e.setLevel(e.INFO),f.setLevel(f.INFO),d.inDevMode()||e.setLevel(Logger.OFF),Logger.setHandler(function(a,b){if(KB.Menubar&&2===b.level.value&&"_KS"===b.name)a[0]&&KB.Menubar.StatusBar.setMsg(a[0]);else{var c=window.console,d=c.log;b.name&&(a[0]="["+b.name+"] "+a[0]),b.level===Logger.WARN&&c.warn?d=c.warn:b.level===Logger.ERROR&&c.error?d=c.error:b.level===Logger.INFO&&c.info&&(d=c.info),d.apply(c,a)}}),b.exports={Debug:e,User:f}},{"common/Config":21}],24:[function(a,b,c){"use strict";b.exports={notice:function(a,b,c){var d=c||3;window.alertify.notify(a,b,d)},confirm:function(a,b,c,d,e){var f=a||"Title";window.alertify.confirm(f,b,function(){c.call(e)},function(){d.call(e)})},prompt:function(a,b,c,d,e,f){var g=a||"Title";window.alertify.prompt(g,b,c,function(a,b){d.call(f,a,b)},function(a,b){e.call(f,a,b)})}}},{}],25:[function(a,b,c){b.exports={getFieldData:function(a,b,c,d){var e;return this._typeExists(a)?(e=KB.payload.fieldData[a],e[b]?_.isEmpty(d)?e[b][c]?e[b][c]:[]:e[b][d]&&e[b][d][c]?e[b][d][c]:[]:[]):[]},_typeExists:function(a){return!_.isUndefined(KB.payload.fieldData[a])},getFieldArgs:function(a,b){return KB.payload.Fields&&KB.payload.Fields[a]?b&&KB.payload.Fields[a][b]?KB.payload.Fields[a][b]:KB.payload.Fields[a]:null},parseAdditionalJSON:function(a){var b;return b={Fields:[]},a&&a.Areas&&_.each(a.Areas,function(a){KB.ObjectProxy.add(KB.Areas.add(a))}),a&&a.Fields&&(b.Fields=KB.FieldControls.add(_.toArray(a.Fields))),b},getPayload:function(a){return KB&&KB.payload&&KB.payload[a]?KB.payload[a]:{}}}},{}],26:[function(a,b,c){function d(){this.items=[]}d.prototype.append=function(a){this.items.push(a)},d.prototype.prepend=function(a){this.items.unshift(a)},d.prototype.reset=function(){this.items=[]},d.prototype.length=function(){return this.items.length},d.prototype.hasItems=function(){return this.items.length>0},d.prototype.first=function(){return this.items.length>0?this.items.shift():null},d.prototype.last=function(){return this.items.length>0?this.items.pop():null},b.exports=d},{}],27:[function(a,b,c){var d=a("common/Ajax"),e=a("common/Logger"),f=a("common/Config");b.exports={removeEditors:function(a){a||(a=jQuery("body")),jQuery(".wp-editor-area",a).each(function(){if("wp-content-wrap"===jQuery(this).attr("id")||"ghosteditor"===jQuery(this).attr("id")||"replycontent"===jQuery(this).attr("id"));else{var a=this.id;tinyMCE.execCommand("mceRemoveEditor",!0,a)}})},restoreEditors:function(a){a||(a=jQuery("body")),jQuery(".wp-editor-wrap",a).each(function(){var a=jQuery(this).find("textarea").attr("id"),b=jQuery(this).find("textarea");"ghosteditor"!==a&&"replycontent"!==a&&(b.val(switchEditors.wpautop(b.val())),tinyMCE.execCommand("mceAddEditor",!0,a),switchEditors.go(a,"tmce"))})},addEditor:function(a,b,c,d){if(!a)return e.Debug.error("No scope element ($el) provided"),!1;if(_.isUndefined(tinyMCEPreInit))return!1;var f=c||350,g=_.isUndefined(d)?!0:!1;jQuery(".wp-editor-area",a).each(function(){var a=this.id,b=window.tinyMCE.get(a);b&&tinyMCE.execCommand("mceRemoveEditor",null,a);var c=tinyMCEPreInit&&tinyMCEPreInit.mceInit&&tinyMCEPreInit.mceInit.ghosteditor?"ghosteditor":"content",d=_.clone(tinyMCEPreInit.mceInit[c]);d.elements=a,d.selector="#"+a,d.id=a,d.kblive=g,d.height=f,d.remove_linebreaks=!1,d.setup=function(a){a.on("init",function(){KB.Events.trigger("kb.tinymce.new-editor",a)}),a.on("change",function(){})},tinymce.init(d),tinyMCEPreInit.mceInit[a]||(tinyMCEPreInit.mceInit[a]=d);var e={buttons:"",disabled_buttons:"",id:a};window.quicktags(e)}),setTimeout(function(){jQuery(".wp-editor-wrap",a).removeClass("html-active").addClass("tmce-active"),window.QTags._buttonsInit()},1500)},remoteGetEditor:function(a,b,c,g,h,i,j){var k=h||KB.appData.config.post.ID,c=c||a.attr("id");if(!i)var i=!1;var l=g||"";return d.send({action:"getRemoteEditor",editorId:c+"_ed",editorName:b,post_id:k,postId:k,editorContent:l,_ajax_nonce:f.getNonce("read"),args:{media_buttons:i}},function(b){b.success?(a.empty().append(b.data.html),this.addEditor(a,null,250,j)):e.Debug.info("Editor markup could not be retrieved from the server")},this)}}},{"common/Ajax":19,"common/Config":21,"common/Logger":23}],28:[function(a,b,c){var d=jQuery,e=a("common/Config"),f=a("common/Ajax"),g=a("common/TinyMCE"),h=a("common/Notice"),i=a("backend/Views/ContextUi/ContextRowGrid"),j={isSorting:!1,init:function(){var a=this,b=d("body");this.initTabs(),this.initSortable(),this.initSortableAreas(),this.initToggleBoxes(),this.flexContext(),this.flushLocalStorage(),this.initTipsy(),b.on("mousedown",".kb-field",function(a){activeField=this}),b.on("mousedown",".kb-module",function(a){activeBlock=this.id}),b.on("mouseenter","[data-kbfield]",function(){KB.currentFieldId=this.id}),b.on("mouseenter",".kb-area__list-item li",function(){KB.currentModuleId=this.id}),jQuery(document).ajaxComplete(function(b,c,d){a.metaBoxReorder(b,c,d,"restore")}),jQuery(document).ajaxSend(function(b,c,d){a.metaBoxReorder(b,c,d,"remove")})},flexContext:function(){jQuery(".kb-context-row").each(function(a,b){var c=jQuery(b);c.data("KB.ContextRow",new i({el:b}))})},repaint:function(a){this.initTabs(a),this.initToggleBoxes(),g.addEditor(a)},initTabs:function(a){var b=a||jQuery("body"),c=d(".kb-field--tabs",b);c.tabs({activate:function(a,b){d(".kb-nano").nanoScroller({contentClass:"kb-nano-content"}),KB.Events.trigger("modal.recalibrate")}}),c.each(function(){var a=d(".ui-tabs-nav li",d(this)).length;1===a&&d(this).find(".ui-tabs-nav").css("display","none")});d("[data-kbfsubtabs]",b).tabs({activate:function(){KB.Events.trigger("modal.recalibrate")}})},initToggleBoxes:function(){d(".kb-togglebox-header").on("click",function(){d(this).next("div").slideToggle()}),d(".kb_fieldtoggles div:first-child").trigger("click")},initSortable:function(a){function b(){var a=i.get("limit"),b=c(i.get("id"));return-1===_.indexOf(i.get("assignedModules"),f.get("settings")["class"])?!1:0!==a&&b-1>=a?(h.notice("Not allowed here","error"),!1):!0}function c(a){return d("#"+a+" li.kb-module").length}var f,i,j=a||jQuery("body"),k=this,l="parent";"default-tabs"===e.getLayoutMode()&&(l="#kb-contexts-tabs"),d(".kb-module-ui__sortable",j).sortable({placeholder:"ui-state-highlight",ghost:!0,connectWith:".kb-module-ui__sortable--connect",helper:"clone",handle:".kb-move",cancel:"li.disabled, li.cantsort",tolerance:"pointer",delay:150,revert:350,appendTo:l,start:function(a,b){k.isSorting=!0,d("body").addClass("kb-is-sorting"),f=KB.Modules.get(b.item.attr("id")),i=KB.currentArea,d(KB).trigger("kb:sortable::start"),d(".kb-open").toggleClass("kb-open"),d(".kb-module__body").hide(),g.removeEditors(),d(document).trigger("kb_sortable_start",[a,b])},stop:function(a,b){k.isSorting=!1,d("body").removeClass("kb-is-sorting"),g.restoreEditors(),d(document).trigger("kb_sortable_stop",[a,b]),f.get("open")&&f.View.toggleBody(155)},over:function(a,b){i=KB.Areas.get(this.id)},receive:function(a,c){b()||(h.notice("Module not allowed in this area","error"),d(c.sender).sortable("cancel"))},update:function(a,c){if(!b())return!1;if(this!==c.item.parent("ul")[0]||c.sender){if(c.sender){if(c.item.parent("ul")[0].id===c.sender.attr("id"))return!1;d.when(k.changeArea(i,f)).then(function(a){return a.success?void k.resort(c.sender):!1}).done(function(){k.triggerAreaChange(i,f),d(KB).trigger("kb:sortable::update"),f.View.clearFields(),h.notice("Area change and order were updated successfully","success")})}}else d.when(k.resort(c.sender)).done(function(a){return a.success?(d(KB).trigger("kb:sortable::update"),void h.notice(a.message,"success")):(h.notice(a.message,"error"),!1)})}})},flushLocalStorage:function(){var a=e.get("env").hash;store.get("kbhash")!==a&&(store.clear(),store.set("kbhash",a))},resort:function(a){var b={};return d(".kb-module-ui__sortable").each(function(){b[this.id]=d("#"+this.id).sortable("serialize",{attribute:"rel"})}),f.send({action:"resortModules",data:b,_ajax_nonce:e.getNonce("update")})},changeArea:function(a,b){return f.send({action:"changeArea",_ajax_nonce:e.getNonce("update"),mid:b.get("mid"),area_id:a.get("id"),context:a.get("context")})},triggerAreaChange:function(a,b){b.unsubscribeFromArea(),b.setArea(a)},toggleModule:function(){d("body").on("click",".kb-toggle",function(){KB.isLocked()&&!KB.userCan("lock_kontentblocks")?h.notice(kontentblocks.l18n.gen_no_permission,"alert"):(d(this).parent().nextAll(".kb-module__body:first").slideToggle("fast",function(){d("body").trigger("module::opened")}),d("#"+activeBlock).toggleClass("kb-open",1e3))})},initSortableAreas:function(){jQuery(".kb-context__inner").sortable({items:".kb-area__wrap",handle:".kb-area-move-handle",start:function(a,b){g.removeEditors()},stop:function(a,b){var c=jQuery("#post").serializeJSON(),d=c.kbcontext;d&&f.send({action:"updateContextAreaOrder",_ajax_nonce:e.getNonce("update"),data:d},function(a){a.success?h.notice(a.message,"success"):h.notice(a.message,"error"),g.restoreEditors()},this)}})},initTipsy:function(){jQuery("body").on("mouseenter","[data-kbtooltip]",function(a){jQuery(this).qtip({content:{attr:"data-kbtooltip"},style:"qtip-dark qtip-shadow",show:{event:a.type,effect:!0,delay:180,solo:!0,ready:!0}})})},metaBoxReorder:function(a,b,c,e){if(c.data){var f=c.data;if(f&&f.split){var h=f.split("&"),i={};d.each(h,function(a,b){var c=b.split("=");i[c[0]]=c[1]}),"meta-box-order"===i.action&&("restore"===e?g.restoreEditors():"remove"===e&&g.removeEditors())}}}};b.exports=j},{"backend/Views/ContextUi/ContextRowGrid":3,"common/Ajax":19,"common/Config":21,"common/Notice":24,"common/TinyMCE":27}],29:[function(a,b,c){var d=function(a){return{stex:{set:function(a,b,c){store.set(a,{val:b,exp:c,time:(new Date).getTime()})},get:function(a){var b=store.get(a);return b?(new Date).getTime()-b.time>b.exp?null:b.val:null}},store:{set:function(a,b){store.set(a,b)},get:function(a){return store.get(a)}},setIndex:function(a,b,c){return _.isObject(a)||(a={}),"string"==typeof b?this.setIndex(a,b.split("."),c):1==b.length&&void 0!==c?a[b[0]]=c:0==b.length?a:this.setIndex(a[b[0]],b.slice(1),c)},getIndex:function(a,b){b=b.replace(/\[(\w+)\]/g,".$1"),b=b.replace(/^\./,"");for(var c=b.split(".");c.length;){var d=c.shift();if(!(_.isObject(a)&&d in a))return{};a=a[d]}return a},hashString:function(a){var b,c,d,e=0;if(0==a)return e;for(b=0,d=a.length;d>b;b++)c=a.charCodeAt(b),e=(e<<5)-e+c,e|=0;return Math.abs(e)},sleep:function(a){for(var b=(new Date).getTime(),c=0;1e7>c&&!((new Date).getTime()-b>a);c++);}}}(jQuery);b.exports=d},{}],30:[function(a,b,c){var d=a("common/Checks"),e=a("common/Utilities"),f=a("common/Payload"),g=a("common/Config"),h=a("common/Logger");b.exports=Backbone.Model.extend({initialize:function(){this.cleanUp();var a=this.get("fieldId");a&&(this.ModuleModel=KB.ObjectProxy.get(a))&&this.getType()&&(this.set("ModuleModel",this.ModuleModel),this.setData(),this.bindHandlers(),this.setupType(),this.ModuleModel.attachField(this))},cleanUp:function(){var a=this.get("linkedFields")||{};a.hasOwnProperty(this.get("uid"))&&delete a[this.get("uid")]},bindHandlers:function(){this.listenTo(this,"field.model.settings",this.updateLinkedFields),this.listenTo(this.ModuleModel,"remove",this.remove),this.listenTo(this.ModuleModel,"change:entityData",this.setData),this.listenTo(this.ModuleModel,"module.model.updated",this.getClean),this.listenTo(this,"change:value",this.upstreamData),this.listenTo(this.ModuleModel,"modal.serialize.before",this.unbind),this.listenTo(this.ModuleModel,"modal.serialize",this.rebind),this.listenTo(this.ModuleModel,"change:area",this.unbind),this.listenTo(this.ModuleModel,"change:viewfile",this.unbind),this.listenTo(this.ModuleModel,"after.change.area",this.rebind)},setupType:function(){var a;(a=this.getType())&&(this.FieldControlView=new a({el:this.getElement(),model:this}))},updateLinkedFields:function(a){a.linkedFields&&(this.set("linkedFields",a.linkedFields),this.cleanUp())},getElement:function(){return jQuery('*[data-kbfuid="'+this.get("uid")+'"]')[0]},getType:function(){var a=this.get("type");if(!d.userCan("edit_kontentblocks"))return!1;var b=KB.Fields.get(a);return b&&b.prototype.hasOwnProperty("initialize")?b:!1},getClean:function(){this.trigger("field.model.clean",this)},setData:function(a){var b,c,d,g,h,i={};b=a||this.get("ModuleModel"),c=f.getPayload("fieldData"),c[this.get("type")]&&(d=c[this.get("type")],d[this.get("fieldId")]&&(g=d[this.get("fieldId")],i=e.getIndex(g,this.get("kpath")))),h=_.clone(e.getIndex(b.get("entityData"),this.get("kpath"))),this.set("value",_.extend(h,i))},upstreamData:function(){var a;if(a=this.get("ModuleModel")){var b=_.clone(this.get("ModuleModel").get("entityData"));e.setIndex(b,this.get("kpath"),this.get("value")),a.set("entityData",b,{silent:!1})}},externalUpdate:function(a){this.FieldControlView.synchronize(a)},remove:function(){this.stopListening(),KB.FieldControls.remove(this)},rebind:function(){var a=this;_.defer(function(){_.isUndefined(a.getElement())?_.defer(_.bind(a.FieldControlView.gone,a.FieldControlView)):a.FieldControlView&&(a.FieldControlView.setElement(a.getElement()),_.defer(_.bind(a.FieldControlView.rerender,a.FieldControlView)))},!0)},unbind:function(){this.FieldControlView&&this.FieldControlView.derender&&this.FieldControlView.derender()},sync:function(a){var b=this;KB.Events.trigger("field.before.sync",this.model);var c=b.toJSON(),d=c.ModuleModel.type,e=c.ModuleModel.toJSON();return delete c.ModuleModel,delete c.linkedFields,jQuery.ajax({url:ajaxurl,data:{action:"updateFieldModel",data:b.get("value"),field:c,module:e,type:d,_ajax_nonce:g.getNonce("update")},context:a?a:b,type:"POST",dataType:"json",success:function(a){b.trigger("field.model.updated",b)},error:function(){h.Debug.error("serialize | FrontendModal | Ajax error")}})},getEntityModel:function(){return this.ModuleModel?this.ModuleModel:!1}})},{"common/Checks":20,"common/Config":21,"common/Logger":23,"common/Payload":25,"common/Utilities":29}],31:[function(a,b,c){var d=a("./FieldControlModel");b.exports=d.extend({bindHandlers:function(){this.listenToOnce(this.ModuleModel,"remove",this.remove),this.listenTo(this.ModuleModel,"change:entityData",this.setData),this.listenTo(KB.Events,"modal.reload",this.rebind),this.listenTo(KB.Events,"modal.close",this.remove)},rebind:function(){this.FieldControlView&&(this.FieldControlView.setElement(this.getElement()),this.FieldControlView.rerender())},getElement:function(){return jQuery('*[data-kbfuid="'+this.get("uid")+'"]')}})},{"./FieldControlModel":30}],32:[function(a,b,c){var d=a("./FieldControlModel");
b.exports=Backbone.Collection.extend({initialize:function(){this._byModule={},this._byArea={},this._linkedFields=[],this.listenTo(this,"add",this.addToModules),this.listenTo(this,"add",this.bindLinkedFields)},model:d,addToModules:function(a){if(a.ModuleModel){var b=a.ModuleModel.id;if(this._byModule[b]||(this._byModule[b]={}),a.ModuleModel.Area){var c=a.ModuleModel.Area.id;this._byArea[c]||(this._byArea[c]={}),this._byArea[c][a.id]=a}this._byModule[b][a.id]=a}},getFieldsforModule:function(a){return this._byModule[a]?this._byModule[a]:{}},bindLinkedFields:function(a){var b=a.get("linkedFields");_.each(b,function(c,d){if(_.isNull(c)){var e=this.get(d);e&&(b[d]=e,a.listenTo(e,"external.change",a.externalUpdate),this.bindLinkedFields(e))}},this)},updateModels:function(a){a&&_.each(a,function(a){var b=this.get(a.uid);b?b.trigger("field.model.settings",a):this.add(a)},this)}})},{"./FieldControlModel":30}],33:[function(a,b,c){var d=a("common/Utilities"),e=a("common/Config");b.exports={_active:!1,init:function(){var a=this;jQuery("#wpadminbar").on("click","li.kb-edit-switch a",function(a){a.preventDefault()});var b=d.stex.get("kb.showcontrols");if(b||e.get("editAlwaysOn")){var c=jQuery(".kb-edit-switch a");this.control(c)}var f=0;jQuery(window).keydown(function(b){var c=b.which;17===c&&(++f>=3&&(a.control(),f=0),setTimeout(function(){f=0},1e3))}),jQuery(document).on("heartbeat-send",function(a,b){var c=KB.appData.config.post.ID;b.kbEditWatcher=c})},control:function(a){this._active=!this._active,jQuery(a).parent("li").toggleClass("kb-edit-on"),jQuery("body").toggleClass("kb-editcontrols-show"),d.stex.set("kb.showcontrols",this._active,144e4),KB.Events.trigger("reposition"),KB.Events.trigger("content.change"),this._active?KB.Events.trigger("editcontrols.show"):KB.Events.trigger("editcontrols.hide")},isActive:function(){return this._active}}},{"common/Config":21,"common/Utilities":29}],34:[function(a,b,c){var d=a("fields/FieldControlModelModal");b.exports=Backbone.Collection.extend({model:d})},{"fields/FieldControlModelModal":31}],35:[function(a,b,c){b.exports=Backbone.Collection.extend({filterByAttr:function(a,b){return this.filter(function(c){return c.get(a)===b},this)}})},{}],36:[function(a,b,c){var d=window.KB||{};d.Events={},_.extend(d,Backbone.Events),_.extend(d.Events,Backbone.Events),d.currentModule={},d.currentArea={};var e=a("shared/ViewsCollection"),f=a("frontend/Views/EditModalModules"),g=a("frontend/Views/Sidebar"),h=a("fields/FieldControlsCollection"),i=a("common/Payload"),j=a("frontend/Collections/ModuleCollection"),k=a("shared/Collections/ObjectProxyCollection"),l=a("frontend/Models/ModuleModel"),m=a("./Views/ModuleView"),n=a("frontend/Models/AreaModel"),o=a("frontend/Models/PanelModel"),p=a("./Views/PanelView"),q=a("common/UI"),r=a("common/Logger"),s=a("shared/ChangeObserver"),t=a("tether"),u=a("frontend/AdminBar"),v=a("common/Checks"),w=a("common/Config");d.Views={Modules:new e,Areas:new e,Context:new e,Panels:new e},d.Modules=new j([],{model:l}),d.Areas=new Backbone.Collection([],{model:n}),d.Panels=new Backbone.Collection([],{model:o}),d.ObjectProxy=new k([]),d.App=function(){function b(){w.get("initFrontend")&&(jQuery("body").addClass("wordpress-"+w.get("wpVersion")),d.appData.config.useModuleNav&&v.userCan("edit_kontentblocks")&&(d.Sidebar=new g),window.Tether=t,a("./InlineSetup"),a("./GlobalEvents"),d.EditModalModules=new f({}),d.ChangeObserver=new s,d.Modules.on("add",e),d.Modules.on("remove",l),d.Areas.on("add",k),d.Panels.on("add",j),c(),d.FieldControls=new h,d.FieldControls.add(_.toArray(i.getPayload("Fields"))),q.init())}function c(){return d.appData.config.preview?!1:(_.each(i.getPayload("Areas"),function(a){d.ObjectProxy.add(d.Areas.add(a))}),_.each(i.getPayload("Modules"),function(a){d.ObjectProxy.add(d.Modules.add(a))}),_.each(i.getPayload("Panels"),function(a){d.ObjectProxy.add(d.Panels.add(a))}),void d.Events.trigger("frontend.init"))}function e(a){d.Views.Modules.add(a.get("mid"),new m({model:a,el:"#"+a.get("mid")})),q.initTabs()}function j(a){d.Views.Panels.add(a.get("settings").uid,new p({model:a,el:"body"}))}function k(b){var c=a("./Views/AreaView"),e=a("./Views/LayoutAreaView");b.get("layoutArea")?d.Views.Areas.add(b.get("id"),new e({model:b,el:"#"+b.get("id")})):d.Views.Areas.add(b.get("id"),new c({model:b,el:"#"+b.get("id")}))}function l(a){a.dispose(),d.Views.Modules.remove(a.get("mid")),d.Events.trigger("content.change")}return{init:b}}(jQuery),jQuery(document).ready(function(){d.App.init();var a=jQuery("body");d.appData&&d.appData.config.frontend&&(d.Views.Modules.readyOnFront(),r.User.info("Frontend welcomes you"),a.addClass("kontentblocks-ready"),d.Events.trigger("content.change")),jQuery(window).on("scroll resize",function(){d.Events.trigger("window.change")}),setUserSetting("editor","tinymce"),a.on("click",".kb-fx-button",function(a){jQuery(this).addClass("kb-fx-button--click"),jQuery(a.currentTarget).one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){a.currentTarget.classList.remove("kb-fx-button--click")})}),d.App.adminBar=u,d.App.adminBar.init()})},{"./GlobalEvents":37,"./InlineSetup":46,"./Views/AreaView":51,"./Views/LayoutAreaView":54,"./Views/ModuleView":63,"./Views/PanelView":64,"common/Checks":20,"common/Config":21,"common/Logger":23,"common/Payload":25,"common/UI":28,"fields/FieldControlsCollection":32,"frontend/AdminBar":33,"frontend/Collections/ModuleCollection":35,"frontend/Models/AreaModel":47,"frontend/Models/ModuleModel":48,"frontend/Models/PanelModel":49,"frontend/Views/EditModalModules":53,"frontend/Views/Sidebar":65,"shared/ChangeObserver":78,"shared/Collections/ObjectProxyCollection":79,"shared/ViewsCollection":91,tether:140}],37:[function(a,b,c){var d=a("common/Logger");KB.Events.on("module.before.sync panel.before.sync",function(a){window.tinymce&&(window.tinymce.triggerSave(),d.Debug.info("tinymce.triggerSave called"))});var e=_.debounce(window.Tether.position,25);KB.Events.on("content.change",function(){e()}),jQuery("body").on("webkitTransitionEnd moztransitionend transitionend oTransitionEnd",function(){KB.Events.trigger("content.change")})},{"common/Logger":23}],38:[function(a,b,c){var d=a("common/Config"),e=(a("common/Utilities"),a("frontend/Inline/controls/EditImage")),f=a("frontend/Inline/controls/InlineUpdate"),g=a("frontend/Inline/InlineToolbar"),h=Backbone.View.extend({initialize:function(){this.mode=this.model.get("mode"),this.defaultState=this.model.get("state")||"replace-image",this.parentView=this.model.get("ModuleModel").View,this.listenTo(this.model,"field.model.settings",this.setMode),this.listenToOnce(this.model.get("ModuleModel"),"module.create",this.showPlaceholder),this.listenTo(KB.Events,"editcontrols.show",this.showPlaceholder),this.listenTo(KB.Events,"editcontrols.hide",this.removePlaceholder),this.Toolbar=new g({FieldControlView:this,model:this.model,controls:[new e({model:this.model,parent:this}),new f({model:this.model,parent:this})]}),this.render()},showPlaceholder:function(){if(this.hasData())return!1;this.$el.on("load",function(){KB.Events.trigger("content.change reposition")});var a="https://unsplash.it/g/"+this.model.get("width")+"/"+this.model.get("height")+"?random";"simple"===this.mode?this.$el.attr("src",a):"background"===this.mode&&this.$el.css("backgroundImage","url('"+a+"')")},removePlaceholder:function(){return this.hasData()?!1:void("simple"===this.mode?this.$el.attr("src",""):"background"===this.mode&&this.$el.css("backgroundImage","url('')"))},hasData:function(){return _.isNumber(parseInt(this.model.get("value").id,10))},setMode:function(a){this.model.set("mode",a.mode),this.mode=a.mode},render:function(){this.delegateEvents(),this.$el.addClass("kb-inline-imageedit-attached"),this.$caption=jQuery("*[data-"+this.model.get("uid")+"-caption]"),this.$title=jQuery("*[data-"+this.model.get("uid")+"-title]")},rerender:function(){this.render(),this.trigger("field.view.rerender",this)},gone:function(){this.trigger("field.view.gone",this),this.Toolbar.hide()},derender:function(){this.frame&&(this.frame.dispose(),this.frame=null),this.$el.off(),this.trigger("field.view.derender",this)},openFrame:function(){var a=this;this.frame&&this.frame.dispose();var b={post__in:[this.model.get("value").id]};wp.media.query(b).more().done(function(){var b=a.attachment=this.first();a.attachment.set("attachment_id",b.get("id")),a.frame=wp.media({frame:"select",state:"library",metadata:b.toJSON(),imageEditView:a,library:{type:"image"}}).on("update",function(b){a.update(b)}).on("ready",function(){a.ready()}).on("replace",function(){a.replace(a.frame.image.attachment)}).on("select",function(){var b=this.get("library").get("selection").first();a.replace(b)}).open()})},ready:function(){jQuery(".media-modal").addClass("smaller kb-image-frame")},replace:function(a){this.attachment=a,this.handleAttachment(a)},update:function(a){this.attachment.set(a),this.attachment.sync("update",this.attachment),this.$caption.length>0&&this.$caption.html(this.attachment.get("caption"))},handleAttachment:function(a,b){var c=this,e=a.get("id"),f=this.prepareValue(a);this.model.attachment=a,this.model.set("value",f),KB.Events.trigger("modal.refresh"),c.model.trigger("field.model.dirty",c.model);var g={width:c.model.get("width"),height:c.model.get("height"),crop:c.model.get("crop"),upscale:c.model.get("upscale")};jQuery.ajax({url:ajaxurl,data:{action:"fieldGetImage",args:g,id:e,_ajax_nonce:d.getNonce("read")},type:"POST",dataType:"json",success:function(d){"simple"===c.mode?c.$el.attr("src",d.data.src):"background"===c.mode&&c.$el.css("backgroundImage","url('"+d.data.src+"')"),c.delegateEvents(),b||c.model.trigger("external.change",c.model),c.$caption.length>0&&c.$caption.html(a.get("caption")),c.$title.length>0&&c.$title.html(a.get("title")),KB.Events.trigger("content.change")},error:function(){}})},prepareValue:function(a){return{id:a.get("id"),title:a.get("title"),caption:a.get("caption")}},synchronize:function(a){this.handleAttachment(a.attachment,!0)}});KB.Fields.registerObject("EditableImage",h),b.exports=h},{"common/Config":21,"common/Utilities":29,"frontend/Inline/InlineToolbar":41,"frontend/Inline/controls/EditImage":42,"frontend/Inline/controls/InlineUpdate":45}],39:[function(a,b,c){var d=(a("common/Config"),a("common/Utilities"),a("frontend/Inline/controls/EditLink")),e=a("frontend/Inline/controls/InlineUpdate"),f=a("frontend/Inline/InlineToolbar"),g=Backbone.View.extend({initialize:function(){this.parentView=this.model.get("ModuleModel").View,this.setupDefaults(),this.Toolbar=new f({FieldControlView:this,model:this.model,controls:[new d({model:this.model,parent:this}),new e({model:this.model,parent:this})],tether:{offset:"0 -20px"}}),this.render()},render:function(){this.Toolbar.show(),this.delegateEvents(),this.$caption=jQuery("*[data-"+this.model.get("uid")+"-caption]")},rerender:function(){this.render(),this.trigger("field.view.rerender",this)},derender:function(){this.$el.off(),this.trigger("field.view.derender",this)},gone:function(){this.trigger("field.view.gone",this),this.Toolbar.hide()},openDialog:function(){var a=this;window.wpActiveEditor="ghosteditor",jQuery("#wp-link-wrap").addClass("kb-customized"),window.kb_restore_htmlUpdate=wpLink.htmlUpdate,window.kb_restore_isMce=wpLink.isMCE,wpLink.isMCE=function(){return!1},wpLink.htmlUpdate=function(){a.htmlUpdate.call(a)},wpLink.open(),jQuery("#wp-link-text").val(this.model.get("value").linktext),jQuery("#wp-link-url").val(this.model.get("value").link)},htmlUpdate:function(){var a,b,c,d=wpLink.textarea;if(d&&(a=wpLink.getAttrs(),c=jQuery("#wp-link-text").val(),a.href&&"http://"!=a.href)){b=a.href,this.$el.attr("href",b),this.$el.text(c);var e={link:b,linktext:c};this.model.set("value",e),this.model.trigger("field.model.dirty",this.model),this.model.trigger("external.change",this.model),wpLink.close(),this.close()}},close:function(){wpLink.isMCE=window.kb_restore_isMce,wpLink.htmlUpdate=window.kb_restore_htmlUpdate,KB.Events.trigger("content.change")},setupDefaults:function(){var a=this.model.get("value");a&&""!==a||(a={});var b=_.defaults(a,{link:"",linktext:""});this.model.set("value",b)},synchronize:function(a){this.$el.attr("href",a.get("value").link),this.$el.html(a.get("value").linktext),this.model.trigger("field.model.dirty",this.model),KB.Events.trigger("content.change")}});KB.Fields.registerObject("EditableLink",g),b.exports=g},{"common/Config":21,"common/Utilities":29,"frontend/Inline/InlineToolbar":41,"frontend/Inline/controls/EditLink":43,"frontend/Inline/controls/InlineUpdate":45}],40:[function(a,b,c){var d=a("common/Utilities"),e=a("common/Config"),f=a("frontend/Inline/controls/EditText"),g=a("frontend/Inline/controls/InlineUpdate"),h=a("frontend/Inline/InlineToolbar"),i=Backbone.View.extend({initialize:function(){this.settings=this.model.get("tinymce"),this.parentView=this.model.get("ModuleModel").View,this.setupDefaults(),this.listenToOnce(this.model.get("ModuleModel"),"remove",this.deactivate),this.listenToOnce(this.model.get("ModuleModel"),"module.create",this.showPlaceholder),this.listenTo(KB.Events,"editcontrols.show",this.showPlaceholder),this.listenTo(KB.Events,"editcontrols.hide",this.removePlaceholder),this.Toolbar=new h({FieldControlView:this,model:this.model,controls:[new f({model:this.model,parent:this}),new g({model:this.model,parent:this})]}),this.render()},showPlaceholder:function(){this.preValue=this.model.get("value");var a=_.isEmpty(this.cleanString(this.model.get("value")));a&&this.$el.html("<p>Start writing here</p>")},removePlaceholder:function(){var a=_.isEmpty(this.cleanString(this.model.get("value")));a&&this.$el.html(this.preValue)},render:function(){this.el.id&&(this.id=this.el.id),this.Toolbar.show()},derender:function(){this.deactivate(),this.trigger("field.view.derender",this),this.$el.off()},gone:function(){this.trigger("field.view.gone",this),this.Toolbar.hide()},rerender:function(){this.render(),this.trigger("field.view.rerender",this)},setupDefaults:function(){var a=this,b={theme:"inlite",skin:!1,menubar:!0,add_unload_trigger:!1,entity_encoding:"raw",fixed_toolbar_container:null,insert_toolbar:"",schema:"html5",inline:!0,selection_toolbar:"bold italic | quicklink h2 h3 blockquote",plugins:"textcolor, wptextpattern,paste",statusbar:!1,preview_styles:!1,paste_as_text:!0,setup:function(b){b.on("init",function(){a.editor=b,b.module=a.model.get("ModuleModel"),b.kfilter=a.model.get("filter")&&"content"===a.model.get("filter"),KB.Events.trigger("KB::tinymce.new-inline-editor",b),b.focus(),jQuery(window).on("scroll.kbmce resize.kbmce",function(){jQuery(".mce-panel.mce-floatpanel").hide()})}),b.on("NodeChange",function(a){KB.Events.trigger("window.change")}),b.on("focus",function(){var c;window.wpActiveEditor=a.el.id,c=d.getIndex(b.module.get("entityData"),a.model.get("kpath")),b.kfilter&&b.setContent(switchEditors.wpautop(c)),b.previousContent=b.getContent(),b.module.View.$el.addClass("kb-inline-text--active")}),b.on("blur",function(c){var d;b.module.View.$el.removeClass("kb-inline-text--active"),d=b.getContent(),b.kfilter&&(d=switchEditors._wp_Nop(b.getContent())),b.isDirty()?b.kfilter?a.retrieveFilteredContent(b,d):(a.model.set("value",d),a.model.syncContent=b.getContent(),a.model.trigger("external.change",a.model),a.model.trigger("field.model.dirty",a.model),KB.Events.trigger("content.change")):b.setContent(b.previousContent)})}};this.defaults=_.extend(b,this.settings)},retrieveFilteredContent:function(a,b){var c=this;jQuery.ajax({url:ajaxurl,data:{action:"applyContentFilter",content:b,postId:a.module.toJSON().parentObjectId,_ajax_nonce:e.getNonce("read")},type:"POST",dataType:"json",success:function(d){a.setContent(d.data.content),c.model.set("value",b),c.model.syncContent=a.getContent(),c.model.trigger("field.model.dirty",c.model),c.model.trigger("external.change",c.model),KB.Events.trigger("content.change"),setTimeout(function(){window.twttr&&window.twttr.widgets.load(),jQuery(window).off("scroll.kbmce resize.kbmce"),a.off("nodeChange ResizeEditor ResizeWindow"),c.deactivate()},500)},error:function(){}})},activate:function(a){KB.EditModalModules&&KB.EditModalModules.destroy(),a.stopPropagation(),this.editor||tinymce.init(_.defaults(this.defaults,{selector:"#"+this.id}))},deactivate:function(){if(this.editor){var a=this.editor;this.editor=null,tinyMCE.execCommand("mceRemoveEditor",!0,a.id),KB.Events.trigger("kb.repaint")}},cleanString:function(a){return a.replace(/\s/g,"").replace(/&nbsp;/g,"").replace(/<br>/g,"").replace(/<[^\/>][^>]*><\/[^>]+>/g,"").replace(/<p><\/p>/g,"")},getSelection:function(a,b){},synchronize:function(a){this.editor?this.editor.setContent(a.syncContent):this.$el.html(a.syncContent),this.model.trigger("field.model.dirty",this.model)}});(function(){var a,b="\ufeff",c="&#xfeff;",d="sel_"+(new Date).getTime()+"_"+Math.random().toString().substr(2);return function(){var e,f;if(document.selection&&document.selection.createRange)f=document.selection.createRange().duplicate(),f.collapse(!1),f.pasteHTML('<span id="'+d+'" style="position: relative;">'+c+"</span>"),a=document.getElementById(d);else if(window.getSelection){e=window.getSelection(),e.getRangeAt?f=e.getRangeAt(0).cloneRange():(f.setStart(e.anchorNode,e.anchorOffset),f.setEnd(e.focusNode,e.focusOffset),f.collapsed!==e.isCollapsed&&(f.setStart(e.focusNode,e.focusOffset),f.setEnd(e.anchorNode,e.anchorOffset))),f.collapse(!1),a=document.createElement("span"),a.id=d;var g=jQuery(a);g.prepend(document.createTextNode(b)),f.insertNode(a)}if(a){var h=a,i=0,j=0;do i+=h.offsetLeft,j+=h.offsetTop;while(h=h.offsetParent);return a.parentNode.removeChild(a),g.remove(),{left:i,top:j}}}})();b.exports=i},{"common/Config":21,"common/Utilities":29,"frontend/Inline/InlineToolbar":41,"frontend/Inline/controls/EditText":44,"frontend/Inline/controls/InlineUpdate":45}],41:[function(a,b,c){var d=a("tether");b.exports=Backbone.View.extend({tagName:"div",className:"kb-inline-toolbar",attributes:function(){return{"data-kbelrel":this.model.get("baseId"),hidefocus:"1",tabindex:"-1"}},initialize:function(a){this.options=a,this.FieldControlView=a.FieldControlView,this.controls=a.controls||[],this.hidden=!1,this.listenTo(this.model,"field.model.dirty",this.getDirty),this.listenTo(this.model,"field.model.clean",this.getClean),this.listenTo(this.FieldControlView,"field.view.derender",this.derender),this.listenTo(this.FieldControlView,"field.view.rerender",this.rerender),this.listenTo(this.FieldControlView,"field.view.gone",this.derender),this.create()},create:function(){var a=this;_.each(this.controls,function(b){b.isValid()&&(b.render().appendTo(a.$el),b.Toolbar=a)}),this.$el.appendTo("body"),this.createPosition()},hide:function(){this.$el.hide(),this.hidden=!0},show:function(){this.hidden&&this.$el.show()},createPosition:function(){var a=this.options.tether||{},b={element:this.$el,target:this.FieldControlView.$el,attachment:"center right",targetAttachment:"center right"};this.Tether=new d(_.defaults(b,a))},getDirty:function(){this.$el.addClass("isDirty")},getClean:function(){this.$el.removeClass("isDirty")},derender:function(){this.Tether&&(this.Tether.destroy(),delete this.Tether)},rerender:function(){this.createPosition()},getTetherDefaults:function(){var a=this.el,b=this.FieldControlView.el;return _.defaults(tether,{element:a,target:b,attachment:"center right",targetAttachment:"center right"})}})},{tether:140}],42:[function(a,b,c){var d=a("common/Checks");b.exports=Backbone.View.extend({initialize:function(a){this.visible=!1,this.options=a||{},this.Parent=a.parent,this.listenTo(KB.Events,"window.change",this.reposition)},className:"kb-inline-control kb-inline--edit-image",events:{click:"openFrame",mouseenter:"mouseenter",mouseleave:"mouseleave"},openFrame:function(){this.Parent.openFrame()},render:function(){return this.$el},isValid:function(){return d.userCan("edit_kontentblocks")},mouseenter:function(){this.Parent.$el.addClass("kb-field--outline"),_.each(this.model.get("linkedFields"),function(a){a.FieldControlView.$el.addClass("kb-field--outline-link")})},mouseleave:function(){this.Parent.$el.removeClass("kb-field--outline"),_.each(this.model.get("linkedFields"),function(a){a.FieldControlView.$el.removeClass("kb-field--outline-link")})}})},{"common/Checks":20}],43:[function(a,b,c){var d=a("common/Checks");b.exports=Backbone.View.extend({initialize:function(a){this.visible=!1,this.options=a||{},this.Parent=a.parent,this.isValid()&&this.render()},className:"kb-inline-control kb-inline--edit-link",events:{click:"openDialog",mouseenter:"mouseenter",mouseleave:"mouseleave"},openDialog:function(){this.Parent.openDialog()},render:function(){return this.$el},isValid:function(){return d.userCan("edit_kontentblocks")},mouseenter:function(){this.Parent.$el.addClass("kb-field--outline"),_.each(this.model.get("linkedFields"),function(a){a.FieldControlView.$el.addClass("kb-field--outline-link")})},mouseleave:function(){this.Parent.$el.removeClass("kb-field--outline"),_.each(this.model.get("linkedFields"),function(a){a.FieldControlView.$el.removeClass("kb-field--outline-link")})}})},{"common/Checks":20}],44:[function(a,b,c){var d=a("common/Checks");b.exports=Backbone.View.extend({initialize:function(a){this.visible=!1,this.options=a||{},this.Parent=a.parent},className:"kb-inline-control kb-inline--edit-text",events:{click:"focusEditor",mouseenter:"mouseenter",mouseleave:"mouseleave"},focusEditor:function(a){this.Parent.editor||this.Parent.activate(a)},render:function(){return this.$el},isValid:function(){return d.userCan("edit_kontentblocks")},mouseenter:function(){this.Parent.$el.addClass("kb-field--outline"),_.each(this.model.get("linkedFields"),function(a){a.FieldControlView.$el.addClass("kb-field--outline-link")})},mouseleave:function(){this.Parent.$el.removeClass("kb-field--outline"),_.each(this.model.get("linkedFields"),function(a){a.FieldControlView.$el.removeClass("kb-field--outline-link")})}})},{"common/Checks":20}],45:[function(a,b,c){var d=a("common/Checks");a("common/Config"),a("common/Logger");b.exports=Backbone.View.extend({initialize:function(a){this.visible=!1,this.options=a||{},this.Parent=a.parent},className:"kb-inline-control kb-inline--update",events:{click:"syncFieldModel",mouseenter:"mouseenter",mouseleave:"mouseleave"},render:function(){return this.$el},syncFieldModel:function(a){var b=this.model.sync(this);b.done(function(a){a.success&&(this.model.getClean(),_.each(this.model.get("linkedFields"),function(a,b){_.isNull(a)||a.getClean()}))})},syncModuleModel:function(){this.model.get("ModuleModel").sync(!0),this.Toolbar.getClean()},isValid:function(){return d.userCan("edit_kontentblocks")},mouseenter:function(){}})},{"common/Checks":20,"common/Config":21,"common/Logger":23}],46:[function(a,b,c){var d=a("frontend/Inline/EditableTextView"),e=a("frontend/Inline/EditableLinkView"),f=a("frontend/Inline/EditableImageView");KB.Fields.registerObject("EditableText",d),KB.Fields.registerObject("EditableImage",f),KB.Fields.registerObject("EditableLink",e)},{"frontend/Inline/EditableImageView":38,"frontend/Inline/EditableLinkView":39,"frontend/Inline/EditableTextView":40}],47:[function(a,b,c){b.exports=Backbone.Model.extend({defaults:{id:"generic"},idAttribute:"id"})},{}],48:[function(a,b,c){var d=a("common/Config"),e=(a("common/Notice"),a("common/Logger"));b.exports=Backbone.Model.extend({idAttribute:"mid",attachedFields:{},changedFields:{},linkedModules:{},initialize:function(){this.subscribeToArea(),this.type="module",this.get("globalModule")&&this.linkModules()},subscribeToArea:function(a){a||(a=KB.Areas.get(this.get("area"))),a.View.attachModule(this),this.Area=a},dispose:function(){this.stopListening()},attachField:function(a){this.attachedFields[a.id]=a,this.listenTo(a,"field.model.dirty",this.addChangedField),this.listenTo(a,"field.model.clean",this.removeChangedField),this.listenTo(a,"remove",this.removeAttachedField)},removeAttachedField:function(a){this.attachedFields[a.id]&&(this.stopListening(a),delete this.attachedFields[a.id]),this.changedFields[a.id]&&delete this.changedFields[a.id]},addChangedField:function(a){this.changedFields[a.id]=a},removeChangedField:function(a){this.changedFields[a.id]&&delete this.changedFields[a.id],_.isEmpty(this.changedFields)&&this.trigger("module.model.clean",this)},sync:function(a,b){var c=this;return KB.Events.trigger("module.before.sync",this),jQuery.ajax({url:ajaxurl,data:{action:"updateModule",data:c.toJSON().entityData,module:c.toJSON(),editmode:a?"update":"preview",_ajax_nonce:d.getNonce("update")},context:b?b:c,type:"POST",dataType:"json",success:function(b){c.set("entityData",b.data.newModuleData),a&&c.trigger("module.model.updated",c)},error:function(){e.Debug.error("serialize | FrontendModal | Ajax error")}})},getModuleView:function(){return this.View?this.View:!1},linkModules:function(){}})},{"common/Config":21,"common/Logger":23,"common/Notice":24}],49:[function(a,b,c){var d=a("common/Config"),e=a("common/Logger");b.exports=Backbone.Model.extend({idAttribute:"baseId",attachedFields:{},changedFields:{},initialize:function(){this.type="panel"},attachField:function(a){this.attachedFields[a.id]=a,this.listenTo(a,"field.model.dirty",this.addChangedField),this.listenTo(a,"field.model.clean",this.removeChangedField),this.listenTo(a,"remove",this.removeAttachedField)},removeAttachedField:function(a){this.attachedFields[a.id]&&delete this.attachedFields[a.id],this.changedFields[a.id]&&delete this.changedFields[a.id]},addChangedField:function(a){this.changedFields[a.id]=a},removeChangedField:function(a){this.changedFields[a.id]&&(this.stopListening(a),delete this.changedFields[a.id]),_.isEmpty(this.changedFields)&&this.trigger("module.model.updated",this)},sync:function(a,b){var c=this;return KB.Events.trigger("panel.before.sync"),jQuery.ajax({url:ajaxurl,data:{action:"updatePostPanel",data:c.toJSON().entityData,panel:c.toJSON(),editmode:a?"update":"preview",_ajax_nonce:d.getNonce("update")},context:b?b:c,type:"POST",dataType:"json",success:function(a){c.set("entityData",a.data.newModuleData),c.trigger("module.model.updated",c)},error:function(){e.Debug.error("sync | FrontendModal | Ajax error")}})}})},{"common/Config":21,"common/Logger":23}],50:[function(a,b,c){var d=a("shared/ModuleBrowser/ModuleBrowserController");a("common/TinyMCE");b.exports=d.extend({success:function(a){var b;this.dropZone?(this.dropZone.$el.after(a.data.html),this.dropZone.removeDropZone()):this.options.area.$el.append(a.data.html).removeClass("kb-area__empty"),KB.ObjectProxy.add(b=KB.Modules.add(a.data.module)),this.parseAdditionalJSON(a.data.json),KB.Fields.trigger("newModule",KB.Views.Modules.lastViewAdded),this.options.area.trigger("kb.module.created"),KB.Events.trigger("content.change reposition"),b.trigger("module.created"),setTimeout(function(){b.View.openOptions()},300)},close:function(){delete this.dropZone,d.prototype.close.apply(this,arguments)}})},{"common/TinyMCE":27,"shared/ModuleBrowser/ModuleBrowserController":80}],51:[function(a,b,c){var d=a("frontend/ModuleBrowser/ModuleBrowserExt"),e=a("common/Config"),f=a("common/Notice"),g=a("common/Ajax"),h=a("templates/frontend/area-empty-placeholder.hbs");b.exports=Backbone.View.extend({isSorting:!1,events:{"click .kb-area__empty-placeholder":"openModuleBrowser"},initialize:function(){this.attachedModules={},this.renderSettings=this.model.get("renderSettings"),this.listenTo(KB.Events,"editcontrols.show",this.showPlaceholder),this.listenTo(KB.Events,"editcontrols.hide",this.removePlaceholder),this.listenToOnce(KB.Events,"frontend.init",this.setupUi),this.listenTo(this,"kb.module.deleted",this.removeModule),this.listenTo(this,"kb.module.created",this.refreshPlaceholder),this.model.View=this,this.$placeholder=jQuery(h({i18n:KB.i18n}))},showPlaceholder:function(){return this.$el.append(this.$placeholder),this},removePlaceholder:function(){return this.$placeholder.detach(),this},refreshPlaceholder:function(){this.removePlaceholder().showPlaceholder()},setupUi:function(){this.model.get("sortable")&&this.setupSortables()},openModuleBrowser:function(){return this.ModuleBrowser||(this.ModuleBrowser=new d({area:this})),this.ModuleBrowser.render(),this.ModuleBrowser},attachModule:function(a){this.attachedModules[a.get("mid")]=a,this.listenTo(a,"change:area",this.removeModule),this.getNumberOfModules()>0,this.trigger("kb.module.created",a)},getNumberOfModules:function(){return _.size(this.attachedModules)},getAttachedModules:function(){return this.attachedModules},setupSortables:function(){var a=this;this.$el.sortable({handle:".kb-module-control--move",items:".module",helper:"clone",cursorAt:{top:5,left:5},delay:150,forceHelperSize:!0,forcePlaceholderSize:!0,placeholder:"kb-front-sortable-placeholder",start:function(b,c){a.isSorting=!0},receive:function(b,c){var d=c.item.data("module");a.isSorting=!1,d.create(c)},stop:function(){a.isSorting&&(a.isSorting=!1,a.resort(a.model),KB.Events.trigger("content.change"))},change:function(){a.applyClasses()}})},removeModule:function(a){var b=a.model.get("mid");this.attachedModules[b]&&delete this.attachedModules[b],this.getNumberOfModules()<1&&(this.$el.addClass("kb-area__empty"),this.showPlaceholder())},resort:function(a){var b={};return b[a.get("id")]=a.View.$el.sortable("serialize",{attribute:"rel"}),g.send({action:"resortModules",postId:a.get("envVars").postId,data:b,_ajax_nonce:e.getNonce("update")},function(){f.notice("Order was updated successfully","success"),a.trigger("area.resorted")},null)},applyClasses:function(){var a,b,c=this.model.View.$el.find(".module");c.removeClass("first-module last-module repeater");for(var d=0;d<c.length;d++){var e=jQuery(c[d]).data("ModuleView");_.isUndefined(e)||(0===d&&e.$el.addClass("first-module"),d===c.length-1&&e.$el.addClass("last-module"),b&&e.model.get("settings").id===b&&e.$el.addClass("repeater"),b=e.model.get("settings").id,a=e.$el.parent(),a.hasClass("kb-wrap")&&a.attr("rel",e.$el.attr("rel")))}}})},{"common/Ajax":19,"common/Config":21,"common/Notice":24,"frontend/ModuleBrowser/ModuleBrowserExt":50,"templates/frontend/area-empty-placeholder.hbs":104}],52:[function(a,b,c){var d=a("common/Stack");b.exports=Backbone.View.extend({events:{click:"goBack"},initialize:function(a){this.stack=new d,this.modal=a.modal,this.setElement(this.modal.$(".kb-modal-history-back")),this.render()},append:function(a){this.stack.append(a),this.render()},prepend:function(a){this.stack.prepend(a),this.render()},reset:function(){this.stack.reset(),this.render()},render:function(){this.stack.length()>0?this.$el.show():this.$el.hide()},goBack:function(){this.modal.openView(this.stack.first(),!1,!1),this.render()}})},{"common/Stack":26}],53:[function(a,b,c){var d=a("common/Logger"),e=a("frontend/Collections/ModalFieldCollection"),f=a("frontend/Views/LoadingAnimation"),g=a("common/Config"),h=a("common/UI"),i=a("common/TinyMCE"),j=a("common/Notice"),k=a("common/Ajax"),l=a("templates/frontend/module-edit-form.hbs"),m=a("frontend/Views/EditModalHistory");b.exports=Backbone.View.extend({tagName:"div",id:"onsite-modal",timerId:null,viewStack:{},initialize:function(){return this.FieldModels=new e,this.$el.append(l({model:{},i18n:KB.i18n.jsFrontend})),this.history=new m({modal:this}),this.LoadingAnimation=new f({el:this.$el}),this.setupElements(),this.bindHandlers(),this},bindHandlers:function(){var a=this;this.listenTo(KB.Events,"modal.recalibrate",this.recalibrate),this.listenTo(KB.Events,"modal.preview",this.preview),this.listenTo(KB.Events,"modal.update",this.update),jQuery(window).on("resize",function(){a.recalibrate()}),this.listenTo(KB.Events,"kb.tinymce.new-editor",function(b){b.settings&&b.settings.kblive&&a.attachEditorEvents(b)})},setupElements:function(){this.$form=jQuery("#onsite-form",this.$el),this.$formContent=jQuery("#onsite-content",this.$el),this.$inner=jQuery(".os-content-inner",this.$formContent),this.$title=jQuery(".controls-title",this.$el),this.$draft=jQuery(".kb-modal__draft-notice",this.$el)},events:{"click .close-controls":"destroy",
"click .kb-save-form":"update","click .kb-preview-form":"preview","change .kb-template-select":"viewfileChange"},openView:function(a,b,c){return this.ModuleView&&this.ModuleView.cid===a.cid?this:(c&&this.history.prepend(this.ModuleView),this.listenTo(KB.Events,"modal.refresh",this.reload),this.ModuleView=a,this.model=a.model,this.realmid=this.setupModuleId(),this.setupWindow(),this.attach(),this.render(),void this.recalibrate())},setupModuleId:function(){return this.model.get("mid")},attach:function(){this.listenTo(this.ModuleView,"kb.frontend.module.inline.saved",this.frontendViewUpdated),this.listenTo(this.model,"data.updated",this.preview),this.listenTo(this.model,"remove",this.destroy)},detach:function(){this.FieldModels.reset(),this.stopListening(),KB.Events.trigger("modal.close",this)},reload:function(){this.render(!0)},destroy:function(){var a=this;this.stopListening(KB.Events,"modal.refresh",this.reload),a.detach(),a.history.reset(),jQuery(".wp-editor-area",this.$el).each(function(a,b){tinymce.remove("#"+b.id)}),a.ModuleView=null,a.initialized=!1,a.unbind(),a.$el.detach(),KB.Sidebar.visible&&KB.Sidebar.$el.css("width","")},setupWindow:function(){var a=this;KB.Sidebar.visible?(this.$el.appendTo(KB.Sidebar.$el),this.mode="sidebar",this.listenToOnce(KB.Sidebar,"sidebar.close",function(){this.mode="body",this.$el.removeClass("kb-modal-sidebar"),this.destroy()}),KB.Sidebar.clearTimer()):(this.mode="body",this.$el.appendTo("body").show()),"body"===this.mode&&this.$el.css("position","fixed").draggable({handle:"._controls-title",containment:"window",helper:"clone",stop:function(b,c){a.recalibrate(c.position)}}).resizable()},frontendViewUpdated:function(){this.$el.removeClass("isDirty"),this.reload()},preview:function(a){a&&a.hasOwnProperty("silent")&&a.silent===!0||this.serialize(!1,!1)},update:function(){this.serialize(!0,!0),this.switchDraftOff()},render:function(a){var b,c=this;d.User.info("Frontend modal retrieves data from the server"),b=this.model.toJSON(),this.applyControlsSettings(this.$el),jQuery.ajax({url:ajaxurl,data:{action:"getModuleForm",module:b,entityData:b.entityData,_ajax_nonce:g.getNonce("read")},type:"POST",dataType:"json",beforeSend:function(){c.LoadingAnimation.show()},success:function(b){c.$inner.empty(),c.ModuleView.clearFields(),c.$inner.attr("id",c.model.get("mid")),c.$inner.append(b.data.html),c.model.get("state").draft?c.$draft.show(150):c.$draft.hide();var e=window.tinymce,f=e.$;jQuery(document).on("click",function(a){var b,c,d=f(a.target);d.hasClass("wp-switch-editor")&&(b=d.attr("data-wp-editor-id"),c=d.hasClass("switch-tmce")?"tmce":"html",window.switchEditors.go(b,c))}),b.data.json&&(KB.payload=_.extend(KB.payload,b.data.json),_.defer(function(){b.data.json.Fields&&c.FieldModels.add(_.toArray(b.data.json.Fields))})),h.initTabs(),h.initToggleBoxes(),i.addEditor(c.$form),d.User.info("Frontend modal done."),c.$title.text(c.model.get("settings").name),a&&c.FieldModels.length>0&&KB.Events.trigger("modal.reload"),d.User.info("Frontend modal.reload triggered."),setTimeout(function(){c.$el.show(),c.LoadingAnimation.hide(),c.ModuleView.renderStatusBar(c.$el),c.$(".kb-template-select").select2({templateResult:function(a){if(!a.id)return a.text;var b=a.element.dataset.tpldesc;return jQuery("<span>"+a.text+'<br><span class="kb-tpl-desc">'+b+"</span></span>")}}),c.recalibrate()},550)},error:function(){j.notice("There went something wrong","error")}})},recalibrate:function(){var a,b,c,d;if(a=jQuery(window).height()-16,b=jQuery(".os-content-inner").height(),c=this.$el.position(),d=b+c.top-a,d>0?this.initScrollbars(b-(d+30)):b-c.top<a?this.initScrollbars(b):this.initScrollbars(a-c.top),c.top<32&&(this.$el.css("top","32px"),this.$el.css("right","20px")),"sidebar"===this.mode){var e=this.model.get("settings"),f=e.controls&&e.controls.width||600;KB.Sidebar.$el.width(f),this.$el.addClass("kb-modal-sidebar"),this.$el.width(f)}},initScrollbars:function(a){jQuery(".kb-nano",this.$el).height(a+20),jQuery(".kb-nano").nanoScroller({preventPageScrolling:!0,contentClass:"kb-nano-content"})},serialize:function(a,b){var c,d=this,e=a||!1,g=b!==!1;tinymce.triggerSave(),c=this.formdataForId(this.realmid),this.model.set("entityData",c),this.LoadingAnimation.show();var h=new f({el:this.ModuleView.$el});h.show(),this.model.sync(e,this).done(function(a,b,c){d.moduleUpdated(a,b,c,e,g),h.remove()})},moduleUpdated:function(a,b,c,d,e){var f=this;f.model.trigger("modal.serialize.before"),f.updateViewClassTo!==!1&&f.updateContainerClass(f.updateViewClassTo),f.ModuleView.trigger("modal.before.nodeupdate"),f.ModuleView.$el.html(a.data.html),f.ModuleView.trigger("modal.after.nodeupdate"),a.data.json&&a.data.json.Fields&&KB.FieldControls.updateModels(a.data.json.Fields),f.model.set("entityData",a.data.newModuleData),d&&(f.model.trigger("module.model.updated",f.model),KB.Events.trigger("modal.saved")),jQuery(document).trigger("kb.module-update",f.model.get("settings").id,f.ModuleView),jQuery(document).trigger("kb.refresh"),f.ModuleView.delegateEvents(),_.defer(function(){f.ModuleView.render(),f.model.trigger("modal.serialize"),f.recalibrate()}),d?(e&&j.notice(KB.i18n.jsFrontend.frontendModal.noticeDataSaved,"success"),f.$el.removeClass("isDirty"),f.ModuleView.getClean()):(e&&j.notice(KB.i18n.jsFrontend.frontendModal.noticePreviewUpdated,"success"),f.$el.addClass("isDirty")),f.ModuleView.trigger("kb.view.module.HTMLChanged"),f.LoadingAnimation.hide()},viewfileChange:function(a){this.updateViewClassTo={current:this.ModuleView.model.get("viewfile"),target:a.currentTarget.value},this.model.set("viewfile",a.currentTarget.value,{silent:!0}),this.preview(),this.reload()},updateContainerClass:function(a){return a&&a.current&&a.target?(this.ModuleView.$el.removeClass(this._classifyView(a.current)),this.ModuleView.$el.addClass(this._classifyView(a.target)),void(this.updateViewClassTo=!1)):!1},delayInput:function(){var a=this;this.timerId&&clearTimeout(this.timerId),this.timerId=setTimeout(function(){a.timerId=null,a.serialize(!1,!1)},750)},attachEditorEvents:function(a){},applyControlsSettings:function(a){var b=this.model.get("settings"),c=b.controls&&b.controls.width;c&&a.css("width",b.controls.width+"px"),"sidebar"===this.mode&&c&&KB.Sidebar.$el.width(c),b.controls&&b.controls.fullscreen?a.width("100%").height("100%").addClass("fullscreen"):a.height("").removeClass("fullscreen")},_classifyView:function(a){return"view-"+a.replace(".twig","")},switchDraftOff:function(){var a=this.model.toJSON(),b=this;this.model.get("state").draft&&k.send({action:"undraftModule",module:a,postId:this.model.get("parentObjectId"),_ajax_nonce:g.getNonce("update")},function(a){a.success&&b.$draft.hide(150)},this)},formdataForId:function(a){var b;return a?(b=this.$form.serializeJSON(),b[a]?_.clone(b[a]):null):null}})},{"common/Ajax":19,"common/Config":21,"common/Logger":23,"common/Notice":24,"common/TinyMCE":27,"common/UI":28,"frontend/Collections/ModalFieldCollection":34,"frontend/Views/EditModalHistory":52,"frontend/Views/LoadingAnimation":55,"templates/frontend/module-edit-form.hbs":107}],54:[function(a,b,c){var d=a("frontend/Views/AreaView"),e=(a("frontend/ModuleBrowser/ModuleBrowserExt"),a("common/Config"),a("common/Notice"),a("common/Ajax"),a("templates/frontend/area-empty-placeholder.hbs"));b.exports=d.extend({isSorting:!1,events:{},initialize:function(){this.attachedModules={},this.renderSettings=this.model.get("renderSettings"),this.listenTo(KB.Events,"editcontrols.show",this.showPlaceholder),this.listenTo(KB.Events,"editcontrols.hide",this.removePlaceholder),this.listenToOnce(KB.Events,"frontend.init",this.setupUi),this.listenTo(this,"kb.module.deleted",this.removeModule),this.listenTo(this,"kb.module.created",this.refreshPlaceholder),this.model.View=this,this.$placeholder=jQuery(e({i18n:KB.i18n})),this.extendElements()},extendElements:function(){var a=this.model.get("layoutData"),b=a.slots;b&&_.each(b,function(a,b){if(a.mid&&""!==a.mid){var c=this.$("#"+a.mid);c.attr("data-slot",b),c.addClass("kbml-slot-ref")}},this)},initDraggable:function(){var a,b,c=this;this.$(".kbml-slot-ref").draggable({revert:"invalid",helper:"clone",revertDuration:200,start:function(){a=jQuery(this)},stop:function(){a=null,jQuery(this).removeClass("being-dragged")}}),this.$(".kbml-slot-ref").droppable({hoverClass:"drop-hover",over:function(a,c){b=jQuery(a.target)},drop:function(d,e){var f=a.data("slot"),g=a.attr("id"),h=b.data("slot"),i=b.attr("id"),j=c.model.get("layoutData"),k=j.slots;return k[f].mid=i,k[h].mid=g,alert(JSON.stringify(k)),!1}})},showPlaceholder:function(){return this},removePlaceholder:function(){return this},refreshPlaceholder:function(){return this},setupUi:function(){return!1},setupSortables:function(){},resort:function(a){}})},{"common/Ajax":19,"common/Config":21,"common/Notice":24,"frontend/ModuleBrowser/ModuleBrowserExt":50,"frontend/Views/AreaView":51,"templates/frontend/area-empty-placeholder.hbs":104}],55:[function(a,b,c){b.exports=Backbone.View.extend({$overlay:jQuery('<div class="kb-loading-overlay" style="display: none;"><span>working...</span></div>'),initialize:function(){this.$el.css("position","relative").append(this.$overlay)},show:function(a){a?this.$overlay.fadeTo(150,a):this.$overlay.show()},hide:function(){this.$overlay.fadeOut(350)},remove:function(){this.$overlay.remove()}})},{}],56:[function(a,b,c){var d=a("./modulecontrols/EditControl"),e=a("./modulecontrols/UpdateControl"),f=a("./modulecontrols/DeleteControl"),g=a("./modulecontrols/MoveControl"),h=a("./modulecontrols/DraftControl"),i=a("templates/frontend/module-controls.hbs");b.exports=Backbone.View.extend({ModuleView:null,$menuList:null,initialize:function(a){this.ModuleView=a.ModuleView},derender:function(){this.$el.detach()},rerender:function(){var a=this;this.ModuleView.$el.append(this.$el),_.defer(function(){a.reposition()})},render:function(){this.ModuleView.$el.append(i({model:this.ModuleView.model.toJSON(),i18n:KB.i18n.jsFrontend})),this.$el=jQuery('[data-kb-mcontrols="'+this.model.get("mid")+'"]',this.ModuleView.$el),this.$menuList=this.$(".kb-controls-wrap"),this.EditControl=this.addItem(new d({model:this.ModuleView.model,parent:this.ModuleView})),this.UpdateControl=this.addItem(new e({model:this.ModuleView.model,parent:this.ModuleView})),this.DeleteControl=this.addItem(new f({model:this.ModuleView.model,parent:this.ModuleView})),this.MoveControl=this.addItem(new g({model:this.ModuleView.model,parent:this.ModuleView})),this.DraftControl=this.addItem(new h({model:this.ModuleView.model,parent:this.ModuleView}))},addItem:function(a){return a.isValid&&a.isValid()===!0?(this.$menuList.append(a.render()),a.listenToOnce(this,"controls.remove",a.remove),a):void 0},dispose:function(){this.trigger("controls.remove"),this.remove()},reposition:function(){var a,b,c,d,e,f;a=0,b=0,c=this.model.get("settings"),d=this.model.get("submodule"),e=this.ModuleView.$el.offset(),f=this.ModuleView.$el.height(),c.controls&&c.controls.toolbar&&(e.top=c.controls.toolbar.top,e.left=c.controls.toolbar.left),"hidden"!==this.ModuleView.$el.css("overflow")&&e.top>60&&119>f&&(a=-25),"hidden"!==this.ModuleView.$el.css("overflow")&&e.left>100&&f>120&&this.ModuleView.$el["class"]&&(a=0,b=-30,this.ModuleView.$el.addClass("kb-module-nav__vertical")),e.top<20&&(a=10),0==a&&(a=20),0==b&&(b=20),d&&(a+=50),this.$el.css({top:a+"px",left:b})}})},{"./modulecontrols/DeleteControl":58,"./modulecontrols/DraftControl":59,"./modulecontrols/EditControl":60,"./modulecontrols/MoveControl":61,"./modulecontrols/UpdateControl":62,"templates/frontend/module-controls.hbs":106}],57:[function(a,b,c){b.exports=Backbone.View.extend({tagName:"div",isValid:function(){return!0},render:function(){return this.el},dispose:function(){this.remove()}})},{}],58:[function(a,b,c){var d=a("frontend/Views/ModuleControls/modulecontrols/ControlsBaseView"),e=a("common/Checks"),f=a("common/Config"),g=a("common/Notice"),h=a("common/Ajax");b.exports=d.extend({initialize:function(a){this.options=a||{},this.Parent=a.parent},className:"kb-module-control kb-module-control--delete",events:{click:"confirmRemoval"},confirmRemoval:function(){g.confirm("Remove",KB.i18n.EditScreen.notices.confirmDeleteMsg,this.removeModule,this.cancelRemoval,this)},removeModule:function(){var a=this;h.send({action:"removeModules",_ajax_nonce:f.getNonce("delete"),module:a.model.get("mid"),postId:a.model.get("postId")},this.afterRemoval,this)},afterRemoval:function(){this.Parent.$el.parent(".kb-wrap").remove(),this.trigger("remove"),KB.Modules.remove(this.model)},cancelRemoval:function(){return!1},isValid:function(){return e.userCan("delete_kontentblocks")}})},{"common/Ajax":19,"common/Checks":20,"common/Config":21,"common/Notice":24,"frontend/Views/ModuleControls/modulecontrols/ControlsBaseView":57}],59:[function(a,b,c){var d=a("frontend/Views/ModuleControls/modulecontrols/ControlsBaseView");b.exports=d.extend({initialize:function(a){this.options=a||{},this.Parent=a.parent,this.$el.append("<div>Draft! Only visible while logged in</div>"),this.listenTo(this.Parent.model,"change:state",this.recheck),this.recheck(this.Parent.model.get("state"))},className:"kb-module-control kb-module-control--draft",isValid:function(){return!0},recheck:function(a){a.draft?this.$el.show():this.$el.hide()}})},{"frontend/Views/ModuleControls/modulecontrols/ControlsBaseView":57}],60:[function(a,b,c){var d=a("frontend/Views/ModuleControls/modulecontrols/ControlsBaseView"),e=a("common/Checks");b.exports=d.extend({initialize:function(a){this.options=a||{},this.parent=a.parent},className:"kb-module-control kb-module-control--edit",events:{click:"openForm"},openForm:function(){return KB.EditModalModules.openView(this.parent,!1,!1),KB.focusedModule=this.model,this},isValid:function(){return e.userCan("edit_kontentblocks")}})},{"common/Checks":20,"frontend/Views/ModuleControls/modulecontrols/ControlsBaseView":57}],61:[function(a,b,c){var d=a("frontend/Views/ModuleControls/modulecontrols/ControlsBaseView"),e=a("common/Checks");b.exports=d.extend({initialize:function(a){this.options=a||{},this.Parent=a.parent},className:"kb-module-control kb-module-control--move",isValid:function(){return this.Parent.model.Area?e.userCan("edit_kontentblocks")&&this.Parent.model.Area.get("sortable")&&!this.model.get("submodule"):!1}})},{"common/Checks":20,"frontend/Views/ModuleControls/modulecontrols/ControlsBaseView":57}],62:[function(a,b,c){var d=a("frontend/Views/ModuleControls/modulecontrols/ControlsBaseView"),e=a("common/Checks"),f=a("common/Config"),g=a("common/Notice");b.exports=d.extend({initialize:function(a){this.options=a||{},this.Parent=a.parent},className:"kb-module-control kb-module-control--update",events:{click:"update"},update:function(){var a=this,b=!1;jQuery.ajax({url:ajaxurl,data:{action:"updateModule",data:a.model.get("entityData"),module:a.model.toJSON(),editmode:"update",refresh:b,_ajax_nonce:f.getNonce("update")},type:"POST",dataType:"json",success:function(c){b&&a.$el.html(c.html),tinymce.triggerSave(),a.model.set("entityData",c.data.newModuleData),a.Parent.render(),a.Parent.trigger("kb.frontend.module.inline.saved"),a.model.trigger("module.model.updated",a.model),g.notice("Module saved successfully","success"),a.Parent.$el.removeClass("isDirty")},error:function(){g.notice("There went something wrong","error")}})},isValid:function(){return e.userCan("edit_kontentblocks")}})},{"common/Checks":20,"common/Config":21,"common/Notice":24,"frontend/Views/ModuleControls/modulecontrols/ControlsBaseView":57}],63:[function(a,b,c){var d=a("frontend/Views/ModuleControls/ModuleControls"),e=a("common/Checks"),f=a("shared/ModuleStatusBar/ModuleStatusBarView"),g=a("shared/ModuleStatusBar/status/TemplateStatus"),h=a("shared/ModuleStatusBar/status/PublishStatus"),i=a("templates/frontend/module-placeholder.hbs");b.exports=Backbone.View.extend({focus:!1,attachedFields:{},initialize:function(){this.Controls=new d({ModuleView:this,model:this.model}),0!==this.$el.length&&e.userCan("edit_kontentblocks")&&(this.model.View=this,this.model.trigger("module.model.view.attached",this),this.bindHandlers(),this.render(),KB.Events.on("reposition",this.setControlsPosition,this))},bindHandlers:function(){this.listenTo(this.model,"change",this.getDirty),this.listenTo(this.model,"module.model.updated",this.getClean),this.listenTo(this.model,"module.model.clean",this.getClean)},events:{"click .kb-module__placeholder":"openOptions","click .editable":"reloadModal","mouseenter.first":"setActive"},renderStatusBar:function(a){this.ModuleStatusBar=new f({el:a,parent:this}),this.ModuleStatusBar.addItem(new g({model:this.model,parent:this})),this.ModuleStatusBar.addItem(new h({model:this.model,parent:this}))},openOptions:function(){this.Controls.EditControl.openForm()},setActive:function(){KB.currentModule=this},rerender:function(){var a=this;this.setElement(jQuery("#"+this.model.get("mid"))),_.defer(function(){a.Controls.rerender()})},derender:function(){this.Controls.derender(),this.$el.remove()},render:function(){var a;this.$el.hasClass("draft")&&""==this.$el.html()&&this.renderPlaceholder(),this.$el.attr("rel",this.model.get("mid")+"_"+_.uniqueId()),a=this.model.get("settings"),a.controls&&a.controls.hide||(this.Controls.render(),this.setControlsPosition())},setControlsPosition:function(){this.Controls.reposition()},reloadModal:function(a){return KB.EditModalModules&&KB.EditModalModules.reload(this,a),KB.focusedModule=this.model,this},renderPlaceholder:function(){this.$el.append(i({model:this.model.toJSON()}))},addField:function(a){this.attachedFields[a.cid]=a},hasField:function(a,b){return _.isEmpty(b)?a in this.attachedFields:(this.attachedFields[b]||(this.attachedFields[b]={}),a in this.attachedFields[b])},getField:function(a,b){return _.isEmpty(b)?this.attachedFields[a]:this.attachedFields[b][a]},clearFields:function(){this.attachedFields={}},getDirty:function(){this.$el.addClass("isDirty"),this.trigger("view.became.dirty",this)},getClean:function(){this.$el.removeClass("isDirty"),this.trigger("view.became.clean",this)},modelChange:function(){this.getDirty()},dispose:function(){this.Controls.dispose(),delete this.model.View,this.stopListening(),this.remove()}})},{"common/Checks":20,"frontend/Views/ModuleControls/ModuleControls":56,"shared/ModuleStatusBar/ModuleStatusBarView":88,"shared/ModuleStatusBar/status/PublishStatus":89,"shared/ModuleStatusBar/status/TemplateStatus":90,"templates/frontend/module-placeholder.hbs":108}],64:[function(a,b,c){b.exports=Backbone.View.extend({initialize:function(){this.model.View=this},getDirty:function(){},getClean:function(){}})},{}],65:[function(a,b,c){var d=a("frontend/Views/Sidebar/AreaOverview/AreaOverviewController"),e=a("frontend/Views/Sidebar/AreaDetails/CategoryFilter"),f=a("frontend/Views/Sidebar/SidebarHeader"),g=a("common/Utilities"),h=a("frontend/Views/Sidebar/PanelOverview/PanelOverviewController"),i=a("templates/frontend/sidebar/sidebar-nav.hbs");b.exports=Backbone.View.extend({currentView:null,viewStack:[],timer:0,initialize:function(){this.render(),this.states={};var a=i({});this.$navControls=jQuery(a),this.bindHandlers(),this.states.AreaList=new d({controller:this}),this.states.PanelList=new h({controller:this}),this.CategoryFilter=new e,this.setView(this.states.AreaList),this.$el.addClass("ui-widget-content"),this.$el.resizable({maxWidth:900,minWidth:340,handles:"e"})},events:{"click .kb-js-sidebar-nav-back":"rootView","click [data-kb-action]":"actionHandler",mouseleave:"detectActivity",mouseenter:"clearTimer"},detectActivity:function(){var a=this;this.timer=setTimeout(function(){a.$el.addClass("kb-opaque")},15e3)},clearTimer:function(){var a=this;this.timer&&(clearTimeout(this.timer),a.$el.removeClass("kb-opaque"))},render:function(){this.$el=jQuery('<div class="kb-sidebar-wrap" style="display: none;"></div>').appendTo("body"),this.$toggle=jQuery('<div class="kb-sidebar-wrap--toggle cbutton cbutto-effect--boris"></div>').appendTo("body"),this.Header=new f({}),this.$el.append(this.Header.render()),this.$container=jQuery('<div class="kb-sidebar-wrap__container"></div>').appendTo(this.$el),this.$extension=jQuery('<div class="kb-sidebar-extension" style="display: none;"></div>').appendTo(this.$el),this.setLayout();var a=g.stex.get("kb-sidebar-visible");a&&(this.toggleSidebar(),this.detectActivity()),this.delegateEvents()},bindHandlers:function(){var a=this;jQuery(window).resize(function(){a.setLayout()}),this.$toggle.on("click",function(){a.toggleSidebar()})},setLayout:function(){var a=jQuery(window).height();this.$el.width();this.$el.height(a),this.$extension.height(a)},setExtendedView:function(a){this.currentExtendedView&&this.currentExtendedView.$el.detach(),this.currentExtendedView=a,this.$extension.html(a.render()),this.$extension.show()},closeExtendedView:function(){this.currentExtendedView.$el.detach(),this.currentExtendedView=null,this.$extension.html(""),this.$extension.hide()},setView:function(a){this.currentView&&this.currentView.$el.detach(),this.currentView=a,this.viewStack.push(a),this.$container.html(a.render()),this.handleNavigationControls()},prevView:function(){var a=this.viewStack.shift();a&&this.setView(a)},rootView:function(){this.viewStack=[],this.setView(this.states.AreaList)},handleNavigationControls:function(){this.viewStack.length>=2?this.$navControls.prependTo(this.$container):this.$navControls.detach()},toggleSidebar:function(){this.visible=!this.visible,this.$el.toggle(0),jQuery("body").toggleClass("kb-sidebar-visible"),g.stex.set("kb-sidebar-visible",this.visible,36e5),this.visible?this.trigger("sidebar.open"):this.trigger("sidebar.close")},actionHandler:function(a){var b=jQuery(a.currentTarget).data("kb-action");b&&this.states[b]&&this.setView(this.states[b])}})},{"common/Utilities":29,"frontend/Views/Sidebar/AreaDetails/CategoryFilter":68,"frontend/Views/Sidebar/AreaOverview/AreaOverviewController":71,"frontend/Views/Sidebar/PanelOverview/PanelOverviewController":75,"frontend/Views/Sidebar/SidebarHeader":77,"templates/frontend/sidebar/sidebar-nav.hbs":119}],66:[function(a,b,c){var d=a("frontend/Views/Sidebar/AreaDetails/CategoryController"),e=(a("common/Config"),a("common/Notice"),a("common/Ajax"),a("templates/frontend/sidebar/area-details-header.hbs"));b.exports=Backbone.View.extend({tagName:"div",className:"kb-sidebar__module-list",initialize:function(a){this.controller=a.controller,this.sidebarController=a.sidebarController,this.categories=this.sidebarController.CategoryFilter.filter(this.model),this.renderHeader(),this.renderCategories()},render:function(){return this.$el},renderHeader:function(){this.$el.append(e(this.model.toJSON()))},renderCategories:function(){var a=this;_.each(this.categories.toJSON(),function(b,c){var e=new d({model:new Backbone.Model(b),controller:a});a.$el.append(e.render())})}})},{"common/Ajax":19,"common/Config":21,"common/Notice":24,"frontend/Views/Sidebar/AreaDetails/CategoryController":67,"templates/frontend/sidebar/area-details-header.hbs":109}],67:[function(a,b,c){var d=a("frontend/Views/Sidebar/AreaDetails/ModuleDragItem"),e=a("templates/frontend/sidebar/category-list.hbs");b.exports=Backbone.View.extend({tagName:"div",className:"kb-sidebar__module-category",initialize:function(a){this.controller=a.controller,this.$el.append(e(this.model.toJSON())),this.$list=this.$el.find(".kb-sidebar__category-item__module-list"),this.setupModuleItems()},render:function(){return this.$el},setupModuleItems:function(){var a=this;_.each(this.model.get("modules"),function(b){var c=new d({model:new Backbone.Model(b),listController:a.controller,controller:a});a.$list.append(c.render())})}})},{"frontend/Views/Sidebar/AreaDetails/ModuleDragItem":69,"templates/frontend/sidebar/category-list.hbs":110}],68:[function(a,b,c){var d=a("common/Payload");b.exports=Backbone.View.extend({categories:d.getPayload("ModuleCategories"),definitions:d.getPayload("ModuleDefinitions"),initialize:function(){this.setupSortTable()},filter:function(a){var b=this.setupSortTable(),c=a.get("assignedModules");return _.each(this.definitions,function(a,d){-1!==_.indexOf(c,d)&&(b[a.settings.category].modules[d]=a)}),new Backbone.Model(this.removeEmptyCats(b))},setupSortTable:function(){var a={};return _.each(this.categories,function(b,c){a[c]={name:b,id:c,modules:{}}}),a},removeEmptyCats:function(a){return _.each(a,function(b,c){_.isEmpty(b.modules)&&delete a[c]}),a.core&&delete a.core,a}})},{"common/Payload":25}],69:[function(a,b,c){var d=a("common/Payload"),e=a("common/Notice"),f=a("common/Config"),g=a("common/Checks"),h=(a("frontend/Models/ModuleModel"),a("frontend/Views/AreaView")),i=a("common/Ajax"),j=a("templates/frontend/sidebar/category-module-item.hbs");b.exports=Backbone.View.extend({tagName:"div",className:"kb-sidebar-module",initialize:function(a){var b=this;this.controller=a.controller,this.listController=a.listController,this.$el.append(j(this.model.toJSON())),this.model.set("area",this.listController.model);var c=this.model.get("area").get("renderSettings").moduleElement||"div";this.$dropHelper=jQuery("<"+c+" class='kb-sidebar-drop-helper ui-sortable-helper'></"+c+">"),this.$el.draggable({appendTo:b.listController.model.View.$el.selector,revert:"invalid",refreshPositions:!0,cursorAt:{top:5,left:5},stop:function(){b.listController.model.View.$el.css("overflow","")},helper:function(){b.listController.model.View.$el.css("overflow","hidden");var a=b.findHelperSize(b.model.get("area").View);return b.$dropHelper.width(a.width).height(a.height),b.$dropHelper},drag:function(){b.$dropHelper.css("zIndex","10000")},connectToSortable:this.listController.model.View.$el.selector}).data("module",this)},render:function(){return this.$el},create:function(a){var b,c,d;return g.userCan("create_kontentblocks")||e.notice("You're not allowed to do this","error"),b=KB.Areas.get(this.model.get("area").get("id")),g.blockLimit(b)?(d=this.model,c={action:"createNewModule","class":d.get("settings")["class"],globalModule:d.get("globalModule"),parentObject:d.get("parentObject"),areaContext:b.get("context"),renderSettings:b.get("renderSettings"),area:b.get("id"),_ajax_nonce:f.getNonce("create"),frontend:KB.appData.config.frontend},this.model.get("area").get("parent_id")&&(c.postId=this.model.get("area").get("parent_id")),void i.send(c,this.success,this,{ui:a})):(e.notice("Limit for this area reached","error"),!1)},success:function(a,b){var c,e=this;b.ui.helper.replaceWith(a.data.html),c=KB.Modules.add(a.data.module),KB.ObjectProxy.add(c),c.Area.View.applyClasses(),h.prototype.resort(this.model.get("area")),e.model.get("area").trigger("kb.module.created"),_.defer(function(){d.parseAdditionalJSON(a.data.json),KB.Events.trigger("content.change reposition"),KB.App.adminBar.isActive()&&c.trigger("module.create")})},findHelperSize:function(a){var b=[],c=[];return _.each(a.attachedModules,function(a){b.push(a.View.$el.width()),c.push(a.View.$el.height())}),{width:Math.max.apply(Math,b)-10,height:Math.max.apply(Math,c)-10}}})},{"common/Ajax":19,"common/Checks":20,"common/Config":21,"common/Notice":24,"common/Payload":25,"frontend/Models/ModuleModel":48,"frontend/Views/AreaView":51,"templates/frontend/sidebar/category-module-item.hbs":111}],70:[function(a,b,c){var d=a("frontend/Views/Sidebar/AreaOverview/ModuleListItem"),e=a("frontend/Views/Sidebar/AreaDetails/AreaDetailsController"),f=a("templates/frontend/sidebar/empty-area.hbs");b.exports=Backbone.View.extend({tagName:"div",className:"kb-sidebar-areaview__modules-list",ModuleViews:{},initialize:function(a){this.Modules=new Backbone.Collection,this.$parent=a.$el,this.controller=a.controller,this.sidebarController=a.sidebarController,this.$toggleHandle=this.$parent.find(".kb-sidebar-areaview__title"),this.ModuleList=new e({controller:a.controller,sidebarController:a.sidebarController,model:this.model}),this.render(),this.bindHandlers()},render:function(){this.$el.appendTo(this.$parent).hide()},bindHandlers:function(){var a=this;this.listenTo(this.Modules,"add",this.renderModuleItem),this.listenTo(this.model,"area.resorted",this.resortViews),this.$toggleHandle.on("click",function(){a.controller.setActiveList(a)}),this.$parent.on("click",".kb-js-sidebar-add-module",function(){a.sidebarController.setView(a.ModuleList)}),this.listenToOnce(KB.Events,"frontend.init",this.afterInit)},activate:function(){this.$parent.removeClass("kb-sidebar-areaview--inactive"),this.model.View.$el.addClass("kb-in-sidebar-active")},deactivate:function(){this.$parent.addClass("kb-sidebar-areaview--inactive"),this.model.View.$el.removeClass("kb-in-sidebar-active")},renderModuleItem:function(a){this.ModuleViews[a.id]=View=new d({$parent:this.$el,model:a}),View.$el.appendTo(this.$el)},attachModuleView:function(a){this.Modules.add(a.model),this.listenToOnce(a.model,"remove",this.removeModuleView)},removeModuleView:function(a){var b=this.ModuleViews[a.id];this.Modules.remove(a),delete this.ModuleViews[a.id],b.dispose()},afterInit:function(){0===this.Modules.models.length&&this.model.View.$el.is(":visible")&&this.$el.append(f({}))},moduleOrder:function(){var a=this.model.View.$el,b=jQuery("[id^=module]",a);return _.pluck(b,"id")},resortViews:function(){var a=this,b=this.moduleOrder().reverse();_.each(b,function(b){var c=a.ModuleViews[b];c.$el.detach(),c.$el.prependTo(a.$el)})}})},{"frontend/Views/Sidebar/AreaDetails/AreaDetailsController":66,"frontend/Views/Sidebar/AreaOverview/ModuleListItem":72,"templates/frontend/sidebar/empty-area.hbs":112}],71:[function(a,b,c){var d=a("frontend/Views/Sidebar/AreaOverview/AreaListItem"),e=a("templates/frontend/sidebar/sidebar-area-view.hbs"),f=a("templates/frontend/sidebar/root-item.hbs");b.exports=Backbone.View.extend({tagName:"div",className:"kb-sidebar-main-panel",Areas:new Backbone.Collection,AreaViews:{},activeList:null,events:{"click .kb-sidebar-areaview__title":"toggleList"},initialize:function(a){this.sidebarController=a.controller,this.render(),this.bindHandlers()},render:function(){return this.$el},bindHandlers:function(){this.listenTo(KB.Views.Areas,"view:add",this.attachAreaView),this.listenTo(KB.Views.Modules,"view:add",this.attachModuleView),this.listenTo(this.Areas,"add",this.createAreaItem)},attachAreaView:function(a){a.el&&this.Areas.add(a.model)},attachModuleView:function(a){var b=this.AreaViews[a.model.get("area")];b&&b.attachModuleView(a)},createAreaItem:function(a){if(!a.get("internal")){var b=jQuery(e(a.toJSON())).appendTo(this.$el);this.AreaViews[a.get("id")]=new d({$el:b,controller:this,sidebarController:this.sidebarController,model:a})}},setActiveList:function(a){return this.activeList&&this.activeList.cid?this.activeList.cid===a.cid?!1:(this.activeList.$el.slideUp(),this.activeList.deactivate(),this.activeList=null,this.setActiveList(a),void 0):(this.activeList=a,a.$el.slideDown(),a.activate(),!0)},renderRootItem:function(){return this.sidebarController.$container.append(f({text:"Areas",id:"AreaList"}))}})},{"frontend/Views/Sidebar/AreaOverview/AreaListItem":70,"templates/frontend/sidebar/root-item.hbs":116,"templates/frontend/sidebar/sidebar-area-view.hbs":117}],72:[function(a,b,c){var d=a("templates/frontend/sidebar/module-view-item.hbs");b.exports=Backbone.View.extend({tagName:"div",className:"kb-sidebar-module-list-container",initialize:function(a){this.$parent=a.$parent,this.parentView=this.model.View,this.bindHandlers(),this.render()},events:{mouseenter:"over",mouseleave:"out",click:"scrollTo","click .kb-sidebar-item__edit":"openControls","click .kb-js-inline-update":"inlineUpdate","click .kb-js-inline-delete":"inlineDelete"},bindHandlers:function(){this.listenTo(this.model,"change",this.getDirty),this.listenTo(this.model,"module.model.updated",this.getClean),this.listenTo(this.model,"module.model.clean",this.getClean)},getDirty:function(){this.$el.addClass("kb-module-dirty")},getClean:function(){this.$el.removeClass("kb-module-dirty")},over:function(){this.parentView.$el.addClass("kb-in-sidebar-active")},out:function(){this.parentView.$el.removeClass("kb-in-sidebar-active")},openControls:function(a){
a.stopPropagation(),this.parentView.openOptions()},inlineUpdate:function(a){a.stopPropagation(),this.parentView.Controls.UpdateControl.update(),this.parentView.getClean()},inlineDelete:function(a){a.stopPropagation(),this.parentView.Controls.DeleteControl.confirmRemoval()},scrollTo:function(){var a=this;jQuery("html, body").animate({scrollTop:a.parentView.$el.offset().top-100},750)},render:function(){this.$el.append(d({view:this.model.toJSON()}))},dispose:function(){this.stopListening(),this.remove(),delete this.model,delete this.parentView}})},{"templates/frontend/sidebar/module-view-item.hbs":113}],73:[function(a,b,c){var d=a("common/Config"),e=a("common/Payload"),f=a("common/UI"),g=a("templates/frontend/sidebar/option-panel-details.hbs");b.exports=Backbone.View.extend({tagName:"div",className:"kb-sidebar__option-panel-wrap",initialize:function(a){this.Controller=a.controller,this.parentView=a.parentView,this.$el.append(g({name:this.model.get("settings").baseId})),this.$form=this.$(".kb-sidebar__form-container")},events:{"click .kb-sidebar-action--update":"save","click .kb-sidebar-action--close":"close"},render:function(){return this.loadForm(),this.$el},save:function(){var a=this;jQuery.ajax({url:ajaxurl,data:{action:"saveStaticPanelForm",data:a.$form.serializeJSON(),panel:a.model.toJSON(),_ajax_nonce:d.getNonce("update")},type:"POST",dataType:"json",success:function(a){},error:function(){}})},loadForm:function(){var a=this;jQuery.ajax({url:ajaxurl,data:{action:"getStaticPanelForm",panel:a.model.toJSON(),_ajax_nonce:d.getNonce("read")},type:"POST",dataType:"json",success:function(b){a.model.trigger("modal.serialize.before"),a.$form.html(b.data.html),e.parseAdditionalJSON(b.data.json),a.model.trigger("modal.serialize"),f.initTabs(a.$el)},error:function(){}})},close:function(){this.model.trigger("modal.serialize.before"),this.parentView.closeDetails()}})},{"common/Config":21,"common/Payload":25,"common/UI":28,"templates/frontend/sidebar/option-panel-details.hbs":114}],74:[function(a,b,c){b.exports=Backbone.View.extend({tagName:"div",className:"kb-sidebar__panel-item",initialize:function(a){this.$parent=a.$parent,this.Controller=a.controller,this.render()},events:{click:"setupFormView"},render:function(){return this.$el.append(KB.Templates.render("frontend/sidebar/panel-list-item",{name:this.model.get("args").menu.name})),this.$parent.append(this.$el)},setupFormView:function(){this.FormView=new KB.Backbone.Sidebar.OptionsPanelFormView({model:this.model,controller:this.Controller,parentView:this}),this.Controller.sidebarController.setExtendedView(this.FormView)},closeDetails:function(){this.Controller.sidebarController.closeExtendedView()}})},{}],75:[function(a,b,c){var d=a("frontend/Views/Sidebar/PanelOverview/StaticPanelView"),e=a("frontend/Views/Sidebar/PanelOverview/OptionPanelView"),f=a("templates/frontend/sidebar/root-item.hbs");b.exports=Backbone.View.extend({tagName:"div",className:"kb-sidebar-main-panel panel-view",Panels:new Backbone.Collection,PanelViews:{option:{},"static":{}},activeList:null,initialize:function(a){this.sidebarController=a.controller,this.render(),this.bindHandlers()},render:function(){return this.$el},bindHandlers:function(){this.listenTo(KB.Panels,"add",this.createPanelItem)},createPanelItem:function(a){a.get("settings").frontend&&(a.get("type")&&"option"===a.get("type")&&(this.PanelViews.option[a.get("baseId")]=new e({model:a,$parent:this.$el,controller:this})),a.get("type")&&"static"===a.get("type")&&(this.PanelViews["static"][a.get("baseId")]=new d({model:a,$parent:this.$el,controller:this})))},renderRootItem:function(){return this.sidebarController.$container.append(f("frontend/sidebar/root-item",{text:"Panels",id:"PanelList"}))}})},{"frontend/Views/Sidebar/PanelOverview/OptionPanelView":74,"frontend/Views/Sidebar/PanelOverview/StaticPanelView":76,"templates/frontend/sidebar/root-item.hbs":116}],76:[function(a,b,c){var d=a("templates/frontend/sidebar/panel-list-item.hbs"),e=a("frontend/Views/Sidebar/PanelDetails/StaticPanelFormView");b.exports=Backbone.View.extend({tagName:"div",className:"kb-sidebar__panel-item",initialize:function(a){this.$parent=a.$parent,this.Controller=a.controller,this.render()},events:{click:"setupFormView"},render:function(){return this.$el.append(d({name:this.model.get("settings").baseId})),this.$parent.append(this.$el)},setupFormView:function(){this.FormView=new e({model:this.model,controller:this.Controller,parentView:this}),this.Controller.sidebarController.setExtendedView(this.FormView)},closeDetails:function(){this.Controller.sidebarController.closeExtendedView()}})},{"frontend/Views/Sidebar/PanelDetails/StaticPanelFormView":73,"templates/frontend/sidebar/panel-list-item.hbs":115}],77:[function(a,b,c){var d=a("templates/frontend/sidebar/sidebar-header.hbs");b.exports=Backbone.View.extend({tagName:"div",className:"kb-sidebar__header",initialize:function(){this.$el.append(d({}))},render:function(){return this.$el}})},{"templates/frontend/sidebar/sidebar-header.hbs":118}],78:[function(a,b,c){var d=a("common/Notice"),e=a("templates/frontend/change-observer.hbs"),f=a("common/I18n"),g=a("common/Config");b.exports=Backbone.View.extend({models:new Backbone.Collection,className:"kb-change-observer",initialize:function(){this.listenTo(KB.Modules,"add",this.attachHandler),this.render()},events:{"click .kb-button":"saveAll"},render:function(){this.$el.append(e({strings:f.getString("UI.changeObserver")})),this.$el.appendTo("body")},attachHandler:function(a){this.listenTo(a,"change:entityData",this.add),this.listenTo(a,"module.model.updated",this.remove),this.listenTo(a,"module.model.clean",this.remove)},add:function(a){this.models.add(a),this.trigger("change"),this.handleState()},remove:function(a){this.models.remove(a,{silent:!0}),this.trigger("change"),this.handleState()},getModels:function(){return this.models},saveAll:function(){tinyMCE.triggerSave(),_.each(this.models.models,function(a){a.sync(!0)}),g.isAdmin()||d.notice("Data is safe.","success"),this.trigger("change")},handleState:function(){var a=this.models.models.length;a>0?this.$el.addClass("show"):this.$el.removeClass("show")}})},{"common/Config":21,"common/I18n":22,"common/Notice":24,"templates/frontend/change-observer.hbs":105}],79:[function(a,b,c){b.exports=Backbone.Collection.extend({initialize:function(){this.listenTo(this,"add",this.attachHandler)},attachHandler:function(a){this.listenTo(a,"remove",this.removeModel)},removeModel:function(a){this.remove(a,{silent:!0})}})},{}],80:[function(a,b,c){var d=a("shared/ModuleBrowser/ModuleBrowserDefinitions"),e=a("shared/ModuleBrowser/ModuleDefinitionModel"),f=a("shared/ModuleBrowser/ModuleBrowserDescriptions"),g=a("shared/ModuleBrowser/ModuleBrowserNavigation"),h=a("common/Checks"),i=a("common/Notice"),j=a("common/Payload"),k=a("common/Ajax"),l=a("common/TinyMCE"),m=a("common/Config"),n=a("templates/backend/modulebrowser/module-browser.hbs");b.exports=Backbone.View.extend({initialize:function(a){this.options=a||{},this.isOpen=!1,this.area=this.options.area,this.viewMode=this.getViewMode(),this.modulesDefinitions=new d(this.prepareAssignedModules(),{model:e,area:this.options.area}).setup(),this.$el.append(n({viewMode:this.getViewModeClass()})),this.$backdrop=jQuery('<div class="kb-module-browser--backdrop"></div>'),this.$list=jQuery(".modules-list",this.$el),this.subviews.ModuleDescription=new f({el:jQuery(".module-description",this.$el),browser:this}),this.subviews.Navigation=new g({el:jQuery(".module-categories",this.$el),cats:this.modulesDefinitions.categories,browser:this}),this.listenTo(this.subviews.Navigation,"browser:change",this.update),this.bindHandlers()},tagName:"div",id:"module-browser",className:"kb-overlay",events:{"click .close-browser":"close","click .module-browser--switch__list-view":"toggleViewMode","click .module-browser--switch__grid-view":"toggleViewMode"},subviews:{},toggleViewMode:function(){jQuery(".module-browser-wrapper",this.$el).toggleClass("module-browser--list-view module-browser--grid-view");var a="mdb_"+this.area.model.get("id")+"_state",b=store.get(a);"list"==b?(this.viewMode="grid",store.set(a,"grid")):(this.viewMode="list",store.set(a,"list"))},render:function(){this.open()},getViewMode:function(){var a="mdb_"+this.area.model.get("id")+"_state";return store.get(a)?store.get(a):(store.set(a,"list"),"list")},getViewModeClass:function(){return"list"===this.viewMode?"module-browser--list-view":"module-browser--grid-view"},bindHandlers:function(){var a=this;jQuery("body").on("click",function(b){a.isOpen&&jQuery(b.target).is(".kb-module-browser--backdrop")&&a.close()}),jQuery(document).keydown(function(b){if(a.isOpen){switch(b.which){case 27:a.close();break;default:return}b.preventDefault()}})},open:function(){this.$el.appendTo("body"),this.$backdrop.appendTo("body"),jQuery("#wpwrap").addClass("module-browser-open"),jQuery(".kb-nano").nanoScroller({flash:!0,contentClass:"kb-nano-content"}),this.isOpen=!0},close:function(){jQuery("#wpwrap").removeClass("module-browser-open"),this.trigger("browser:close"),this.$backdrop.detach(),this.$el.detach(),this.isOpen=!1},update:function(a){var b=a.model.get("id");this.modulesDefinitions.getModules(b);a.renderList()},loadDetails:function(a){this.subviews.ModuleDescription.model=a,this.subviews.ModuleDescription.update()},createModule:function(a){var b,c;return h.userCan("create_kontentblocks")||i.notice("You're not allowed to do this","error"),b=KB.Areas.get(this.options.area.model.get("id")),h.blockLimit(b)?(c={action:"createNewModule","class":a.get("settings")["class"],globalModule:a.get("globalModule"),parentObject:a.get("parentObject"),parentObjectId:a.get("parentObjectId"),areaContext:this.options.area.model.get("context"),area:this.options.area.model.get("id"),_ajax_nonce:m.getNonce("create"),frontend:KB.appData.config.frontend,submodule:!1},this.options.area.model.get("parent_id")&&(c.postId=this.options.area.model.get("parent_id")),this.close(),void k.send(c,this.success,this)):(i.notice("Limit for this area reached","error"),!1)},success:function(a){var b,c;c=a.data,this.options.area.$modulesList.append(c.html),b=KB.ObjectProxy.add(KB.Modules.add(c.module)),this.options.area.attachModule(b),this.parseAdditionalJSON(c.json),b.View.trigger("toggle.open"),setTimeout(function(){KB.Fields.trigger("newModule",b.View),l.addEditor(b.View.$el)},150),this.trigger("browser.module.created",{res:a})},parseAdditionalJSON:function(a){KB.payload.Fields||(KB.payload.Fields={}),_.extend(KB.payload.Fields,a.Fields),j.parseAdditionalJSON(a)},prepareAssignedModules:function(){var a=this.area.model.get("assignedModules"),b=[];return _.each(j.getPayload("ModuleDefinitions"),function(c){-1!==_.indexOf(a,c.settings["class"])&&b.push(c)}),KB.Events.trigger("module.browser.setup.defs",this,b),b}})},{"common/Ajax":19,"common/Checks":20,"common/Config":21,"common/Notice":24,"common/Payload":25,"common/TinyMCE":27,"shared/ModuleBrowser/ModuleBrowserDefinitions":81,"shared/ModuleBrowser/ModuleBrowserDescriptions":82,"shared/ModuleBrowser/ModuleBrowserNavigation":85,"shared/ModuleBrowser/ModuleDefinitionModel":87,"templates/backend/modulebrowser/module-browser.hbs":93}],81:[function(a,b,c){var d=a("common/Payload");b.exports=Backbone.Collection.extend({initialize:function(a,b){this.area=b.area},setup:function(){return this.categories=this.prepareCategories(),this.sortToCategories(),this},getModules:function(a){return this.categories[a]?this.categories[a].modules:void 0},getCategories:function(){return this.categories},sortToCategories:function(){var a=this;_.each(this.models,function(b){if(a.validateVisibility(b)){var c=_.isUndefined(b.get("settings").category)?"standard":b.get("settings").category;a.categories[c].modules.push(b)}})},validateVisibility:function(a){return a.get("settings").hidden?!1:a.get("settings").disabled?!1:!(!a.get("settings").globalModule&&this.area.model.get("dynamic"))},prepareCategories:function(){var a={},b=d.getPayload("ModuleCategories");return _.each(b,function(b,c){a[c]={id:c,name:b,modules:[]}}),KB.Events.trigger("module.browser.setup.cats",a),a}})},{"common/Payload":25}],82:[function(a,b,c){var d=a("templates/backend/modulebrowser/module-template-description.hbs"),e=a("templates/backend/modulebrowser/module-description.hbs");b.exports=Backbone.View.extend({initialize:function(a){this.options=a||{},this.Browser=a.browser,this.Browser.on("browser:close",this.close,this)},events:{"click .kb-js-create-module":"createModule"},update:function(){this.$el.empty(),this.model.get("template")?this.$el.html(d({module:this.model.toJSON(),i18n:KB.i18n})):this.$el.html(e({module:this.model.toJSON(),i18n:KB.i18n})),this.model.get("settings").helptext!==!1&&this.$el.append(this.model.get("settings").helptext)},close:function(){},createModule:function(){this.Browser.createModule(this.model)}})},{"templates/backend/modulebrowser/module-description.hbs":94,"templates/backend/modulebrowser/module-template-description.hbs":96}],83:[function(a,b,c){var d=a("shared/ModuleBrowser/ModuleBrowserListItem");b.exports=Backbone.View.extend({initialize:function(a){this.options=a||{},this.cat=a.cat},modules:{},subviews:{},setModules:function(a){return this.modules=a,this},update:function(){var a=this,b=!1;this.$el.empty();var c=this.cat.model.get("modules");c.sort(function(a,b){return a.get("settings").name>b.get("settings").name?1:b.get("settings").name>a.get("settings").name?-1:0}),_.each(c,function(c){a.subviews[c.cid]=new d({model:c,parent:a,browser:a.options.browser}),b===!1&&(a.options.browser.loadDetails(c),b=!b),a.$el.append(a.subviews[c.cid].render(a.$el))})},render:function(){}})},{"shared/ModuleBrowser/ModuleBrowserListItem":84}],84:[function(a,b,c){var d=a("templates/backend/modulebrowser/module-template-list-item.hbs"),e=a("templates/backend/modulebrowser/module-list-item.hbs"),f=a("templates/backend/modulebrowser/poster.hbs");b.exports=Backbone.View.extend({tagName:"div",className:"modules-list-item",initialize:function(a){this.options=a||{},this.Browser=a.browser,this.area=a.browser.area},render:function(a){this.model.get("globalModule")?this.$el.html(d({module:this.model.toJSON(),i18n:KB.i18n})):this.$el.html(e({module:this.model.toJSON(),i18n:KB.i18n})),a.append(this.$el),this.model.get("settings").poster!==!1&&this.$el.qtip({content:{text:f({module:this.model.toJSON()})},style:{classes:"kb-qtip"},position:{my:"top left",at:"bottom right",target:"mouse",adjust:{x:80,y:20}}})},events:{click:"handleClick","click .kb-js-create-module":"handlePlusClick"},handleClick:function(){"list"===this.Browser.viewMode?this.createModule():this.Browser.loadDetails(this.model)},handlePlusClick:function(){return"list"===this.Browser.viewMode?(this.handleClick(),!1):void this.createModule()},createModule:function(){this.Browser.createModule(this.model)},close:function(){this.remove()}})},{"templates/backend/modulebrowser/module-list-item.hbs":95,"templates/backend/modulebrowser/module-template-list-item.hbs":97,"templates/backend/modulebrowser/poster.hbs":98}],85:[function(a,b,c){var d=a("shared/ModuleBrowser/ModuleBrowserTabItemView");b.exports=Backbone.View.extend({catSet:!1,initialize:function(a){var b=this;this.options=a||{},this.$list=jQuery("<div></div>").appendTo(this.$el),_.each(this.options.cats,function(a){var c=new Backbone.Model(a);new d({parent:b,model:c,browser:b.options.browser}).render()})}})},{"shared/ModuleBrowser/ModuleBrowserTabItemView":86}],86:[function(a,b,c){var d=a("shared/ModuleBrowser/ModuleBrowserList");b.exports=Backbone.View.extend({initialize:function(a){if(this.options=a||{},this.model.get("listRenderer")){var b=this.model.get("listRenderer");this.listRenderer=new b({cat:this,el:a.browser.$list,browser:a.browser})}else this.listRenderer=new d({cat:this,el:a.browser.$list,browser:a.browser})},tagName:"div",className:"cat-item",events:{click:"change"},change:function(){this.options.parent.trigger("browser:change",this),this.$el.addClass("active"),jQuery(".cat-item").not(this.$el).removeClass("active")},render:function(){var a=_.keys(this.model.get("modules")).length,b=" ("+a+")";return 0===a?!1:(this.options.parent.catSet===!1&&(this.options.parent.catSet=!0,this.options.browser.update(this),this.$el.addClass("active")),void this.options.parent.$list.append(this.$el.html(this.model.get("name")+'<span class="module-count">'+b+"</span>")))},renderList:function(){this.listRenderer.update()}})},{"shared/ModuleBrowser/ModuleBrowserList":83}],87:[function(a,b,c){b.exports=Backbone.Model.extend({initialize:function(){var a=this;this.id=function(){return"template"===a.get("settings").category?a.get("mid"):a.get("settings")["class"]}()}})},{}],88:[function(a,b,c){var d=a("backend/Views/ModuleControls/ControlsView");b.exports=d.extend({tagName:"div",className:"kb-module--status-bar-list",initialize:function(a){this.$menuWrap=jQuery(".kb-module--status-bar",this.$el),this.$menuWrap.append("<div class='kb-module--status-bar-list'></div>"),this.$menuList=jQuery(".kb-module--status-bar-list",this.$menuWrap)}})},{"backend/Views/ModuleControls/ControlsView":7}],89:[function(a,b,c){var d=a("backend/Views/BaseControlView"),e=a("templates/backend/status/publish.hbs"),f=a("common/Ajax"),g=a("common/Config"),h=a("common/I18n");b.exports=d.extend({id:"publish",className:"kb-status-draft",events:{click:"toggleDraft"},isValid:function(){return!0},render:function(){var a=this.model.get("state").draft,b=this.model.View.$el;this.$el.append(e({draft:this.model.get("state").draft,strings:h.getString("Modules.tooltips")})),a?b.addClass("kb-module-draft"):b.removeClass("kb-module-draft")},toggleDraft:function(){var a=this;f.send({action:"undraftModule",module:this.model.toJSON(),_ajax_nonce:g.getNonce("update")}).done(function(){a.model.get("state").draft=!a.model.get("state").draft,a.$el.empty(),a.render(),a.model.trigger("change:state",a.model.get("state"))})}})},{"backend/Views/BaseControlView":1,"common/Ajax":19,"common/Config":21,"common/I18n":22,"templates/backend/status/publish.hbs":99}],90:[function(a,b,c){var d=a("backend/Views/BaseControlView"),e=a("templates/backend/status/templates.hbs"),f=a("backend/Views/TemplateEditor/CodemirrorOverlay");b.exports=d.extend({id:"templates",controller:null,className:"kb-status-templates",initialize:function(a){this.moduleView=a.parent,this.views=this.prepareViews(this.model.get("views"))},events:{dblclick:"openEditor"},isValid:function(){return!0},render:function(a){var b=a||this.views,c=_.size(b)>1;this.$el.empty().append(e({show:c,module:this.model.toJSON(),views:b}))},openEditor:function(){new f({views:this.views,module:this.model})},prepareViews:function(a){return _.map(a,function(a){return a.selected=a.filename===this.model.get("viewfile")?'selected="selected"':"",a.isActive=a.filename===this.model.get("viewfile"),a},this)}})},{"backend/Views/BaseControlView":1,"backend/Views/TemplateEditor/CodemirrorOverlay":8,"templates/backend/status/templates.hbs":100}],91:[function(a,b,c){KB.ViewsCollection=function(){this.views={},this.lastViewAdded=null,this.add=function(a,b){return this.views[a]||(this.views[a]=b,KB.trigger("kb:"+b.model.get("class")+":added",b),this.trigger("view:add",b),this.lastViewAdded=b),b},this.ready=function(){_.each(this.views,function(a){a.trigger("kb:"+a.model.get("class"),a),KB.trigger("kb:"+a.model.get("class")+":loaded",a)}),KB.trigger("kb:ready")},this.readyOnFront=function(){_.each(this.views,function(a){a.trigger("kb:"+a.model.get("class"),a),KB.trigger("kb:"+a.model.get("class")+":loadedOnFront",a)}),KB.trigger("kb:ready")},this.remove=function(a){var b=this.get(a);b.model.Area.View.trigger("kb.module.deleted",b),this.trigger("kb.modules.view.deleted",b),delete this.views[a],b.dispose()},this.get=function(a){return this.views[a]?this.views[a]:void 0},this.filterByModelAttr=function(a,b){return _.filter(this.views,function(c){return c.model.get(a)===b})}},_.extend(KB.ViewsCollection.prototype,Backbone.Events),b.exports=KB.ViewsCollection},{}],92:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){return'<div class="kb-context-bar grid__col grid__col--12-of-12">\n    <div class="kb-context-bar--actions">\n\n    </div>\n</div>'},useData:!0})},{"hbsfy/runtime":139}],93:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f;return'<div class="module-browser-wrapper '+a.escapeExpression((f=null!=(f=c.viewMode||(null!=b?b.viewMode:b))?f:c.helperMissing,"function"==typeof f?f.call(null!=b?b:a.nullContext||{},{name:"viewMode",hash:{},data:e}):f))+'">\n\n    <div class="module-browser-header module-categories">\n        <div class="genericon genericon-close-alt close-browser kb-button"></div>\n        <div class="dashicons dashicons-list-view module-browser--switch__list-view kb-hide"></div>\n        <div class="dashicons dashicons-exerpt-view module-browser--switch__excerpt-view kb-hide"></div>\n        <div class="dashicons dashicons-grid-view module-browser--switch__grid-view kb-hide"></div>\n    </div>\n\n    <div class="module-browser__left-column kb-nano">\n        <div class="modules-list kb-nano-content">\n\n        </div>\n    </div>\n\n    <div class="module-browser__right-column kb-nano">\n        <div class="module-description kb-nano-content">\n\n        </div>\n    </div>\n</div>'},useData:!0})},{"hbsfy/runtime":139}],94:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f,g=a.lambda,h=a.escapeExpression;return"<h3>"+h(g(null!=(f=null!=(f=null!=b?b.module:b)?f.settings:f)?f.publicName:f,b))+' <div class="kb-button-small kb-js-create-module">'+h(g(null!=(f=null!=(f=null!=(f=null!=b?b.i18n:b)?f.EditScreen:f)?f.moduleBrowser:f)?f.addModule:f,b))+"</div>\n</h3>\n"},useData:!0})},{"hbsfy/runtime":139}],95:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f,g=a.lambda,h=a.escapeExpression;return'<div class="kbmb-icon '+h(g(null!=(f=null!=(f=null!=b?b.module:b)?f.settings:f)?f.iconclass:f,b))+'"></div>\n<div class="kbmb-hl">'+h(g(null!=(f=null!=(f=null!=b?b.module:b)?f.settings:f)?f.name:f,b))+'</div>\n<div class="kbmb-description">'+h(g(null!=(f=null!=(f=null!=b?b.module:b)?f.settings:f)?f.description:f,b))+"</div>"},useData:!0})},{"hbsfy/runtime":139}],96:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f;return"<h3>"+a.escapeExpression(a.lambda(null!=(f=null!=(f=null!=b?b.module:b)?f.parentObject:f)?f.post_title:f,b))+"</h3>"},useData:!0})},{"hbsfy/runtime":139}],97:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f;return'<div class="dashicons dashicons-plus kb-js-create-module"></div>\n<div class="kbmb-hl">'+a.escapeExpression(a.lambda(null!=(f=null!=(f=null!=b?b.module:b)?f.parentObject:f)?f.post_title:f,b))+"</div>"},useData:!0})},{"hbsfy/runtime":139}],98:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f;return'<div class="module-browser--poster-wrap">\n    <img src="'+a.escapeExpression(a.lambda(null!=(f=null!=(f=null!=b?b.module:b)?f.settings:f)?f.poster:f,b))+'" >\n</div>'},useData:!0})},{"hbsfy/runtime":139}],99:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({1:function(a,b,c,d,e){var f,g=a.lambda,h=a.escapeExpression;return'    <div class="kb-status-draft kb-button-small" data-kbtooltip="'+h(g(null!=(f=null!=b?b.strings:b)?f.tooltipUndraft:f,b))+'">'+h(g(null!=(f=null!=b?b.strings:b)?f.draft:f,b))+"</div>\n"},3:function(a,b,c,d,e){var f,g=a.lambda,h=a.escapeExpression;return'   <div class="kb-status-public kb-button-small" data-kbtooltip="'+h(g(null!=(f=null!=b?b.strings:b)?f.tooltipDraft:f,b))+'">'+h(g(null!=(f=null!=b?b.strings:b)?f.published:f,b))+"</div>\n"},compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f;return null!=(f=c["if"].call(null!=b?b:a.nullContext||{},null!=b?b.draft:b,{name:"if",hash:{},fn:a.program(1,e,0),inverse:a.program(3,e,0),data:e}))?f:""},useData:!0})},{"hbsfy/runtime":139}],100:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({1:function(a,b,c,d,e){var f,g=a.lambda,h=a.escapeExpression;return'    <div class="kb-template-selector--wrapper">\n        <div class="kb-selectbox">\n            <select class="kb-template-select" data-kb-rel="'+h(g(null!=(f=null!=b?b.module:b)?f.mid:f,b))+'" name="'+h(g(null!=(f=null!=b?b.module:b)?f.mid:f,b))+'[viewfile]">\n'+(null!=(f=c.each.call(null!=b?b:a.nullContext||{},null!=b?b.views:b,{name:"each",hash:{},fn:a.program(2,e,0),inverse:a.noop,data:e}))?f:"")+"            </select>\n        </div>\n    </div>\n"},2:function(a,b,c,d,e){var f,g=a.lambda,h=a.escapeExpression;return"                    <option "+(null!=(f=g(null!=b?b.selected:b,b))?f:"")+' value="'+h(g(null!=b?b.filename:b,b))+'"\n                                                data-tpldesc="'+h(g(null!=b?b.description:b,b))+'">'+h(g(null!=b?b.name:b,b))+"</option>\n"},4:function(a,b,c,d,e){var f,g=a.lambda,h=a.escapeExpression;return'    <input name="'+h(g(null!=(f=null!=b?b.module:b)?f.mid:f,b))+'[viewfile]" type="hidden" value="'+h(g(null!=(f=null!=b?b.module:b)?f.viewfile:f,b))+'">\n'},compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f;return(null!=(f=c["if"].call(null!=b?b:a.nullContext||{},null!=b?b.show:b,{name:"if",hash:{},fn:a.program(1,e,0),inverse:a.program(4,e,0),data:e}))?f:"")+"\n"},useData:!0})},{"hbsfy/runtime":139}],101:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f,g=a.lambda,h=a.escapeExpression;return'<div class="kb-tpled--field-item">\n    <div><strong>Label:</strong>'+h(g(null!=(f=null!=(f=null!=b?b.data:b)?f.args:f)?f.label:f,b))+'</div>\n    <div class="kb-tpled--details">\n        <div><strong>Type:</strong>'+h(g(null!=(f=null!=b?b.data:b)?f.type:f,b))+"</div>\n        <div><strong>Key:</strong>"+h(g(null!=(f=null!=b?b.data:b)?f.key:f,b))+"</div>\n        <div><strong>Access:</strong>Model."+h(g(null!=(f=null!=b?b.data:b)?f.kpath:f,b))+"</div>\n        <div><strong>Value:</strong>Model."+h(g(null!=(f=null!=b?b.data:b)?f.value:f,b))+"</div>\n    </div>\n</div>"},useData:!0})},{"hbsfy/runtime":139}],102:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f;return'<div class="kb-template-edditor--file-item">\n    '+a.escapeExpression(a.lambda(null!=(f=null!=b?b.data:b)?f.name:f,b))+"\n</div>"},useData:!0})},{"hbsfy/runtime":139}],103:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){return'<div class="kb-tpled--wrap">\n\n    <div class="kb-tpled--header">\n        <div class="kb-fullscreen--controls">\n            <div class="kb-tpled--close"><span class="dashicons dashicons-no-alt"></span></div>\n        </div>\n    </div>\n    <div class="kb-tpled--inner kbflexwrap">\n        <div class="kb-tpled--sidebar kbflex">\n            <div class="kb-tpled--views">\n                <h5>Templates</h5>\n                <div data-views></div>\n            </div>\n            <div class="kb-tpled--actions">\n                <h5>Actions</h5>\n                <div data-controls></div>\n            </div>\n        </div>\n        <div class="kb-tpled--content kbflex">\n            <div id="codemirror"></div>\n\n        </div>\n        <div class="kb-tpled--sidebar kb-tpled--sidebar-right kbflex">\n            <div class="kb-tpled--fields">\n                <h5>Available Datafields</h5>\n                <div data-fields></div>\n            </div>\n        </div>\n    </div>\n    <div class="kb-tpled--footer">\n\n    </div>\n\n</div>'},useData:!0})},{"hbsfy/runtime":139}],104:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f;return'<div class="kb-area__empty-placeholder">\n    <div class="kb-module-trigger">'+a.escapeExpression(a.lambda(null!=(f=null!=(f=null!=(f=null!=b?b.i18n:b)?f.jsFrontend:f)?f.onpage:f)?f.placeholder:f,b))+"</div>\n</div>"},useData:!0})},{"hbsfy/runtime":139}],105:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f;return"<div>"+(null!=(f=a.lambda(null!=(f=null!=b?b.strings:b)?f.feedback:f,b))?f:"")+"</div>"},useData:!0})},{"hbsfy/runtime":139}],106:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({1:function(a,b,c,d,e){return" kb-dynamic-module "},3:function(a,b,c,d,e){return" global-module "},compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f,g=null!=b?b:a.nullContext||{};return'<div data-kb-mcontrols="'+a.escapeExpression(a.lambda(null!=(f=null!=b?b.model:b)?f.mid:f,b))+"\" class='kb-module-controls "+(null!=(f=c["if"].call(g,null!=(f=null!=b?b.model:b)?f.inDynamic:f,{name:"if",hash:{},fn:a.program(1,e,0),inverse:a.noop,data:e}))?f:"")+" "+(null!=(f=c["if"].call(g,null!=(f=null!=b?b.model:b)?f.globalModule:f,{name:"if",hash:{},fn:a.program(3,e,0),inverse:a.noop,data:e}))?f:"")+'\'>\n    <div class="kb-controls-wrap"></div>\n</div>'},useData:!0})},{"hbsfy/runtime":139}],107:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f,g=a.lambda,h=a.escapeExpression;return'<div class="controls-title">Module: <span> '+h(g(null!=(f=null!=(f=null!=b?b.model:b)?f.settings:f)?f.name:f,b))+'</span></div>\n<div class="dashicons dashicons-no close-controls kb-button"></div>\n<div class="kb-controls--buttons-wrap">\n    <div class="kb-modal-history-back kb-button kb-button-secondary">&laquo; previous module</div>\n    <div class="kb-save-form kb-button kb-button-primary" title="'+h(g(null!=(f=null!=(f=null!=b?b.i18n:b)?f.frontendModal:f)?f.modalSave:f,b))+'">\n        <div class="dashicons dashicons-update"></div>'+h(g(null!=(f=null!=(f=null!=b?b.i18n:b)?f.frontendModal:f)?f.modalSave:f,b))+'<span\n            class="kb-dirty-notice">*</span></div>\n    <div class="kb-preview-form kb-button kb-button-secondary">'+h(g(null!=(f=null!=(f=null!=b?b.i18n:b)?f.frontendModal:f)?f.modalPreview:f,b))+'</div>\n\n</div>\n<form id="onsite-form" class="wp-core-ui wp-admin kb-nano">\n    <div class="kb-nano-content" id="onsite-content">\n\n        <div class="os-content-inner kb-module">\n\n        </div>\n    </div>\n</form>'},useData:!0})},{"hbsfy/runtime":139}],108:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f;return'<div class="kb-module__placeholder">\n    <p>'+a.escapeExpression(a.lambda(null!=(f=null!=(f=null!=b?b.model:b)?f.settings:f)?f.name:f,b))+"\n    <span>Start here.</span>\n    </p>\n</div>"},useData:!0})},{"hbsfy/runtime":139}],109:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f;return'<div class="kb-sidebar__subheader">\n    <span>You are editing area:</span> '+a.escapeExpression((f=null!=(f=c.name||(null!=b?b.name:b))?f:c.helperMissing,"function"==typeof f?f.call(null!=b?b:a.nullContext||{},{name:"name",hash:{},data:e}):f))+'\n</div>\n<div class="kb-sidebar-area-details__settings" style="display: none">\n\n</div>\n<!--<div class="kb-sidebar-area-details__subheader">Categories</div>-->'},useData:!0})},{"hbsfy/runtime":139}],110:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f;return'<div class="kb-sidebar__category-item">\n    <div class="kb-sidebar__category-item__title">\n        Category: '+a.escapeExpression((f=null!=(f=c.name||(null!=b?b.name:b))?f:c.helperMissing,"function"==typeof f?f.call(null!=b?b:a.nullContext||{},{name:"name",hash:{},data:e}):f))+'\n    </div>\n    <div class="kb-sidebar__category-item__module-list">\n    </div>\n</div>';
},useData:!0})},{"hbsfy/runtime":139}],111:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f;return'<div class="kb-sidebar__cat-module-item">\n    '+a.escapeExpression(a.lambda(null!=(f=null!=b?b.settings:b)?f.name:f,b))+'\n    <div class="kb-sidebar__cat-module-item__actions">\n    </div>\n</div>\n'},useData:!0})},{"hbsfy/runtime":139}],112:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){return'<li class="kb-sidebar__no-modules">No Modules attached yet</li>'},useData:!0})},{"hbsfy/runtime":139}],113:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f,g=a.lambda,h=a.escapeExpression;return'<div class="kb-sidebar-item__wrapper">\n    <div class="kb-sidebar-item__name">'+(null!=(f=g(null!=(f=null!=(f=null!=b?b.view:b)?f.settings:f)?f.name:f,b))?f:"")+'</div>\n    <div class="kb-sidebar-item__id">'+(null!=(f=g(null!=(f=null!=(f=null!=b?b.view:b)?f.settings:f)?f.id:f,b))?f:"")+"</div>\n</div>\n<div class=\"kb-sidebar-item__actions\">\n    <a class='kb-sidebar-item__edit' title='edit'\n       data='"+h(g(null!=(f=null!=b?b.view:b)?f.mid:f,b))+"' data-url='"+h(g(null!=(f=null!=b?b.view:b)?f.editURL:f,b))+'\'>\n        <span class="dashicons dashicons-edit"></span>\n        <span class="os-action">'+h(g(null!=(f=null!=(f=null!=b?b.i18n:b)?f.moduleControls:f)?f.controlsEdit:f,b))+"</span></a>\n    <a class='kb-sidebar__module-delete kb-js-inline-delete'><span\n            class=\"dashicons dashicons-trash\"></span></a>\n    <a class='kb-sidebar__module-update kb-js-inline-update'><span\n            class=\"dashicons dashicons-update\"></span></a>\n\n</div>"},useData:!0})},{"hbsfy/runtime":139}],114:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f;return'<div class="kb-sidebar__header-wrap">\n    <div class="kb-sidebar__subheader">\n        '+a.escapeExpression((f=null!=(f=c.name||(null!=b?b.name:b))?f:c.helperMissing,"function"==typeof f?f.call(null!=b?b:a.nullContext||{},{name:"name",hash:{},data:e}):f))+'\n    </div>\n    <span class="genericon genericon-close-alt kb-sidebar-action--close"></span>\n    <div class="kb-sidebar-action--update kb-fx-button kb-fx-button--effect-boris"><span class="dashicons dashicons-update"></span></div>\n\n</div>\n<form class="kb-sidebar__form-container">\n\n</form>\n'},useData:!0})},{"hbsfy/runtime":139}],115:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f;return'<div class="kb-sidebar--panel-item kb-sidebar__item">\n    '+a.escapeExpression((f=null!=(f=c.name||(null!=b?b.name:b))?f:c.helperMissing,"function"==typeof f?f.call(null!=b?b:a.nullContext||{},{name:"name",hash:{},data:e}):f))+"\n</div>"},useData:!0})},{"hbsfy/runtime":139}],116:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f,g=null!=b?b:a.nullContext||{},h=c.helperMissing,i="function",j=a.escapeExpression;return'<div class="kb-sidebar__item kb-sidebar__item--root" data-kb-action="'+j((f=null!=(f=c.id||(null!=b?b.id:b))?f:h,typeof f===i?f.call(g,{name:"id",hash:{},data:e}):f))+'">\n    '+j((f=null!=(f=c.text||(null!=b?b.text:b))?f:h,typeof f===i?f.call(g,{name:"text",hash:{},data:e}):f))+'\n    <span class="dashicons dashicons-arrow-right-alt2 kb-sidebar__add-module kb-js-sidebar-add-module"></span>\n\n</div>'},useData:!0})},{"hbsfy/runtime":139}],117:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){var f;return'<div class="kb-sidebar-areaview kb-sidebar-areaview--inactive">\n    <div class="kb-sidebar-areaview__title"> '+a.escapeExpression((f=null!=(f=c.name||(null!=b?b.name:b))?f:c.helperMissing,"function"==typeof f?f.call(null!=b?b:a.nullContext||{},{name:"name",hash:{},data:e}):f))+'</div>\n    <span class="dashicons dashicons-arrow-right-alt2 kb-sidebar__add-module kb-js-sidebar-add-module"></span>\n</div>'},useData:!0})},{"hbsfy/runtime":139}],118:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){return'<div class="kb-sidebar__header-wrap">\n    <div class="kb-sidebar__subheader">\n        Kontentblocks\n    </div>\n</div>'},useData:!0})},{"hbsfy/runtime":139}],119:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[7,">= 4.0.0"],main:function(a,b,c,d,e){return'<div class="kb-sidebar__nav-controls">\n    <div class="kb-sidebar__nav-button kb-js-sidebar-nav-back">\n        <span class="dashicons dashicons-arrow-left-alt2 cbutton cbutton--effect-boris"></span>\n    </div>\n</div>'},useData:!0})},{"hbsfy/runtime":139}],120:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function f(){var a=new h.HandlebarsEnvironment;return n.extend(a,h),a.SafeString=j["default"],a.Exception=l["default"],a.Utils=n,a.escapeExpression=n.escapeExpression,a.VM=p,a.template=function(b){return p.template(b,a)},a}c.__esModule=!0;var g=a("./handlebars/base"),h=e(g),i=a("./handlebars/safe-string"),j=d(i),k=a("./handlebars/exception"),l=d(k),m=a("./handlebars/utils"),n=e(m),o=a("./handlebars/runtime"),p=e(o),q=a("./handlebars/no-conflict"),r=d(q),s=f();s.create=f,r["default"](s),s["default"]=s,c["default"]=s,b.exports=c["default"]},{"./handlebars/base":121,"./handlebars/exception":124,"./handlebars/no-conflict":134,"./handlebars/runtime":135,"./handlebars/safe-string":136,"./handlebars/utils":137}],121:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b,c){this.helpers=a||{},this.partials=b||{},this.decorators=c||{},i.registerDefaultHelpers(this),j.registerDefaultDecorators(this)}c.__esModule=!0,c.HandlebarsEnvironment=e;var f=a("./utils"),g=a("./exception"),h=d(g),i=a("./helpers"),j=a("./decorators"),k=a("./logger"),l=d(k),m="4.0.11";c.VERSION=m;var n=7;c.COMPILER_REVISION=n;var o={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0"};c.REVISION_CHANGES=o;var p="[object Object]";e.prototype={constructor:e,logger:l["default"],log:l["default"].log,registerHelper:function(a,b){if(f.toString.call(a)===p){if(b)throw new h["default"]("Arg not supported with multiple helpers");f.extend(this.helpers,a)}else this.helpers[a]=b},unregisterHelper:function(a){delete this.helpers[a]},registerPartial:function(a,b){if(f.toString.call(a)===p)f.extend(this.partials,a);else{if("undefined"==typeof b)throw new h["default"]('Attempting to register a partial called "'+a+'" as undefined');this.partials[a]=b}},unregisterPartial:function(a){delete this.partials[a]},registerDecorator:function(a,b){if(f.toString.call(a)===p){if(b)throw new h["default"]("Arg not supported with multiple decorators");f.extend(this.decorators,a)}else this.decorators[a]=b},unregisterDecorator:function(a){delete this.decorators[a]}};var q=l["default"].log;c.log=q,c.createFrame=f.createFrame,c.logger=l["default"]},{"./decorators":122,"./exception":124,"./helpers":125,"./logger":133,"./utils":137}],122:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){g["default"](a)}c.__esModule=!0,c.registerDefaultDecorators=e;var f=a("./decorators/inline"),g=d(f)},{"./decorators/inline":123}],123:[function(a,b,c){"use strict";c.__esModule=!0;var d=a("../utils");c["default"]=function(a){a.registerDecorator("inline",function(a,b,c,e){var f=a;return b.partials||(b.partials={},f=function(e,f){var g=c.partials;c.partials=d.extend({},g,b.partials);var h=a(e,f);return c.partials=g,h}),b.partials[e.args[0]]=e.fn,f})},b.exports=c["default"]},{"../utils":137}],124:[function(a,b,c){"use strict";function d(a,b){var c=b&&b.loc,f=void 0,g=void 0;c&&(f=c.start.line,g=c.start.column,a+=" - "+f+":"+g);for(var h=Error.prototype.constructor.call(this,a),i=0;i<e.length;i++)this[e[i]]=h[e[i]];Error.captureStackTrace&&Error.captureStackTrace(this,d);try{c&&(this.lineNumber=f,Object.defineProperty?Object.defineProperty(this,"column",{value:g,enumerable:!0}):this.column=g)}catch(j){}}c.__esModule=!0;var e=["description","fileName","lineNumber","message","name","number","stack"];d.prototype=new Error,c["default"]=d,b.exports=c["default"]},{}],125:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){g["default"](a),i["default"](a),k["default"](a),m["default"](a),o["default"](a),q["default"](a),s["default"](a)}c.__esModule=!0,c.registerDefaultHelpers=e;var f=a("./helpers/block-helper-missing"),g=d(f),h=a("./helpers/each"),i=d(h),j=a("./helpers/helper-missing"),k=d(j),l=a("./helpers/if"),m=d(l),n=a("./helpers/log"),o=d(n),p=a("./helpers/lookup"),q=d(p),r=a("./helpers/with"),s=d(r)},{"./helpers/block-helper-missing":126,"./helpers/each":127,"./helpers/helper-missing":128,"./helpers/if":129,"./helpers/log":130,"./helpers/lookup":131,"./helpers/with":132}],126:[function(a,b,c){"use strict";c.__esModule=!0;var d=a("../utils");c["default"]=function(a){a.registerHelper("blockHelperMissing",function(b,c){var e=c.inverse,f=c.fn;if(b===!0)return f(this);if(b===!1||null==b)return e(this);if(d.isArray(b))return b.length>0?(c.ids&&(c.ids=[c.name]),a.helpers.each(b,c)):e(this);if(c.data&&c.ids){var g=d.createFrame(c.data);g.contextPath=d.appendContextPath(c.data.contextPath,c.name),c={data:g}}return f(b,c)})},b.exports=c["default"]},{"../utils":137}],127:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}c.__esModule=!0;var e=a("../utils"),f=a("../exception"),g=d(f);c["default"]=function(a){a.registerHelper("each",function(a,b){function c(b,c,f){j&&(j.key=b,j.index=c,j.first=0===c,j.last=!!f,k&&(j.contextPath=k+b)),i+=d(a[b],{data:j,blockParams:e.blockParams([a[b],b],[k+b,null])})}if(!b)throw new g["default"]("Must pass iterator to #each");var d=b.fn,f=b.inverse,h=0,i="",j=void 0,k=void 0;if(b.data&&b.ids&&(k=e.appendContextPath(b.data.contextPath,b.ids[0])+"."),e.isFunction(a)&&(a=a.call(this)),b.data&&(j=e.createFrame(b.data)),a&&"object"==typeof a)if(e.isArray(a))for(var l=a.length;l>h;h++)h in a&&c(h,h,h===a.length-1);else{var m=void 0;for(var n in a)a.hasOwnProperty(n)&&(void 0!==m&&c(m,h-1),m=n,h++);void 0!==m&&c(m,h-1,!0)}return 0===h&&(i=f(this)),i})},b.exports=c["default"]},{"../exception":124,"../utils":137}],128:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}c.__esModule=!0;var e=a("../exception"),f=d(e);c["default"]=function(a){a.registerHelper("helperMissing",function(){if(1===arguments.length)return void 0;throw new f["default"]('Missing helper: "'+arguments[arguments.length-1].name+'"')})},b.exports=c["default"]},{"../exception":124}],129:[function(a,b,c){"use strict";c.__esModule=!0;var d=a("../utils");c["default"]=function(a){a.registerHelper("if",function(a,b){return d.isFunction(a)&&(a=a.call(this)),!b.hash.includeZero&&!a||d.isEmpty(a)?b.inverse(this):b.fn(this)}),a.registerHelper("unless",function(b,c){return a.helpers["if"].call(this,b,{fn:c.inverse,inverse:c.fn,hash:c.hash})})},b.exports=c["default"]},{"../utils":137}],130:[function(a,b,c){"use strict";c.__esModule=!0,c["default"]=function(a){a.registerHelper("log",function(){for(var b=[void 0],c=arguments[arguments.length-1],d=0;d<arguments.length-1;d++)b.push(arguments[d]);var e=1;null!=c.hash.level?e=c.hash.level:c.data&&null!=c.data.level&&(e=c.data.level),b[0]=e,a.log.apply(a,b)})},b.exports=c["default"]},{}],131:[function(a,b,c){"use strict";c.__esModule=!0,c["default"]=function(a){a.registerHelper("lookup",function(a,b){return a&&a[b]})},b.exports=c["default"]},{}],132:[function(a,b,c){"use strict";c.__esModule=!0;var d=a("../utils");c["default"]=function(a){a.registerHelper("with",function(a,b){d.isFunction(a)&&(a=a.call(this));var c=b.fn;if(d.isEmpty(a))return b.inverse(this);var e=b.data;return b.data&&b.ids&&(e=d.createFrame(b.data),e.contextPath=d.appendContextPath(b.data.contextPath,b.ids[0])),c(a,{data:e,blockParams:d.blockParams([a],[e&&e.contextPath])})})},b.exports=c["default"]},{"../utils":137}],133:[function(a,b,c){"use strict";c.__esModule=!0;var d=a("./utils"),e={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(a){if("string"==typeof a){var b=d.indexOf(e.methodMap,a.toLowerCase());a=b>=0?b:parseInt(a,10)}return a},log:function(a){if(a=e.lookupLevel(a),"undefined"!=typeof console&&e.lookupLevel(e.level)<=a){var b=e.methodMap[a];console[b]||(b="log");for(var c=arguments.length,d=Array(c>1?c-1:0),f=1;c>f;f++)d[f-1]=arguments[f];console[b].apply(console,d)}}};c["default"]=e,b.exports=c["default"]},{"./utils":137}],134:[function(a,b,c){"use strict";c.__esModule=!0,c["default"]=function(a){var b="undefined"!=typeof global?global:window,c=b.Handlebars;a.noConflict=function(){return b.Handlebars===a&&(b.Handlebars=c),a}},b.exports=c["default"]},{}],135:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function f(a){var b=a&&a[0]||1,c=r.COMPILER_REVISION;if(b!==c){if(c>b){var d=r.REVISION_CHANGES[c],e=r.REVISION_CHANGES[b];throw new q["default"]("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+d+") or downgrade your runtime to an older version ("+e+").")}throw new q["default"]("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+a[1]+").")}}function g(a,b){function c(c,d,e){e.hash&&(d=o.extend({},d,e.hash),e.ids&&(e.ids[0]=!0)),c=b.VM.resolvePartial.call(this,c,d,e);var f=b.VM.invokePartial.call(this,c,d,e);if(null==f&&b.compile&&(e.partials[e.name]=b.compile(c,a.compilerOptions,b),f=e.partials[e.name](d,e)),null!=f){if(e.indent){for(var g=f.split("\n"),h=0,i=g.length;i>h&&(g[h]||h+1!==i);h++)g[h]=e.indent+g[h];f=g.join("\n")}return f}throw new q["default"]("The partial "+e.name+" could not be compiled when running in runtime-only mode")}function d(b){function c(b){return""+a.main(e,b,e.helpers,e.partials,g,i,h)}var f=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],g=f.data;d._setup(f),!f.partial&&a.useData&&(g=l(b,g));var h=void 0,i=a.useBlockParams?[]:void 0;return a.useDepths&&(h=f.depths?b!=f.depths[0]?[b].concat(f.depths):f.depths:[b]),(c=m(a.main,c,e,f.depths||[],g,i))(b,f)}if(!b)throw new q["default"]("No environment passed to template");if(!a||!a.main)throw new q["default"]("Unknown template object: "+typeof a);a.main.decorator=a.main_d,b.VM.checkRevision(a.compiler);var e={strict:function(a,b){if(!(b in a))throw new q["default"]('"'+b+'" not defined in '+a);return a[b]},lookup:function(a,b){for(var c=a.length,d=0;c>d;d++)if(a[d]&&null!=a[d][b])return a[d][b]},lambda:function(a,b){return"function"==typeof a?a.call(b):a},escapeExpression:o.escapeExpression,invokePartial:c,fn:function(b){var c=a[b];return c.decorator=a[b+"_d"],c},programs:[],program:function(a,b,c,d,e){var f=this.programs[a],g=this.fn(a);return b||e||d||c?f=h(this,a,g,b,c,d,e):f||(f=this.programs[a]=h(this,a,g)),f},data:function(a,b){for(;a&&b--;)a=a._parent;return a},merge:function(a,b){var c=a||b;return a&&b&&a!==b&&(c=o.extend({},b,a)),c},nullContext:Object.seal({}),noop:b.VM.noop,compilerInfo:a.compiler};return d.isTop=!0,d._setup=function(c){c.partial?(e.helpers=c.helpers,e.partials=c.partials,e.decorators=c.decorators):(e.helpers=e.merge(c.helpers,b.helpers),a.usePartial&&(e.partials=e.merge(c.partials,b.partials)),(a.usePartial||a.useDecorators)&&(e.decorators=e.merge(c.decorators,b.decorators)))},d._child=function(b,c,d,f){if(a.useBlockParams&&!d)throw new q["default"]("must pass block params");if(a.useDepths&&!f)throw new q["default"]("must pass parent depths");return h(e,b,a[b],c,0,d,f)},d}function h(a,b,c,d,e,f,g){function h(b){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],h=g;return!g||b==g[0]||b===a.nullContext&&null===g[0]||(h=[b].concat(g)),c(a,b,a.helpers,a.partials,e.data||d,f&&[e.blockParams].concat(f),h)}return h=m(c,h,a,g,d,f),h.program=b,h.depth=g?g.length:0,h.blockParams=e||0,h}function i(a,b,c){return a?a.call||c.name||(c.name=a,a=c.partials[a]):a="@partial-block"===c.name?c.data["partial-block"]:c.partials[c.name],a}function j(a,b,c){var d=c.data&&c.data["partial-block"];c.partial=!0,c.ids&&(c.data.contextPath=c.ids[0]||c.data.contextPath);var e=void 0;if(c.fn&&c.fn!==k&&!function(){c.data=r.createFrame(c.data);var a=c.fn;e=c.data["partial-block"]=function(b){var c=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return c.data=r.createFrame(c.data),c.data["partial-block"]=d,a(b,c)},a.partials&&(c.partials=o.extend({},c.partials,a.partials))}(),void 0===a&&e&&(a=e),void 0===a)throw new q["default"]("The partial "+c.name+" could not be found");return a instanceof Function?a(b,c):void 0}function k(){return""}function l(a,b){return b&&"root"in b||(b=b?r.createFrame(b):{},b.root=a),b}function m(a,b,c,d,e,f){if(a.decorator){var g={};b=a.decorator(b,g,c,d&&d[0],e,f,d),o.extend(b,g)}return b}c.__esModule=!0,c.checkRevision=f,c.template=g,c.wrapProgram=h,c.resolvePartial=i,c.invokePartial=j,c.noop=k;var n=a("./utils"),o=e(n),p=a("./exception"),q=d(p),r=a("./base")},{"./base":121,"./exception":124,"./utils":137}],136:[function(a,b,c){"use strict";function d(a){this.string=a}c.__esModule=!0,d.prototype.toString=d.prototype.toHTML=function(){return""+this.string},c["default"]=d,b.exports=c["default"]},{}],137:[function(a,b,c){"use strict";function d(a){return l[a]}function e(a){for(var b=1;b<arguments.length;b++)for(var c in arguments[b])Object.prototype.hasOwnProperty.call(arguments[b],c)&&(a[c]=arguments[b][c]);return a}function f(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1}function g(a){if("string"!=typeof a){if(a&&a.toHTML)return a.toHTML();if(null==a)return"";if(!a)return a+"";a=""+a}return n.test(a)?a.replace(m,d):a}function h(a){return a||0===a?q(a)&&0===a.length?!0:!1:!0}function i(a){var b=e({},a);return b._parent=a,b}function j(a,b){return a.path=b,a}function k(a,b){return(a?a+".":"")+b}c.__esModule=!0,c.extend=e,c.indexOf=f,c.escapeExpression=g,c.isEmpty=h,c.createFrame=i,c.blockParams=j,c.appendContextPath=k;var l={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},m=/[&<>"'`=]/g,n=/[&<>"'`=]/,o=Object.prototype.toString;c.toString=o;var p=function(a){return"function"==typeof a};p(/x/)&&(c.isFunction=p=function(a){return"function"==typeof a&&"[object Function]"===o.call(a)}),c.isFunction=p;var q=Array.isArray||function(a){return a&&"object"==typeof a?"[object Array]"===o.call(a):!1};c.isArray=q},{}],138:[function(a,b,c){b.exports=a("./dist/cjs/handlebars.runtime")["default"]},{"./dist/cjs/handlebars.runtime":120}],139:[function(a,b,c){b.exports=a("handlebars/runtime")["default"]},{"handlebars/runtime":138}],140:[function(a,b,c){!function(a,d){"function"==typeof define&&define.amd?define([],d):"object"==typeof c?b.exports=d():a.Tether=d()}(this,function(){"use strict";function a(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function b(a){var c=a.getBoundingClientRect(),d={};for(var e in c)d[e]=c[e];if(a.ownerDocument!==document){var f=a.ownerDocument.defaultView.frameElement;if(f){var g=b(f);d.top+=g.top,d.bottom+=g.top,d.left+=g.left,d.right+=g.left}}return d}function c(a){var b=getComputedStyle(a)||{},c=b.position,d=[];if("fixed"===c)return[a];for(var e=a;(e=e.parentNode)&&e&&1===e.nodeType;){var f=void 0;try{f=getComputedStyle(e)}catch(g){}if("undefined"==typeof f||null===f)return d.push(e),d;var h=f,i=h.overflow,j=h.overflowX,k=h.overflowY;/(auto|scroll|overlay)/.test(i+k+j)&&("absolute"!==c||["relative","absolute","fixed"].indexOf(f.position)>=0)&&d.push(e)}return d.push(a.ownerDocument.body),a.ownerDocument!==document&&d.push(a.ownerDocument.defaultView),d}function d(){w&&document.body.removeChild(w),w=null}function e(a){var c=void 0;a===document?(c=document,a=document.documentElement):c=a.ownerDocument;var d=c.documentElement,e=b(a),f=z();return e.top-=f.top,e.left-=f.left,"undefined"==typeof e.width&&(e.width=document.body.scrollWidth-e.left-e.right),"undefined"==typeof e.height&&(e.height=document.body.scrollHeight-e.top-e.bottom),e.top=e.top-d.clientTop,e.left=e.left-d.clientLeft,e.right=c.body.clientWidth-e.width-e.left,e.bottom=c.body.clientHeight-e.height-e.top,e}function f(a){return a.offsetParent||document.documentElement}function g(){if(A)return A;var a=document.createElement("div");a.style.width="100%",a.style.height="200px";var b=document.createElement("div");h(b.style,{position:"absolute",top:0,left:0,pointerEvents:"none",visibility:"hidden",width:"200px",height:"150px",overflow:"hidden"}),b.appendChild(a),document.body.appendChild(b);var c=a.offsetWidth;b.style.overflow="scroll";var d=a.offsetWidth;c===d&&(d=b.clientWidth),document.body.removeChild(b);var e=c-d;return A={width:e,height:e}}function h(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b=[];return Array.prototype.push.apply(b,arguments),b.slice(1).forEach(function(b){if(b)for(var c in b)({}).hasOwnProperty.call(b,c)&&(a[c]=b[c])}),a}function i(a,b){if("undefined"!=typeof a.classList)b.split(" ").forEach(function(b){b.trim()&&a.classList.remove(b)});else{var c=new RegExp("(^| )"+b.split(" ").join("|")+"( |$)","gi"),d=l(a).replace(c," ");m(a,d)}}function j(a,b){if("undefined"!=typeof a.classList)b.split(" ").forEach(function(b){b.trim()&&a.classList.add(b)});else{i(a,b);var c=l(a)+(" "+b);m(a,c)}}function k(a,b){if("undefined"!=typeof a.classList)return a.classList.contains(b);var c=l(a);return new RegExp("(^| )"+b+"( |$)","gi").test(c)}function l(a){return a.className instanceof a.ownerDocument.defaultView.SVGAnimatedString?a.className.baseVal:a.className}function m(a,b){a.setAttribute("class",b)}function n(a,b,c){c.forEach(function(c){-1===b.indexOf(c)&&k(a,c)&&i(a,c)}),b.forEach(function(b){k(a,b)||j(a,b)})}function a(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function o(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function p(a,b){var c=arguments.length<=2||void 0===arguments[2]?1:arguments[2];return a+c>=b&&b>=a-c}function q(){return"object"==typeof performance&&"function"==typeof performance.now?performance.now():+new Date}function r(){for(var a={top:0,left:0},b=arguments.length,c=Array(b),d=0;b>d;d++)c[d]=arguments[d];return c.forEach(function(b){var c=b.top,d=b.left;"string"==typeof c&&(c=parseFloat(c,10)),"string"==typeof d&&(d=parseFloat(d,10)),a.top+=c,a.left+=d}),a}function s(a,b){return"string"==typeof a.left&&-1!==a.left.indexOf("%")&&(a.left=parseFloat(a.left,10)/100*b.width),"string"==typeof a.top&&-1!==a.top.indexOf("%")&&(a.top=parseFloat(a.top,10)/100*b.height),a}function t(a,b){return"scrollParent"===b?b=a.scrollParents[0]:"window"===b&&(b=[pageXOffset,pageYOffset,innerWidth+pageXOffset,innerHeight+pageYOffset]),b===document&&(b=b.documentElement),"undefined"!=typeof b.nodeType&&!function(){var a=b,c=e(b),d=c,f=getComputedStyle(b);if(b=[d.left,d.top,c.width+d.left,c.height+d.top],a.ownerDocument!==document){var g=a.ownerDocument.defaultView;b[0]+=g.pageXOffset,b[1]+=g.pageYOffset,b[2]+=g.pageXOffset,b[3]+=g.pageYOffset}U.forEach(function(a,c){a=a[0].toUpperCase()+a.substr(1),"Top"===a||"Left"===a?b[c]+=parseFloat(f["border"+a+"Width"]):b[c]-=parseFloat(f["border"+a+"Width"])})}(),b}var u=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),v=void 0;"undefined"==typeof v&&(v={modules:[]});var w=null,x=function(){var a=0;return function(){return++a}}(),y={},z=function(){var a=w;a&&document.body.contains(a)||(a=document.createElement("div"),a.setAttribute("data-tether-id",x()),h(a.style,{top:0,left:0,position:"absolute"}),document.body.appendChild(a),w=a);var c=a.getAttribute("data-tether-id");return"undefined"==typeof y[c]&&(y[c]=b(a),C(function(){delete y[c]})),y[c]},A=null,B=[],C=function(a){B.push(a)},D=function(){for(var a=void 0;a=B.pop();)a()},E=function(){function b(){a(this,b)}return u(b,[{key:"on",value:function(a,b,c){var d=arguments.length<=3||void 0===arguments[3]?!1:arguments[3];"undefined"==typeof this.bindings&&(this.bindings={}),"undefined"==typeof this.bindings[a]&&(this.bindings[a]=[]),this.bindings[a].push({handler:b,ctx:c,once:d})}},{key:"once",value:function(a,b,c){this.on(a,b,c,!0)}},{key:"off",value:function(a,b){if("undefined"!=typeof this.bindings&&"undefined"!=typeof this.bindings[a])if("undefined"==typeof b)delete this.bindings[a];else for(var c=0;c<this.bindings[a].length;)this.bindings[a][c].handler===b?this.bindings[a].splice(c,1):++c}},{key:"trigger",value:function(a){if("undefined"!=typeof this.bindings&&this.bindings[a]){for(var b=0,c=arguments.length,d=Array(c>1?c-1:0),e=1;c>e;e++)d[e-1]=arguments[e];for(;b<this.bindings[a].length;){var f=this.bindings[a][b],g=f.handler,h=f.ctx,i=f.once,j=h;"undefined"==typeof j&&(j=this),g.apply(j,d),i?this.bindings[a].splice(b,1):++b}}}}]),b}();v.Utils={getActualBoundingClientRect:b,getScrollParents:c,getBounds:e,getOffsetParent:f,extend:h,addClass:j,removeClass:i,hasClass:k,updateClasses:n,defer:C,flush:D,uniqueId:x,Evented:E,getScrollBarSize:g,removeUtilElements:d};var F=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),G=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0,h=j=void 0}};if("undefined"==typeof v)throw new Error("You must include the utils.js file before tether.js");var H=v.Utils,c=H.getScrollParents,e=H.getBounds,f=H.getOffsetParent,h=H.extend,j=H.addClass,i=H.removeClass,n=H.updateClasses,C=H.defer,D=H.flush,g=H.getScrollBarSize,d=H.removeUtilElements,I=function(){if("undefined"==typeof document)return"";for(var a=document.createElement("div"),b=["transform","WebkitTransform","OTransform","MozTransform","msTransform"],c=0;c<b.length;++c){var d=b[c];if(void 0!==a.style[d])return d}}(),J=[],K=function(){J.forEach(function(a){a.position(!1)}),D()};!function(){var a=null,b=null,c=null,d=function e(){return"undefined"!=typeof b&&b>16?(b=Math.min(b-16,250),void(c=setTimeout(e,250))):void("undefined"!=typeof a&&q()-a<10||(null!=c&&(clearTimeout(c),c=null),a=q(),K(),b=q()-a))};"undefined"!=typeof window&&"undefined"!=typeof window.addEventListener&&["resize","scroll","touchmove"].forEach(function(a){window.addEventListener(a,d)})}();var L={center:"center",left:"right",right:"left"},M={middle:"middle",top:"bottom",bottom:"top"},N={top:0,left:0,middle:"50%",center:"50%",bottom:"100%",right:"100%"},O=function(a,b){var c=a.left,d=a.top;return"auto"===c&&(c=L[b.left]),"auto"===d&&(d=M[b.top]),{left:c,top:d}},P=function(a){var b=a.left,c=a.top;return"undefined"!=typeof N[a.left]&&(b=N[a.left]),"undefined"!=typeof N[a.top]&&(c=N[a.top]),{left:b,top:c}},Q=function(a){var b=a.split(" "),c=F(b,2),d=c[0],e=c[1];return{top:d,left:e}},R=Q,S=function(b){function k(b){var c=this;a(this,k),G(Object.getPrototypeOf(k.prototype),"constructor",this).call(this),this.position=this.position.bind(this),J.push(this),this.history=[],this.setOptions(b,!1),v.modules.forEach(function(a){"undefined"!=typeof a.initialize&&a.initialize.call(c)}),this.position()}return o(k,b),u(k,[{key:"getClass",value:function(){var a=arguments.length<=0||void 0===arguments[0]?"":arguments[0],b=this.options.classes;return"undefined"!=typeof b&&b[a]?this.options.classes[a]:this.options.classPrefix?this.options.classPrefix+"-"+a:a}},{key:"setOptions",value:function(a){var b=this,d=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],e={offset:"0 0",targetOffset:"0 0",targetAttachment:"auto auto",classPrefix:"tether"};this.options=h(e,a);var f=this.options,g=f.element,i=f.target,k=f.targetModifier;if(this.element=g,this.target=i,this.targetModifier=k,"viewport"===this.target?(this.target=document.body,this.targetModifier="visible"):"scroll-handle"===this.target&&(this.target=document.body,this.targetModifier="scroll-handle"),["element","target"].forEach(function(a){if("undefined"==typeof b[a])throw new Error("Tether Error: Both element and target must be defined");"undefined"!=typeof b[a].jquery?b[a]=b[a][0]:"string"==typeof b[a]&&(b[a]=document.querySelector(b[a]))}),j(this.element,this.getClass("element")),this.options.addTargetClasses!==!1&&j(this.target,this.getClass("target")),!this.options.attachment)throw new Error("Tether Error: You must provide an attachment");this.targetAttachment=R(this.options.targetAttachment),this.attachment=R(this.options.attachment),this.offset=Q(this.options.offset),this.targetOffset=Q(this.options.targetOffset),"undefined"!=typeof this.scrollParents&&this.disable(),"scroll-handle"===this.targetModifier?this.scrollParents=[this.target]:this.scrollParents=c(this.target),this.options.enabled!==!1&&this.enable(d)}},{key:"getTargetBounds",value:function(){if("undefined"==typeof this.targetModifier)return e(this.target);if("visible"===this.targetModifier){if(this.target===document.body)return{top:pageYOffset,left:pageXOffset,height:innerHeight,width:innerWidth};var a=e(this.target),b={height:a.height,width:a.width,top:a.top,left:a.left};return b.height=Math.min(b.height,a.height-(pageYOffset-a.top)),b.height=Math.min(b.height,a.height-(a.top+a.height-(pageYOffset+innerHeight))),b.height=Math.min(innerHeight,b.height),b.height-=2,b.width=Math.min(b.width,a.width-(pageXOffset-a.left)),b.width=Math.min(b.width,a.width-(a.left+a.width-(pageXOffset+innerWidth))),b.width=Math.min(innerWidth,b.width),b.width-=2,b.top<pageYOffset&&(b.top=pageYOffset),b.left<pageXOffset&&(b.left=pageXOffset),b}if("scroll-handle"===this.targetModifier){var a=void 0,c=this.target;c===document.body?(c=document.documentElement,a={left:pageXOffset,top:pageYOffset,height:innerHeight,width:innerWidth}):a=e(c);var d=getComputedStyle(c),f=c.scrollWidth>c.clientWidth||[d.overflow,d.overflowX].indexOf("scroll")>=0||this.target!==document.body,g=0;f&&(g=15);var h=a.height-parseFloat(d.borderTopWidth)-parseFloat(d.borderBottomWidth)-g,b={width:15,height:.975*h*(h/c.scrollHeight),left:a.left+a.width-parseFloat(d.borderLeftWidth)-15},i=0;408>h&&this.target===document.body&&(i=-11e-5*Math.pow(h,2)-.00727*h+22.58),this.target!==document.body&&(b.height=Math.max(b.height,24));var j=this.target.scrollTop/(c.scrollHeight-h);return b.top=j*(h-b.height-i)+a.top+parseFloat(d.borderTopWidth),
this.target===document.body&&(b.height=Math.max(b.height,24)),b}}},{key:"clearCache",value:function(){this._cache={}}},{key:"cache",value:function(a,b){return"undefined"==typeof this._cache&&(this._cache={}),"undefined"==typeof this._cache[a]&&(this._cache[a]=b.call(this)),this._cache[a]}},{key:"enable",value:function(){var a=this,b=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];this.options.addTargetClasses!==!1&&j(this.target,this.getClass("enabled")),j(this.element,this.getClass("enabled")),this.enabled=!0,this.scrollParents.forEach(function(b){b!==a.target.ownerDocument&&b.addEventListener("scroll",a.position)}),b&&this.position()}},{key:"disable",value:function(){var a=this;i(this.target,this.getClass("enabled")),i(this.element,this.getClass("enabled")),this.enabled=!1,"undefined"!=typeof this.scrollParents&&this.scrollParents.forEach(function(b){b.removeEventListener("scroll",a.position)})}},{key:"destroy",value:function(){var a=this;this.disable(),J.forEach(function(b,c){b===a&&J.splice(c,1)}),0===J.length&&d()}},{key:"updateAttachClasses",value:function(a,b){var c=this;a=a||this.attachment,b=b||this.targetAttachment;var d=["left","top","bottom","right","middle","center"];"undefined"!=typeof this._addAttachClasses&&this._addAttachClasses.length&&this._addAttachClasses.splice(0,this._addAttachClasses.length),"undefined"==typeof this._addAttachClasses&&(this._addAttachClasses=[]);var e=this._addAttachClasses;a.top&&e.push(this.getClass("element-attached")+"-"+a.top),a.left&&e.push(this.getClass("element-attached")+"-"+a.left),b.top&&e.push(this.getClass("target-attached")+"-"+b.top),b.left&&e.push(this.getClass("target-attached")+"-"+b.left);var f=[];d.forEach(function(a){f.push(c.getClass("element-attached")+"-"+a),f.push(c.getClass("target-attached")+"-"+a)}),C(function(){"undefined"!=typeof c._addAttachClasses&&(n(c.element,c._addAttachClasses,f),c.options.addTargetClasses!==!1&&n(c.target,c._addAttachClasses,f),delete c._addAttachClasses)})}},{key:"position",value:function(){var a=this,b=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];if(this.enabled){this.clearCache();var c=O(this.targetAttachment,this.attachment);this.updateAttachClasses(this.attachment,c);var d=this.cache("element-bounds",function(){return e(a.element)}),h=d.width,i=d.height;if(0===h&&0===i&&"undefined"!=typeof this.lastSize){var j=this.lastSize;h=j.width,i=j.height}else this.lastSize={width:h,height:i};var k=this.cache("target-bounds",function(){return a.getTargetBounds()}),l=k,m=s(P(this.attachment),{width:h,height:i}),n=s(P(c),l),o=s(this.offset,{width:h,height:i}),p=s(this.targetOffset,l);m=r(m,o),n=r(n,p);for(var q=k.left+n.left-m.left,t=k.top+n.top-m.top,u=0;u<v.modules.length;++u){var w=v.modules[u],x=w.position.call(this,{left:q,top:t,targetAttachment:c,targetPos:k,elementPos:d,offset:m,targetOffset:n,manualOffset:o,manualTargetOffset:p,scrollbarSize:B,attachment:this.attachment});if(x===!1)return!1;"undefined"!=typeof x&&"object"==typeof x&&(t=x.top,q=x.left)}var y={page:{top:t,left:q},viewport:{top:t-pageYOffset,bottom:pageYOffset-t-i+innerHeight,left:q-pageXOffset,right:pageXOffset-q-h+innerWidth}},z=this.target.ownerDocument,A=z.defaultView,B=void 0;return A.innerHeight>z.documentElement.clientHeight&&(B=this.cache("scrollbar-size",g),y.viewport.bottom-=B.height),A.innerWidth>z.documentElement.clientWidth&&(B=this.cache("scrollbar-size",g),y.viewport.right-=B.width),(-1===["","static"].indexOf(z.body.style.position)||-1===["","static"].indexOf(z.body.parentElement.style.position))&&(y.page.bottom=z.body.scrollHeight-t-i,y.page.right=z.body.scrollWidth-q-h),"undefined"!=typeof this.options.optimizations&&this.options.optimizations.moveElement!==!1&&"undefined"==typeof this.targetModifier&&!function(){var b=a.cache("target-offsetparent",function(){return f(a.target)}),c=a.cache("target-offsetparent-bounds",function(){return e(b)}),d=getComputedStyle(b),g=c,h={};if(["Top","Left","Bottom","Right"].forEach(function(a){h[a.toLowerCase()]=parseFloat(d["border"+a+"Width"])}),c.right=z.body.scrollWidth-c.left-g.width+h.right,c.bottom=z.body.scrollHeight-c.top-g.height+h.bottom,y.page.top>=c.top+h.top&&y.page.bottom>=c.bottom&&y.page.left>=c.left+h.left&&y.page.right>=c.right){var i=b.scrollTop,j=b.scrollLeft;y.offset={top:y.page.top-c.top+i-h.top,left:y.page.left-c.left+j-h.left}}}(),this.move(y),this.history.unshift(y),this.history.length>3&&this.history.pop(),b&&D(),!0}}},{key:"move",value:function(a){var b=this;if("undefined"!=typeof this.element.parentNode){var c={};for(var d in a){c[d]={};for(var e in a[d]){for(var g=!1,i=0;i<this.history.length;++i){var j=this.history[i];if("undefined"!=typeof j[d]&&!p(j[d][e],a[d][e])){g=!0;break}}g||(c[d][e]=!0)}}var k={top:"",left:"",right:"",bottom:""},l=function(a,c){var d="undefined"!=typeof b.options.optimizations,e=d?b.options.optimizations.gpu:null;if(e!==!1){var f=void 0,g=void 0;if(a.top?(k.top=0,f=c.top):(k.bottom=0,f=-c.bottom),a.left?(k.left=0,g=c.left):(k.right=0,g=-c.right),window.matchMedia){var h=window.matchMedia("only screen and (min-resolution: 1.3dppx)").matches||window.matchMedia("only screen and (-webkit-min-device-pixel-ratio: 1.3)").matches;h||(g=Math.round(g),f=Math.round(f))}k[I]="translateX("+g+"px) translateY("+f+"px)","msTransform"!==I&&(k[I]+=" translateZ(0)")}else a.top?k.top=c.top+"px":k.bottom=c.bottom+"px",a.left?k.left=c.left+"px":k.right=c.right+"px"},m=!1;if((c.page.top||c.page.bottom)&&(c.page.left||c.page.right)?(k.position="absolute",l(c.page,a.page)):(c.viewport.top||c.viewport.bottom)&&(c.viewport.left||c.viewport.right)?(k.position="fixed",l(c.viewport,a.viewport)):"undefined"!=typeof c.offset&&c.offset.top&&c.offset.left?!function(){k.position="absolute";var d=b.cache("target-offsetparent",function(){return f(b.target)});f(b.element)!==d&&C(function(){b.element.parentNode.removeChild(b.element),d.appendChild(b.element)}),l(c.offset,a.offset),m=!0}():(k.position="absolute",l({top:!0,left:!0},a.page)),!m)if(this.options.bodyElement)this.element.parentNode!==this.options.bodyElement&&this.options.bodyElement.appendChild(this.element);else{for(var n=!0,o=this.element.parentNode;o&&1===o.nodeType&&"BODY"!==o.tagName;){if("static"!==getComputedStyle(o).position){n=!1;break}o=o.parentNode}n||(this.element.parentNode.removeChild(this.element),this.element.ownerDocument.body.appendChild(this.element))}var q={},r=!1;for(var e in k){var s=k[e],t=this.element.style[e];t!==s&&(r=!0,q[e]=s)}r&&C(function(){h(b.element.style,q),b.trigger("repositioned")})}}}]),k}(E);S.modules=[],v.position=K;var T=h(S,v),F=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),H=v.Utils,e=H.getBounds,h=H.extend,n=H.updateClasses,C=H.defer,U=["left","top","right","bottom"];v.modules.push({position:function(a){var b=this,c=a.top,d=a.left,f=a.targetAttachment;if(!this.options.constraints)return!0;var g=this.cache("element-bounds",function(){return e(b.element)}),i=g.height,j=g.width;if(0===j&&0===i&&"undefined"!=typeof this.lastSize){var k=this.lastSize;j=k.width,i=k.height}var l=this.cache("target-bounds",function(){return b.getTargetBounds()}),m=l.height,o=l.width,p=[this.getClass("pinned"),this.getClass("out-of-bounds")];this.options.constraints.forEach(function(a){var b=a.outOfBoundsClass,c=a.pinnedClass;b&&p.push(b),c&&p.push(c)}),p.forEach(function(a){["left","top","right","bottom"].forEach(function(b){p.push(a+"-"+b)})});var q=[],r=h({},f),s=h({},this.attachment);return this.options.constraints.forEach(function(a){var e=a.to,g=a.attachment,h=a.pin;"undefined"==typeof g&&(g="");var k=void 0,l=void 0;if(g.indexOf(" ")>=0){var n=g.split(" "),p=F(n,2);l=p[0],k=p[1]}else k=l=g;var u=t(b,e);("target"===l||"both"===l)&&(c<u[1]&&"top"===r.top&&(c+=m,r.top="bottom"),c+i>u[3]&&"bottom"===r.top&&(c-=m,r.top="top")),"together"===l&&("top"===r.top&&("bottom"===s.top&&c<u[1]?(c+=m,r.top="bottom",c+=i,s.top="top"):"top"===s.top&&c+i>u[3]&&c-(i-m)>=u[1]&&(c-=i-m,r.top="bottom",s.top="bottom")),"bottom"===r.top&&("top"===s.top&&c+i>u[3]?(c-=m,r.top="top",c-=i,s.top="bottom"):"bottom"===s.top&&c<u[1]&&c+(2*i-m)<=u[3]&&(c+=i-m,r.top="top",s.top="top")),"middle"===r.top&&(c+i>u[3]&&"top"===s.top?(c-=i,s.top="bottom"):c<u[1]&&"bottom"===s.top&&(c+=i,s.top="top"))),("target"===k||"both"===k)&&(d<u[0]&&"left"===r.left&&(d+=o,r.left="right"),d+j>u[2]&&"right"===r.left&&(d-=o,r.left="left")),"together"===k&&(d<u[0]&&"left"===r.left?"right"===s.left?(d+=o,r.left="right",d+=j,s.left="left"):"left"===s.left&&(d+=o,r.left="right",d-=j,s.left="right"):d+j>u[2]&&"right"===r.left?"left"===s.left?(d-=o,r.left="left",d-=j,s.left="right"):"right"===s.left&&(d-=o,r.left="left",d+=j,s.left="left"):"center"===r.left&&(d+j>u[2]&&"left"===s.left?(d-=j,s.left="right"):d<u[0]&&"right"===s.left&&(d+=j,s.left="left"))),("element"===l||"both"===l)&&(c<u[1]&&"bottom"===s.top&&(c+=i,s.top="top"),c+i>u[3]&&"top"===s.top&&(c-=i,s.top="bottom")),("element"===k||"both"===k)&&(d<u[0]&&("right"===s.left?(d+=j,s.left="left"):"center"===s.left&&(d+=j/2,s.left="left")),d+j>u[2]&&("left"===s.left?(d-=j,s.left="right"):"center"===s.left&&(d-=j/2,s.left="right"))),"string"==typeof h?h=h.split(",").map(function(a){return a.trim()}):h===!0&&(h=["top","left","right","bottom"]),h=h||[];var v=[],w=[];c<u[1]&&(h.indexOf("top")>=0?(c=u[1],v.push("top")):w.push("top")),c+i>u[3]&&(h.indexOf("bottom")>=0?(c=u[3]-i,v.push("bottom")):w.push("bottom")),d<u[0]&&(h.indexOf("left")>=0?(d=u[0],v.push("left")):w.push("left")),d+j>u[2]&&(h.indexOf("right")>=0?(d=u[2]-j,v.push("right")):w.push("right")),v.length&&!function(){var a=void 0;a="undefined"!=typeof b.options.pinnedClass?b.options.pinnedClass:b.getClass("pinned"),q.push(a),v.forEach(function(b){q.push(a+"-"+b)})}(),w.length&&!function(){var a=void 0;a="undefined"!=typeof b.options.outOfBoundsClass?b.options.outOfBoundsClass:b.getClass("out-of-bounds"),q.push(a),w.forEach(function(b){q.push(a+"-"+b)})}(),(v.indexOf("left")>=0||v.indexOf("right")>=0)&&(s.left=r.left=!1),(v.indexOf("top")>=0||v.indexOf("bottom")>=0)&&(s.top=r.top=!1),(r.top!==f.top||r.left!==f.left||s.top!==b.attachment.top||s.left!==b.attachment.left)&&(b.updateAttachClasses(s,r),b.trigger("update",{attachment:s,targetAttachment:r}))}),C(function(){b.options.addTargetClasses!==!1&&n(b.target,q,p),n(b.element,q,p)}),{top:c,left:d}}});var H=v.Utils,e=H.getBounds,n=H.updateClasses,C=H.defer;v.modules.push({position:function(a){var b=this,c=a.top,d=a.left,f=this.cache("element-bounds",function(){return e(b.element)}),g=f.height,h=f.width,i=this.getTargetBounds(),j=c+g,k=d+h,l=[];c<=i.bottom&&j>=i.top&&["left","right"].forEach(function(a){var b=i[a];(b===d||b===k)&&l.push(a)}),d<=i.right&&k>=i.left&&["top","bottom"].forEach(function(a){var b=i[a];(b===c||b===j)&&l.push(a)});var m=[],o=[],p=["left","top","right","bottom"];return m.push(this.getClass("abutted")),p.forEach(function(a){m.push(b.getClass("abutted")+"-"+a)}),l.length&&o.push(this.getClass("abutted")),l.forEach(function(a){o.push(b.getClass("abutted")+"-"+a)}),C(function(){b.options.addTargetClasses!==!1&&n(b.target,o,m),n(b.element,o,m)}),!0}});var F=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();return v.modules.push({position:function(a){var b=a.top,c=a.left;if(this.options.shift){var d=this.options.shift;"function"==typeof this.options.shift&&(d=this.options.shift.call(this,{top:b,left:c}));var e=void 0,f=void 0;if("string"==typeof d){d=d.split(" "),d[1]=d[1]||d[0];var g=d,h=F(g,2);e=h[0],f=h[1],e=parseFloat(e,10),f=parseFloat(f,10)}else e=d.top,f=d.left;return b+=e,c+=f,{top:b,left:c}}}}),T})},{}]},{},[36]);