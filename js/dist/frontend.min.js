/*! kontentblocks 2013-10-14 */
var KB=KB||{};KB.ModulesCollection=Backbone.Collection.extend({});var KB=KB||{};KB.Templates=function(a){function b(b,d){if(!c[b]){var e,f=kontentblocks.config.url+"js/templates",g=f+"/"+b+".html";a.ajax({url:g,method:"GET",async:!1,success:function(a){e=a}}),c[b]=_.template(e)}return c[b](d)}var c={};return{render:b}}(jQuery);var KB=KB||{};KB.ModuleModel=Backbone.Model.extend({idAttribute:"instance_id"});var KB=KB||{};KB.ModuleView=Backbone.View.extend({initialize:function(){this.render()},events:{"click a.os-edit-block":"openVex",dblclick:"openVex","click .slider-controls":"openSlider"},render:function(){this.$el.append(KB.Templates.render("module-controls",{model:this.model.toJSON()}))},openVex:function(){target=this.model.get("editURL"),height=jQuery(window).height(),jQuery("#osframe").attr("src",target).attr("height",height-200),KB.openedModal=vex.open({content:jQuery("#onsite-modal").html(),contentClassName:"onsite",afterOpen:function(){jQuery(".nano").nanoScroller()}})},openSlider:function(){KB.OpenSlider&&KB.OpenSlider.destroy(),KB.OpenSlider=new KB.SliderView({tagName:"div",id:"slider-unique",className:"slider-controls-wrapper",model:this.model,parent:this})}});var KB=KB||{};KB.OSConfig=KB.OSConfig||{},KB.SliderView=Backbone.View.extend({initialize:function(){this.targetEl=this.options.parent.$el,this.render()},events:{"click a.close-controls":"destroy"},render:function(){var a=this;this.targetEl.addClass("edit-active"),this.$el.append(KB.Templates.render("slider",{model:this.model.toJSON()}));var b=jQuery(".os-controls-container",this.$el);b.css("position","absolute").draggable({handle:"h2",containment:"window",stop:function(a,b){KB.OSConfig.Position=b.position}}),KB.OSConfig.Position&&b.css({top:KB.OSConfig.Position.top,left:KB.OSConfig.Position.left}),jQuery("body").append(this.$el),this.$el.tabs();var c=a.targetEl.css("marginTop");jQuery("#KBMarginTop").ionRangeSlider({from:parseInt(c,10),postfix:"px",onChange:function(b){a.targetEl.css("marginTop",b.fromNumber)}});var d=a.targetEl.css("marginBottom");jQuery("#KBMarginBottom").ionRangeSlider({from:parseInt(d,10),postfix:"px",onChange:function(b){a.targetEl.css("marginBottom",b.fromNumber)}})},destroy:function(){this.targetEl.removeClass("edit-active"),this.remove()}});var KBApp=KBApp||{},KBApp=function(a){var b={},c=[],d=new KB.ModulesCollection(Konfig,{model:KB.ModuleModel});return _.each(d.models,function(a){c.push(new KB.ModuleView({el:"#"+a.get("instance_id"),model:a}))}),a("body").append(KB.Templates.render("fe_iframe",{})),b.Collection=d,b.Views=c,b}(jQuery);