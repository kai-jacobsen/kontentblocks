<<<<<<< HEAD
/*! kontentblocks 2013-10-21 */
var KB=KB||{};KB.ModulesCollection=Backbone.Collection.extend({});var KB=KB||{};KB.Templates=function(a){function b(b,d){if(!c[b]){var e,f=kontentblocks.config.url+"js/templates",g=f+"/"+b+".html";a.ajax({url:g,method:"GET",async:!1,success:function(a){e=a}}),c[b]=_.template(e)}return c[b](d)}var c={};return{render:b}}(jQuery);var KB=KB||{};KB.ModuleModel=Backbone.Model.extend({idAttribute:"instance_id"});var KB=KB||{};KB.ModuleView=Backbone.View.extend({initialize:function(){console.log(jQuery("[data-rel]")),this.render()},events:{"click a.os-edit-block":"openVex",dblclick:"openVex","click .slider-controls":"openSlider"},render:function(){this.$el.append(KB.Templates.render("module-controls",{model:this.model.toJSON()}))},openVex:function(){target=this.model.get("editURL"),height=jQuery(window).height(),jQuery("#osframe").attr("src",target).attr("height",height-200),KB.openedModal=vex.open({content:jQuery("#onsite-modal").html(),contentClassName:"onsite",afterOpen:function(){jQuery(".nano").nanoScroller()}})},openSlider:function(){KB.OpenSlider&&KB.OpenSlider.destroy(),KB.OpenSlider=new KB.SliderView({tagName:"div",id:"slider-unique",className:"slider-controls-wrapper",model:this.model,parent:this})}});var KB=KB||{};KB.OSConfig=KB.OSConfig||{},KB.SliderView=Backbone.View.extend({initialize:function(){this.targetEl=this.options.parent.$el,this.render()},events:{"click a.close-controls":"destroy"},render:function(){var a=this;this.targetEl.addClass("edit-active"),this.$el.append(KB.Templates.render("slider",{model:this.model.toJSON()}));var b=jQuery(".os-controls-container",this.$el);b.css("position","absolute").draggable({handle:"h2",containment:"window",stop:function(a,b){KB.OSConfig.Position=b.position}}),KB.OSConfig.Position&&b.css({top:KB.OSConfig.Position.top,left:KB.OSConfig.Position.left}),jQuery("body").append(this.$el),this.$el.tabs();var c=a.targetEl.css("marginTop");jQuery("#KBMarginTop").ionRangeSlider({from:parseInt(c,10),postfix:"px",onChange:function(b){a.targetEl.css("marginTop",b.fromNumber)}});var d=a.targetEl.css("marginBottom");jQuery("#KBMarginBottom").ionRangeSlider({from:parseInt(d,10),postfix:"px",onChange:function(b){a.targetEl.css("marginBottom",b.fromNumber)}})},destroy:function(){this.targetEl.removeClass("edit-active"),this.remove()}});var KBApp=KBApp||{},KBApp=function(a){var b={},c=[],d=new KB.ModulesCollection(Konfig,{model:KB.ModuleModel});return _.each(d.models,function(a){c.push(new KB.ModuleView({el:"#"+a.get("instance_id"),model:a}))}),a("body").append(KB.Templates.render("fe_iframe",{})),b.Collection=d,b.Views=c,b}(jQuery);
=======
/*! kontentblocks 2013-10-16 */
!function(a){"use strict";var b={},c={},d={},e={};e.VERSION="0.6.2",e.config={selector:".editable",buttonClasses:{"default":["save"],all:["bold","italic","underline","unordered-list","ordered-list","link","clear-formatting","save"],title:["bold","italic","underline","save"]}},b.Editor=Backbone.Model,c.Editor=Backbone.View.extend({initialize:function(){this.$el=a(this.el),_.bindAll(this,"changeButtons","changePosition","changeEditable","insertImage"),this.model.bind("change:buttons",this.changeButtons),this.model.bind("change:position",this.changePosition),this.model.bind("change:editable",this.changeEditable),this.changeEditable()},events:{"click .etch-bold":"toggleBold","click .etch-italic":"toggleItalic","click .etch-underline":"toggleUnderline","click .etch-heading":"toggleHeading","click .etch-unordered-list":"toggleUnorderedList","click .etch-justify-left":"justifyLeft","click .etch-justify-center":"justifyCenter","click .etch-justify-right":"justifyRight","click .etch-ordered-list":"toggleOrderedList","click .etch-link":"toggleLink","click .etch-image":"getImage","click .etch-save":"save","click .etch-clear-formatting":"clearFormatting"},changeEditable:function(){this.setButtonClass()},setButtonClass:function(){var a=this.model,b=a.get("editable").attr("data-button-class")||"default";a.set({buttons:e.config.buttonClasses[b]})},changeButtons:function(){this.$el.empty();var b=this,c=this.model.get("buttons");return c.length?(_.each(this.model.get("buttons"),function(c){var d=a('<a href="#" class="etch-editor-button etch-'+c+'" title="'+c.replace("-"," ")+'"><span></span></a>');b.$el.append(d)}),a(this.el).show("fast"),void 0):(a(this.el).hide(),void 0)},changePosition:function(){var a=this.model.get("position");this.$el.animate({top:a.y,left:a.x},{queue:!1})},wrapSelection:function(a,b){var c=a===Range?a:a.getRangeAt(0),d=document.createElement(b);c.surroundContents(d)},clearFormatting:function(a){a.preventDefault(),document.execCommand("removeFormat",!1,null)},toggleBold:function(a){a.preventDefault(),document.execCommand("bold",!1,null)},toggleItalic:function(a){a.preventDefault(),document.execCommand("italic",!1,null)},toggleUnderline:function(a){a.preventDefault(),document.execCommand("underline",!1,null)},toggleHeading:function(b){b.preventDefault();var c=window.getSelection().getRangeAt(0),d=c.commonAncestorContainer.parentElement;if(a(d).is("h3"))return a(d).replaceWith(d.textContent),void 0;var e=document.createElement("h3");c.surroundContents(e)},urlPrompt:function(a){var b=prompt("Enter a url","http://");/^((http|https)...)/.test(b)?a(b):a("http://"+b)},toggleLink:function(a){a.preventDefault();var b=window.getSelection().getRangeAt(0);"A"===b.startContainer.parentNode.tagName||"A"===b.endContainer.parentNode.tagName?document.execCommand("unlink",!1,null):this.urlPrompt(function(a){document.execCommand("createLink",!1,a)})},toggleUnorderedList:function(a){a.preventDefault(),document.execCommand("insertUnorderedList",!1,null)},toggleOrderedList:function(a){a.preventDefault(),document.execCommand("insertOrderedList",!1,null)},justifyLeft:function(a){a.preventDefault(),document.execCommand("justifyLeft",!1,null)},justifyCenter:function(a){a.preventDefault(),document.execCommand("justifyCenter",!1,null)},justifyRight:function(a){a.preventDefault(),document.execCommand("justifyRight",!1,null)},getImage:function(a){a.preventDefault(),this.startUploader(this.insertImage)},startUploader:function(d){var e=new b.ImageUploader,f=new c.ImageUploader({model:e});e._imageCallback=function(a){f.startCropper(a,d)},this._savedRange=window.getSelection().getRangeAt(0),a("body").append(f.render().el)},insertImage:function(d){var e=window.getSelection();e.removeAllRanges(),e.addRange(this._savedRange);var f={editable:this.model.get("editable"),editableModel:this.model.get("editableModel")};_.extend(f,d);var g=new b.EditableImage(f),h=new c.EditableImage({model:g});this._savedRange.insertNode(a(h.render().el).addClass("etch-float-left")[0])},save:function(a){console.log(this),a.preventDefault();var b=this.model.get("editableModel");b.trigger("save",this.model)}}),_.extend(e,{models:b,views:c,collections:d,editableInit:function(d){d.stopPropagation();var f=this,g=d.target||d.srcElement,h=a(g).etchFindEditable();h.attr("contenteditable",!0);var i=a(".etch-editor-panel"),j=i.data("model");if(i.size())h[0]!==j.get("editable")[0]&&j.set({editable:h,editableModel:this.model});else{i=a('<div class="etch-editor-panel">');var k={editable:h,editableModel:this.model};document.body.appendChild(i[0]),i.etchInstantiate({classType:"Editor",attrs:k}),j=i.data("model")}try{document.execCommand("StyleWithCSS",!1,!1)}catch(l){if("Invalid argument."!==l.message)throw l}if(b.EditableImage){var m=h.find("img");if(m.size()){var n={editable:h,editableModel:this.model};m.each(function(){var d=a(this);if(!d.data("editableImageModel")){var e=new b.EditableImage(n);new c.EditableImage({model:e,el:this,tagName:this.tagName}),d.data("editableImageModel",e)}})}}f.model&&f.model.trigger("etch:init"),a("body").bind("mousedown.editor",function(c){var d=c.target||c.srcElement;a(d).not(".etch-editor-panel, .etch-editor-panel *, .etch-image-tools, .etch-image-tools *").size()&&(f.model&&f.model.trigger("etch:remove"),i.remove(),b.EditableImage&&(h.find("img").unbind("mouseenter"),a(e.config.selector+" img").data("editableImageModel",!1)),a(this).unbind("mousedown.editor"))}),j.set({position:{x:d.pageX-15,y:d.pageY-80}})}}),a.fn.etchInstantiate=function(d,e){return this.each(function(){var f=a(this);d||(d={});var g={el:this,attrs:{}};_.extend(g,d);var h=new b[g.classType](g.attrs,g);if(_.isFunction(c[g.classType]))var i=new c[g.classType]({model:h,el:this,tagName:this.tagName});f.data({model:h}),f.data({view:i}),_.isFunction(e)&&e({model:h,view:i})})},a.fn.etchFindEditable=function(){var b=a(this);return b.is(e.config.selector)?b:b.closest(e.config.selector)},window.etch=e}(jQuery);var KB=KB||{};KB.ModulesCollection=Backbone.Collection.extend({});var KB=KB||{};KB.Templates=function(a){function b(b,d){if(!c[b]){var e,f=kontentblocks.config.url+"js/templates",g=f+"/"+b+".html";a.ajax({url:g,method:"GET",async:!1,success:function(a){e=a}}),c[b]=_.template(e)}return c[b](d)}var c={};return{render:b}}(jQuery);var KB=KB||{};KB.ModuleModel=Backbone.Model.extend({idAttribute:"instance_id",save:function(a){console.log(a.get("editable"))}});var KB=KB||{};KB.ModuleView=Backbone.View.extend({initialize:function(){console.log(this.model),this.model.bind("save",this.model.save),this.render()},save:function(){},events:{"click a.os-edit-block":"openVex","click .editable":"initEtch","click .slider-controls":"openSlider"},render:function(){this.$el.append(KB.Templates.render("module-controls",{model:this.model.toJSON()}))},initEtch:etch.editableInit,openVex:function(){target=this.model.get("editURL"),height=jQuery(window).height(),jQuery("#osframe").attr("src",target).attr("height",height-200),KB.openedModal=vex.open({content:jQuery("#onsite-modal").html(),contentClassName:"onsite",afterOpen:function(){jQuery(".nano").nanoScroller()}})},openSlider:function(){KB.OpenSlider&&KB.OpenSlider.destroy(),KB.OpenSlider=new KB.SliderView({tagName:"div",id:"slider-unique",className:"slider-controls-wrapper",model:this.model,parent:this})}});var KB=KB||{};KB.OSConfig=KB.OSConfig||{},KB.SliderView=Backbone.View.extend({initialize:function(){this.targetEl=this.options.parent.$el,this.render()},events:{"click a.close-controls":"destroy"},render:function(){var a=this;this.targetEl.addClass("edit-active"),this.$el.append(KB.Templates.render("slider",{model:this.model.toJSON()}));var b=jQuery(".os-controls-container",this.$el);b.css("position","absolute").draggable({handle:"h2",containment:"window",stop:function(a,b){KB.OSConfig.Position=b.position}}),KB.OSConfig.Position&&b.css({top:KB.OSConfig.Position.top,left:KB.OSConfig.Position.left}),jQuery("body").append(this.$el),this.$el.tabs();var c=a.targetEl.css("marginTop");jQuery("#KBMarginTop").ionRangeSlider({from:parseInt(c,10),postfix:"px",onChange:function(b){a.targetEl.css("marginTop",b.fromNumber)}});var d=a.targetEl.css("marginBottom");jQuery("#KBMarginBottom").ionRangeSlider({from:parseInt(d,10),postfix:"px",onChange:function(b){a.targetEl.css("marginBottom",b.fromNumber)}})},destroy:function(){this.targetEl.removeClass("edit-active"),this.remove()}});var KBApp=KBApp||{},KBApp=function(a){var b={},c=[],d=new KB.ModulesCollection(Konfig,{model:KB.ModuleModel});return _.each(d.models,function(a){c.push(new KB.ModuleView({el:"#"+a.get("instance_id"),model:a}))}),a("body").append(KB.Templates.render("fe_iframe",{})),b.Collection=d,b.Views=c,b}(jQuery);
>>>>>>> etch
