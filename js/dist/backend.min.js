/*! Kontentblocks ProdVersion 2015-09-09 10:09 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=window.KB||{};d.Events={},_.extend(d,Backbone.Events),_.extend(d.Events,Backbone.Events),d.currentModule={},d.currentArea={};var e=a("shared/ViewsCollection"),f=a("fields/FieldControlsCollection"),g=a("backend/Collections/AreasCollection"),h=a("common/Payload"),i=a("common/UI"),j=a("common/Config"),k=a("backend/Views/ModuleView"),l=a("backend/Models/ModuleModel"),m=a("backend/Views/AreaView"),n=a("backend/Models/AreaModel"),o=a("backend/Models/PanelModel"),p=a("backend/Views/PanelView"),q=a("backend/Views/ContextView"),r=a("backend/Models/ContextModel"),s=a("backend/Views/Ui/TabbedEditScreen");d.Views={Modules:new e,Areas:new e,Context:new e,Panels:new e,Contexts:new e},d.Modules=new Backbone.Collection([],{model:l}),d.Areas=new g([],{model:n}),d.Panels=new Backbone.Collection([],{model:o}),d.Contexts=new Backbone.Collection([],{model:r}),d.ObjectProxy=new Backbone.Collection,d.App=function(){function b(){d.Modules.on("add",e),d.Areas.on("add",g),d.Panels.on("add",l),d.Modules.on("remove",o),d.Contexts.on("add",n),c(),d.FieldControls=new f,d.FieldControls.add(_.toArray(h.getPayload("Fields"))),d.Menus=a("backend/Menus"),d.Window=a("common/Window").init(),i.init(),"default-tabs"===j.getLayoutMode()&&new s}function c(){_.each(h.getPayload("Areas"),function(a){"_internal"!==a.id&&(_.isNull(a.settings)||d.ObjectProxy.add(d.Areas.add(a)))}),_.each(h.getPayload("Modules"),function(a){d.ObjectProxy.add(d.Modules.add(a))}),_.each(h.getPayload("Panels"),function(a){d.ObjectProxy.add(d.Panels.add(a))}),_.each(h.getPayload("Contexts"),function(a){d.ObjectProxy.add(d.Contexts.add(a))})}function e(a){d.Views.Modules.add(a.get("mid"),new k({model:a,el:"#"+a.get("mid")})),i.initTabs()}function g(a){d.Views.Areas.add(a.get("id"),new m({model:a,el:"#"+a.get("id")+"-container"}))}function l(a){d.Views.Areas.add(a.get("id"),new p({model:a,el:"#"+a.get("id")+"-container"}))}function n(a){d.Views.Contexts.add(a.get("id"),new q({model:a,el:"#context_"+a.get("id")}))}function o(a){d.Views.Modules.remove(a.get("mid"))}return{init:b}}(jQuery),d.App.init(),jQuery(document).ready(function(){d.appData&&!d.appData.config.frontend&&d.Views.Modules.ready()})},{"backend/Collections/AreasCollection":2,"backend/Menus":3,"backend/Models/AreaModel":4,"backend/Models/ContextModel":5,"backend/Models/ModuleModel":6,"backend/Models/PanelModel":7,"backend/Views/AreaView":12,"backend/Views/ContextView":21,"backend/Views/ModuleView":36,"backend/Views/PanelView":37,"backend/Views/Ui/TabbedEditScreen":38,"common/Config":41,"common/Payload":45,"common/UI":48,"common/Window":50,"fields/FieldControlsCollection":52,"shared/ViewsCollection":61}],2:[function(a,b,c){b.exports=Backbone.Collection.extend({_bycontext:{},_globalAreas:{},initialize:function(){this.listenTo(this,"add",this.categorize)},categorize:function(a){var b=a.get("context");this._bycontext[b]||(this._bycontext[b]={}),this._bycontext[b][a.get("id")]=a,a.get("dynamic")&&(this._globalAreas[a.get("id")]=a)},getByContext:function(a){return this._bycontext[a]?this._bycontext[a]:{}},getGlobalAreas:function(){return this._globalAreas}})},{}],3:[function(a,b,c){var d=a("common/Ajax"),e=a("common/Config");b.exports={loadingContainer:null,initiatorEl:null,sendButton:null,createSanitizedId:function(a,b){this.initiatorEl=jQuery(a),this.loadingContainer=this.initiatorEl.closest(".kb-menu-field").addClass("loading"),this.$sendButton=jQuery("#kb-submit"),this.disableSendButton(),d.send({inputvalue:a.value,checkmode:b,action:"getSanitizedId",_ajax_nonce:e.getNonce("read")},this.insertId,this)},insertId:function(a){a.success?(jQuery(".kb-js-area-id").val(a.data.id),this.enableSendButton()):(this.initiatorEl.addClass(),jQuery(".kb-js-area-id").val("Please chose a different name")),this.loadingContainer.removeClass("loading")},disableSendButton:function(){this.$sendButton.attr("disabled","disabled").val("Disabled")},enableSendButton:function(){this.$sendButton.attr("disabled",!1).val("Create")},reloadContext:function(a){var b=a.value;window.location.href=window.location+"&area-context="+b}}},{"common/Ajax":39,"common/Config":41}],4:[function(a,b,c){b.exports=Backbone.Model.extend({idAttribute:"id"})},{}],5:[function(a,b,c){b.exports=Backbone.Model.extend({idAttribute:"id"})},{}],6:[function(a,b,c){b.exports=Backbone.Model.extend({idAttribute:"mid",attachedFields:{},initialize:function(){this.type="module",this.listenTo(this,"change:area",this.areaChanged),this.subscribeToArea()},destroy:function(){this.unsubscribeFromArea(),this.stopListening()},attachField:function(a){this.attachedFields[a.id]=a,this.listenTo(a,"remove",this.removeAttachedField)},removeAttachedField:function(a){this.attachedFields[a.id]&&delete this.attachedFields[a.id]},setArea:function(a){this.setEnvVar("area",a.get("id")),this.setEnvVar("areaContext",a.get("context")),this.set("areaContext",a.get("context")),this.set("area",a.get("id")),this.Area=a,this.subscribeToArea(a)},areaChanged:function(){this.View.updateModuleForm()},subscribeToArea:function(a){a||(a=KB.Areas.get(this.get("area"))),a&&(a.View.attachModuleView(this),this.Area=a)},unsubscribeFromArea:function(){this.Area.View.removeModule(this)},setEnvVar:function(a,b){var c=_.clone(this.get("envVars"));c[a]=b,this.set("envVars",c)}})},{}],7:[function(a,b,c){b.exports=Backbone.Model.extend({idAttribute:"baseId",attachedFields:{},attachField:function(a){this.attachedFields[a.id]=a,this.listenTo(a,"remove",this.removeAttachedField)},removeAttachedField:function(a){this.attachedFields[a.id]&&delete this.attachedFields[a.id]}})},{}],8:[function(a,b,c){var d=a("backend/Views/ModuleControls/ControlsView"),e=a("templates/backend/area-controls-menu.hbs");b.exports=d.extend({initialize:function(){this.$menuWrap=jQuery(".kb-area-actions",this.$el),this.$menuWrap.append(e({})),this.$menuList=jQuery(".kb-area-actions-list",this.$menuWrap)}})},{"backend/Views/ModuleControls/ControlsView":23,"templates/backend/area-controls-menu.hbs":63}],9:[function(a,b,c){var d=a("backend/Views/BaseControlView"),e=(a("common/Checks"),a("common/Config")),f=a("common/Notice"),g=a("common/Ajax");b.exports=d.extend({initialize:function(a){this.options=a||{},this.parent=a.parent},attributes:{"data-tipsy":"Detach area from this post"},className:"dashicons dashicons-no-alt",events:{click:"detach"},detach:function(){var a=_.clone(this.model.get("settings"));a.attached=!a.attached,g.send({action:"syncAreaSettings",_ajax_nonce:e.getNonce("update"),areaId:this.model.get("id"),settings:a},this.success,this)},isValid:function(){return KB.Environment&&"kb-dyar"===KB.Environment.postType?!1:this.model.get("dynamic")},success:function(a){a.success?(this.model.set("settings",a.data),f.notice("Area status updated","success"),jQuery(".tipsy").remove(),this.parent.$el.remove()):f.notice(a.message,"error")}})},{"backend/Views/BaseControlView":13,"common/Ajax":39,"common/Checks":40,"common/Config":41,"common/Notice":44}],10:[function(a,b,c){var d=a("backend/Views/BaseControlView");a("common/Checks"),a("common/Config"),a("common/Notice"),a("common/Ajax");b.exports=d.extend({initialize:function(a){this.options=a||{},this.parent=a.parent},attributes:{"data-tipsy":"Move area inside context"},className:"genericon genericon-draggable kb-area-move-handle",isValid:function(){return KB.Environment&&"kb-dyar"===KB.Environment.postType?!1:!0}})},{"backend/Views/BaseControlView":13,"common/Ajax":39,"common/Checks":40,"common/Config":41,"common/Notice":44}],11:[function(a,b,c){var d=a("backend/Views/BaseControlView"),e=(a("common/Checks"),a("common/Config")),f=a("common/Notice"),g=a("common/Ajax");b.exports=d.extend({initialize:function(a){this.options=a||{},this.parent=a.parent},attributes:{"data-tipsy":"Switch area visibility on/off"},className:"dashicons dashicons-visibility kb-area-status-action",events:{click:"changeStatus"},render:function(){var a=this.model.get("settings");this.parent.$el.removeClass("kb-area-status-inactive"),a.active||this.parent.$el.addClass("kb-area-status-inactive")},changeStatus:function(){var a=this.model.get("settings");a.active=!a.active,g.send({action:"syncAreaSettings",_ajax_nonce:e.getNonce("update"),areaId:this.model.get("id"),settings:a},this.success,this)},isValid:function(){return KB.Environment&&"kb-dyar"===KB.Environment.postType?!1:!0},success:function(a){a.success?(this.model.set("settings",a.data),this.render(),f.notice("Area status updated","success")):f.notice(a.message,"error")}})},{"backend/Views/BaseControlView":13,"common/Ajax":39,"common/Checks":40,"common/Config":41,"common/Notice":44}],12:[function(a,b,c){var d=a("templates/backend/area-item-placeholder.hbs"),e=a("templates/backend/area-add-module.hbs"),f=a("shared/ModuleBrowser/ModuleBrowserController"),g=a("backend/Views/AreaControls/AreaControlsView"),h=a("backend/Views/AreaControls/controls/StatusControl"),i=a("backend/Views/AreaControls/controls/DetachControl"),j=a("backend/Views/AreaControls/controls/MoveControl");b.exports=Backbone.View.extend({initialize:function(){this.attachedModuleViews={},this.controlsContainer=jQuery(".add-modules",this.$el),this.settingsContainer=jQuery(".kb-area-settings-wrapper",this.$el),this.modulesList=jQuery("#"+this.model.get("id"),this.$el),this.$placeholder=jQuery(d({i18n:KB.i18n})),this.model.View=this,this.listenTo(this,"module:attached",this.ui),this.listenTo(this,"module:detached",this.ui),this.AreaControls=new g({el:this.$el,parent:this}),this.setupDefaultMenuItems(),this.render()},events:{"click .modules-link":"openModuleBrowser","click .js-area-settings-opener":"toggleSettings",mouseenter:"setActive"},render:function(){this.addControls(),this.ui()},resetElement:function(){this.setElement("#"+this.model.get("id")+"-container"),this.initialize()},addControls:function(){this.controlsContainer.append(e({i18n:KB.i18n}))},openModuleBrowser:function(a){a.preventDefault(),this.ModuleBrowser||(this.ModuleBrowser=new f({area:this})),this.ModuleBrowser.render()},toggleSettings:function(a){a.preventDefault(),this.settingsContainer.slideToggle().toggleClass("open"),KB.currentArea=this.model},setActive:function(){KB.currentArea=this.model},attachModuleView:function(a){this.attachedModuleViews[a.cid]=a.View,this.listenTo(a,"change:area",this.removeModule),this.trigger("module:attached",a)},removeModule:function(a){var b;b=a.cid,this.attachedModuleViews[b]&&(delete this.attachedModuleViews[b],this.stopListening(a,"change:area",this.removeModule)),this.trigger("module:detached",a)},ui:function(){var a;a=_.size(this.attachedModuleViews),0===a?this.renderPlaceholder():this.$placeholder.remove()},renderPlaceholder:function(){this.modulesList.before(this.$placeholder)},setupDefaultMenuItems:function(){this.AreaControls.addItem(new h({model:this.model,parent:this})),this.AreaControls.addItem(new i({model:this.model,parent:this})),this.AreaControls.addItem(new j({model:this.model,parent:this}))}})},{"backend/Views/AreaControls/AreaControlsView":8,"backend/Views/AreaControls/controls/DetachControl":9,"backend/Views/AreaControls/controls/MoveControl":10,"backend/Views/AreaControls/controls/StatusControl":11,"shared/ModuleBrowser/ModuleBrowserController":54,"templates/backend/area-add-module.hbs":62,"templates/backend/area-item-placeholder.hbs":64}],13:[function(a,b,c){b.exports=Backbone.View.extend({tagName:"div",className:"",isValid:function(){return!0}})},{}],14:[function(a,b,c){var d=a("backend/Views/ContextBrowserAreaView"),e=a("templates/backend/context-browser.hbs");b.exports=Backbone.View.extend({tagName:"div",className:"kb-global-areas-browser-wrap base-box-border base-box-shadow",initialize:function(a){this.isOpen=!1,this.Controller=a.Controller,this.subViews=this.setupViews(),this.setupElements(),this.render(),this.open()},events:{"click .close-browser":"close"},render:function(){var a=this;this.$list.empty(),_.each(this.subViews,function(b){var c=b.render();c&&a.$list.append(c)})},setupElements:function(){this.$backdrop=jQuery("<div class='kb-global-areas-backdrop'></div>"),this.$el.append(e()),this.$list=this.$(".kb-global-areas-list")},open:function(){this.$backdrop.appendTo("body"),jQuery("#wpwrap").addClass("module-browser-open"),this.$el.appendTo("body")},close:function(){this.$backdrop.detach(),jQuery("#wpwrap").removeClass("module-browser-open"),this.$el.detach()},setupViews:function(){var a=this,b=this.Controller.GlobalAreas;return _.map(b,function(b){return new d({model:b,Browser:a})})}})},{"backend/Views/ContextBrowserAreaView":15,"templates/backend/context-browser.hbs":68}],15:[function(a,b,c){var d=a("templates/backend/cb-global-area-item.hbs"),e=a("common/Ajax"),f=a("common/Config"),g=a("common/Notice");b.exports=Backbone.View.extend({tagName:"li",initialize:function(a){this.Browser=a.Browser},events:{click:"add"},render:function(){return this.model.get("settings").attached?!1:this.$el.append(d(this.model.toJSON()))},add:function(){var a=_.clone(this.model.get("settings"));a.attached=!0,e.send({action:"getGlobalAreaHTML",_ajax_nonce:f.getNonce("update"),areaId:this.model.get("id"),settings:a},this.success,this)},success:function(a){a.success?(this.model.set("settings",a.data.settings),this.Browser.Controller.$inner.append(a.data.html),this.Browser.close(),this.model.View.resetElement(),g.notice("Area attached","success")):g.notice(a.message,"error")}})},{"common/Ajax":39,"common/Config":41,"common/Notice":44,"templates/backend/cb-global-area-item.hbs":66}],16:[function(a,b,c){b.exports=Backbone.View.extend({initialize:function(a){this.Controller=a.Controller,this.ContextsViews=this.setupContextsViews(),this.isVisible=!0,this.listenTo(this.Controller,"columns.rendered",this.columnActivated),this.listenTo(this.Controller,"columns.reset",this.reset)},setupContextsViews:function(){var a={},b=this,c=this.$(".kb-context-container");return _.each(c,function(c,d){var e=c.dataset.kbcontext,f=KB.Contexts.get(e);a[f.View.cid]=f.View,f.View.isVisible=!0,f.View.ColumnView=b,b.listenTo(f.View,"context.activated",b.activateColumn)}),a},activateColumn:function(){this.trigger("column.activate",this)},columnActivated:function(a){a.cid!==this.cid?_.each(this.ContextsViews,function(a){a.renderProxy()}):_.each(this.ContextsViews,function(a){a.removeProxy()})},reset:function(){_.each(this.ContextsViews,function(a){a.removeProxy()})}})},{}],17:[function(a,b,c){var d=a("templates/backend/context-bar.hbs"),e=a("backend/Views/ContextUi/ContextUiView"),f=a("backend/Views/ContextUi/ContextColumnView"),g=a("backend/Views/ContextUi/controls/ResetControl"),h=a("backend/Views/ContextUi/controls/ColumnControl");b.exports=Backbone.View.extend({initialize:function(){var a=this;this.columns=this.setupColumns(),this.layoutBackup=this.createLayoutBackup(),this.cols=_.toArray(this.columns).length,this.render(),jQuery(window).resize(function(){a.resetLayout()})},setupColumns:function(){var a=this,b=this.$(".kb-context-col");return _.map(b,function(b){var c=new f({el:b,Controller:a});return a.listenTo(c,"column.activate",a.evalLayout),c})},render:function(){var a=jQuery(d({}));this.$el.before(a),this.BarView=new e({el:a}),this.setupMenuItems()},setupMenuItems:function(){var a=this;this.BarView.addItem(new g({model:this.model,parent:this})),_.each(this.columns,function(b){a.BarView.addItem(new h({model:a.model,parent:a,ColumnView:b}))})},createLayoutBackup:function(){var a={};return _.each(this.columns,function(b,c){a[c]=b.$el.attr("class")}),a},resetLayout:function(){var a=this;_.each(this.columns,function(b){b.isVisible||b.Control["switch"](),b.$el.attr("class",a.layoutBackup[b.cid]),b.$el.width("")}),this.trigger("columns.reset")},evalLayout:function(a){var b=this.$el.width()-20*this.cols,c=this.findProportion(this.cols);return 1100>b?!1:(_.each(this.columns,function(d){d.cid===a.cid?d.$el.width(Math.floor(b*c.large)):d.$el.width(Math.floor(b*c.small))}),void this.trigger("columns.rendered",a))},renderLayout:function(){var a=_.filter(this.columns,function(a){return a.isVisible}),b=a.length,c=this.$el.width()-20*b;_.each(a,function(a){a.$el.width(Math.floor(c*(100/b/100)))})},findProportion:function(a){switch(a){case 3:return{small:.1,large:.8};case 2:return{small:.3333,large:.6666};default:return{small:1,large:1}}}})},{"backend/Views/ContextUi/ContextColumnView":16,"backend/Views/ContextUi/ContextUiView":18,"backend/Views/ContextUi/controls/ColumnControl":19,"backend/Views/ContextUi/controls/ResetControl":20,"templates/backend/context-bar.hbs":67}],18:[function(a,b,c){var d=a("backend/Views/ModuleControls/ControlsView");b.exports=d.extend({initialize:function(){this.$menuList=jQuery(".kb-context-bar--actions",this.$el)}})},{"backend/Views/ModuleControls/ControlsView":23}],19:[function(a,b,c){var d=a("backend/Views/BaseControlView");b.exports=d.extend({initialize:function(a){this.options=a||{},this.Controller=a.parent,this.ColumnView=a.ColumnView,this.ColumnView.Control=this},className:"context-visibility",events:{click:"switch"},render:function(){this.$el.append('<span class="kb-button-small">'+this.ColumnView.$el.data("kbcolname")+"</span>")},isValid:function(){return!0},"switch":function(){this.$el.toggleClass("kb-context-hidden"),this.ColumnView.$el.toggle(),this.ColumnView.isVisible=!this.ColumnView.isVisible,this.Controller.renderLayout()}})},{"backend/Views/BaseControlView":13}],20:[function(a,b,c){var d=a("backend/Views/BaseControlView");b.exports=d.extend({initialize:function(a){this.options=a||{},this.Controller=a.parent},className:"context-reset-layout",events:{click:"resetLayout"},render:function(){this.$el.append('<span class="kb-button-small">Reset</span>')},isValid:function(){return!0},resetLayout:function(){this.Controller.resetLayout()}})},{"backend/Views/BaseControlView":13}],21:[function(a,b,c){var d=a("templates/backend/context-header.hbs"),e=a("backend/Views/ContextBrowser");b.exports=Backbone.View.extend({initialize:function(){this.active=!1,this.model.View=this,this.Areas=this.setupAreas(),this.GlobalAreas=this.filterGlobalAreas(),this.AttachedGlobalAreas=this.filterAttachedGlobalAreas(),this.setupElements(),this.bindHandlers(),this.render(),this.listenTo(KB.Events,"context.activate",this.activate)},events:{"click .kb-js-add-global-area":"openBrowser","click .kb-context__header":function(){KB.Events.trigger("context.activate",this)},"click .kb-context-inner--overlay":function(){KB.Events.trigger("context.activate",this)}},setupElements:function(){this.$header=this.$(".kb-context__header"),this.$header.append(d({})),this.$button=jQuery(".kb-button-small",this.$header),this.$inner=this.$(".kb-context__inner"),this.$overlay=jQuery('<div class="kb-context-inner--overlay"><span>'+this.model.get("title")+"</span><br>click to show</div>")},render:function(){_.isEmpty(this.GlobalAreas)?this.$button.hide():this.$button.show()},activate:function(a){a.cid!==this.cid||this.active?this.active&&a.cid!==this.cid&&(this.active=!1,this.$el.removeClass("kb-context-focus"),this.trigger("context.deactivated",this)):(this.active=!0,this.trigger("context.activated",this),this.$el.addClass("kb-context-focus"))},setupAreas:function(){return KB.Areas.getByContext(this.model.get("id"))},filterGlobalAreas:function(){var a={};return _.each(this.Areas,function(b){b.get("dynamic")&&!b.get("settings").attached&&(a[b.get("id")]=b)}),a},filterAttachedGlobalAreas:function(){var a={};return _.each(this.Areas,function(b){b.get("settings").attached&&b.get("dynamic")&&(a[b.get("id")]=b)}),a},bindHandlers:function(){var a=this;_.each(this.Areas,function(b){a.listenTo(b,"change:settings",a.observeAttachedAreas)})},observeAttachedAreas:function(a){this.GlobalAreas=this.filterGlobalAreas(),this.render()},openBrowser:function(){this.Browser||(this.Browser=new e({Controller:this})),this.Browser.open()},renderProxy:function(){this.$el.addClass("kb-context-downsized"),this.$inner.append(this.$overlay)},removeProxy:function(){this.$el.removeClass("kb-context-downsized"),this.$overlay.detach()}})},{"backend/Views/ContextBrowser":14,"templates/backend/context-header.hbs":69}],22:[function(a,b,c){var d=a("templates/backend/fullscreen-inner.hbs"),e=a("common/TinyMCE");b.exports=Backbone.View.extend({className:"kb-fullscreen--holder",initialize:function(){return this.$parent=this.model.View.$el,this.$body=jQuery(".kb-module__body",this.$parent),this},events:{"click .kb-fullscreen-js-close":"close"},open:function(){var a=this;e.removeEditors(),this.$backdrop=jQuery('<div class="kb-fullscreen-backdrop"></div>').appendTo("body"),this.$fswrap=jQuery(d()).appendTo(this.$el),this.$el.width(.8*jQuery(window).width()),jQuery("#wpwrap").addClass("module-browser-open"),this.$body.detach().appendTo(this.$fswrap.find(".kb-fullscreen--inner")).show().addClass("kb-module--fullscreen"),jQuery(window).resize(function(){a.$fswrap.width(.8*jQuery(window).width())}),this.$el.appendTo("body"),e.restoreEditors()},close:function(){e.removeEditors(),jQuery("#wpwrap").removeClass("module-browser-open"),this.$body.detach().appendTo(this.$parent),this.$backdrop.remove(),this.$fswrap.remove(),this.$el.detach(),setTimeout(function(){e.restoreEditors()},250)}})},{"common/TinyMCE":47,"templates/backend/fullscreen-inner.hbs":70}],23:[function(a,b,c){var d=a("templates/backend/module-menu.hbs");b.exports=Backbone.View.extend({$menuWrap:{},$menuList:{},initialize:function(){this.$menuWrap=jQuery(".menu-wrap",this.$el),this.$menuWrap.append(d({})),this.$menuList=jQuery(".module-actions",this.$menuWrap)},addItem:function(a){if(a.isValid&&a.isValid()===!0){var b=jQuery("<li></li>").appendTo(this.$menuList),c=b.append(a.el);this.$menuList.append(c),a.render.call(a)}}})},{"templates/backend/module-menu.hbs":71}],24:[function(a,b,c){var d=a("backend/Views/BaseControlView"),e=a("common/Checks"),f=a("common/Notice"),g=a("common/Ajax"),h=a("common/Config"),i=a("common/TinyMCE"),j=a("common/Window"),k=a("shared/BatchDelete/BatchDeleteController"),l=a("common/I18n");b.exports=d.extend({marked:!1,className:"kb-delete block-menu-icon",attributes:{"data-kbtooltip":l.getString("Modules.controls.be.tooltips.delete")},initialize:function(){_.bindAll(this,"yes","no")},events:{click:"deleteModule"},deleteModule:function(){j.ctrlPressed()?this.marked?(k.remove(this),this.unmark()):(k.add(this),this.mark()):f.confirm("",KB.i18n.EditScreen.notices.confirmDeleteMsg,this.yes,this.no,this)},mark:function(){this.$el.addClass("kb-batch-marked"),this.marked=!0},unmark:function(){this.$el.removeClass("kb-batch-marked"),this.marked=!1},isValid:function(){return!(this.model.get("predefined")||this.model.get("disabled")||!e.userCan("delete_kontentblocks"))},yes:function(){g.send({action:"removeModules",_ajax_nonce:h.getNonce("delete"),module:this.model.get("mid")},this.success,this)},no:function(){return!1},success:function(a){a.success?(i.removeEditors(this.model.View.$el),KB.Modules.remove(this.model),wp.heartbeat.interval("fast",2),this.model.destroy()):f.notice("Error while removing a module","error")}})},{"backend/Views/BaseControlView":13,"common/Ajax":39,"common/Checks":40,"common/Config":41,"common/I18n":42,"common/Notice":44,"common/TinyMCE":47,"common/Window":50,"shared/BatchDelete/BatchDeleteController":53}],25:[function(a,b,c){var d=a("backend/Views/BaseControlView"),e=a("common/Checks"),f=a("common/Notice"),g=a("common/Ajax"),h=a("common/Config"),i=a("common/UI"),j=a("common/Payload"),k=a("common/I18n");b.exports=d.extend({className:"kb-duplicate block-menu-icon",events:{click:"duplicateModule"},attributes:{"data-kbtooltip":k.getString("Modules.controls.be.tooltips.duplicate")},duplicateModule:function(){g.send({action:"duplicateModule",module:this.model.get("mid"),areaContext:this.model.Area.get("context"),_ajax_nonce:h.getNonce("create"),"class":this.model.get("class")},this.success,this)},isValid:function(){return this.model.get("predefined")||this.model.get("disabled")||!e.userCan("edit_kontentblocks")?!1:!0},success:function(a){if(!a.success)return f.notice("Request Error","error"),!1;this.parseAdditionalJSON(a.data.json),this.model.Area.View.modulesList.append(a.data.html);var b=KB.Modules.add(a.data.module);this.model.Area.View.attachModuleView(b),f.notice("Module Duplicated","success"),i.repaint("#"+a.data.module.mid),KB.Fields.trigger("update")},parseAdditionalJSON:function(a){KB.payload.Fields||(KB.payload.Fields={}),_.extend(KB.payload.Fields,a.Fields),KB.payload.fieldData||(KB.payload.fieldData={}),_.extend(KB.payload.fieldData,a.fieldData),j.parseAdditionalJSON(a)}})},{"backend/Views/BaseControlView":13,"common/Ajax":39,"common/Checks":40,"common/Config":41,"common/I18n":42,"common/Notice":44,"common/Payload":45,"common/UI":48}],26:[function(a,b,c){var d=a("backend/Views/BaseControlView"),e=a("common/Checks"),f=a("common/Notice"),g=a("common/Ajax"),h=a("common/Config"),i=(a("common/UI"),a("common/Payload"),a("common/I18n"));b.exports=d.extend({initialize:function(a){this.options=a||{},this.parentView=a.parent,this.listenTo(this.parentView,"kb::module.input.changed",this.getDirty),this.listenTo(this.parentView,"kb::module.data.updated",this.getClean)},attributes:{"data-kbtooltip":i.getString("Modules.controls.be.tooltips.save")},className:"kb-save block-menu-icon",events:{click:"saveData"},saveData:function(){tinyMCE.triggerSave(),g.send({action:"updateModuleData",module:this.model.toJSON(),data:this.parentView.serialize(),_ajax_nonce:h.getNonce("update")},this.success,this)},getDirty:function(){this.$el.addClass("is-dirty")},getClean:function(){this.$el.removeClass("is-dirty")},isValid:function(){return this.model.get("master")?!1:!this.model.get("disabled")&&e.userCan("edit_kontentblocks")},success:function(a){a&&a.data.newModuleData||_K.error("Failed to save module data."),this.parentView.model.set("moduleData",a.data.newModuleData),f.notice("Data saved","success")}})},{"backend/Views/BaseControlView":13,"common/Ajax":39,"common/Checks":40,"common/Config":41,"common/I18n":42,"common/Notice":44,"common/Payload":45,"common/UI":48}],27:[function(a,b,c){var d=a("backend/Views/BaseControlView"),e=a("common/Checks"),f=a("common/Config"),g=a("common/Notice"),h=a("common/Ajax"),i=a("common/I18n");b.exports=d.extend({initialize:function(a){this.options=a||{}},className:"module-status block-menu-icon",events:{click:"changeStatus"},attributes:function(){return this.model.get("state").active?{"data-kbtooltip":i.getString("Modules.controls.be.tooltips.status.off")}:{"data-kbtooltip":i.getString("Modules.controls.be.tooltips.status.on")}},changeStatus:function(){h.send({action:"changeModuleStatus",module:this.model.get("mid"),_ajax_nonce:f.getNonce("update")},this.success,this)},isValid:function(){return!this.model.get("disabled")&&e.userCan("deactivate_kontentblocks")?!0:!1},success:function(){var a=this.model.get("state");a.active=!a.active,this.model.set("state",a),a.active?this.$el.attr("data-kbtooltip",i.getString("Modules.controls.be.tooltips.status.off")):this.$el.attr("data-kbtooltip",i.getString("Modules.controls.be.tooltips.status.on")),this.options.parent.$head.toggleClass("module-inactive"),this.options.parent.$el.toggleClass("activated deactivated"),g.notice("Status changed","success")}})},{"backend/Views/BaseControlView":13,"common/Ajax":39,"common/Checks":40,"common/Config":41,"common/I18n":42,"common/Notice":44}],28:[function(a,b,c){var d=a("backend/Views/ModuleControls/ControlsView"),e=a("templates/backend/status-bar.hbs");b.exports=d.extend({tagName:"ul",className:"kb-module--status-bar-list",initialize:function(a){this.$menuWrap=jQuery(".kb-module--status-bar",this.$el),this.$menuWrap.append(e({})),this.$menuList=jQuery(".kb-module--status-bar-list",this.$menuWrap)}})},{"backend/Views/ModuleControls/ControlsView":23,"templates/backend/status-bar.hbs":78}],29:[function(a,b,c){var d=a("backend/Views/BaseControlView"),e=a("templates/backend/status/draft.hbs");b.exports=d.extend({className:"kb-status-draft",events:{click:"deleteModule"},isValid:function(){return!0},render:function(){this.$el.append(e({draft:this.model.get("state").draft,i18n:KB.i18n.Modules.notices}))}})},{"backend/Views/BaseControlView":13,"templates/backend/status/draft.hbs":79}],30:[function(a,b,c){var d=a("backend/Views/BaseControlView");b.exports=d.extend({className:"kb-status-draft",events:{click:"deleteModule"},isValid:function(){return!0},render:function(){this.$el.append('<span class="kb-module--status-label">Module Name</span>'+this.model.get("settings").publicName)}})},{"backend/Views/BaseControlView":13}],31:[function(a,b,c){var d=a("backend/Views/ModuleControls/ControlsView"),e=a("templates/backend/ui-menu.hbs");b.exports=d.extend({initialize:function(){this.$menuWrap=jQuery(".ui-wrap",this.$el),this.$menuWrap.append(e({})),this.$menuList=jQuery(".ui-actions",this.$menuWrap)}})},{"backend/Views/ModuleControls/ControlsView":23,"templates/backend/ui-menu.hbs":80}],32:[function(a,b,c){var d=a("backend/Views/BaseControlView");b.exports=d.extend({initialize:function(a){this.options=a||{}},className:"ui-disabled kb-disabled block-menu-icon dashicons dashicons-dismiss",isValid:function(){return this.model.get("settings").disabled?!0:!1}})},{"backend/Views/BaseControlView":13}],33:[function(a,b,c){var d=a("backend/Views/BaseControlView"),e=a("backend/Views/FullscreenView"),f=a("common/Checks");b.exports=d.extend({initialize:function(a){this.options=a||{},this.$parent=this.model.View.$el,this.$body=jQuery(".kb-module__body",this.$parent)},attributes:{"data-kbtooltip":"turn fullscreen mode on"},events:{click:"openFullscreen"},className:"ui-fullscreen kb-fullscreen block-menu-icon",isValid:function(){return!this.model.get("settings").disabled&&f.userCan("edit_kontentblocks")?!0:!1},openFullscreen:function(){this.FullscreenView||(this.FullscreenView=new e({model:this.model}).open())}})},{"backend/Views/BaseControlView":13,"backend/Views/FullscreenView":22,"common/Checks":40}],34:[function(a,b,c){var d=a("backend/Views/BaseControlView"),e=a("common/Checks");b.exports=d.extend({initialize:function(a){this.options=a||{}},attributes:{"data-kbtooltip":"move to sort"},className:"ui-move kb-move block-menu-icon",isValid:function(){return!this.model.get("settings").disabled&&e.userCan("edit_kontentblocks")?!0:!1}})},{"backend/Views/BaseControlView":13,"common/Checks":40}],35:[function(a,b,c){var d=a("backend/Views/BaseControlView"),e=a("common/Checks");b.exports=d.extend({initialize:function(a){this.options=a||{},this.parent=a.parent,store.get(this.parent.model.get("mid")+"_open")&&(this.toggleBody(),this.parent.model.set("open",!0))},events:{click:"toggleBody"},className:"ui-toggle kb-toggle block-menu-icon",isValid:function(){return!this.model.get("settings").disabled&&e.userCan("edit_kontentblocks")?!0:!1},toggleBody:function(a){var b=a||400;e.userCan("edit_kontentblocks")&&(this.parent.$body.slideToggle(b),this.parent.$el.toggleClass("kb-open"),KB.currentModule=this.model,this.setOpenStatus())},setOpenStatus:function(){this.parent.model.set("open",!this.model.get("open")),store.set(this.parent.model.get("mid")+"_open",this.parent.model.get("open"))}})},{"backend/Views/BaseControlView":13,"common/Checks":40}],36:[function(a,b,c){var d=a("backend/Views/ModuleControls/ControlsView"),e=a("backend/Views/ModuleUi/ModuleUiView"),f=a("backend/Views/ModuleStatusBar/ModuleStatusBarView"),g=a("backend/Views/ModuleControls/controls/DeleteControl"),h=a("backend/Views/ModuleControls/controls/DuplicateControl"),i=a("backend/Views/ModuleControls/controls/SaveControl"),j=a("backend/Views/ModuleControls/controls/StatusControl"),k=a("backend/Views/ModuleUi/controls/MoveControl"),l=a("backend/Views/ModuleUi/controls/ToggleControl"),m=a("backend/Views/ModuleUi/controls/FullscreenControl"),n=a("backend/Views/ModuleUi/controls/DisabledControl"),o=a("backend/Views/ModuleStatusBar/status/DraftStatus"),p=a("backend/Views/ModuleStatusBar/status/OriginalNameStatus"),q=(a("common/Checks"),
a("common/Ajax")),r=a("common/UI"),s=a("common/Config"),t=a("common/Payload");b.exports=Backbone.View.extend({$head:{},$body:{},ModuleMenu:{},instanceId:"",events:{mouseenter:"setFocusedModule","change .kb-template-select":"viewfileChange","change input,textarea,select":"handleChange","tinymce.change":"handleChange"},setFocusedModule:function(){KB.focusedModule=this.model},handleChange:function(){this.trigger("kb::module.input.changed",this)},viewfileChange:function(a){this.model.set("viewfile",a.currentTarget.value),this.clearFields(),this.updateModuleForm(),this.trigger("KB::backend.module.viewfile.changed")},initialize:function(){this.$head=jQuery(".kb-module__header",this.$el),this.$body=jQuery(".kb-module__body",this.$el),this.$inner=jQuery(".kb-module__controls-inner",this.$el),this.attachedFields={},this.instanceId=this.model.get("mid"),this.ModuleMenu=new d({el:this.$el,parent:this}),this.ModuleUi=new e({el:this.$el,parent:this}),this.ModuleStatusBar=new f({el:this.$el,parent:this}),this.model.View=this,this.setupDefaultMenuItems(),this.setupDefaultUiItems(),this.setupDefaultStatusItems(),KB.Views.Modules.on("kb.modules.view.deleted",function(a){a.$el.fadeOut(500,function(){a.$el.remove()})})},setupDefaultMenuItems:function(){this.ModuleMenu.addItem(new i({model:this.model,parent:this})),this.ModuleMenu.addItem(new h({model:this.model,parent:this})),this.ModuleMenu.addItem(new g({model:this.model,parent:this})),this.ModuleMenu.addItem(new j({model:this.model,parent:this}))},setupDefaultUiItems:function(){this.ModuleUi.addItem(new k({model:this.model,parent:this})),this.ModuleUi.addItem(new l({model:this.model,parent:this})),this.ModuleUi.addItem(new m({model:this.model,parent:this})),this.ModuleUi.addItem(new n({model:this.model,parent:this}))},setupDefaultStatusItems:function(){this.ModuleStatusBar.addItem(new o({model:this.model,parent:this})),this.ModuleStatusBar.addItem(new p({model:this.model,parent:this}))},updateModuleForm:function(){q.send({action:"afterAreaChange",module:this.model.toJSON(),_ajax_nonce:s.getNonce("read")},this.insertNewUpdateForm,this)},insertNewUpdateForm:function(a){a.success?this.$inner.html(a.data.html):this.$inner.html("empty"),a.data.json.Fields&&(KB.payload.Fields=_.extend(t.getPayload("Fields"),a.data.json.Fields),KB.FieldControls.add(_.toArray(KB.payload.Fields))),r.repaint(this.$el),KB.Fields.trigger("update"),this.trigger("kb:backend::viewUpdated"),this.model.trigger("after.change.area")},serialize:function(){var a,b;return a=jQuery("#post").serializeJSON(),b=a[this.model.get("mid")],delete b.areaContext,delete b.moduleName,this.trigger("kb::module.data.updated"),b},addField:function(a,b,c){_.isEmpty(c)?this.attachedFields[a]=b:this.attachedFields[c][a]=b},hasField:function(a,b){return _.isEmpty(b)?a in this.attachedFields:(this.attachedFields[b]||(this.attachedFields[b]={}),a in this.attachedFields[b])},getField:function(a,b){return _.isEmpty(b)?this.attachedFields[a]:this.attachedFields[b][a]},clearFields:function(){this.attachedFields={}},dispose:function(){},getDirty:function(){},getClean:function(){}})},{"backend/Views/ModuleControls/ControlsView":23,"backend/Views/ModuleControls/controls/DeleteControl":24,"backend/Views/ModuleControls/controls/DuplicateControl":25,"backend/Views/ModuleControls/controls/SaveControl":26,"backend/Views/ModuleControls/controls/StatusControl":27,"backend/Views/ModuleStatusBar/ModuleStatusBarView":28,"backend/Views/ModuleStatusBar/status/DraftStatus":29,"backend/Views/ModuleStatusBar/status/OriginalNameStatus":30,"backend/Views/ModuleUi/ModuleUiView":31,"backend/Views/ModuleUi/controls/DisabledControl":32,"backend/Views/ModuleUi/controls/FullscreenControl":33,"backend/Views/ModuleUi/controls/MoveControl":34,"backend/Views/ModuleUi/controls/ToggleControl":35,"common/Ajax":39,"common/Checks":40,"common/Config":41,"common/Payload":45,"common/UI":48}],37:[function(a,b,c){var d=a("common/Logger");b.exports=Backbone.View.extend({initialize:function(){this.model.View=this},getDirty:function(){d.Debug.info("Panel data dirty")},getClean:function(){d.Debug.info("Panel data clean")}})},{"common/Logger":43}],38:[function(a,b,c){b.exports=Backbone.View.extend({el:"#kb-contexts-tabs",initialize:function(){var a=this,b=this.$el.tabs({}),c=jQuery("ul:first li",b).droppable({accept:".kb-module-ui__sortable--connect li",hoverClass:"ui-state-hover",tolerance:"pointer",over:function(b,d){var e=jQuery(this);a.$el.tabs("option","active",c.index(e)),a.$(".kb-module-ui__sortable").sortable("refresh")}})}})},{}],39:[function(a,b,c){var d=a("common/Notice");b.exports={send:function(a,b,c,e){var f,g=e||{};f=a.postId?a.postId:KB.Environment&&KB.Environment.postId?KB.Environment.postId:!1;var h=_.extend({supplemental:a.supplemental||{},nonce:jQuery("#_kontentblocks_ajax_nonce").val(),post_id:f,postId:f,kbajax:!0},a);return jQuery("#publish").attr("disabled","disabled"),jQuery.ajax({url:ajaxurl,data:h,type:"POST",dataType:"json",success:function(a){a&&(c&&b?b.call(c,a,g):b&&b(a,g))},error:function(){d.notice("<p>Generic Ajax Error</p>","error")},complete:function(){jQuery("#publish").removeAttr("disabled")}})}}},{"common/Notice":44}],40:[function(a,b,c){var d=a("common/Config");b.exports={blockLimit:function(a){var b=a.get("limit"),c=jQuery("#"+a.get("id")+" li.kb-module").length;return!(0!==b&&c===b)},userCan:function(a){var b=jQuery.inArray(a,d.get("caps"));return-1!==b}}},{"common/Config":41}],41:[function(a,b,c){var d=function(a){var b=KB.appData.config;return{get:function(a){return a?b[a]?b[a]:null:b},getNonce:function(a){var c=["update","create","delete","read"];return-1!==_.indexOf(c,a)?b.nonces[a]:(console.error("Invalid nonce requested in kb.cm.Config.js"),null)},inDevMode:function(){return b.env.dev},getRootURL:function(){return b.env.rootUrl},getFieldJsUrl:function(){return b.env.fieldJsUrl},getHash:function(){return b.env.hash},getLayoutMode:function(){return b.layoutMode||"default-boxes"}}}(jQuery);b.exports=d},{}],42:[function(a,b,c){var d=a("common/Utilities");b.exports={getString:function(a){return a&&KB&&KB.i18n?d.getIndex(KB.i18n,a):null}}},{"common/Utilities":49}],43:[function(a,b,c){var d=a("common/Config");Function.prototype.bind&&window.console&&"object"==typeof console.log&&["log","info","warn","error","assert","dir","clear","profile","profileEnd"].forEach(function(a){console[a]=this.bind(console[a],console)},Function.prototype.call),Logger.useDefaults();var e=Logger.get("_K"),f=Logger.get("_KS");e.setLevel(e.INFO),f.setLevel(f.INFO),d.inDevMode()||e.setLevel(Logger.OFF),Logger.setHandler(function(a,b){if(KB.Menubar&&2===b.level.value&&"_KS"===b.name)a[0]&&KB.Menubar.StatusBar.setMsg(a[0]);else{var c=window.console,d=c.log;b.name&&(a[0]="["+b.name+"] "+a[0]),b.level===Logger.WARN&&c.warn?d=c.warn:b.level===Logger.ERROR&&c.error?d=c.error:b.level===Logger.INFO&&c.info&&(d=c.info),d.apply(c,a)}}),b.exports={Debug:e,User:f}},{"common/Config":41}],44:[function(a,b,c){"use strict";b.exports={notice:function(a,b,c){var d=c||3;window.alertify.notify(a,b,d)},confirm:function(a,b,c,d,e){var f=a||"Title";window.alertify.confirm(f,b,function(){c.call(e)},function(){d.call(e)})}}},{}],45:[function(a,b,c){b.exports={getFieldData:function(a,b,c,d){var e;return this._typeExists(a)?(e=KB.payload.fieldData[a],e[b]?_.isEmpty(d)?e[b][c]?e[b][c]:[]:e[b][d]&&e[b][d][c]?e[b][d][c]:[]:[]):[]},_typeExists:function(a){return!_.isUndefined(KB.payload.fieldData[a])},getFieldArgs:function(a,b){return KB.payload.Fields&&KB.payload.Fields[a]?b&&KB.payload.Fields[a][b]?KB.payload.Fields[a][b]:KB.payload.Fields[a]:null},parseAdditionalJSON:function(a){var b;return b={Fields:[]},a&&a.Fields&&(b.Fields=KB.FieldControls.add(_.toArray(a.Fields))),b},getPayload:function(a){return KB&&KB.payload&&KB.payload[a]?KB.payload[a]:{}}}},{}],46:[function(a,b,c){var d=a("common/Config"),e=a("common/Utilities"),f=function(){function a(a,b,f,g){var h,i;if(b=b||{},g=g||this,h=f||null,!c[a]){var j=d.getRootURL()+"js/templates",k=j+"/"+a+".hbs?"+d.getHash(),l=/^https?:\/\//i;l.test(a)&&(k=a),e.stex.get(k)?(i=e.stex.get(k),h&&h.call(g)):jQuery.ajax({url:k,method:"GET",async:!1,success:function(a){i=a,e.stex.set(k,i,12e4),h&&h.call(g)}}),c[a]=HandlebarsKB.compile(i)}return c[a](b)}function b(a){if(!f[a]){var b;jQuery.ajax({url:a,method:"GET",async:!1,dataType:"html",success:function(a){b=a}}),f[a]=a}return f[a]}var c={},f={};return{render:a,helpfile:b}}();b.exports=f},{"common/Config":41,"common/Utilities":49}],47:[function(a,b,c){var d=a("common/Ajax"),e=a("common/Logger"),f=a("common/Config");b.exports={removeEditors:function(a){a||(a=jQuery("body")),jQuery(".wp-editor-area",a).each(function(){if("wp-content-wrap"===jQuery(this).attr("id")||"ghosteditor"===jQuery(this).attr("id"));else{var a=this.id;tinyMCE.execCommand("mceRemoveEditor",!0,a)}})},restoreEditors:function(a){a||(a=jQuery("body")),jQuery(".wp-editor-wrap",a).each(function(){var a=jQuery(this).find("textarea").attr("id"),b=jQuery(this).find("textarea");"ghosteditor"!==a&&(b.val(switchEditors.wpautop(b.val())),tinyMCE.execCommand("mceAddEditor",!0,a),switchEditors.go(a,"tmce"))})},addEditor:function(a,b,c,d){if(!a)return e.Debug.error("No scope element ($el) provided"),!1;if(_.isUndefined(tinyMCEPreInit))return!1;var f=c||350,g=_.isUndefined(d)?!0:!1;jQuery(".wp-editor-area",a).each(function(){var a=this.id,b=window.tinyMCE.get(a);b&&tinyMCE.execCommand("mceRemoveEditor",null,a);var c=tinyMCEPreInit&&tinyMCEPreInit.mceInit&&tinyMCEPreInit.mceInit.ghosteditor?"ghosteditor":"content",d=_.clone(tinyMCEPreInit.mceInit[c]);d.elements=a,d.selector="#"+a,d.id=a,d.kblive=g,d.height=f,d.remove_linebreaks=!1,d.setup=function(a){a.on("init",function(){KB.Events.trigger("KB::tinymce.new-editor",a)}),a.on("change",function(){var b;a.module||(b=jQuery(a.editorContainer).closest(".kb-module"),a.module=KB.Views.Modules.get(b.attr("id"))),a.module.$el.trigger("tinymce.change")})},tinymce.init(d),tinyMCEPreInit.mceInit[a]||(tinyMCEPreInit.mceInit[a]=d);var e={buttons:"",disabled_buttons:"",id:a};window.quicktags(e)}),setTimeout(function(){jQuery(".wp-editor-wrap",a).removeClass("html-active").addClass("tmce-active"),window.QTags._buttonsInit()},1500)},remoteGetEditor:function(a,b,c,g,h,i,j){var k=h||KB.appData.config.post.ID,c=c||a.attr("id");if(!i)var i=!1;var l=g||"";return d.send({action:"getRemoteEditor",editorId:c+"_ed",editorName:b,post_id:k,postId:k,editorContent:l,_ajax_nonce:f.getNonce("read"),args:{media_buttons:i}},function(b){b.success?(a.empty().append(b.data.html),this.addEditor(a,null,150,j)):e.Debug.info("Editor markup could not be retrieved from the server")},this)}}},{"common/Ajax":39,"common/Config":41,"common/Logger":43}],48:[function(a,b,c){var d=jQuery,e=a("common/Config"),f=a("common/Ajax"),g=a("common/TinyMCE"),h=a("common/Notice"),i=a("backend/Views/ContextUi/ContextRowGrid"),j={isSorting:!1,init:function(){var a=this,b=d("body");this.initTabs(),this.initSortable(),this.initSortableAreas(),this.initToggleBoxes(),this.flexContext(),this.flushLocalStorage(),this.initTipsy(),b.on("mousedown",".kb_field",function(a){activeField=this}),b.on("mousedown",".kb-module",function(a){activeBlock=this.id}),b.on("mouseenter",".kb-js-field-identifier",function(){KB.currentFieldId=this.id}),b.on("mouseenter",".kb-area__list-item li",function(){KB.currentModuleId=this.id}),jQuery(document).ajaxComplete(function(b,c,d){a.metaBoxReorder(b,c,d,"restore")}),jQuery(document).ajaxSend(function(b,c,d){a.metaBoxReorder(b,c,d,"remove")})},flexContext:function(){jQuery(".kb-context-row").each(function(a,b){var c=jQuery(b);c.data("KB.ContextRow",new i({el:b}))})},repaint:function(a){this.initTabs(),this.initToggleBoxes(),g.addEditor(a)},initTabs:function(a){var b=a||jQuery("body"),c=d(".kb_fieldtabs",b);c.tabs({activate:function(a,b){d(".kb-nano").nanoScroller({contentClass:"kb-nano-content"}),KB.Events.trigger("modal.recalibrate")}}),c.each(function(){var a=d(".ui-tabs-nav li",d(this)).length;1===a&&d(this).find(".ui-tabs-nav").css("display","none")})},initToggleBoxes:function(){d(".kb-togglebox-header").on("click",function(){d(this).next("div").slideToggle()}),d(".kb_fieldtoggles div:first-child").trigger("click")},initSortable:function(a){function b(){var a=i.get("limit"),b=c(i.get("id"));return-1===_.indexOf(i.get("assignedModules"),f.get("settings")["class"])?!1:0!==a&&b-1>=a?(h.notice("Not allowed here","error"),!1):!0}function c(a){return d("#"+a+" li.kb-module").length}var f,i,j=a||jQuery("body"),k=this,l="parent";"default-tabs"===e.getLayoutMode()&&(l="#kb-contexts-tabs"),d(".kb-module-ui__sortable",j).sortable({placeholder:"ui-state-highlight",ghost:!0,connectWith:".kb-module-ui__sortable--connect",helper:"clone",handle:".kb-move",cancel:"li.disabled, li.cantsort",tolerance:"pointer",delay:150,revert:350,appendTo:l,start:function(a,b){k.isSorting=!0,d("body").addClass("kb-is-sorting"),f=KB.Modules.get(b.item.attr("id")),i=KB.currentArea,d(KB).trigger("kb:sortable::start"),d(".kb-open").toggleClass("kb-open"),d(".kb-module__body").hide(),g.removeEditors(),d(document).trigger("kb_sortable_start",[a,b])},stop:function(a,b){k.isSorting=!1,d("body").removeClass("kb-is-sorting"),g.restoreEditors(),d(document).trigger("kb_sortable_stop",[a,b]),f.get("open")&&f.View.toggleBody(155)},over:function(a,b){i=KB.Areas.get(this.id)},receive:function(a,c){b()||(h.notice("Module not allowed in this area","error"),d(c.sender).sortable("cancel"))},update:function(a,c){if(!b())return!1;if(this!==c.item.parent("ul")[0]||c.sender){if(c.sender){if(c.item.parent("ul")[0].id===c.sender.attr("id"))return!1;d.when(k.changeArea(i,f)).then(function(a){return a.success?void k.resort(c.sender):!1}).done(function(){k.triggerAreaChange(i,f),d(KB).trigger("kb:sortable::update"),f.View.clearFields(),h.notice("Area change and order were updated successfully","success")})}}else d.when(k.resort(c.sender)).done(function(a){return a.success?(d(KB).trigger("kb:sortable::update"),void h.notice(a.message,"success")):(h.notice(a.message,"error"),!1)})}}).disableSelection()},flushLocalStorage:function(){var a=e.get("env").hash;store.get("kbhash")!==a&&(store.clear(),store.set("kbhash",a))},resort:function(a){var b={};return d(".kb-module-ui__sortable").each(function(){b[this.id]=d("#"+this.id).sortable("serialize",{attribute:"rel"})}),f.send({action:"resortModules",data:b,_ajax_nonce:e.getNonce("update")})},changeArea:function(a,b){return f.send({action:"changeArea",_ajax_nonce:e.getNonce("update"),mid:b.get("mid"),area_id:a.get("id"),context:a.get("context")})},triggerAreaChange:function(a,b){b.unsubscribeFromArea(),b.setArea(a)},toggleModule:function(){d("body").on("click",".kb-toggle",function(){KB.isLocked()&&!KB.userCan("lock_kontentblocks")?h.notice(kontentblocks.l18n.gen_no_permission,"alert"):(d(this).parent().nextAll(".kb-module__body:first").slideToggle("fast",function(){d("body").trigger("module::opened")}),d("#"+activeBlock).toggleClass("kb-open",1e3))})},initSortableAreas:function(){jQuery(".kb-context__inner").sortable({items:".kb-area__wrap",handle:".kb-area-move-handle",start:function(a,b){g.removeEditors()},stop:function(a,b){var c=jQuery("#post").serializeJSON(),d=c.kbcontext;d&&f.send({action:"updateContextAreaOrder",_ajax_nonce:e.getNonce("update"),data:d},function(a){a.success?h.notice(a.message,"success"):h.notice(a.message,"error"),g.restoreEditors()},this)}})},initTipsy:function(){jQuery("body").on("mouseenter","[data-kbtooltip]",function(a){jQuery(this).qtip({content:{attr:"data-kbtooltip"},style:"qtip-dark qtip-shadow",show:{event:a.type,effect:!0,delay:180,solo:!0,ready:!0}})})},metaBoxReorder:function(a,b,c,e){if(c.data){var f=c.data,h=f.split("&"),i={};d.each(h,function(a,b){var c=b.split("=");i[c[0]]=c[1]}),"meta-box-order"===i.action&&("restore"===e?g.restoreEditors():"remove"===e&&g.removeEditors())}}};b.exports=j},{"backend/Views/ContextUi/ContextRowGrid":17,"common/Ajax":39,"common/Config":41,"common/Notice":44,"common/TinyMCE":47}],49:[function(a,b,c){var d=function(a){return{stex:{set:function(a,b,c){store.set(a,{val:b,exp:c,time:(new Date).getTime()})},get:function(a){var b=store.get(a);return b?(new Date).getTime()-b.time>b.exp?null:b.val:null}},setIndex:function(a,b,c){return _.isObject(a)||(a={}),"string"==typeof b?this.setIndex(a,b.split("."),c):1==b.length&&void 0!==c?a[b[0]]=c:0==b.length?a:this.setIndex(a[b[0]],b.slice(1),c)},getIndex:function(a,b){b=b.replace(/\[(\w+)\]/g,".$1"),b=b.replace(/^\./,"");for(var c=b.split(".");c.length;){var d=c.shift();if(!(_.isObject(a)&&d in a))return{};a=a[d]}return a},sleep:function(a){for(var b=(new Date).getTime(),c=0;1e7>c&&!((new Date).getTime()-b>a);c++);}}}(jQuery);b.exports=d},{}],50:[function(a,b,c){b.exports={cntrlIsPressed:!1,init:function(){var a=this;jQuery(document).keydown(function(b){"17"==b.which&&(a.cntrlIsPressed=!0)}),jQuery(document).keyup(function(){a.cntrlIsPressed=!1})},ctrlPressed:function(){return this.cntrlIsPressed}}},{}],51:[function(a,b,c){var d=a("common/Checks"),e=a("common/Utilities"),f=a("common/Payload"),g=a("common/Config"),h=a("common/Logger");b.exports=Backbone.Model.extend({idAttribute:"uid",initialize:function(){this.cleanUp();var a=this.get("fieldId");a&&(this.ModuleModel=KB.ObjectProxy.get(a))&&this.getType()&&(this.set("ModuleModel",this.ModuleModel),this.setData(),this.bindHandlers(),this.setupType(),this.ModuleModel.attachField(this))},cleanUp:function(){var a=this.get("linkedFields")||{};a.hasOwnProperty(this.get("uid"))&&delete a[this.get("uid")]},bindHandlers:function(){this.listenTo(this,"field.model.settings",this.updateLinkedFields),this.listenToOnce(this.ModuleModel,"remove",this.remove),this.listenTo(this.ModuleModel,"change:moduleData",this.setData),this.listenTo(this.ModuleModel,"module.model.updated",this.getClean),this.listenTo(this,"change:value",this.upstreamData),this.listenTo(this.ModuleModel,"modal.serialize.before",this.unbind),this.listenTo(this.ModuleModel,"modal.serialize",this.rebind),this.listenTo(this.ModuleModel,"change:area",this.unbind),this.listenTo(this.ModuleModel,"after.change.area",this.rebind)},setupType:function(){var a;(a=this.getType())&&(this.FieldControlView=new a({el:this.getElement(),model:this}))},updateLinkedFields:function(a){a.linkedFields&&(this.set("linkedFields",a.linkedFields),this.cleanUp())},getElement:function(){return jQuery('*[data-kbfuid="'+this.get("uid")+'"]')[0]},getType:function(){var a=this.get("type");if(!d.userCan("edit_kontentblocks"))return!1;var b=KB.Fields.get(a);return b&&b.prototype.hasOwnProperty("initialize")?b:!1},getClean:function(){this.trigger("field.model.clean",this)},setData:function(a){var b,c,d,g,h,i={};b=a||this.get("ModuleModel"),c=f.getPayload("fieldData"),c[this.get("type")]&&(d=c[this.get("type")],d[this.get("fieldId")]&&(g=d[this.get("fieldId")],i=e.getIndex(g,this.get("kpath")))),h=e.getIndex(b.get("moduleData"),this.get("kpath")),this.set("value",_.extend(h,i))},upstreamData:function(){var a;if(a=this.get("ModuleModel")){var b=_.clone(this.get("ModuleModel").get("moduleData"));e.setIndex(b,this.get("kpath"),this.get("value")),a.set("moduleData",b,{silent:!1}),a.View.getDirty()}},externalUpdate:function(a){this.FieldControlView.synchronize(a)},remove:function(){this.stopListening(),KB.FieldControls.remove(this)},rebind:function(){var a=this;_.defer(function(){_.isUndefined(a.getElement())?_.defer(_.bind(a.FieldControlView.gone,a.FieldControlView)):a.FieldControlView&&(a.FieldControlView.setElement(a.getElement()),_.defer(_.bind(a.FieldControlView.rerender,a.FieldControlView)))},!0)},unbind:function(){this.FieldControlView&&this.FieldControlView.derender&&this.FieldControlView.derender()},sync:function(a){var b=this;KB.Events.trigger("field.before.sync",this.model);var c=b.toJSON(),d=c.ModuleModel.type,e=c.ModuleModel.toJSON();return delete c.ModuleModel,delete c.linkedFields,jQuery.ajax({url:ajaxurl,data:{action:"updateFieldModel",data:b.get("value"),field:c,module:e,type:d,_ajax_nonce:g.getNonce("update")},context:a?a:b,type:"POST",dataType:"json",success:function(a){b.trigger("field.model.updated",b)},error:function(){h.Debug.error("serialize | FrontendModal | Ajax error")}})}})},{"common/Checks":40,"common/Config":41,"common/Logger":43,"common/Payload":45,"common/Utilities":49}],52:[function(a,b,c){var d=a("./FieldControlModel");b.exports=Backbone.Collection.extend({initialize:function(){this._byModule={},this._linkedFields=[],this.listenTo(this,"add",this.addToModules),this.listenTo(this,"add",this.bindLinkedFields)},model:d,addToModules:function(a){if(a.ModuleModel){var b=a.ModuleModel.id;this._byModule[b]||(this._byModule[b]={}),this._byModule[b][a.id]=a}},getFieldsforModule:function(a){return this._byModule[a]?this._byModule[a]:{}},bindLinkedFields:function(a){var b=a.get("linkedFields");_.each(b,function(c,d){if(_.isNull(c)){var e=this.get(d);e&&(b[d]=e,a.listenTo(e,"external.change",a.externalUpdate),this.bindLinkedFields(e))}},this)},updateModels:function(a){a&&_.each(a,function(a){var b=this.get(a.uid);b?b.trigger("field.model.settings",a):this.add(a)},this)}})},{"./FieldControlModel":51}],53:[function(a,b,c){var d=a("templates/backend/batch-delete.hbs"),e=a("common/Ajax"),f=a("common/Config"),g=a("common/TinyMCE"),h=Backbone.View.extend({collection:{},visible:!1,className:"kb-batch-delete-wrap",events:{"click .kb-batch-delete--action-delete":"process","click .kb-batch-delete--action-reset":"reset"},initialize:function(){this.render()},render:function(){this.$el.append(d()),jQuery("body").append(this.$el)},add:function(a){this.collection[a.model.id]=a,this.refresh()},remove:function(a){this.collection[a.model.id]&&delete this.collection[a.model.id],this.refresh()},refresh:function(){var a=_.size(this.collection);a>0?this.show():this.hide()},reset:function(){_.each(this.collection,function(a){a.unmark(),this.remove(a)},this)},process:function(){var a=[];_.each(this.collection,function(b,c,d){a.push(c)}),e.send({action:"batchRemoveModules",_ajax_nonce:f.getNonce("delete"),modules:a},this.success,this)},success:function(a){a.data.modules&&_.each(a.data.modules,function(a,b){if(a){var c=this.collection[b];g.removeEditors(c.model.View.$el),KB.Modules.remove(c.model),wp.heartbeat.interval("fast",2),c.model.destroy()}},this)},show:function(){this.$el.addClass("visible")},hide:function(){this.$el.removeClass("visible")}});b.exports=new h},{"common/Ajax":39,"common/Config":41,"common/TinyMCE":47,"templates/backend/batch-delete.hbs":65}],54:[function(a,b,c){var d=a("shared/ModuleBrowser/ModuleBrowserDefinitions"),e=a("shared/ModuleBrowser/ModuleDefinitionModel"),f=a("shared/ModuleBrowser/ModuleBrowserDescriptions"),g=a("shared/ModuleBrowser/ModuleBrowserNavigation"),h=a("shared/ModuleBrowser/ModuleBrowserList"),i=a("common/Checks"),j=a("common/Notice"),k=a("common/Payload"),l=a("common/Ajax"),m=a("common/TinyMCE"),n=a("common/Config"),o=a("templates/backend/modulebrowser/module-browser.hbs");b.exports=Backbone.View.extend({initialize:function(a){this.options=a||{},this.isOpen=!1,this.area=this.options.area,this.viewMode=this.getViewMode(),this.modulesDefinitions=new d(this.prepareAssignedModules(),{model:e,area:this.options.area}).setup(),this.$el.append(o({viewMode:this.getViewModeClass()})),this.$backdrop=jQuery('<div class="kb-module-browser--backdrop"></div>'),this.subviews.ModulesList=new h({el:jQuery(".modules-list",this.$el),browser:this}),this.subviews.ModuleDescription=new f({el:jQuery(".module-description",this.$el),browser:this}),this.subviews.Navigation=new g({el:jQuery(".module-categories",this.$el),cats:this.modulesDefinitions.categories,browser:this}),this.listenTo(this.subviews.Navigation,"browser:change",this.update),this.bindHandlers()},tagName:"div",id:"module-browser",className:"kb-overlay",events:{"click .close-browser":"close","click .module-browser--switch__list-view":"toggleViewMode","click .module-browser--switch__excerpt-view":"toggleViewMode"},subviews:{},toggleViewMode:function(){jQuery(".module-browser-wrapper",this.$el).toggleClass("module-browser--list-view module-browser--excerpt-view");var a="mdb_"+this.area.model.get("id")+"_state",b=store.get(a);"list"==b?(this.viewMode="excerpt",store.set(a,"excerpt")):(this.viewMode="list",store.set(a,"list"))},render:function(){this.open()},getViewMode:function(){var a="mdb_"+this.area.model.get("id")+"_state";return store.get(a)?store.get(a):(store.set(a,"list"),"list")},getViewModeClass:function(){return"list"===this.viewMode?"module-browser--list-view":"module-browser--excerpt-view"},bindHandlers:function(){var a=this;jQuery("body").on("click",function(b){a.isOpen&&jQuery(b.target).is(".kb-module-browser--backdrop")&&a.close()}),jQuery(document).keydown(function(b){if(a.isOpen){switch(b.which){case 27:a.close();break;default:return}b.preventDefault()}})},open:function(){this.$el.appendTo("body"),this.$backdrop.appendTo("body"),jQuery("#wpwrap").addClass("module-browser-open"),jQuery(".kb-nano").nanoScroller({flash:!0,contentClass:"kb-nano-content"}),this.isOpen=!0},close:function(){jQuery("#wpwrap").removeClass("module-browser-open"),this.trigger("browser:close"),this.$backdrop.detach(),this.$el.detach(),this.isOpen=!1},update:function(a){var b=a.get("id"),c=this.modulesDefinitions.getModules(b);this.subviews.ModulesList.setModules(c).update()},loadDetails:function(a){this.subviews.ModuleDescription.model=a,this.subviews.ModuleDescription.update()},createModule:function(a){var b,c;return i.userCan("create_kontentblocks")||j.notice("You're not allowed to do this","error"),b=KB.Areas.get(this.options.area.model.get("id")),i.blockLimit(b)?(c={action:"createNewModule","class":a.get("settings")["class"],globalModule:a.get("globalModule"),parentObject:a.get("parentObject"),parentObjectId:a.get("parentObjectId"),areaContext:this.options.area.model.get("context"),area:this.options.area.model.get("id"),_ajax_nonce:n.getNonce("create"),frontend:KB.appData.config.frontend},this.options.area.model.get("parent_id")&&(c.postId=this.options.area.model.get("parent_id")),this.close(),void l.send(c,this.success,this)):(j.notice("Limit for this area reached","error"),!1)},success:function(a){var b,c;c=a.data,this.options.area.modulesList.append(c.html),b=KB.ObjectProxy.add(KB.Modules.add(c.module)),this.options.area.attachModuleView(b),this.parseAdditionalJSON(c.json),b.View.$el.addClass("kb-open"),setTimeout(function(){KB.Fields.trigger("newModule",b.View),m.addEditor(b.View.$el)},150)},parseAdditionalJSON:function(a){KB.payload.Fields||(KB.payload.Fields={}),_.extend(KB.payload.Fields,a.Fields),k.parseAdditionalJSON(a)},prepareAssignedModules:function(){var a=this.area.model.get("assignedModules"),b=[];return _.each(k.getPayload("ModuleDefinitions"),function(c){-1!==_.indexOf(a,c.settings["class"])&&b.push(c)}),b}})},{"common/Ajax":39,"common/Checks":40,"common/Config":41,"common/Notice":44,"common/Payload":45,"common/TinyMCE":47,"shared/ModuleBrowser/ModuleBrowserDefinitions":55,"shared/ModuleBrowser/ModuleBrowserDescriptions":56,"shared/ModuleBrowser/ModuleBrowserList":57,"shared/ModuleBrowser/ModuleBrowserNavigation":59,"shared/ModuleBrowser/ModuleDefinitionModel":60,"templates/backend/modulebrowser/module-browser.hbs":72}],55:[function(a,b,c){var d=a("common/Payload");b.exports=Backbone.Collection.extend({initialize:function(a,b){this.area=b.area},setup:function(){return this.categories=this.prepareCategories(),this.sortToCategories(),this},getModules:function(a){return this.categories[a].modules},sortToCategories:function(){var a=this;_.each(this.models,function(b){if(a.validateVisibility(b)){var c=_.isUndefined(b.get("settings").category)?"standard":b.get("settings").category;a.categories[c].modules.push(b)}})},validateVisibility:function(a){return a.get("settings").hidden?!1:a.get("settings").disabled?!1:!(!a.get("settings").globalModule&&this.area.model.get("dynamic"))},prepareCategories:function(){var a={};return _.each(d.getPayload("ModuleCategories"),function(b,c){a[c]={id:c,name:b,modules:[]}}),a}})},{"common/Payload":45}],56:[function(a,b,c){var d=a("common/Templates"),e=a("templates/backend/modulebrowser/module-template-description.hbs"),f=a("templates/backend/modulebrowser/module-description.hbs"),g=a("templates/backend/modulebrowser/poster.hbs");b.exports=Backbone.View.extend({initialize:function(a){this.options=a||{},this.Browser=a.browser,this.Browser.on("browser:close",this.close,this)},events:{"click .kb-js-create-module":"createModule"},update:function(){this.$el.empty(),this.model.get("template")?this.$el.html(e({module:this.model.toJSON()})):this.$el.html(f({module:this.model.toJSON()})),this.model.get("settings").poster!==!1&&this.$el.append(g({module:this.model.toJSON()})),this.model.get("settings").helpfile!==!1&&this.$el.append(d.render(this.model.get("settings").helpfile,{module:this.model.toJSON()}))},close:function(){},createModule:function(){this.Browser.createModule(this.model)}})},{"common/Templates":46,"templates/backend/modulebrowser/module-description.hbs":73,"templates/backend/modulebrowser/module-template-description.hbs":75,"templates/backend/modulebrowser/poster.hbs":77}],57:[function(a,b,c){var d=a("shared/ModuleBrowser/ModuleBrowserListItem");b.exports=Backbone.View.extend({initialize:function(a){this.options=a||{}},modules:{},subviews:{},setModules:function(a){return this.modules=a,this},update:function(){var a=this,b=!1;this.$el.empty(),_.each(this.modules,function(c){a.subviews[c.cid]=new d({model:c,parent:a,browser:a.options.browser}),b===!1&&(a.options.browser.loadDetails(c),b=!b),a.$el.append(a.subviews[c.cid].render(a.$el))})}})},{"shared/ModuleBrowser/ModuleBrowserListItem":58}],58:[function(a,b,c){var d=a("templates/backend/modulebrowser/module-template-list-item.hbs"),e=a("templates/backend/modulebrowser/module-list-item.hbs");b.exports=Backbone.View.extend({tagName:"li",className:"modules-list-item",initialize:function(a){this.options=a||{},this.Browser=a.browser,this.area=a.browser.area},render:function(a){this.model.get("globalModule")?this.$el.html(d({module:this.model.toJSON()})):this.$el.html(e({module:this.model.toJSON()})),a.append(this.$el)},events:{click:"handleClick","click .kb-js-create-module":"handlePlusClick"},handleClick:function(){"list"===this.Browser.viewMode?this.createModule():this.Browser.loadDetails(this.model)},handlePlusClick:function(){return"list"===this.Browser.viewMode?(this.handleClick(),!1):void this.createModule()},createModule:function(){this.Browser.createModule(this.model)},close:function(){this.remove()}})},{"templates/backend/modulebrowser/module-list-item.hbs":74,"templates/backend/modulebrowser/module-template-list-item.hbs":76}],59:[function(a,b,c){b.exports=Backbone.View.extend({item:Backbone.View.extend({initialize:function(a){this.options=a||{}},tagName:"li",className:"cat-item",events:{click:"change"},change:function(){this.options.parent.trigger("browser:change",this.model),this.$el.addClass("active"),jQuery("li").not(this.$el).removeClass("active")},render:function(){var a=_.keys(this.model.get("modules")).length,b="("+a+")";return 0===a?!1:(this.options.parent.catSet===!1&&(this.options.parent.catSet=!0,this.options.browser.update(this.model),this.$el.addClass("active")),void this.options.parent.$list.append(this.$el.html(this.model.get("name")+'<span class="module-count">'+b+"</span>")))}}),catSet:!1,initialize:function(a){var b=this;this.options=a||{},this.$list=jQuery("<ul></ul>").appendTo(this.$el),_.each(this.options.cats,function(a){var c=new Backbone.Model(a);new b.item({parent:b,model:c,browser:b.options.browser}).render()})}})},{}],60:[function(a,b,c){b.exports=Backbone.Model.extend({initialize:function(){var a=this;this.id=function(){return"template"===a.get("settings").category?a.get("mid"):a.get("settings")["class"]}()}})},{}],61:[function(a,b,c){KB.ViewsCollection=function(){this.views={},this.lastViewAdded=null,this.add=function(a,b){return this.views[a]||(this.views[a]=b,KB.trigger("kb:"+b.model.get("class")+":added",b),
this.trigger("view:add",b),this.lastViewAdded=b),b},this.ready=function(){_.each(this.views,function(a){a.trigger("kb:"+a.model.get("class"),a),KB.trigger("kb:"+a.model.get("class")+":loaded",a)}),KB.trigger("kb:ready")},this.readyOnFront=function(){_.each(this.views,function(a){a.trigger("kb:"+a.model.get("class"),a),KB.trigger("kb:"+a.model.get("class")+":loadedOnFront",a)}),KB.trigger("kb:ready")},this.remove=function(a){var b=this.get(a);b.model.Area.View.trigger("kb.module.deleted",b),this.trigger("kb.modules.view.deleted",b),delete this.views[a],b.dispose()},this.get=function(a){return this.views[a]?this.views[a]:void 0},this.filterByModelAttr=function(a,b){return _.filter(this.views,function(c){return c.model.get(a)===b})}},_.extend(KB.ViewsCollection.prototype,Backbone.Events),b.exports=KB.ViewsCollection},{}],62:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'<a class="modal modules-link" href="">\n    '+this.escapeExpression(this.lambda(null!=(e=null!=(e=null!=(e=null!=a?a.i18n:a)?e.Areas:e)?e.ui:e)?e.addNewModule:e,a))+"\n</a>"},useData:!0})},{"hbsfy/runtime":89}],63:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return"<ul class='kb-area-actions-list'></ul>"},useData:!0})},{"hbsfy/runtime":89}],64:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'<div class="kb-area__item-placeholder modules-link">\n    '+this.escapeExpression(this.lambda(null!=(e=null!=(e=null!=(e=null!=a?a.i18n:a)?e.Areas:e)?e.ui:e)?e.clickToAdd:e,a))+"\n</div>"},useData:!0})},{"hbsfy/runtime":89}],65:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return'<p>Multiple modules are selected</p>\n<div class="kb-button kb-batch-delete--action-delete">Delete all</div>\n<div class="kb-button kb-batch-delete--action-reset">Unselect all</div>'},useData:!0})},{"hbsfy/runtime":89}],66:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f,g=b.helperMissing,h="function",i=this.escapeExpression,j=this.lambda;return'<div class="dashicons dashicons-plus"></div>\n<div class="kb-global-area-item">\n    <h4>'+i((f=null!=(f=b.name||(null!=a?a.name:a))?f:g,typeof f===h?f.call(a,{name:"name",hash:{},data:d}):f))+" <span>(Contains "+i(j(null!=(e=null!=a?a.meta:a)?e.modules:e,a))+" modules)</span></h4>\n    <p>"+i((f=null!=(f=b.description||(null!=a?a.description:a))?f:g,typeof f===h?f.call(a,{name:"description",hash:{},data:d}):f))+'</p>\n    <a target="_blank" class="kb-button-small" href="'+i(j(null!=(e=null!=a?a.meta:a)?e.editLink:e,a))+'">View</a>\n</div>'},useData:!0})},{"hbsfy/runtime":89}],67:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return'<div class="kb-context-bar grid__col grid__col--12-of-12">\n    <ul class="kb-context-bar--actions">\n\n    </ul>\n</div>'},useData:!0})},{"hbsfy/runtime":89}],68:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return'<div class="kb-context-browser-inner">\n    <div class="kb-context-browser--header">\n        <h3>Available global areas</h3>\n        <a class="genericon genericon-close-alt close-browser kb-button"></a>\n    </div>\n    <div class="kb-context-browser--body">\n        <ul class="kb-global-areas-list">\n\n        </ul>\n    </div>\n</div>'},useData:!0})},{"hbsfy/runtime":89}],69:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return'<div data-tipsy="open context browser" class="kb-button-small kb-js-add-global-area">add from global areas</div>'},useData:!0})},{"hbsfy/runtime":89}],70:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return'<div class="kb-fullscreen--holder-wrap">\n    <ul class="kb-fullscreen--controls">\n       <li class="kb-fullscreen-js-close"><span class="dashicons dashicons-no-alt"></span></li>\n    </ul>\n    <div class="kb-fullscreen--inner">\n\n    </div>\n</div>'},useData:!0})},{"hbsfy/runtime":89}],71:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return"<ul class='module-actions'></ul>"},useData:!0})},{"hbsfy/runtime":89}],72:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'<div class="module-browser-wrapper '+this.escapeExpression((e=null!=(e=b.viewMode||(null!=a?a.viewMode:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"viewMode",hash:{},data:d}):e))+'">\n\n    <div class="module-browser-header module-categories">\n        <a class="genericon genericon-close-alt close-browser kb-button"></a>\n        <a class="dashicons dashicons-list-view module-browser--switch__list-view "></a>\n        <a class="dashicons dashicons-exerpt-view module-browser--switch__excerpt-view "></a>\n    </div>\n\n    <div class="module-browser__left-column kb-nano">\n        <ul class="modules-list kb-nano-content">\n\n        </ul>\n    </div>\n\n    <div class="module-browser__right-column kb-nano">\n        <div class="module-description kb-nano-content">\n\n        </div>\n    </div>\n</div>'},useData:!0})},{"hbsfy/runtime":89}],73:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return"<h3>"+this.escapeExpression(this.lambda(null!=(e=null!=(e=null!=a?a.module:a)?e.settings:e)?e.publicName:e,a))+' <div class="kb-button-small kb-js-create-module">Add module</div>\n</h3>\n'},useData:!0})},{"hbsfy/runtime":89}],74:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f=this.lambda,g=this.escapeExpression;return'<div class="dashicons dashicons-plus kb-js-create-module"></div>\n<h4>'+g(f(null!=(e=null!=(e=null!=a?a.module:a)?e.settings:e)?e.publicName:e,a))+'</h4>\n<p class="description">'+g(f(null!=(e=null!=(e=null!=a?a.module:a)?e.settings:e)?e.description:e,a))+"</p>"},useData:!0})},{"hbsfy/runtime":89}],75:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return"<h3>"+this.escapeExpression(this.lambda(null!=(e=null!=(e=null!=a?a.module:a)?e.parentObject:e)?e.post_title:e,a))+"</h3>"},useData:!0})},{"hbsfy/runtime":89}],76:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'<div class="dashicons dashicons-plus kb-js-create-module"></div>\n<h4>'+this.escapeExpression(this.lambda(null!=(e=null!=(e=null!=a?a.module:a)?e.parentObject:e)?e.post_title:e,a))+"</h4>"},useData:!0})},{"hbsfy/runtime":89}],77:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'<div class="module-browser--poster-wrap">\n    <img src="'+this.escapeExpression(this.lambda(null!=(e=null!=(e=null!=a?a.module:a)?e.settings:e)?e.poster:e,a))+'" >\n</div>'},useData:!0})},{"hbsfy/runtime":89}],78:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return"<ul class='kb-module--status-bar-list'></ul>"},useData:!0})},{"hbsfy/runtime":89}],79:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({1:function(a,b,c,d){var e;return'    <span class="kbu-color-red"><span class="dashicons dashicons-flag"></span> '+this.escapeExpression(this.lambda(null!=(e=null!=a?a.i18n:a)?e.draft:e,a))+"</span>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return null!=(e=b["if"].call(a,null!=a?a.draft:a,{name:"if",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:""},useData:!0})},{"hbsfy/runtime":89}],80:[function(a,b,c){var d=a("hbsfy/runtime");b.exports=d.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return"<ul class='ui-actions'></ul>"},useData:!0})},{"hbsfy/runtime":89}],81:[function(a,b,c){"use strict";function d(){var a=new g.HandlebarsEnvironment;return m.extend(a,g),a.SafeString=i["default"],a.Exception=k["default"],a.Utils=m,a.escapeExpression=m.escapeExpression,a.VM=o,a.template=function(b){return o.template(b,a)},a}var e=function(a){return a&&a.__esModule?a:{"default":a}};c.__esModule=!0;var f=a("./handlebars/base"),g=e(f),h=a("./handlebars/safe-string"),i=e(h),j=a("./handlebars/exception"),k=e(j),l=a("./handlebars/utils"),m=e(l),n=a("./handlebars/runtime"),o=e(n),p=a("./handlebars/no-conflict"),q=e(p),r=d();r.create=d,q["default"](r),r["default"]=r,c["default"]=r,b.exports=c["default"]},{"./handlebars/base":82,"./handlebars/exception":83,"./handlebars/no-conflict":84,"./handlebars/runtime":85,"./handlebars/safe-string":86,"./handlebars/utils":87}],82:[function(a,b,c){"use strict";function d(a,b){this.helpers=a||{},this.partials=b||{},e(this)}function e(a){a.registerHelper("helperMissing",function(){if(1===arguments.length)return void 0;throw new k["default"]('Missing helper: "'+arguments[arguments.length-1].name+'"')}),a.registerHelper("blockHelperMissing",function(b,c){var d=c.inverse,e=c.fn;if(b===!0)return e(this);if(b===!1||null==b)return d(this);if(o(b))return b.length>0?(c.ids&&(c.ids=[c.name]),a.helpers.each(b,c)):d(this);if(c.data&&c.ids){var g=f(c.data);g.contextPath=i.appendContextPath(c.data.contextPath,c.name),c={data:g}}return e(b,c)}),a.registerHelper("each",function(a,b){function c(b,c,e){j&&(j.key=b,j.index=c,j.first=0===c,j.last=!!e,l&&(j.contextPath=l+b)),h+=d(a[b],{data:j,blockParams:i.blockParams([a[b],b],[l+b,null])})}if(!b)throw new k["default"]("Must pass iterator to #each");var d=b.fn,e=b.inverse,g=0,h="",j=void 0,l=void 0;if(b.data&&b.ids&&(l=i.appendContextPath(b.data.contextPath,b.ids[0])+"."),p(a)&&(a=a.call(this)),b.data&&(j=f(b.data)),a&&"object"==typeof a)if(o(a))for(var m=a.length;m>g;g++)c(g,g,g===a.length-1);else{var n=void 0;for(var q in a)a.hasOwnProperty(q)&&(n&&c(n,g-1),n=q,g++);n&&c(n,g-1,!0)}return 0===g&&(h=e(this)),h}),a.registerHelper("if",function(a,b){return p(a)&&(a=a.call(this)),!b.hash.includeZero&&!a||i.isEmpty(a)?b.inverse(this):b.fn(this)}),a.registerHelper("unless",function(b,c){return a.helpers["if"].call(this,b,{fn:c.inverse,inverse:c.fn,hash:c.hash})}),a.registerHelper("with",function(a,b){p(a)&&(a=a.call(this));var c=b.fn;if(i.isEmpty(a))return b.inverse(this);if(b.data&&b.ids){var d=f(b.data);d.contextPath=i.appendContextPath(b.data.contextPath,b.ids[0]),b={data:d}}return c(a,b)}),a.registerHelper("log",function(b,c){var d=c.data&&null!=c.data.level?parseInt(c.data.level,10):1;a.log(d,b)}),a.registerHelper("lookup",function(a,b){return a&&a[b]})}function f(a){var b=i.extend({},a);return b._parent=a,b}var g=function(a){return a&&a.__esModule?a:{"default":a}};c.__esModule=!0,c.HandlebarsEnvironment=d,c.createFrame=f;var h=a("./utils"),i=g(h),j=a("./exception"),k=g(j),l="3.0.1";c.VERSION=l;var m=6;c.COMPILER_REVISION=m;var n={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1"};c.REVISION_CHANGES=n;var o=i.isArray,p=i.isFunction,q=i.toString,r="[object Object]";d.prototype={constructor:d,logger:s,log:t,registerHelper:function(a,b){if(q.call(a)===r){if(b)throw new k["default"]("Arg not supported with multiple helpers");i.extend(this.helpers,a)}else this.helpers[a]=b},unregisterHelper:function(a){delete this.helpers[a]},registerPartial:function(a,b){if(q.call(a)===r)i.extend(this.partials,a);else{if("undefined"==typeof b)throw new k["default"]("Attempting to register a partial as undefined");this.partials[a]=b}},unregisterPartial:function(a){delete this.partials[a]}};var s={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:1,log:function(a,b){if("undefined"!=typeof console&&s.level<=a){var c=s.methodMap[a];(console[c]||console.log).call(console,b)}}};c.logger=s;var t=s.log;c.log=t},{"./exception":83,"./utils":87}],83:[function(a,b,c){"use strict";function d(a,b){var c=b&&b.loc,f=void 0,g=void 0;c&&(f=c.start.line,g=c.start.column,a+=" - "+f+":"+g);for(var h=Error.prototype.constructor.call(this,a),i=0;i<e.length;i++)this[e[i]]=h[e[i]];Error.captureStackTrace&&Error.captureStackTrace(this,d),c&&(this.lineNumber=f,this.column=g)}c.__esModule=!0;var e=["description","fileName","lineNumber","message","name","number","stack"];d.prototype=new Error,c["default"]=d,b.exports=c["default"]},{}],84:[function(a,b,c){"use strict";c.__esModule=!0,c["default"]=function(a){var b="undefined"!=typeof global?global:window,c=b.Handlebars;a.noConflict=function(){b.Handlebars===a&&(b.Handlebars=c)}},b.exports=c["default"]},{}],85:[function(a,b,c){"use strict";function d(a){var b=a&&a[0]||1,c=p.COMPILER_REVISION;if(b!==c){if(c>b){var d=p.REVISION_CHANGES[c],e=p.REVISION_CHANGES[b];throw new o["default"]("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+d+") or downgrade your runtime to an older version ("+e+").")}throw new o["default"]("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+a[1]+").")}}function e(a,b){function c(c,d,e){e.hash&&(d=m.extend({},d,e.hash)),c=b.VM.resolvePartial.call(this,c,d,e);var f=b.VM.invokePartial.call(this,c,d,e);if(null==f&&b.compile&&(e.partials[e.name]=b.compile(c,a.compilerOptions,b),f=e.partials[e.name](d,e)),null!=f){if(e.indent){for(var g=f.split("\n"),h=0,i=g.length;i>h&&(g[h]||h+1!==i);h++)g[h]=e.indent+g[h];f=g.join("\n")}return f}throw new o["default"]("The partial "+e.name+" could not be compiled when running in runtime-only mode")}function d(b){var c=void 0===arguments[1]?{}:arguments[1],f=c.data;d._setup(c),!c.partial&&a.useData&&(f=j(b,f));var g=void 0,h=a.useBlockParams?[]:void 0;return a.useDepths&&(g=c.depths?[b].concat(c.depths):[b]),a.main.call(e,b,e.helpers,e.partials,f,h,g)}if(!b)throw new o["default"]("No environment passed to template");if(!a||!a.main)throw new o["default"]("Unknown template object: "+typeof a);b.VM.checkRevision(a.compiler);var e={strict:function(a,b){if(!(b in a))throw new o["default"]('"'+b+'" not defined in '+a);return a[b]},lookup:function(a,b){for(var c=a.length,d=0;c>d;d++)if(a[d]&&null!=a[d][b])return a[d][b]},lambda:function(a,b){return"function"==typeof a?a.call(b):a},escapeExpression:m.escapeExpression,invokePartial:c,fn:function(b){return a[b]},programs:[],program:function(a,b,c,d,e){var g=this.programs[a],h=this.fn(a);return b||e||d||c?g=f(this,a,h,b,c,d,e):g||(g=this.programs[a]=f(this,a,h)),g},data:function(a,b){for(;a&&b--;)a=a._parent;return a},merge:function(a,b){var c=a||b;return a&&b&&a!==b&&(c=m.extend({},b,a)),c},noop:b.VM.noop,compilerInfo:a.compiler};return d.isTop=!0,d._setup=function(c){c.partial?(e.helpers=c.helpers,e.partials=c.partials):(e.helpers=e.merge(c.helpers,b.helpers),a.usePartial&&(e.partials=e.merge(c.partials,b.partials)))},d._child=function(b,c,d,g){if(a.useBlockParams&&!d)throw new o["default"]("must pass block params");if(a.useDepths&&!g)throw new o["default"]("must pass parent depths");return f(e,b,a[b],c,0,d,g)},d}function f(a,b,c,d,e,f,g){function h(b){var e=void 0===arguments[1]?{}:arguments[1];return c.call(a,b,a.helpers,a.partials,e.data||d,f&&[e.blockParams].concat(f),g&&[b].concat(g))}return h.program=b,h.depth=g?g.length:0,h.blockParams=e||0,h}function g(a,b,c){return a?a.call||c.name||(c.name=a,a=c.partials[a]):a=c.partials[c.name],a}function h(a,b,c){if(c.partial=!0,void 0===a)throw new o["default"]("The partial "+c.name+" could not be found");return a instanceof Function?a(b,c):void 0}function i(){return""}function j(a,b){return b&&"root"in b||(b=b?p.createFrame(b):{},b.root=a),b}var k=function(a){return a&&a.__esModule?a:{"default":a}};c.__esModule=!0,c.checkRevision=d,c.template=e,c.wrapProgram=f,c.resolvePartial=g,c.invokePartial=h,c.noop=i;var l=a("./utils"),m=k(l),n=a("./exception"),o=k(n),p=a("./base")},{"./base":82,"./exception":83,"./utils":87}],86:[function(a,b,c){"use strict";function d(a){this.string=a}c.__esModule=!0,d.prototype.toString=d.prototype.toHTML=function(){return""+this.string},c["default"]=d,b.exports=c["default"]},{}],87:[function(a,b,c){"use strict";function d(a){return k[a]}function e(a){for(var b=1;b<arguments.length;b++)for(var c in arguments[b])Object.prototype.hasOwnProperty.call(arguments[b],c)&&(a[c]=arguments[b][c]);return a}function f(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1}function g(a){if("string"!=typeof a){if(a&&a.toHTML)return a.toHTML();if(null==a)return"";if(!a)return a+"";a=""+a}return m.test(a)?a.replace(l,d):a}function h(a){return a||0===a?p(a)&&0===a.length?!0:!1:!0}function i(a,b){return a.path=b,a}function j(a,b){return(a?a+".":"")+b}c.__esModule=!0,c.extend=e,c.indexOf=f,c.escapeExpression=g,c.isEmpty=h,c.blockParams=i,c.appendContextPath=j;var k={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},l=/[&<>"'`]/g,m=/[&<>"'`]/,n=Object.prototype.toString;c.toString=n;var o=function(a){return"function"==typeof a};o(/x/)&&(c.isFunction=o=function(a){return"function"==typeof a&&"[object Function]"===n.call(a)});var o;c.isFunction=o;var p=Array.isArray||function(a){return a&&"object"==typeof a?"[object Array]"===n.call(a):!1};c.isArray=p},{}],88:[function(a,b,c){b.exports=a("./dist/cjs/handlebars.runtime")["default"]},{"./dist/cjs/handlebars.runtime":81}],89:[function(a,b,c){b.exports=a("handlebars/runtime")["default"]},{"handlebars/runtime":88}]},{},[1]);