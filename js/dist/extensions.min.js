/*! Kontentblocks ProdVersion 2015-09-13 07:09 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){b.exports=Backbone.View.extend({tagName:"div",className:"",isValid:function(){return!0}})},{}],2:[function(a,b,c){var d=a("common/Notice");b.exports={send:function(a,b,c,e){var f,g=e||{};f=a.postId?a.postId:KB.Environment&&KB.Environment.postId?KB.Environment.postId:!1;var h=_.extend({supplemental:a.supplemental||{},nonce:jQuery("#_kontentblocks_ajax_nonce").val(),post_id:f,postId:f,kbajax:!0},a);return jQuery("#publish").attr("disabled","disabled"),jQuery.ajax({url:ajaxurl,data:h,type:"POST",dataType:"json",success:function(a){a&&(c&&b?b.call(c,a,g):b&&b(a,g))},error:function(){d.notice("<p>Generic Ajax Error</p>","error")},complete:function(){jQuery("#publish").removeAttr("disabled")}})}}},{"common/Notice":7}],3:[function(a,b,c){var d=a("common/Config");b.exports={blockLimit:function(a){var b=a.get("limit"),c=jQuery("#"+a.get("id")+" li.kb-module").length;return!(0!==b&&c===b)},userCan:function(a){var b=jQuery.inArray(a,d.get("caps"));return-1!==b}}},{"common/Config":4}],4:[function(a,b,c){var d=function(a){var b=KB.appData.config;return{get:function(a){return a?b[a]?b[a]:null:b},getNonce:function(a){var c=["update","create","delete","read"];return-1!==_.indexOf(c,a)?b.nonces[a]:(console.error("Invalid nonce requested in kb.cm.Config.js"),null)},inDevMode:function(){return b.env.dev},getRootURL:function(){return b.env.rootUrl},getFieldJsUrl:function(){return b.env.fieldJsUrl},getHash:function(){return b.env.hash},getLayoutMode:function(){return b.layoutMode||"default-boxes"}}}(jQuery);b.exports=d},{}],5:[function(a,b,c){var d=a("common/Utilities");b.exports={getString:function(a){return a&&KB&&KB.i18n?d.getIndex(KB.i18n,a):null}}},{"common/Utilities":8}],6:[function(a,b,c){var d=a("common/Config");Function.prototype.bind&&window.console&&"object"==typeof console.log&&["log","info","warn","error","assert","dir","clear","profile","profileEnd"].forEach(function(a){console[a]=this.bind(console[a],console)},Function.prototype.call),Logger.useDefaults();var e=Logger.get("_K"),f=Logger.get("_KS");e.setLevel(e.INFO),f.setLevel(f.INFO),d.inDevMode()||e.setLevel(Logger.OFF),Logger.setHandler(function(a,b){if(KB.Menubar&&2===b.level.value&&"_KS"===b.name)a[0]&&KB.Menubar.StatusBar.setMsg(a[0]);else{var c=window.console,d=c.log;b.name&&(a[0]="["+b.name+"] "+a[0]),b.level===Logger.WARN&&c.warn?d=c.warn:b.level===Logger.ERROR&&c.error?d=c.error:b.level===Logger.INFO&&c.info&&(d=c.info),d.apply(c,a)}}),b.exports={Debug:e,User:f}},{"common/Config":4}],7:[function(a,b,c){"use strict";b.exports={notice:function(a,b,c){var d=c||3;window.alertify.notify(a,b,d)},confirm:function(a,b,c,d,e){var f=a||"Title";window.alertify.confirm(f,b,function(){c.call(e)},function(){d.call(e)})}}},{}],8:[function(a,b,c){var d=function(a){return{stex:{set:function(a,b,c){store.set(a,{val:b,exp:c,time:(new Date).getTime()})},get:function(a){var b=store.get(a);return b?(new Date).getTime()-b.time>b.exp?null:b.val:null}},store:{set:function(a,b){store.set(a,b)},get:function(a){return store.get(a)}},setIndex:function(a,b,c){return _.isObject(a)||(a={}),"string"==typeof b?this.setIndex(a,b.split("."),c):1==b.length&&void 0!==c?a[b[0]]=c:0==b.length?a:this.setIndex(a[b[0]],b.slice(1),c)},getIndex:function(a,b){b=b.replace(/\[(\w+)\]/g,".$1"),b=b.replace(/^\./,"");for(var c=b.split(".");c.length;){var d=c.shift();if(!(_.isObject(a)&&d in a))return{};a=a[d]}return a},sleep:function(a){for(var b=(new Date).getTime(),c=0;1e7>c&&!((new Date).getTime()-b>a);c++);}}}(jQuery);b.exports=d},{}],9:[function(a,b,c){var d=a("common/Ajax"),e=a("common/Notice"),f=a("common/Config");b.exports={el:jQuery("#backup-inspect"),lastItem:null,firstRun:!0,init:function(){var a=this;this.listEl=jQuery("<ul></ul>").appendTo(this.el),this.listEl.length>0&&this.update(),jQuery(document).on("heartbeat-send",function(b,c){c.kbBackupWatcher=a.lastItem,c.post_id=KB.Environment.postId||0}),jQuery(document).on("heartbeat-tick",function(b,c){c.kbHasNewBackups&&_.isObject(c.kbHasNewBackups)&&a.renderList(c.kbHasNewBackups)})},update:function(){var a=this;d.send({action:"get_backups",_ajax_nonce:f.getNonce("read")},function(b){a.items=b,a.renderList(b)})},renderList:function(a){var b=this;this.listEl.empty(),_.each(a,function(a,c){b.lastItem=c,b.listEl.append(_.template("                <li>\n                    <details>\n                        <summary>\n                            <%= data.time %>\n                        </summary>\n                    <div class='actions' data-id='<%= key %>'>\n                        <span class='js-restore'>Restore</span>\n                        <p class='description'><b>Comment:</b> <%= item.msg %></p>\n                    </details>\n                </li>",{data:{time:new moment.unix(c).format("HH:mm:ss / DD.MMM")},item:a,key:c}))}),this.firstRun||e.notice("<p>"+KB.i18n.Extensions.backups.newBackupcreated+"</p>","success"),this.firstRun=!1,this.listEl.on("click",".js-restore",function(a){var c=jQuery(this).parent().attr("data-id");b.restore(c)})},restore:function(a){var b=window.location.href+"&restore_backup="+a+"&post_id="+jQuery("#post_ID").val();window.location=b}}},{"common/Ajax":2,"common/Config":4,"common/Notice":7}],10:[function(a,b,c){var d=a("extensions/clipboard/ClipboardController");b.exports={init:function(){var a=jQuery("#kontentblocks-clipboard");1==a.length&&new d({el:a.find(".inside")})}}},{"extensions/clipboard/ClipboardController":14}],11:[function(a,b,c){!function(b){a("extensions/LayoutConfigurations").init(),a("extensions/BackupUI").init(),a("extensions/Clipboard").init()}(jQuery)},{"extensions/BackupUI":9,"extensions/Clipboard":10,"extensions/LayoutConfigurations":12}],12:[function(a,b,c){var d=a("common/Logger"),e=a("common/Ajax"),f=a("common/Notice"),g=a("common/Config"),h={el:jQuery("#kb-layout-configurations"),init:function(){return KB.appData.config.frontend?!1:0===this.el.length?!1:(this.options={},this.areaConfig=this._areaConfig(),this.selectContainer=this._selectContainer(),this.selectMenuEl=this._createSelectMenu(),this.loadButton=this._loadButton(),this.deleteButton=this._deleteButton(),this.createContainer=this._createContainer(),this.createInput=this._createInput(),this.createButton=this._createButton(),void this.update())},_selectContainer:function(){return jQuery("<div class='select-container clearfix'>"+KB.i18n.Extensions.layoutConfigs.info+"</div>").appendTo(this.el)},_createSelectMenu:function(){return jQuery('<select name="kb-layout-configuration"></select>').appendTo(this.selectContainer),jQuery("select",this.el)},update:function(){var a=this;e.send({action:"getLayoutConfig",_ajax_nonce:g.getNonce("read"),data:{areaConfig:this.areaConfig}},function(b){a.options=b,a.renderSelectMenu(b)})},save:function(){var a=this,b=this.createInput.val();return _.isEmpty(b)?(f.notice("Please enter a Name for the template","error"),!1):void e.send({action:"setLayoutConfig",_ajax_nonce:g.getNonce("update"),data:{areaConfig:this.areaConfig,name:b}},function(b){a.update(),a.createInput.val(""),f.notice("Saved","success")})},"delete":function(){var a=this,b=this.selectMenuEl.val();return _.isEmpty(b)?(f.notice("Please chose a template to delete","error"),!1):void e.send({action:"deleteLayoutConfig",_ajax_nonce:g.getNonce("delete"),data:{areaConfig:this.areaConfig,name:b}},function(b){a.update(),f.notice("Deleted","success")})},renderSelectMenu:function(a){var b=this;b.selectMenuEl.empty(),_.each(a,function(a,c,d){b.selectMenuEl.append(_.template("<option value='<%= data.key %>'><%= data.name %></option>",{data:{key:c,name:a.name}}))})},_areaConfig:function(){var a="";return KB.payload.Areas&&_.each(KB.payload.Areas,function(b){a+=b.id,d.Debug.debug("Layout Configurations: Concat",a)}),this.hash(a.replace(",",""))},hash:function(a){return a.split("").reduce(function(a,b){return a=(a<<5)-a+b.charCodeAt(0),a&a},0)},_createContainer:function(){return jQuery("<div class='create-container'></div>").appendTo(this.el)},_createInput:function(){return jQuery("<input type='text' >").appendTo(this.createContainer)},_createButton:function(){var a=this,b=jQuery("<a class='button kb-lc-save'>Save</a>").appendTo(this.createContainer);return b.on("click",function(b){b.preventDefault(),a.save()}),b},_loadButton:function(){var a=this,b=jQuery("<a class='button-primary kb-lc-load'>Load</a>").appendTo(this.selectContainer);return b.on("click",function(b){b.preventDefault(),a.load()}),b},_deleteButton:function(){var a=this,b=jQuery("<a class='delete-js kb-lc-delete'>delete</a>").appendTo(this.selectContainer);return b.on("click",function(b){b.preventDefault(),a["delete"]()}),b},load:function(){var a=window.location.href+"&kb_load_configuration="+this.selectMenuEl.val()+"&post_id="+jQuery("#post_ID").val()+"&config="+this.areaConfig;window.location=a}};b.exports=h},{"common/Ajax":2,"common/Config":4,"common/Logger":6,"common/Notice":7}],13:[function(a,b,c){var d=a("common/Utilities");b.exports=Backbone.Collection.extend({initialize:function(){this.listenTo(this,"add",this.modelAdded)},modelAdded:function(a){var b=this.getStorage();b[a.get("mid")]=a.toJSON(),console.log(b),this.setStorage(b)},fetch:function(){this.ensureStorage(),this.set(this.getStorage())},ensureStorage:function(){var a=this.getStorage();a||this.clean()},clean:function(){this.reset()},getStorage:function(){return d.store.get("kb-clipboard")||{}},setStorage:function(a){console.log(a,"set"),d.store.set("kb-clipboard",a)}})},{"common/Utilities":8}],14:[function(a,b,c){var d=a("extensions/clipboard/ClipboardModel"),e=a("extensions/clipboard/controls/ClipboardControl"),f=a("extensions/clipboard/ClipboardCollection");b.exports=Backbone.View.extend({initialize:function(){var a=this;this.listenTo(KB.Modules,"add",function(b){a.listenTo(b,"module.model.view.connected",a.bindHandler)}),this.items=new f([],{model:d}),this.items.fetch()},bindHandler:function(a){this.listenTo(a,"module.view.setup.menu",this.addControl)},addControl:function(a,b,c){a.addItem(new e({model:b,parent:this}))},add:function(a){this.items.add(a.toJSON()),console.log(this.items)},entryExists:function(a){return!_.isUndefined(this.items.get("mid"))}})},{"extensions/clipboard/ClipboardCollection":13,"extensions/clipboard/ClipboardModel":15,"extensions/clipboard/controls/ClipboardControl":16}],15:[function(a,b,c){b.exports=Backbone.Model.extend({idAttribute:"mid",initialize:function(){}})},{}],16:[function(a,b,c){var d=a("backend/Views/BaseControlView"),e=a("common/Checks"),f=(a("common/Config"),a("common/Notice"),a("common/Ajax"),a("common/I18n"));b.exports=d.extend({initialize:function(a){this.options=a||{},this.ClipboardController=a.parent},className:"module-clipboard block-menu-icon",events:{click:"toggleClipboard"},attributes:function(){return this.model.get("state").active?{"data-kbtooltip":f.getString("Modules.controls.be.tooltips.status.off")}:{"data-kbtooltip":f.getString("Modules.controls.be.tooltips.status.on")}},toggleClipboard:function(){var a=this.model.get("mid");this.ClipboardController.entryExists(a)||this.ClipboardController.add(this.model)},isValid:function(){return!this.model.get("disabled")&&e.userCan("deactivate_kontentblocks")?!0:!1},success:function(){}})},{"backend/Views/BaseControlView":1,"common/Ajax":2,"common/Checks":3,"common/Config":4,"common/I18n":5,"common/Notice":7}]},{},[11]);