/*! Kontentblocks ProdVersion 2015-07-20 02:07 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=a("common/Notice");b.exports={send:function(a,b,c,e){var f,g=e||{};f=a.postId?a.postId:KB.Environment&&KB.Environment.postId?KB.Environment.postId:!1;var h=_.extend({supplemental:a.supplemental||{},nonce:jQuery("#_kontentblocks_ajax_nonce").val(),post_id:f,kbajax:!0},a);return jQuery("#publish").attr("disabled","disabled"),jQuery.ajax({url:ajaxurl,data:h,type:"POST",dataType:"json",success:function(a){a&&(c&&b?b.call(c,a,g):b&&b(a,g))},error:function(){d.notice("<p>Generic Ajax Error</p>","error")},complete:function(){jQuery("#publish").removeAttr("disabled")}})}}},{"common/Notice":4}],2:[function(a,b,c){var d=function(a){var b=KB.appData.config;return{get:function(a){return a?b[a]?b[a]:null:b},getNonce:function(a){var c=["update","create","delete","read"];return-1!==_.indexOf(c,a)?b.nonces[a]:(console.error("Invalid nonce requested in kb.cm.Config.js"),null)},inDevMode:function(){return b.env.dev},getRootURL:function(){return b.env.rootUrl},getFieldJsUrl:function(){return b.env.fieldJsUrl},getHash:function(){return b.env.hash}}}(jQuery);b.exports=d},{}],3:[function(a,b,c){var d=a("common/Config");Function.prototype.bind&&window.console&&"object"==typeof console.log&&["log","info","warn","error","assert","dir","clear","profile","profileEnd"].forEach(function(a){console[a]=this.bind(console[a],console)},Function.prototype.call),Logger.useDefaults();var e=Logger.get("_K"),f=Logger.get("_KS");e.setLevel(e.INFO),f.setLevel(f.INFO),d.inDevMode()||e.setLevel(Logger.OFF),Logger.setHandler(function(a,b){if(KB.Menubar&&2===b.level.value&&"_KS"===b.name)a[0]&&KB.Menubar.StatusBar.setMsg(a[0]);else{var c=window.console,d=c.log;b.name&&(a[0]="["+b.name+"] "+a[0]),b.level===Logger.WARN&&c.warn?d=c.warn:b.level===Logger.ERROR&&c.error?d=c.error:b.level===Logger.INFO&&c.info&&(d=c.info),d.apply(c,a)}}),b.exports={Debug:e,User:f}},{"common/Config":2}],4:[function(a,b,c){"use strict";b.exports={notice:function(a,b,c){var d=c||3;window.alertify.notify(a,b,d)},confirm:function(a,b,c,d,e){var f=a||"Title";window.alertify.confirm(f,b,function(){c.call(e)},function(){d.call(e)})}}},{}],5:[function(a,b,c){var d=a("common/Ajax"),e=a("common/Notice"),f=a("common/Config");b.exports={el:jQuery("#backup-inspect"),lastItem:null,firstRun:!0,init:function(){var a=this;this.listEl=jQuery("<ul></ul>").appendTo(this.el),this.listEl.length>0&&this.update(),jQuery(document).on("heartbeat-send",function(b,c){c.kbBackupWatcher=a.lastItem,c.post_id=KB.Environment.postId||0}),jQuery(document).on("heartbeat-tick",function(b,c){c.kbHasNewBackups&&_.isObject(c.kbHasNewBackups)&&a.renderList(c.kbHasNewBackups)})},update:function(){var a=this;d.send({action:"get_backups",_ajax_nonce:f.getNonce("read")},function(b){a.items=b,a.renderList(b)})},renderList:function(a){var b=this;this.listEl.empty(),_.each(a,function(a,c){b.lastItem=c,b.listEl.append(_.template("                <li>\n                    <details>\n                        <summary>\n                            <%= data.time %>\n                        </summary>\n                    <div class='actions' data-id='<%= key %>'>\n                        <span class='js-restore'>Restore</span>\n                        <p class='description'><b>Comment:</b> <%= item.msg %></p>\n                    </details>\n                </li>",{data:{time:new moment.unix(c).format("HH:mm:ss / DD.MMM")},item:a,key:c}))}),this.firstRun||e.notice("<p>"+KB.i18n.Extensions.backups.newBackupcreated+"</p>","success"),this.firstRun=!1,this.listEl.on("click",".js-restore",function(a){var c=jQuery(this).parent().attr("data-id");b.restore(c)})},restore:function(a){var b=window.location.href+"&restore_backup="+a+"&post_id="+jQuery("#post_ID").val();window.location=b}}},{"common/Ajax":1,"common/Config":2,"common/Notice":4}],6:[function(a,b,c){!function(b){a("extensions/LayoutConfigurations").init(),a("extensions/SidebarSelector").init(),a("extensions/BackupUI").init()}(jQuery)},{"extensions/BackupUI":5,"extensions/LayoutConfigurations":7,"extensions/SidebarSelector":8}],7:[function(a,b,c){var d=a("common/Logger"),e=a("common/Ajax"),f=a("common/Notice"),g=a("common/Config"),h={el:jQuery("#kb-layout-configurations"),init:function(){return KB.appData.config.frontend?!1:0===this.el.length?!1:(this.options={},this.areaConfig=this._areaConfig(),this.selectContainer=this._selectContainer(),this.selectMenuEl=this._createSelectMenu(),this.loadButton=this._loadButton(),this.deleteButton=this._deleteButton(),this.createContainer=this._createContainer(),this.createInput=this._createInput(),this.createButton=this._createButton(),void this.update())},_selectContainer:function(){return jQuery("<div class='select-container clearfix'>"+KB.i18n.Extensions.layoutConfigs.info+"</div>").appendTo(this.el)},_createSelectMenu:function(){return jQuery('<select name="kb-layout-configuration"></select>').appendTo(this.selectContainer),jQuery("select",this.el)},update:function(){var a=this;e.send({action:"getLayoutConfig",_ajax_nonce:g.getNonce("read"),data:{areaConfig:this.areaConfig}},function(b){a.options=b,a.renderSelectMenu(b)})},save:function(){var a=this,b=this.createInput.val();return _.isEmpty(b)?(f.notice("Please enter a Name for the template","error"),!1):void e.send({action:"setLayoutConfig",_ajax_nonce:g.getNonce("update"),data:{areaConfig:this.areaConfig,name:b}},function(b){a.update(),a.createInput.val(""),f.notice("Saved","success")})},"delete":function(){var a=this,b=this.selectMenuEl.val();return _.isEmpty(b)?(f.notice("Please chose a template to delete","error"),!1):void e.send({action:"deleteLayoutConfig",_ajax_nonce:g.getNonce("delete"),data:{areaConfig:this.areaConfig,name:b}},function(b){a.update(),f.notice("Deleted","success")})},renderSelectMenu:function(a){var b=this;b.selectMenuEl.empty(),_.each(a,function(a,c,d){b.selectMenuEl.append(_.template("<option value='<%= data.key %>'><%= data.name %></option>",{data:{key:c,name:a.name}}))})},_areaConfig:function(){var a="";return KB.payload.Areas&&_.each(KB.payload.Areas,function(b){a+=b.id,d.Debug.debug("Layout Configurations: Concat",a)}),this.hash(a.replace(",",""))},hash:function(a){return a.split("").reduce(function(a,b){return a=(a<<5)-a+b.charCodeAt(0),a&a},0)},_createContainer:function(){return jQuery("<div class='create-container'></div>").appendTo(this.el)},_createInput:function(){return jQuery("<input type='text' >").appendTo(this.createContainer)},_createButton:function(){var a=this,b=jQuery("<a class='button kb-lc-save'>Save</a>").appendTo(this.createContainer);return b.on("click",function(b){b.preventDefault(),a.save()}),b},_loadButton:function(){var a=this,b=jQuery("<a class='button-primary kb-lc-load'>Load</a>").appendTo(this.selectContainer);return b.on("click",function(b){b.preventDefault(),a.load()}),b},_deleteButton:function(){var a=this,b=jQuery("<a class='delete-js kb-lc-delete'>delete</a>").appendTo(this.selectContainer);return b.on("click",function(b){b.preventDefault(),a["delete"]()}),b},load:function(){var a=window.location.href+"&kb_load_configuration="+this.selectMenuEl.val()+"&post_id="+jQuery("#post_ID").val()+"&config="+this.areaConfig;window.location=a}};b.exports=h},{"common/Ajax":1,"common/Config":2,"common/Logger":3,"common/Notice":4}],8:[function(a,b,c){b.exports={$stage:null,areaToEdit:null,$editWrap:null,init:function(){return KB.appData.config.frontend?!1:void this.sortable()},sortable:function(){jQuery("#existing-areas, #active-dynamic-areas").sortable({connectWith:".connect",cancel:"li.ui-state-disabled",placeholder:"sortable-placeholder",helper:"clone",receive:function(a,b){item=b.item,id=jQuery(item).attr("id"),jQuery(item).toggleClass("dynamic-area-active"),"active-dynamic-areas"==this.id?(action="<span><a href=''>edit</a></span>",content="<input id='"+id+"_hidden' type='hidden' name='active_sidebar_areas[]' value='"+id+"' />",jQuery(item).append(content)):jQuery("input#"+id+"_hidden").remove()}})}}},{}]},{},[6]);