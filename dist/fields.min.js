/*! kontentblocks 2013-08-17 */
var KBCropImage;!function(a){KBCropImage={init:function(){return!1},tb_position:function(){thickbox=a(top.document).find("#TB_window"),frame=a(top.document).find("#TB_iframeContent"),winW=Math.round(.9*a(top.window).width()),winH=Math.round(.9*a(top.window).height()),width=960,a(frame).css({width:width+"px"}),a(thickbox).css("top:","10%"),a(thickbox).animate({width:width+"px",marginLeft:-width/2+"px"})},unload:function(){tb_remove()},insert:function(){id=KBCropImage.attachment_id,input=KBCropImage.cropImage,holder=KBCropImage.imageHolder,oldimg=a(holder).find("img"),a(input).val(id),a.post(ajaxurl,{action:"kb_get_crop_image",id:id},function(b){res=a.parseJSON(b),oldimg&&a(oldimg).remove(),a(holder).append("<img src="+res.src+" >"),KBCropImage.unload()})}},a(document).ready(KBCropImage.init)}(jQuery);var KBDate;!function(a){KBDate={init:function(){a(".datepicker").each(function(){a(this).datepicker({altField:a(this).closest("div").find(".altfield"),altFormat:"yy-mm-dd",dateFormat:"DD, MM d, yy",regional:"de"})}),a.datepicker.setDefaults(a.datepicker.regional.de)}},a(document).ready(KBDate.init)}(jQuery);var KBFile,input;!function(a){KBFile={init:function(){a("body").on("click","a.kb-add-file",function(b){input=a(this).prev(),type=a(this).attr("data-type"),b.preventDefault(),KBFile.start(type)})},start:function(b){a(window).bind("tb_unload",function(){KBFile.unload()}),window.original_send_to_editor=window.send_to_editor,post_id=a("#post_ID").val(),tb_show("","media-upload.php?post_id="+post_id+"&type="+b+"&tab=type&kb_change_iu=true&amp;TB_iframe=true"),window.send_to_editor=function(){a(input).val(kb_file_send_id),KBFile.unload(),tb_remove()}},unload:function(){window.send_to_editor=window.original_send_to_editor},remove:function(){}},a(document).ready(KBFile.init)}(jQuery);var KBFile,input;!function(a){KBFile={init:function(){a("body").on("click","a.kb-add-file",function(b){input=a(this).prev(),type=a(this).attr("data-type"),b.preventDefault(),KBFile.start(type)})},start:function(){MediaFrameBackup=wp.media.view.MediaFrame.Post.prototype.createStates,wp.media.view.MediaFrame.Post.prototype.createStates=function(){var a=this.options;media=wp.media,l10n=wp.media.view.l10n,l10n.insertIntoPost="Einfügen",this.states.add([new media.controller.Library({id:"insert",title:l10n.insertMediaTitle,priority:20,toolbar:"main-insert",filterable:"all",library:media.query(_.defaults({type:"document"}),a.library),multiple:"false",editable:!0,allowLocalEdits:!0,displaySettings:!1,displayUserSettings:!0})])},"undefined"!=typeof wp&&wp.media&&wp.media.editor&&wp.media.editor.open(activeBlock),backup=wp.media.editor.send.attachment,wp.media.editor.send.attachment=function(a,b){attach=b},a(window).bind("tb_unload",function(){KBFile.unload()}),window.original_send_to_editor=window.send_to_editor,window.send_to_editor=null,window.send_to_editor=function(){console.log(attach),a(input).val(attach.id),a(activeField).find(".description").append(attach.url),KBFile.unload(),tb_remove()}},unload:function(){window.send_to_editor=window.original_send_to_editor},remove:function(){}},a(document).ready(KBFile.init)}(jQuery);var KBImageGallery,KBInputs={};!function(a){var b,c,d=[],e={init:function(){a("body").on("click",".kb-add-gallery-images",function(a){e.start(),a.preventDefault()}),a("body").on("modal-close",function(){e.unload()}),a("body").on("click",".kb-field-gallery-image-delete",function(){e.remove(a(this))}),a("body").on("click",".kb-field-gallery-image-info",function(){e.getInfo(a(this))}),a("body").on("click",".kb-field-gallery-update",function(){e.update(a(this))}),a(".kb-field-gallery-wrapper").sortable()},setupInputs:function(){e.list=a(e.caller).find(".kb-field-gallery-wrapper"),e.post_id=a("#post_ID").val(),e.add=a(e.caller).find(".kb-add-gallery-images"),e.key=a(KBInputs.save_field).attr("data-key")},start:function(){e.caller=activeField,e.setupInputs(),c=wp.media.view.MediaFrame.Post.prototype.createStates,wp.media.view.MediaFrame.Post.prototype.createStates=function(){var a=this.options;media=wp.media,l10n=wp.media.view.l10n,l10n.insertIntoPost="Einfügen_",this.states.add([new media.controller.Library({id:"insert",title:l10n.insertMediaTitle,priority:20,toolbar:"main-insert",filterable:"image",library:media.query(_.defaults({type:"image"}),a.library),multiple:"add",editable:!1,allowLocalEdits:!1,displaySettings:!1,displayUserSettings:!1})])},"undefined"!=typeof wp&&wp.media&&wp.media.editor&&wp.media.editor.open(activeBlock),b=wp.media.editor.send.attachment,wp.media.editor.send.attachment=function(a,b){d.push(b)},window.original_send_to_editor=window.send_to_editor,KBInputs.image_frame=a(e.caller).find("kb-field-gallery-wrapper"),KBInputs.save_field=a(e.caller).find(".keyref"),KBInputs.key=a(KBInputs.save_field).attr("data-key"),data=[],data.attachments=d,data.post_id=a("#post_ID").val(),data.blockid=activeBlock,data.key=KBInputs.key,window.send_to_editor=function(){KB.ajax({action:"kb_gallery_get_images",attachments:data.attachments,key:data.key,blockid:data.blockid},function(b){"success"==b.status&&a.each(b.attachments,function(a,b){e.list.append(b)})}),e.unload()}},unload:function(){window.send_to_editor=window.original_send_to_editor,wp.media.editor.send.attachment=b,wp.media.view.MediaFrame.Post.prototype.createStates=c},remove:function(b){parent=a(b).closest("li"),parent.hasClass("todelete")?a(parent).removeClass("todelete").find("input").val(a(parent).attr("data-id")):a(parent).addClass("todelete").find("input").val("")}};a(document).ready(function(){e.init()})}(jQuery);var KBLink,input;!function(a){var b,c;KBLink={init:function(){a("body").on("click",".kb-add-link",function(b){b.preventDefault(),input=a(this).prev().attr("id"),KBLink.start(input)})},start:function(d){a("#wp-link").find(".link-target").hide().prev("div").hide(),wpActiveEditor=d,wpLink.open(),b=wpLink.htmlUpdate,c=wpLink.isMCE,wpLink.isMCE=function(){return!1},wpLink.htmlUpdate=function(){var a,b=wpLink.textarea;b&&(a=wpLink.getAttrs(),a.href&&"http://"!=a.href&&(jQuery(b).empty(),b.value=a.href,wpLink.close(),KBLink.close(),b.focus()))}},remove:function(){a("#"+activeBlock).find("input").each(function(){a(this).val("")})},close:function(){wpLink.isMCE=c,wpLink.htmlUpdate=b}},a(document).ready(KBLink.init)}(jQuery);var KBPageContent;!function(a){KBPageContent={init:function(){a("#kontentblocks_stage").on("change",".kb-chose-pt",function(b){b.preventDefault(),$value=a(this).val(),$container=a(this).parent().find(".kb-chose-pid"),caller=a(this).parent(),a.post(ajaxurl,{action:"get_post_list",post_type:$value},function(b){a($container).empty().append(b),a($container).trigger("liszt:updated"),excerptfor=a($container).val(),KBPageContent.get_excerpt(excerptfor,caller)})}),a("#kontentblocks_stage").on("change",".kb-chose-pid",function(){excerptfor=a(this).val(),caller=a(this).parent(),KBPageContent.get_excerpt(excerptfor,caller)})},get_excerpt:function(b,c){a.post(ajaxurl,{action:"get_post_excerpt",post_id:b},function(b){""==b&&(b="<p>No post content available for preview"),a(c).find(".page-content-preview").fadeTo(350,0,function(){a(this).empty().append(b),a(this).fadeTo(350,1)})})}},a(document).ready(KBPageContent.init)}(jQuery);var KBQuicktags,input;!function(a){KBQuicktags={init:function(){KBQuicktags.add(),a(document).bind("kb_block_added",function(){KBQuicktags.add()})},add:function(){a(".quicktags").each(function(){id=a(this).find("textarea").attr("id"),settings={id:id,buttons:"strong,em,link"},$check=a(this).find(".quicktags-toolbar").length,$check||(new QTags(settings),QTags._buttonsInit())})}},a(document).ready(KBQuicktags.init)}(jQuery);var KBRadioImages;!function(a){KBRadioImages={init:function(){a("body").on("click",".kb_radio_image",function(){a(this).prev().prop("checked",!0),console.log("click"),a(this).parent().parent().find(".kb_radio_image").each(function(){a(this).removeClass("kb_radio_selected")}),a(this).addClass("kb_radio_selected")})}},a(document).ready(KBRadioImages.init)}(jQuery);var KBSingleImage,KBInputs={};!function(a){KBSingleImage={init:function(){a("body").on("click",".kb-add-single-image",function(b){caller=a(this).parent().parent(),KBSingleImage.setupInputs(),KBSingleImage.start(),b.preventDefault()}),a("body").on("click",".kb-remove-single-image",function(b){caller=a(this).parent().parent(),KBSingleImage.setupInputs(),KBSingleImage.remove(),b.preventDefault()}),KBInputs.post_id=a("#post_ID").val()},setupInputs:function(){KBInputs.image_frame=a(caller).find(".kb-field-image-frame"),KBInputs.save_field=a(caller).find("input[type=hidden]"),KBInputs.remove=a(caller).find(".kb-remove-single-image"),KBInputs.add=a(caller).find(".kb-add-single-image"),KBInputs.key=a(KBInputs.save_field).attr("data-key")},start:function(){a(window).bind("tb_unload",function(){KBSingleImage.unload()}),window.original_send_to_editor=window.send_to_editor,KBInputs.image_frame=a(caller).find(".kb-field-image-frame"),KBInputs.save_field=a(caller).find("input[type=hidden]"),KBInputs.remove=a(caller).find(".kb-remove-single-image"),KBInputs.add=a(caller).find(".kb-add-single-image"),KBInputs.key=a(KBInputs.save_field).attr("data-key"),tb_show("","media-upload.php?post_id="+KBInputs.post_id+"&type=image&tab=type&kb_change_iu=true&TB_iframe=true"),window.send_to_editor=function(){KB.ajax({action:"kb_single_image_get_and_set",attachment_id:kb_attachment_id,blockid:activeBlock,post_id:a("#post_ID").val(),key:KBInputs.key},function(a){0!=a&&(KBInputs.save_field.val(kb_attachment_id),KBInputs.image_frame.fadeTo(500,0,function(){KBInputs.image_frame.empty(),KBInputs.image_frame.append(a),KBInputs.image_frame.fadeTo(500,1),KBInputs.remove.fadeTo(350,1),KBInputs.add.text("Change Image"),KB.notice("<p>Image added</p>")}))}),KBSingleImage.unload(),tb_remove()}},unload:function(){window.send_to_editor=window.original_send_to_editor},remove:function(){KB.ajax({action:"kb_single_image_remove",blockid:activeBlock,key:KBInputs.key,post_id:a("#post_ID").val()},function(b){1==b?(KBInputs.save_field.val(""),KBInputs.image_frame.find("img").fadeTo(350,.4,function(){a(this).remove(),KBInputs.remove.fadeTo(300,0),KBInputs.add.text("add Image")}),KB.notice("<p>Image removed</p>")):KB.notice("<p>There was a problem</p>")})}},a(document).ready(KBSingleImage.init)}(jQuery);var KBSingleImage,KBInputs={},attach,backup,freak;!function(a){KBSingleImage={init:function(){a("body").on("click",".kb-add-single-image",function(b){caller=a(this).parent().parent(),KBSingleImage.setupInputs(),KBSingleImage.start(),b.preventDefault()}),a("body").on("click",".kb-remove-single-image",function(b){caller=a(this).parent().parent(),KBSingleImage.setupInputs(),KBSingleImage.remove(),b.preventDefault()}),KBInputs.post_id=a("#post_ID").val()},setupInputs:function(){KBInputs.image_frame=a(caller).find(".kb-field-image-frame"),KBInputs.save_field=a(caller).find("input[type=hidden]"),KBInputs.remove=a(caller).find(".kb-remove-single-image"),KBInputs.add=a(caller).find(".kb-add-single-image"),KBInputs.key=a(KBInputs.save_field).attr("data-key")},start:function(){MediaFrameBackup=wp.media.view.MediaFrame.Post.prototype.createStates,wp.media.view.MediaFrame.Post.prototype.createStates=function(){var a=this.options;media=wp.media,l10n=wp.media.view.l10n,l10n.insertIntoPost="Einfügen",this.states.add([new media.controller.Library({id:"insert",title:l10n.insertMediaTitle,priority:20,toolbar:"main-insert",filterable:"all",library:media.query(_.defaults({type:"image"}),a.library),multiple:!1,editable:!0,allowLocalEdits:!0,displaySettings:!1,displayUserSettings:!0})])},"undefined"!=typeof wp&&wp.media&&wp.media.editor&&wp.media.editor.open(activeBlock),backup=wp.media.editor.send.attachment,wp.media.editor.send.attachment=function(a,b){attach=b},a(window).bind("tb_unload",function(){KBSingleImage.unload()}),window.original_send_to_editor=window.send_to_editor,window.send_to_editor=null,KBInputs.image_frame=a(caller).find(".kb-field-image-frame"),KBInputs.save_field=a(caller).find("input[type=hidden]"),KBInputs.remove=a(caller).find(".kb-remove-single-image"),KBInputs.add=a(caller).find(".kb-add-single-image"),KBInputs.key=a(KBInputs.save_field).attr("data-key"),window.send_to_editor=function(){KB.ajax({action:"kb_single_image_get_and_set",attachment_id:attach.id,blockid:activeBlock,post_id:a("#post_ID").val(),key:KBInputs.key},function(a){console.log(a),a.success===!0&&(KBInputs.save_field.val(attach.id),KBInputs.image_frame.fadeTo(500,0,function(){KBInputs.image_frame.empty(),KBInputs.image_frame.append(a.data),KBInputs.image_frame.fadeTo(500,1),KBInputs.remove.fadeTo(350,1),KBInputs.add.text("Change Image"),KB.notice("<p>Image added</p>")}))}),KBSingleImage.unload(),tb_remove()}},unload:function(){window.send_to_editor=window.original_send_to_editor,wp.media.editor.send.attachment=backup,wp.media.view.MediaFrame.Post.prototype.createStates=MediaFrameBackup},remove:function(){KB.ajax({action:"kb_single_image_remove",blockid:activeBlock,key:KBInputs.key,post_id:a("#post_ID").val()},function(b){1==b?(KBInputs.save_field.val(""),KBInputs.image_frame.find("img").fadeTo(350,.4,function(){a(this).remove(),KBInputs.remove.fadeTo(300,0),KBInputs.add.text("add Image")}),KB.notice("<p>Image removed</p>")):KB.notice("<p>There was a problem</p>")})}},a(document).ready(KBSingleImage.init)}(jQuery),function(a){function b(){this._disabledInputs=[],this.regional=[],this.regional[""]={show24Hours:!1,separator:":",ampmPrefix:"",ampmNames:["AM","PM"],spinnerTexts:["Now","Previous field","Next field","Increment","Decrement"]},this._defaults={appendText:"",showSeconds:!1,timeSteps:[1,1,1],initialField:0,noSeparatorEntry:!1,useMouseWheel:!0,defaultTime:null,minTime:null,maxTime:null,spinnerImage:"spinnerDefault.png",spinnerSize:[20,20,8],spinnerBigImage:"",spinnerBigSize:[40,40,16],spinnerIncDecOnly:!1,spinnerRepeat:[500,250],beforeShow:null,beforeSetTime:null},a.extend(this._defaults,this.regional[""])}function c(b,c){return"option"==b&&(0==c.length||1==c.length&&"string"==typeof c[0])?!0:a.inArray(b,d)>-1}a.extend(b.prototype,{markerClassName:"hasTimeEntry",propertyName:"timeEntry",_appendClass:"timeEntry_append",_controlClass:"timeEntry_control",_expandClass:"timeEntry_expand",setDefaults:function(b){return a.extend(this._defaults,b||{}),this},_attachPlugin:function(b,c){var d=a(b);if(!d.hasClass(this.markerClassName)){var f={options:a.extend({},this._defaults,c),input:d,_field:0,_selectedHour:0,_selectedMinute:0,_selectedSecond:0};d.data(this.propertyName,f).addClass(this.markerClassName).bind("focus."+this.propertyName,this._doFocus).bind("blur."+this.propertyName,this._doBlur).bind("click."+this.propertyName,this._doClick).bind("keydown."+this.propertyName,this._doKeyDown).bind("keypress."+this.propertyName,this._doKeyPress).bind("paste."+this.propertyName,function(){setTimeout(function(){e._parseTime(f)},1)}),this._optionPlugin(b,c)}},_optionPlugin:function(b,c,d){b=a(b);var e=b.data(this.propertyName);if(!c||"string"==typeof c&&null==d){var f=c;return c=(e||{}).options,c&&f?c[f]:c}if(b.hasClass(this.markerClassName)){if(c=c||{},"string"==typeof c){var f=c;c={},c[f]=d}var g=this._extractTime(e);a.extend(e.options,c),e._field=0,g&&this._setTime(e,new Date(0,0,0,g[0],g[1],g[2])),b.next("span."+this._appendClass).remove(),b.parent().find("span."+this._controlClass).remove(),a.fn.mousewheel&&b.unmousewheel();var h=e.options.spinnerImage?a('<span class="'+this._controlClass+'" style="display: inline-block; '+"background: url('"+e.options.spinnerImage+"') 0 0 no-repeat; width: "+e.options.spinnerSize[0]+"px; height: "+e.options.spinnerSize[1]+'px;"></span>'):null;b.after(e.options.appendText?'<span class="'+this._appendClass+'">'+e.options.appendText+"</span>":"").after(h||""),e.options.useMouseWheel&&a.fn.mousewheel&&b.mousewheel(this._doMouseWheel),h&&h.mousedown(this._handleSpinner).mouseup(this._endSpinner).mouseover(this._expandSpinner).mouseout(this._endSpinner).mousemove(this._describeSpinner)}},_enablePlugin:function(a){this._enableDisable(a,!1)},_disablePlugin:function(a){this._enableDisable(a,!0)},_enableDisable:function(b,c){var d=a.data(b,this.propertyName);d&&(b.disabled=c,b.nextSibling&&"span"==b.nextSibling.nodeName.toLowerCase()&&e._changeSpinner(d,b.nextSibling,c?5:-1),e._disabledInputs=a.map(e._disabledInputs,function(a){return a==b?null:a}),c&&e._disabledInputs.push(b))},_isDisabledPlugin:function(b){return a.inArray(b,this._disabledInputs)>-1},_destroyPlugin:function(b){b=a(b),b.hasClass(this.markerClassName)&&(b.removeClass(this.markerClassName).removeData(this.propertyName).unbind("."+this.propertyName),a.fn.mousewheel&&b.unmousewheel(),this._disabledInputs=a.map(this._disabledInputs,function(a){return a==b[0]?null:a}),b.siblings("."+this._appendClass+",."+this._controlClass).remove())},_setTimePlugin:function(b,c){var d=a.data(b,this.propertyName);d&&(null===c||""===c?d.input.val(""):this._setTime(d,c?"object"==typeof c?new Date(c.getTime()):c:null))},_getTimePlugin:function(b){var c=a.data(b,this.propertyName),d=c?this._extractTime(c):null;return d?new Date(0,0,0,d[0],d[1],d[2]):null},_getOffsetPlugin:function(b){var c=a.data(b,this.propertyName),d=c?this._extractTime(c):null;return d?1e3*(3600*d[0]+60*d[1]+d[2]):0},_doFocus:function(b){var c=b.nodeName&&"input"==b.nodeName.toLowerCase()?b:this;if(e._lastInput==c||e._isDisabledPlugin(c))return e._focussed=!1,void 0;var d=a.data(c,e.propertyName);e._focussed=!0,e._lastInput=c,e._blurredInput=null,a.extend(d.options,a.isFunction(d.options.beforeShow)?d.options.beforeShow.apply(c,[c]):{}),e._parseTime(d),setTimeout(function(){e._showField(d)},10)},_doBlur:function(){e._blurredInput=e._lastInput,e._lastInput=null},_doClick:function(b){var c=b.target,d=a.data(c,e.propertyName);if(!e._focussed){var f=d.options.separator.length+2;if(d._field=0,null!=c.selectionStart)for(var g=0;g<=Math.max(1,d._secondField,d._ampmField);g++){var h=g!=d._ampmField?g*f+2:d._ampmField*f+d.options.ampmPrefix.length+d.options.ampmNames[0].length;if(d._field=g,c.selectionStart<h)break}else if(c.createTextRange)for(var i=a(b.srcElement),j=c.createTextRange(),k=function(a){return{thin:2,medium:4,thick:6}[a]||a},l=b.clientX+document.documentElement.scrollLeft-(i.offset().left+parseInt(k(i.css("border-left-width")),10))-j.offsetLeft,g=0;g<=Math.max(1,d._secondField,d._ampmField);g++){var h=g!=d._ampmField?g*f+2:d._ampmField*f+d.options.ampmPrefix.length+d.options.ampmNames[0].length;if(j.collapse(),j.moveEnd("character",h),d._field=g,l<j.boundingWidth)break}}e._showField(d),e._focussed=!1},_doKeyDown:function(b){if(b.keyCode>=48)return!0;var c=a.data(b.target,e.propertyName);switch(b.keyCode){case 9:return b.shiftKey?e._changeField(c,-1,!0):e._changeField(c,1,!0);case 35:b.ctrlKey?e._setValue(c,""):(c._field=Math.max(1,c._secondField,c._ampmField),e._adjustField(c,0));break;case 36:b.ctrlKey?e._setTime(c):(c._field=0,e._adjustField(c,0));break;case 37:e._changeField(c,-1,!1);break;case 38:e._adjustField(c,1);break;case 39:e._changeField(c,1,!1);break;case 40:e._adjustField(c,-1);break;case 46:e._setValue(c,"");break;default:return!0}return!1},_doKeyPress:function(b){var c=String.fromCharCode(void 0==b.charCode?b.keyCode:b.charCode);if(" ">c)return!0;var d=a.data(b.target,e.propertyName);return e._handleKeyPress(d,c),!1},_doMouseWheel:function(b,c){if(!e._isDisabledPlugin(b.target)){var d=a.data(b.target,e.propertyName);d.input.focus(),d.input.val()||e._parseTime(d),e._adjustField(d,c),b.preventDefault()}},_expandSpinner:function(b){var c=e._getSpinnerTarget(b),d=a.data(e._getInput(c),e.propertyName);if(!e._isDisabledPlugin(d.input[0])&&d.options.spinnerBigImage){d._expanded=!0;var f=a(c).offset(),g=null;a(c).parents().each(function(){var b=a(this);return("relative"==b.css("position")||"absolute"==b.css("position"))&&(g=b.offset()),!g}),a('<div class="'+e._expandClass+'" style="position: absolute; left: '+(f.left-(d.options.spinnerBigSize[0]-d.options.spinnerSize[0])/2-(g?g.left:0))+"px; top: "+(f.top-(d.options.spinnerBigSize[1]-d.options.spinnerSize[1])/2-(g?g.top:0))+"px; width: "+d.options.spinnerBigSize[0]+"px; height: "+d.options.spinnerBigSize[1]+"px; background: transparent url("+d.options.spinnerBigImage+') no-repeat 0px 0px; z-index: 10;"></div>').mousedown(e._handleSpinner).mouseup(e._endSpinner).mouseout(e._endExpand).mousemove(e._describeSpinner).insertAfter(c)}},_getInput:function(b){return a(b).siblings("."+e.markerClassName)[0]},_describeSpinner:function(b){var c=e._getSpinnerTarget(b),d=a.data(e._getInput(c),e.propertyName);c.title=d.options.spinnerTexts[e._getSpinnerRegion(d,b)]},_handleSpinner:function(b){var c=e._getSpinnerTarget(b),d=e._getInput(c);if(!e._isDisabledPlugin(d)){d==e._blurredInput&&(e._lastInput=d,e._blurredInput=null);var f=a.data(d,e.propertyName);e._doFocus(d);var g=e._getSpinnerRegion(f,b);e._changeSpinner(f,c,g),e._actionSpinner(f,g),e._timer=null,e._handlingSpinner=!0,g>=3&&f.options.spinnerRepeat[0]&&(e._timer=setTimeout(function(){e._repeatSpinner(f,g)},f.options.spinnerRepeat[0]),a(c).one("mouseout",e._releaseSpinner).one("mouseup",e._releaseSpinner))}},_actionSpinner:function(a,b){switch(a.input.val()||e._parseTime(a),b){case 0:this._setTime(a);break;case 1:this._changeField(a,-1,!1);break;case 2:this._changeField(a,1,!1);break;case 3:this._adjustField(a,1);break;case 4:this._adjustField(a,-1)}},_repeatSpinner:function(a,b){e._timer&&(e._lastInput=e._blurredInput,this._actionSpinner(a,b),this._timer=setTimeout(function(){e._repeatSpinner(a,b)},a.options.spinnerRepeat[1]))},_releaseSpinner:function(){clearTimeout(e._timer),e._timer=null},_endExpand:function(b){e._timer=null;var c=e._getSpinnerTarget(b),d=e._getInput(c),f=a.data(d,e.propertyName);a(c).remove(),f._expanded=!1},_endSpinner:function(b){e._timer=null;var c=e._getSpinnerTarget(b),d=e._getInput(c),f=a.data(d,e.propertyName);e._isDisabledPlugin(d)||e._changeSpinner(f,c,-1),e._handlingSpinner&&(e._lastInput=e._blurredInput),e._lastInput&&e._handlingSpinner&&e._showField(f),e._handlingSpinner=!1},_getSpinnerTarget:function(a){return a.target||a.srcElement},_getSpinnerRegion:function(b,c){var d=this._getSpinnerTarget(c),e=a(d).offset(),f=[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop],g=b.options.spinnerIncDecOnly?99:c.clientX+f[0]-e.left,h=c.clientY+f[1]-e.top,i=b.options[b._expanded?"spinnerBigSize":"spinnerSize"],j=b.options.spinnerIncDecOnly?99:i[0]-1-g,k=i[1]-1-h;if(i[2]>0&&Math.abs(g-j)<=i[2]&&Math.abs(h-k)<=i[2])return 0;var l=Math.min(g,h,j,k);return l==g?1:l==j?2:l==h?3:4},_changeSpinner:function(b,c,d){a(c).css("background-position","-"+(d+1)*b.options[b._expanded?"spinnerBigSize":"spinnerSize"][0]+"px 0px")},_parseTime:function(a){var b=this._extractTime(a);if(b)a._selectedHour=b[0],a._selectedMinute=b[1],a._selectedSecond=b[2];else{var c=this._constrainTime(a);a._selectedHour=c[0],a._selectedMinute=c[1],a._selectedSecond=a.options.showSeconds?c[2]:0}a._secondField=a.options.showSeconds?2:-1,a._ampmField=a.options.show24Hours?-1:a.options.showSeconds?3:2,a._lastChr="",a._field=Math.max(0,Math.min(Math.max(1,a._secondField,a._ampmField),a.options.initialField)),""!=a.input.val()&&this._showTime(a)},_extractTime:function(a,b){b=b||a.input.val();var c=b.split(a.options.separator);if(""==a.options.separator&&""!=b&&(c[0]=b.substring(0,2),c[1]=b.substring(2,4),c[2]=b.substring(4,6)),c.length>=2){var d=!a.options.show24Hours&&b.indexOf(a.options.ampmNames[0])>-1,e=!a.options.show24Hours&&b.indexOf(a.options.ampmNames[1])>-1,f=parseInt(c[0],10);f=isNaN(f)?0:f,f=((d||e)&&12==f?0:f)+(e?12:0);var g=parseInt(c[1],10);g=isNaN(g)?0:g;var h=c.length>=3?parseInt(c[2],10):0;return h=isNaN(h)||!a.options.showSeconds?0:h,this._constrainTime(a,[f,g,h])}return null},_constrainTime:function(a,b){var c=null!=b;if(!c){var d=this._determineTime(a.options.defaultTime,a)||new Date;b=[d.getHours(),d.getMinutes(),d.getSeconds()]}for(var e=!1,f=0;f<a.options.timeSteps.length;f++)e?b[f]=0:a.options.timeSteps[f]>1&&(b[f]=Math.round(b[f]/a.options.timeSteps[f])*a.options.timeSteps[f],e=!0);return b},_showTime:function(a){var b=this._formatNumber(a.options.show24Hours?a._selectedHour:(a._selectedHour+11)%12+1)+a.options.separator+this._formatNumber(a._selectedMinute)+(a.options.showSeconds?a.options.separator+this._formatNumber(a._selectedSecond):"")+(a.options.show24Hours?"":a.options.ampmPrefix+a.options.ampmNames[a._selectedHour<12?0:1]);this._setValue(a,b),this._showField(a)},_showField:function(a){var b=a.input[0];if(!a.input.is(":hidden")&&e._lastInput==b){var c=a.options.separator.length+2,d=a._field!=a._ampmField?a._field*c:a._ampmField*c-a.options.separator.length+a.options.ampmPrefix.length,f=d+(a._field!=a._ampmField?2:a.options.ampmNames[0].length);if(b.setSelectionRange)b.setSelectionRange(d,f);else if(b.createTextRange){var g=b.createTextRange();g.moveStart("character",d),g.moveEnd("character",f-a.input.val().length),g.select()}b.disabled||b.focus()}},_formatNumber:function(a){return(10>a?"0":"")+a},_setValue:function(a,b){b!=a.input.val()&&a.input.val(b).trigger("change")},_changeField:function(a,b,c){var d=""==a.input.val()||a._field==(-1==b?0:Math.max(1,a._secondField,a._ampmField));return d||(a._field+=b),this._showField(a),a._lastChr="",d&&c},_adjustField:function(a,b){""==a.input.val()&&(b=0),this._setTime(a,new Date(0,0,0,a._selectedHour+(0==a._field?b*a.options.timeSteps[0]:0)+(a._field==a._ampmField?12*b:0),a._selectedMinute+(1==a._field?b*a.options.timeSteps[1]:0),a._selectedSecond+(a._field==a._secondField?b*a.options.timeSteps[2]:0)))},_setTime:function(b,c){c=this._determineTime(c,b);var d=this._constrainTime(b,c?[c.getHours(),c.getMinutes(),c.getSeconds()]:null);c=new Date(0,0,0,d[0],d[1],d[2]);var c=this._normaliseTime(c),e=this._normaliseTime(this._determineTime(b.options.minTime,b)),f=this._normaliseTime(this._determineTime(b.options.maxTime,b));c=e&&e>c?e:f&&c>f?f:c,a.isFunction(b.options.beforeSetTime)&&(c=b.options.beforeSetTime.apply(b.input[0],[this._getTimePlugin(b.input[0]),c,e,f])),b._selectedHour=c.getHours(),b._selectedMinute=c.getMinutes(),b._selectedSecond=c.getSeconds(),this._showTime(b)},_determineTime:function(a,b){var c=function(a){var b=new Date;return b.setTime(b.getTime()+1e3*a),b},d=function(a){var c=e._extractTime(b,a),d=new Date,f=c?c[0]:d.getHours(),g=c?c[1]:d.getMinutes(),h=c?c[2]:d.getSeconds();if(!c)for(var i=/([+-]?[0-9]+)\s*(s|S|m|M|h|H)?/g,j=i.exec(a);j;){switch(j[2]||"s"){case"s":case"S":h+=parseInt(j[1],10);break;case"m":case"M":g+=parseInt(j[1],10);break;case"h":case"H":f+=parseInt(j[1],10)}j=i.exec(a)}return d=new Date(0,0,10,f,g,h,0),/^!/.test(a)&&(d.getDate()>10?d=new Date(0,0,10,23,59,59):d.getDate()<10&&(d=new Date(0,0,10,0,0,0))),d};return a?"string"==typeof a?d(a):"number"==typeof a?c(a):a:null},_normaliseTime:function(a){return a?(a.setFullYear(1900),a.setMonth(0),a.setDate(0),a):null},_handleKeyPress:function(a,b){if(b==a.options.separator)this._changeField(a,1,!1);else if(b>="0"&&"9">=b){var c=parseInt(b,10),d=parseInt(a._lastChr+b,10),e=0!=a._field?a._selectedHour:a.options.show24Hours?24>d?d:c:(d>=1&&12>=d?d:c>0?c:a._selectedHour)%12+(a._selectedHour>=12?12:0),f=1!=a._field?a._selectedMinute:60>d?d:c,g=a._field!=a._secondField?a._selectedSecond:60>d?d:c,h=this._constrainTime(a,[e,f,g]);this._setTime(a,new Date(0,0,0,h[0],h[1],h[2])),a.options.noSeparatorEntry&&a._lastChr?this._changeField(a,1,!1):a._lastChr=b}else if(!a.options.show24Hours&&(b=b.toLowerCase(),b==a.options.ampmNames[0].substring(0,1).toLowerCase()&&a._selectedHour>=12||b==a.options.ampmNames[1].substring(0,1).toLowerCase()&&a._selectedHour<12)){var i=a._field;a._field=a._ampmField,this._adjustField(a,1),a._field=i,this._showField(a)}}});var d=["getOffset","getTime","isDisabled"];a.fn.timeEntry=function(b){var d=Array.prototype.slice.call(arguments,1);return c(b,d)?e["_"+b+"Plugin"].apply(e,[this[0]].concat(d)):this.each(function(){if("string"==typeof b){if(!e["_"+b+"Plugin"])throw"Unknown command: "+b;e["_"+b+"Plugin"].apply(e,[this].concat(d))}else{var c=a.fn.metadata?a(this).metadata():{};e._attachPlugin(this,a.extend({},c,b||{}))}})};var e=a.timeEntry=new b}(jQuery),jQuery(document).ready(function(){jQuery(".kb-time-picker").timeEntry({show24Hours:!0})});var KBkvm;!function(a){KBkvm={init:function(){a("body").on("click",".kvm_add_item",function(b){var c=a("#"+activeBlock+" .clone-reference-empty:first");b.preventDefault(),a(c).clone().prependTo("#"+activeBlock+" .kvm-field-wrapper").removeClass("clone-reference-empty")}),a(".sortable").sortable()}},a(document).ready(KBkvm.init)}(jQuery),function(a){"use strict";a(document).ready(function(){var b=a(".kb-color-picker");b.wpColorPicker({change:function(a){console.log(a.target)},clear:function(){pickColor("")}})})}(jQuery),jQuery(document).ready(function(a){KBPlupload.init(),a(document).on("kb_block_added",function(){KBInputs.plupload_init||KBPlupload.init(),a(".tabs").tabs(),KBPlupload.plupload(),KBPlupload.sortable()}),a(document).on("click",".plupload-image-item img",function(){$this=this,a($this).closest("li").toggleClass("details")})});var KBPlupload,kb_uploaders;!function(a){var b={},c=null,d=null;KBPlupload={init:function(){KBInputs.plupload_init=!0,KBPlupload.plupload(),a(".tabs").tabs(),KBPlupload.sortable(),a(document).on("click"," ul.kb-gallery-tab-list li",function(b){b.preventDefault(),a(this).toggleClass("chosen")}),a(document).on("click",".kb_plupload_image-wrap a",function(b){b.preventDefault(),KBPlupload.deleteItem(a(this))}),a(document).on("click",".gallery-tab-add",function(b){b.preventDefault(),post_id=a("#post_ID").val(),blockid=activeBlock,key=a(this).closest(".kb_block").find(".field-key").val(),a(".kb-gallery-tab-list li.chosen").each(function(){el=a(this),id=a(this).attr("data-id"),a(this).removeClass("chosen"),KBPlupload.getImageMarkup(id,blockid,key)})}),a("body").on("keyup",".kb-search",function(b){27==b.keyCode||""==a(this).val()?(a(this).val(""),a("#"+activeBlock+" .media-library li").show().addClass("visible")):KBPlupload.filterData("#"+activeBlock+" .item-description h4",a(this).val())})},sortable:function(){a(".kb-plupload-list").sortable({helper:"clone",placeholder:"ui-state-highlight"})},plupload:function(){a("input:hidden.kb-plupload-id").each(function(){prefix=a(this).val(),key=a(this).closest(".kb_block").find(".field-key").val(),blockid=a(this).closest(".kb_block").find(".block-id").val(),kb_plupload_init=a.extend({container:prefix+"-container",browse_button:prefix+"-browse-button",drop_element:prefix+"-dragdrop"},kb_plupload_defaults),b[prefix]=new plupload.Uploader(kb_plupload_init),b[prefix].init(),b[prefix].bind("FilesAdded",function(b,e){c=104857600,d=parseInt(b.settings.max_file_size,10),a.each(e,function(b,c){c.size>=d?alert("Too large"):(a("#"+activeBlock+" .kb-queue").append('<div id="'+c.id+'">'+c.name+" ("+plupload.formatSize(c.size)+") <b></b>"+'<div id="'+c.id+'_progress"></div>'+"</div>"),a("#"+c.id+"_progress").progressbar({value:0}))}),b.refresh(),b.start()}),b[prefix].bind("BeforeUpload",function(b){key=a("#"+activeBlock).find(".field-key").val(),b.settings.multipart_params.blockid=activeBlock,b.settings.multipart_params.field_key=key}),b[prefix].bind("Error",function(a,b){alert("Error occured."),a.removeFile(b.file)}),b[prefix].bind("UploadProgress",function(b,c){a("#"+c.id+" b").html(c.percent+"%"),a("#"+c.id+"_progress").progressbar({value:parseInt(c.percent)})}),b[prefix].bind("UploadComplete",function(){a("#"+activeBlock+" .kb-queue div").each(function(b){a(this).delay(150*b).fadeTo(300,0,function(){a(this).remove()})})}),b[prefix].bind("FileUploaded",function(b,c,d){var e=d;e=a.parseJSON(e.response),img_id=e.data,img_src=e.supplemental.thumbnail,blockid=e.supplemental.blockid,key=e.supplemental.key,KBPlupload.getImageMarkup(img_id,blockid,key)})})},imageResort:function(b,c,d,e){serialized=a(b).sortable("serialize",{key:"id[]"}),a.post(ajaxurl,{action:"kb-field-plupload-resort",blockid:d,serialized:serialized,post_id:c,key:e},function(a){1==a?KB.notice("<p>Sorting successful!</p>"):KB.errornotice("error while updateing")
})},updateMeta:function(b,c,d,e,f){a.post(ajaxurl,{action:"kb_field_plupload_update",blockid:d,attachment:c,post_id:b,key:e},function(b){1==b?(KBPlupload.getImageMarkup(c,d),a(f).removeClass("chosen").addClass("exists")):alert("error while updateing")})},getImageMarkup:function(b,c,d){a.post(ajaxurl,{action:"kb_field_plupload_img",blockid:c,attachment:b,key:d},function(b){container=a("#"+activeBlock).find(".kb-plupload-list"),newitem=a(b).hide(),a(container).append(newitem),a(newitem).fadeTo(800,1)},"html")},deleteItem:function(b){blockid=activeBlock,item=a(b).closest("li"),attachment=a(b).closest("li").attr("data-id"),key=a(b).closest(".kb_block").find(".field-key").val(),post_id=a("#post_ID").val(),a.post(ajaxurl,{action:"kb_plupload_delete_item",blockid:blockid,attachment:attachment,key:key,post_id:post_id},function(){a(item).fadeTo(500,0,function(){a(this).remove()}),a(".kb-gallery-tab-list")&&a('[data-id="'+attachment+'"]').removeClass("exists")})},filterData:function(b,c){c=a.trim(c),c=c.replace(/ /gi,"|"),a(b).each(function(){a(this).text().search(new RegExp(c,"i"))<0?a(this).closest("li").hide().removeClass("visible"):a(this).closest("li").show().addClass("visible")})}}}(jQuery);